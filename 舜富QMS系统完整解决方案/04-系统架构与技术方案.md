# 安徽舜富精密压铸科技有限公司 QMS质量管理系统

**分册4：系统架构与技术方案**

---

## 一、总体架构设计

### 1.1 系统分层架构

QMS系统采用分层架构设计，确保系统的可扩展性、可维护性和高可用性。

**表示层（Presentation Layer）**
- Web管理控制台：支持PC端访问，提供完整的管理功能
- 质量数据大屏：实时展示质量KPI、趋势分析、异常预警
- 移动端应用：支持iOS/Android/小程序，支持现场办公
- 客户门户：支持客户查看质量数据、提交反馈、追踪处理进度

**应用层（Application Layer）**
- 核心业务引擎：APQP/PPAP、FMEA、SPC、MSA等核心业务逻辑
- 业务功能模块：变化点管理、CAPA、围堵单、QRQC等25个功能模块
- 工作流引擎：支持复杂业务流程的配置和执行
- 权限管理引擎：基于角色的访问控制和权限管理

**集成层（Integration Layer）**
- API网关：统一对外接口，支持多种协议和认证
- 服务发现：Nacos服务注册发现，支持动态服务路由
- 消息中间件：RabbitMQ异步消息队列，支持事件驱动
- 数据同步：支持与现有系统的双向数据同步

**数据层（Data Layer）**
- 关系数据库：PostgreSQL存储核心业务数据和用户权限数据
- 时序数据库：InfluxDB存储SPC过程数据和性能监控数据
- 文档数据库：MongoDB存储质量文档、知识库、附件等非结构化数据
- 缓存层：Redis集群提供高性能缓存和分布式锁

### 1.2 微服务架构设计

采用Spring Cloud微服务架构，将系统拆分为多个独立的服务，实现解耦和独立部署。

**服务拆分原则**：
- 按业务领域拆分：质量管理、供应商管理、客户管理等
- 按技术能力拆分：数据分析、报表服务、文件服务等
- 按数据类型拆分：结构化数据、时序数据、文档数据

**服务注册与发现**：
- 使用Nacos作为服务注册中心
- 支持服务自动注册和健康检查
- 支持服务元数据管理和查询
- 支持多环境隔离（开发、测试、生产）

**服务治理**：
- 使用Sentinel进行限流和熔断
- 支持多维度限流策略（QPS、并发、线程等）
- 支持服务降级和熔断策略
- 支持实时监控和告警

**配置管理**：
- 使用Nacos配置中心
- 支持配置的动态刷新和热更新
- 支持多环境配置管理
- 支持配置版本控制和回滚

---

## 二、技术架构选型

### 2.1 后端技术选型

**开发框架选型**：
- Spring Boot 3.x：轻量级快速开发框架
- Spring Cloud 2022.x：微服务开发套件
- Spring Security：安全认证和授权框架
- MyBatis Plus：持久层框架

**数据库选型对比**：

| 数据库 | 用途 | 优势 | 劣势 | 选型理由 |
|--------|------|------|------|----------|
| PostgreSQL | 关系数据 | ACID特性、JSON支持、丰富数据类型 | 占用资源较多 | 核心业务数据存储 |
| InfluxDB | 时序数据 | 高性能时序读写、数据压缩 | 学习曲线较陡 | SPC过程数据和监控数据 |
| MongoDB | 文档数据 | 灵活文档结构、全文搜索 | 强一致性要求低 | 质量文档和知识库 |

**中间件选型**：
- Redis 7.x集群：分布式缓存，支持主从哨兵
- RabbitMQ 3.12：消息队列，支持集群和高可用
- Elasticsearch 8.x：全文搜索引擎，支持分布式部署

### 2.2 前端技术选型

**技术栈对比分析**：

| 技术 | 用途 | 选型理由 |
|------|------|----------|
| Vue.js 3.x | Web前端框架 | 生态成熟、性能优秀、组件丰富 |
| Element Plus | UI组件库 | 丰富的企业级组件、开箱即用 |
| ECharts 5.x | 数据可视化 | 图表类型丰富、性能优异 |
| DataV | 大屏可视化 | 支持复杂大屏、效果炫酷 |
| Uni-app | 移动端框架 | 一套代码多端发布、生态丰富 |

### 2.3 部署架构选型

**容器化技术选型**：
- Docker：应用容器化，标准化部署环境
- Kubernetes：容器编排，支持自动扩缩容
- Harbor：私有镜像仓库，镜像安全管理

**云原生技术选型**：
- 支持私有云部署：企业数据中心
- 支持公有云部署：阿里云、腾讯云、华为云
- 支持混合云部署：核心系统私有云+ 扩展功能公有云

**服务网格选型**：
- Istio：服务网格，支持流量管理和安全
- 支持服务间通信的监控和追踪
- 支持金丝发布和回滚

---

## 三、部署架构规划

### 3.1 网络架构设计

**网络拓扑**：
```
                        ┌──────────────────┐
                        │   防火墙集群   │
                        └──────────────────┘
                                │
                                ▼
        ┌────────────────────────────────────┐
        │         负载均衡器              │
        │  (Nginx + Keepalived)           │
        └────────────────────────────────────┘
                                │
                ┌───────────────────┴───────────────────┐
                │         应用服务器集群1         │                 │
                │  (3节点)                │                 │
                └─────────────────────────────────┘                 │
                                │                        ┌─────────────────────────────────┐
                ┌────────────────────────────────────┐           │                 │
                │         应用服务器集群2         │           │                 │
                │  (3节点)                │           │                 │
                └─────────────────────────────────┘           │                 │
                                │                        ┌─────────────────────────────────┐
                ┌────────────────────────────────────┐           │                 │
                │         数据服务层              │           │                 │
                │  ┌─────────┐ ┌─────────┐ ┌─────────┐           │                 │
                │  │PostgreSQL│ │ InfluxDB  │ │ MongoDB │           │                 │
                │  │  (主从)  │ │ (集群)  │ │ (副本集)│           │                 │
                │  └─────────┘ └─────────┘ └─────────┘           │                 │
                └────────────────────────────────────────────┘           │                 │
                                │                        ┌─────────────────────────────────┐
                ┌────────────────────────────────────┐           │                 │
                │         备份服务器             │           │                 │
                │  ┌─────────┐ ┌─────────┐           │                 │
                │  │ 主备份  │ │ 异地备份 │           │                 │
                │  └─────────┘ └─────────┘           │                 │
                └────────────────────────────────────┘           │                 │
                                │                        ┌─────────────────────────────────┐
                ┌────────────────────────────────────┐           │                 │
                │         监控服务器             │           │                 │
                │  (Prometheus + Grafana)           │                 │
                │  └─────────────────────────────┘           │                 │
                └────────────────────────────────────┘           │
```

**网络设计要点**：
- 防火墙集群支持双机热备和自动切换
- 负载均衡器支持4-7层负载均衡和健康检查
- 应用服务器采用K8s集群，支持自动扩缩容
- 数据库采用主从和集群架构，确保高可用
- 备份服务器支持本地和异地双重备份

### 3.2 高可用设计

**同城双活设计**：
- 两个数据中心部署：主数据中心和备数据中心
- 实时数据同步：基于应用层的双向数据同步
- 流量分发策略：基于地理位置和负载情况
- 自动故障切换：故障时自动切换到备中心

**异地灾备设计**：
- 异地灾备中心：不同城市的灾备中心
- 异地数据备份：定时将关键数据备份到异地
- 灾备演练：定期进行灾备切换演练
- RPO规划：制定详细的恢复点和恢复计划

**恢复时间目标**：
- RTO（恢复时间目标）≤4小时
- RPO（恢复点目标）≤2小时
- 数据丢失≤5分钟
- 核心业务恢复优先级明确

### 3.3 监控体系设计

**监控层级**：
```
┌─────────────────────────────────────────────────────┐
│                   监控体系                              │
├─────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────┐   │
│  │                基础设施监控                    │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │服务器监控│ │网络监控 │ │ 存储监控 │   │   │
│  │  │CPU/内存│ │带宽/延迟│ │ 容量/IOPS │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────┘   │
│                              ↓                           │
│  ┌─────────────────────────────────────────────┐   │
│  │                应用性能监控                    │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │响应时间 │ │吞吐量  │ │错误率   │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────┘   │
│                              ↓                           │
│  ┌─────────────────────────────────────────────┐   │
│  │                业务监控                          │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │功能使用 │ │数据质量 │ │用户活跃 │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────┘   │
│                              ↓                           │
│  ┌─────────────────────────────────────────────┐   │
│  │                安全监控                          │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │访问控制 │ │漏洞扫描 │ │入侵检测 │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

---

## 四、安全架构设计

### 4.1 认证与授权架构

**认证方式**：
- 用户名密码认证：支持LDAP集成和本地认证
- 手机验证码认证：支持短信和邮件验证码
- 第三方登录：支持微信、钉钉等企业应用
- 双因素认证：支持手机令牌和硬件令牌

**授权模型**：
- RBAC（基于角色的访问控制）：5级角色体系
- ABAC（基于属性的访问控制）：支持细粒度权限控制
- 数据权限：支持行级和字段级权限控制
- 资源权限：支持菜单、按钮、API接口权限

### 4.2 数据安全设计

**数据加密**：
- 传输加密：全链路SSL/TLS加密
- 存储加密：敏感数据AES-256加密
- 密钥管理：专业的密钥管理和轮换机制

**数据脱敏**：
- 敏感字段自动识别和脱敏
- 支持姓名、电话、身份证等脱敏规则
- 支持日志和报表中的数据脱敏

**访问控制**：
- IP白名单：限制特定IP访问
- 时间窗口：限制特定时间段访问
- 地理围栏：限制特定地区访问
- 操作审计：记录所有敏感操作

### 4.3 审计追踪设计

**审计范围**：
- 登录审计：记录所有登录行为
- 操作审计：记录所有业务操作
- 数据审计：记录数据访问和修改
- 系统审计：记录系统配置和变更

**审计分析**：
- 异常行为识别：异常时间、异常地点、异常操作
- 风险行为预警：大量数据导出、频繁失败登录
- 合规性检查：操作是否符合规范和权限
- 审计报告：自动生成多维度审计报告

---

## 五、性能优化设计

### 5.1 缓存策略

**多级缓存架构**：
```
┌─────────────────────────────────────────────────────┐
│                   缓存体系                              │
├─────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────┐   │
│  │                L1缓存（本地缓存）                  │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │浏览器  │ │CDN加速 │ │内存缓存 │   │   │
│  │  │缓存    │ │         │ │(本地)  │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────┘   │
│                              ↓                           │
│  ┌─────────────────────────────────────────────┐   │
│  │                L2缓存（分布式缓存）              │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │Redis集群│ │Memcached│ │缓存策略 │   │   │
│  │  │(主从)  │ │         │ │(热点数据)│   │   │
│  │  └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

**缓存策略**：
- 热点数据：本地缓存+CDN加速
- 数据库查询：Redis缓存减少数据库压力
- 接口响应：多级缓存提升响应速度
- 缓存失效：基于时间的缓存失效策略

### 5.2 数据库优化

**读写分离**：
- 主库：负责写操作，数据实时性
- 从库：负责读操作，分担主库压力
- 数据同步：主从库实时数据同步
- 故障切换：主库故障时从库升级为主库

**分库分表**：
- 按业务域分库：质量管理、供应商管理、客户管理
- 按数据类型分表：结构化数据、时序数据、文档数据
- 按访问频率分表：热数据、温数据、冷数据
- 按数据量分表：大表拆分，提升查询性能

**索引优化**：
- 复合索引：支持多字段组合查询
- 覆盖索引：确保最常用查询都有索引
- 索引维护：定期分析和优化索引使用
- 慢查询分析：识别和优化慢查询

---

**版本信息**
- 版本：V2.0 Final Edition
- 创建日期：2026年1月15日
- 文档类型：系统架构与技术方案分册
- 适用对象：安徽舜富精密压铸科技有限公司
- 文档密级：内部机密