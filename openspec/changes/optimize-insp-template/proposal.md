# Proposal: 优化 QMS 检验模板与方案核心模型设计

## 概述
根据 `insp_main_data_req.md` 需求文档第四部分内容，重新梳理并优化 QMS 系统的检验模板（L2）、物料规格（L3）及检验方案绑定策略（L3）。本次优化不仅强化了模板层，更重点在于构建“大脑级”的方案匹配引擎，实现根据业务上下文（物料、供应商、工序、检查类型等）动态组装检验任务的能力。

## 目标
- **三层架构对齐**：完整实现 L1（标准库）-> L2（模板蓝图）-> L3（规格与策略）的协同逻辑。
- **高阶匹配引擎**：建立基于优先级的检验方案（InspPlan）匹配逻辑，支持 IQC、IPQC（首检/巡检/末检）、OQC 等多业务场景。
- **物料级规格定义**：实现物料检验规格（MaterialSpec）管理，支持“一套方案，多套规格（公差）”的灵活配置。
- **业务上下文集成**：将检验方案与具体的供应商、客户、工序号及触发条件（如新供应商前N批）深度绑定。
- **防错设计增强**：完善项目与不良现象的关联，实现检验执行过程中的精准防呆。

## 核心变更
### 1. 检验方案 (InspPlan) 核心模型优化
- **多准则绑定**：支持物料、物料组、供应商（IQC）、客户（OQC）、工序号（IPQC）等多维度绑定。
- **IPQC 类型支持**：增加首检（FAI）、巡检（PATROL）、末检（LAI）的针对性方案配置。
- **触发条件控制**：支持“总是触发”、“新供应商前N批”、“工程变更前N批”等动态策略。

### 2. 物料检验规格 (MaterialSpec) 独立化
- **公差与目标值**：独立维护物理、尺寸、功能等特性的具体公差范围（USL/LSL/目标值）。
- **工厂级差异化**：支持同一物料在不同工厂生产时引用不同的规格标准。

### 3. 三层组装逻辑
- 当业务事件发生时，系统由 `InspPlan` 定位 `InspTemplate`，再由 `MaterialSpec` 注入具体数值。

## 下一步计划
1. 在 `design.md` 中细化 `InspPlan` 与 `MaterialSpec` 的详细字段定义。
2. 在 `src/types/index.ts` 中补全所有 L3 相关的 TypeScript 定义。
3. 实现更完善的 `InspPlanEdit.vue` 界面，支持多维度绑定和规格联调测试。
