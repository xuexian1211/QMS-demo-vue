# 提案: 检验主数据重构 - 第一阶段

## 概述

本提案对S_QMS系统的检验主数据管理进行全面重构和补充。第一阶段重点完善基础数据管理层的核心功能，确保数据模型符合业务需求，并提升用户体验。

### 实施范围（第一阶段）

第一阶段将完成以下功能模块的重构和补充：

1. **基础数据重构** - 参照JNPF模板优化现有页面
   - 不良现象管理 - 重构为独立页面
   - 不良原因管理 - 重构为独立页面
   - 物料档案管理 - 重构优化
   - 工艺路线管理 - 重构优化
   - 检验项目管理 - 重构优化

2. **缺失功能补充**
   - 缺陷分类独立管理页面
   - 量检具类型独立管理页面
   - 物料检验规格管理
   - 检验模板管理（含模板明细）

3. **检验方案优化**
   - 检验方案列表页面重构
   - 检验方案编辑页面优化
   - 完善方案关联绑定逻辑

## 动机

### 当前问题

1. **现有页面实现不一致**
   - 不同页面使用不同的布局模式
   - 部分功能内嵌在其他页面中，不便管理
   - 缺少统一的组件库和代码规范

2. **核心功能缺失**
   - 缺少独立的缺陷分类和量检具类型管理
   - 缺少物料检验规格管理
   - 缺少检验模板功能

3. **数据模型不完整**
   - 缺少检验项目-不良现象映射
   - 缺少现象-原因关联
   - 缺少原因-FMEA关联

### 业务价值

1. **提高数据管理效率**
   - 统一的页面布局和交互模式
   - 独立的分类管理页面便于维护
   - 完整的数据模型支持复杂业务场景

2. **符合需求规范**
   - 参照 `insp_main_data_req.md` 完善数据结构
   - 支持L1/L2/L3三层架构
   - 支持多组织、多版本管理

3. **提升用户体验**
   - 统一的UI风格和交互模式
   - 更好的搜索和筛选功能
   - 更清晰的权限和状态管理

## 建议的解决方案

### 设计原则

参照JNPF框架的设计模式（E:\Jworkspace\jnpf60-master\jnpf-web-monorepo-v6x\apps\web\src\views\extend），采用以下原则：

1. **统一的页面布局**
   - 工具栏 + 搜索表单 + 数据表格结构
   - 统一的操作按钮样式和位置
   - 统一的弹窗和提示组件

2. **组件化设计**
   - 提取可复用的表格组件
   - 统一的搜索表单组件
   - 标准的编辑/查看弹窗

3. **数据驱动**
   - 基于数据模型生成表格列
   - 动态的表单字段显示
   - 统一的验证规则

### 第一阶段实施计划

#### 模块1: 基础数据重构

**1.1 不良现象管理重构**
- 拆分缺陷分类为独立页面 `DefectCategory.vue`
- 优化不良现象列表页面 `DefectPhenomenonList.vue`
- 统一搜索和筛选功能
- 优化表格展示和操作按钮

**1.2 不良原因管理重构**
- 优化不良原因列表页面 `DefectCauseList.vue`
- 优化不良原因编辑页面 `DefectCauseEdit.vue`
- 增加FMEA关联Tab（第二阶段实现）

**1.3 物料档案管理重构**
- 优化物料列表页面 `MaterialProduct.vue`
- 增加物料检验规格入口
- 优化搜索和筛选功能

**1.4 工艺路线管理重构**
- 优化工艺路线列表页面 `ProcessRoute.vue`
- 优化路线明细展示
- 增加工序管理功能

**1.5 检验项目管理重构**
- 优化检验项目列表页面 `InspectionItemList.vue`
- 优化检验项目编辑页面 `InspectionItemEdit.vue`
- 增加关联不良现象功能

#### 模块2: 缺失功能补充

**2.1 缺陷分类独立管理**
- 创建独立页面 `DefectCategory.vue`
- 支持树状结构展示
- 支持增删改查操作
- 支持搜索和导出

**2.2 量检具类型独立管理**
- 创建独立页面 `MeasureType.vue`
- 支持树状结构展示
- 支持精度、MSA要求配置
- 支持增删改查操作

**2.3 物料检验规格管理（从物料档案入口）**
- 通过物料档案的"检验规格"按钮打开抽屉组件 `MaterialSpecDrawer.vue`
- 支持计量型和计数型规格
- 动态表单字段显示
- 无需独立路由和菜单

**2.4 检验模板管理**
- 创建列表页面 `InspTemplateList.vue`
- 创建编辑页面 `InspTemplateEdit.vue`
- 支持模板明细管理
- 支持版本管理和状态流转

#### 模块3: 检验方案优化

**3.1 检验方案列表重构**
- 优化 `InspPlanList.vue` 页面布局
- 统一搜索和筛选
- 增加导出功能

**3.2 检验方案编辑优化**
- 优化 `InspPlanEdit.vue` 页面布局
- 优化Tab页展示
- 完善数据验证规则

## 替代方案

### 方案A: 保持现状（不推荐）
- 继续使用现有页面结构
- 优点：无需重构
- 缺点：功能不完整，用户体验差

### 方案B: 完全迁移到JNPF框架（不推荐）
- 将整个项目迁移到JNPF框架
- 优点：技术栈统一
- 缺点：工作量大，风险高，周期长

### 方案C: 分阶段重构优化（推荐）
- 保持现有技术栈
- 参照JNPF模板优化页面
- 优先实现核心功能
- 优点：风险可控，循序渐进

**建议采用方案C**

## 影响分析

### 用户影响
- 质量工程师可以使用更完善的检验主数据管理功能
- 页面布局和交互更加统一和友好
- 数据管理更加规范和高效

### 系统影响
- 需要重构8个现有页面
- 需要新增4个页面组件
- 需要优化路由配置
- 需要更新类型定义

### 技术影响
- 遵循Vue 3组合式API和TypeScript规范
- 保持Ant Design Vue组件库
- 不引入新的技术栈
- 优化代码结构和复用性

## 成功标准

1. 所有重构页面的布局和交互符合设计规范
2. 所有新增功能页面能够正常创建、编辑、删除记录
3. 缺陷分类和量检具类型独立管理功能正常
4. 物料检验规格支持计量型和计数型两种数据类型
5. 检验模板支持版本管理和状态流转
6. 所有页面响应速度满足用户需求（<500ms）
7. 代码符合项目的风格规范
8. 类型定义完整，无编译错误

## 未解决的问题

1. **后端API对接** - 当前使用模拟数据，需要确认后端接口规范
2. **权限控制** - 需要确认不同角色对这些功能的访问权限
3. **数据导入导出** - 批量导入导出功能在第二阶段完善
4. **知识库关联** - 现象-原因关联、原因-FMEA关联在第二阶段实现
5. **流程集成** - 工作流集成在第二阶段实现
