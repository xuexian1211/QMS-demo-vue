# Proposal: 优化 QMS 检验模板与方案核心模型设计

## 概述
根据 `insp_main_data_req.md` 需求文档及用户最新反馈，重新梳理 QMS 系统的检验策划体系。核心目标是构建一个灵活、分层、可复用的检验策划架构，满足“模板定义蓝图 -> 方案实例化微调 -> 策略动态绑定 -> 规格精细定义”的完整业务流。

## 目标
- **检验方案 (InspScheme) 独立化**：实现检验方案作为独立的业务对象，可引用检验模板 (InspTemplate) 初始化，**并支持在方案层面进行增删改（Add/Modify/Delete）而不影响模板**。
- **动态绑定策略 (InspStrategy)**：建立“方案与上下文一对多”的绑定关系。一个检验方案可被多个业务规则（如不同供应商、不同工序）共享。
- **物料级规格 (MaterialSpec) 独立**：实现“一套方案，多套规格”的架构。方案定义“查什么”，规格定义“标准是多少（公差）”。
- **高阶匹配引擎**：基于优先级和业务上下文（IQC/IPQC/OQC、供应商、工序、触发条件等）自动匹配最佳方案。
- **UI/UE 体验提升**：优化方案编辑器，支持从模板快速导入、行内编辑明细、模拟匹配测试等功能。

## 核心变更
### 1. 引入 "检验方案" (InspScheme) 实体
- **定义**：检验的具体执行指令集合，是“模板”的实例化副本。
- **能力**：
    - **引用模板**：创建时可选择模板，系统自动复制模板明细 (TemplateDetail) 到方案明细 (SchemeDetail)。
    - **独立编辑**：用户可在方案中修改抽样规则、检验方法，或增删检验项目，与原模板解耦。
    - **版本管理**：支持方案自身的版本控制。

### 2. 重构 "检验策略" (InspStrategy / Binding)
- **定义**：连接“业务上下文”与“检验方案”的路由规则。
- **关系**：Scheme (1) <-> (N) Strategy。
- **功能**：
    - 定义何时使用该方案（如：供应商=S01 且 物料=M007 -> 使用方案 Scheme-A）。
    - 支持优先级控制和触发条件（如新供应商前3批）。

### 3. 物料检验规格 (MaterialSpec)
- **定义**：特定物料在特定检验项目上的技术参数（目标值、USL、LSL）。
- **关系**：Scheme (1) <-> (N) MaterialSpec (逻辑上)。
- **交互**：检验执行时，系统根据 Scheme 确定项目列表，根据 MaterialSpec 确定每个项目的判定标准。

## 业务流示意
1. **定义模板 (L2)**：质量部制定“电子料通用检验模板”。
2. **创建方案 (L3)**：工程师基于模板创建“IC芯片专用检验方案”，并添加“引脚平整度”特殊检查项。
3. **绑定策略 (L3)**：
    - 策略A：对应所有IC芯片，默认使用该方案。
    - 策略B：对应供应商X的IC芯片，使用该方案（高优先级）。
    - 策略C：对应新供应商的前3批，使用该方案（加严）。
4. **定义规格 (L3)**：
    - 物料M1的“引脚平整度”公差为 0.1mm。
    - 物料M2的“引脚平整度”公差为 0.05mm。
5. **执行 (Runtime)**：
    - 收货 M1 -> 命中策略A -> 加载方案 -> 加载 M1 规格 -> 生成任务。

## 下一步计划
1. 在 `design.md` 中详细定义 `InspScheme`, `InspSchemeDetail`, `InspStrategy` 的数据结构。
2. 更新 UI 设计，增加“方案详情编辑”和“策略绑定”视图。
3. 定义相关 API 和前端逻辑。
