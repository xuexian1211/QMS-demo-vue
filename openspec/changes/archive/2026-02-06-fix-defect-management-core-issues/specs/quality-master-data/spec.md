## ADDED Requirements

### Requirement: 不良现象数据模型

系统必须(SHALL)支持多组织的不良现象管理，允许集团级和工厂级数据共存。

#### Scenario: 集团级不良现象对所有工厂可见

- **WHEN** 质量工程师创建不良现象时选择"集团级"（orgId = NULL）
- **THEN** 该不良现象应对所有工厂可见
- **AND** 所有工厂都可以在选择器中看到该现象
- **AND** 该现象应标记为"集团级"

#### Scenario: 工厂级不良现象仅本工厂可见

- **WHEN** 合肥工厂的质量工程师创建不良现象时选择"合肥工厂"（orgId = 1）
- **THEN** 该不良现象仅对合肥工厂可见
- **AND** 芜湖工厂（orgId = 2）不应看到该现象
- **AND** 该现象应标记为"合肥工厂"

#### Scenario: 现象代码在组织内唯一

- **WHEN** 质量工程师尝试创建不良现象
- **AND** 相同组织下已存在相同代码的现象
- **THEN** 系统应拒绝创建并提示"代码已存在"
- **BUT** 不同组织可以使用相同代码

---

### Requirement: 不良原因树状结构

系统必须(SHALL)支持多层级的不良原因树，实现深度根因分析（5Why 方法）。

#### Scenario: 创建根原因

- **WHEN** 质量工程师点击"添加根原因"按钮
- **THEN** 系统应显示原因编辑表单
- **AND** 父原因字段应为空（parentId = NULL）
- **AND** 保存后应在树的根层级显示

#### Scenario: 创建子原因

- **WHEN** 质量工程师在原因树中点击某个原因的"添加子原因"按钮
- **THEN** 系统应显示原因编辑表单
- **AND** 父原因字段应自动填充为选中的原因
- **AND** 保存后应在父原因下方显示为子节点
- **AND** 树应自动展开显示新增的子原因

#### Scenario: 删除有子原因的父原因

- **WHEN** 质量工程师尝试删除一个有子原因的父原因
- **THEN** 系统应显示确认对话框
- **AND** 提示"该原因有 N 个子原因，删除后子原因也将被删除"
- **AND** 用户确认后，应级联删除所有子原因

#### Scenario: 原因树层级展示

- **WHEN** 质量工程师查看不良原因页面
- **THEN** 左侧应显示原因树（非简单分类）
- **AND** 树应支持展开/折叠
- **AND** 树应显示层级缩进
- **AND** 高频原因应显示⭐图标

---

### Requirement: 高频原因推荐

系统必须(SHALL)支持标记高频原因，并在选择器中优先显示。

#### Scenario: 标记高频原因

- **WHEN** 质量工程师编辑不良原因
- **AND** 勾选"高频原因"开关
- **THEN** 保存后该原因应标记为高频
- **AND** 在原因树中应显示⭐图标
- **AND** 在列表中应显示高频标记

#### Scenario: 高频原因优先显示

- **WHEN** 质量工程师在不良现象页面添加关联原因
- **AND** 打开原因选择器
- **THEN** 高频原因应排在列表前面
- **AND** 高频原因应有明显的视觉标识
- **AND** 可以按高频筛选

#### Scenario: 高频原因统计

- **WHEN** 质量工程师查看不良原因列表
- **THEN** 应支持按"是否高频"筛选
- **AND** 应显示高频原因数量统计
- **AND** 高频原因应在报表中突出显示

---

### Requirement: 现象-原因关联权重

系统必须(SHALL)支持为现象-原因关联设置权重，用于排序和推荐。

#### Scenario: 设置关联权重

- **WHEN** 质量工程师在不良现象编辑页面添加关联原因
- **THEN** 每个关联应有权重字段（1-10）
- **AND** 默认权重应为 1
- **AND** 应支持手动调整权重

#### Scenario: 按权重排序显示

- **WHEN** 质量工程师查看不良现象的关联原因列表
- **THEN** 关联原因应按权重降序排列
- **AND** 权重高的原因应排在前面
- **AND** 权重应清晰显示

#### Scenario: 权重影响推荐

- **WHEN** 系统推荐原因时
- **THEN** 应综合考虑权重和高频标记
- **AND** 权重高的原因应获得更高评分
- **AND** 推荐列表应按评分排序
