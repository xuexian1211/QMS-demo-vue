# 提案: 物料-工艺路线-检验方案集成

## 概述

本提案建立物料档案、工艺路线、检验方案之间的完整关联关系，实现从物料维度统一管理其工艺路线和检验方案的能力。

### 核心目标

1. **物料-工艺路线关联**：在物料档案中管理关联的工艺路线
2. **工序级检验配置**：在工艺路线的具体工序处配置检验方案（支持多种检验类型）
3. **物料级检验方案入口**：在物料档案中配置IQC/FQC/OQC检验方案

## 动机

### 当前问题

1. **关联关系松散**
   - 工艺路线与物料的关联仅通过文本输入，无法选择和校验
   - 物料档案无法直接查看其关联的工艺路线
   - 检验方案与物料/工序的绑定需要在检验方案侧操作，不够直观

2. **业务流程不完整**
   - 用户需要在多个页面间切换才能完成物料的检验配置
   - IPQC检验无法直接在工序层级配置
   - IQC/FQC/OQC检验方案入口不明确

3. **信息展示不充分**
   - 物料档案看不到关联的工艺路线数量
   - 工序明细看不到已配置的检验方案

### 业务价值

1. **统一入口**：从物料维度集中管理所有质量检验配置
2. **直观配置**：在工序层级直接配置检验方案，符合IPQC实际业务场景
3. **完整视图**：一目了然地了解某物料的完整检验配置

## 建议的解决方案

### 功能模块

#### 模块1: 物料档案增强

**1.1 工艺路线关联管理**
- 在物料档案操作列增加"工艺路线"按钮
- 点击后打开抽屉，展示该物料关联的所有工艺路线列表
- 支持从抽屉跳转到工艺路线详情页

**1.2 物料表格扩展**
- 增加"工艺路线数"列，显示已关联的工艺路线数量

**1.3 检验方案入口**
- 在物料档案操作列增加"检验配置"下拉菜单
- 菜单项包括：IQC方案、FQC方案、OQC方案、检验规格（已有）
- 点击后打开对应的检验方案配置抽屉

#### 模块2: 工艺路线增强

**2.1 物料关联优化**
- "关联物料"字段改为下拉选择器，支持搜索物料
- 显示物料编码和名称

**2.2 工序检验配置**
- 工序明细表格增加"检验配置"列
- 每个工序可配置多个检验方案：
  - 首检方案
  - 巡检方案
  - 末检方案

**2.3 工序检验配置弹窗**
- 点击工序的"检验配置"按钮，弹出配置弹窗
- 可选择已存在的检验方案进行关联
- 配置检验触发条件（首件、巡检频次、末件等）

#### 模块3: 检验方案配置抽屉

**3.1 物料IQC/FQC/OQC配置抽屉**
- 从物料档案打开，自动带入物料ID
- 展示该物料已绑定的对应类型检验方案
- 支持新增/编辑/删除绑定关系

**3.2 工序IPQC配置抽屉**
- 从工艺路线的工序打开，自动带入物料ID和工序ID
- 按检验类型（首检/巡检/末检）分组展示
- 支持配置频次、触发条件

## 数据模型设计

### 实体关系

```
物料档案 (Material)
    │
    ├── 1:N ── 物料-检验方案绑定 (MaterialInspPlanBinding)
    │              ├── inspType: IQC | FQC | OQC
    │              └── planId: 检验方案ID
    │
    └── 1:N ── 工艺路线 (ProcessRoute)
                   │
                   └── 1:N ── 工序 (Operation)
                                  │
                                  └── 1:N ── 工序-检验方案绑定 (OperationInspPlanBinding)
                                                 ├── inspType: 首检 | 巡检 | 末检
                                                 ├── planId: 检验方案ID
                                                 └── frequency: 频次配置
```

### 新增数据结构

#### MaterialInspPlanBinding
| 字段 | 类型 | 说明 |
|------|------|------|
| id | string | 主键 |
| materialId | string | 物料ID |
| inspType | enum | IQC/FQC/OQC |
| planId | string | 检验方案ID |
| priority | number | 优先级 |
| isDefault | boolean | 是否默认方案 |

#### OperationInspPlanBinding
| 字段 | 类型 | 说明 |
|------|------|------|
| id | string | 主键 |
| routeId | string | 工艺路线ID |
| operationId | string | 工序ID |
| inspType | enum | 首检/巡检/末检 |
| planId | string | 检验方案ID |
| frequency | object | 频次配置 |

## 成功标准

1. 物料档案列表显示关联的工艺路线数量
2. 从物料档案可打开工艺路线关联管理抽屉
3. 从物料档案可打开IQC/FQC/OQC检验方案配置
4. 工艺路线的物料关联改为下拉选择
5. 工序明细可配置首检/巡检/末检方案
6. 所有配置抽屉可正常增删改查

## 实施计划

### 阶段1: 物料-工艺路线关联 (优先级高)
- 物料档案增加工艺路线按钮和数量显示
- 创建工艺路线关联抽屉组件
- 工艺路线物料字段改为下拉选择

### 阶段2: 物料级检验方案配置 (优先级高)
- 物料档案增加检验配置下拉菜单
- 创建IQC/FQC/OQC方案配置抽屉
- 整合现有的检验规格入口

### 阶段3: 工序级检验配置 (优先级中)
- 工序明细增加检验配置列
- 创建工序检验配置弹窗
- 支持首检/巡检/末检多种类型

## 未解决的问题

1. **历史数据迁移**：现有工艺路线的物料文本字段如何迁移到关联关系
2. **权限控制**：检验方案配置的操作权限如何细分
3. **版本管理**：当工艺路线升版时，检验配置是否需要继承
