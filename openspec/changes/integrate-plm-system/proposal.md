# 提案：QMS与PLM系统集成对接

## Why
舜富QMS系统当前已实现与ERP、MES、SRM、WMS、CRM五大系统的集成，但尚未与PLM（产品生命周期管理）系统对接。PLM系统管理着产品从设计、工艺到生产的全生命周期数据，与QMS系统存在大量数据交互需求：

**业务痛点**：
1. **产品设计数据孤岛**：PLM中的BOM、图纸、技术规范无法实时同步到QMS，导致质量检验标准滞后
2. **工程变更无法联动**：PLM中的ECN/ECO变更无法自动触发QMS的变化点管理和质量风险评估
3. **APQP流程断层**：PLM中的新产品开发流程与QMS的APQP/PPAP流程脱节，数据需人工转移
4. **检验依据不统一**：质量检验依据的技术图纸、规格书等需从PLM手动下载，版本管理混乱
5. **质量反馈闭环缺失**：QMS中发现的质量问题无法及时反馈到PLM进行设计改进

**集成价值**：
- 实现产品数据的单一数据源（SSOT），消除数据重复录入
- 建立工程变更到质量管理的自动化联动机制
- 打通新产品导入（NPI）全流程的数据闭环
- 提升质量检验标准的及时性和准确性
- 支持质量问题驱动的设计改进（DFQ - Design for Quality）

## What Changes

本次集成将实现QMS与PLM系统在以下5个核心领域的双向数据对接：

### 1. 产品主数据同步
**PLM → QMS（单向同步）**：
- 产品BOM结构（包括物料清单、层级关系、用量关系）
- 产品技术规范（设计图纸、工程规格、技术标准）
- 工艺路线与工序定义
- 检验特性与公差要求
- 关键质量特性（CTQ）标识

### 2. 工程变更管理联动
**PLM → QMS（推送触发）**：
- ECN/ECO变更单数据推送
- 变更影响的产品/零件/工艺清单
- 变更类型与变更等级
- 变更生效日期与批次

**QMS响应动作**：
- 自动创建4M1E变化点管理单
- 触发影响分析与风险评估
- 更新相关检验标准与SIP
- 记录变更质量追踪

### 3. APQP/PPAP流程集成
**PLM ↔ QMS（双向同步）**：
- APQP五阶段里程碑同步
- PPAP提交资料状态同步
- 设计FMEA（DFMEA）数据共享
- 特殊特性矩阵同步
- 控制计划（Control Plan）协同

**异常情况处理**：
- PPAP批准状态通知PLM
- 质量问题触发设计评审
- 客户特殊要求（CSR）同步

### 4. 质量反馈与改进闭环
**QMS → PLM（反馈推送）**：
- 批量质量问题反馈（按产品/零件维度聚合）
- 慢性质量问题的设计根因分析
- 设计改进建议与CAPA关联
- 可靠性数据（故障率、寿命数据）

### 5. 文档与技术资料管理
**PLM → QMS（引用/下载）**：
- 产品图纸的在线查看与版本追溯
- 技术标准与检验作业指导书关联
- 测量系统与检具的CAD数据引用
- 客户技术要求文档同步

## Design

### 集成架构设计

```
┌─────────────────────────────────────────────────────────────┐
│                         PLM System                           │
│          (Product Lifecycle Management)                      │
├─────────────────────────────────────────────────────────────┤
│  产品数据 │ 工程变更 │ APQP流程 │ 技术文档 │ DFMEA            │
└─────────────────────────────────────────────────────────────┘
                           ↕ (REST API / WebService)
┌─────────────────────────────────────────────────────────────┐
│                  Integration Middleware                      │
├─────────────────────────────────────────────────────────────┤
│  数据转换 │ 路由规则 │ 消息队列 │ 错误重试 │ 审计日志        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ Data     │  │ Message  │  │ Error    │  │ Sync     │   │
│  │ Mapper   │  │ Queue    │  │ Handler  │  │ Monitor  │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                           ↕
┌─────────────────────────────────────────────────────────────┐
│                       QMS System                             │
├─────────────────────────────────────────────────────────────┤
│  变化点管理 │ APQP │ 检验系统 │ CAPA │ 知识库              │
└─────────────────────────────────────────────────────────────┘
```

### 集成模式选择

| 集成场景 | 集成模式 | 同步方式 | 频率 |
|---------|---------|---------|------|
| 产品BOM同步 | API调用 | 主动拉取 | 每日/按需 |
| 技术规范同步 | API调用 | 主动拉取 | 实时/按需 |
| ECN/ECO推送 | 事件驱动 | PLM推送 | 实时 |
| APQP状态同步 | 双向API | 双向推送 | 准实时（5分钟） |
| 质量反馈 | 消息队列 | QMS推送 | 批量（每日） |
| 文档引用 | 文件服务 | 按需下载 | 实时 |

### 数据映射策略

**PLM产品编码 ↔ QMS物料编码**：
- 建立编码映射表，支持一对多关系
- 支持PLM产品族到QMS物料族的映射
- 处理版本差异（PLM版本 vs QMS检验版本）

**PLM工程变更 → QMS变化点类型**：
```
PLM ECN类型映射:
- Design Change → 物料变化 (Material)
- Process Change → 方法变化 (Method)  
- Supplier Change → 供应商变化 (Man)
- Equipment Change → 设备变化 (Machine)
- Environment Change → 环境变化 (Environment)
```

**PLM APQP阶段 ↔ QMS APQP阶段**：
```
阶段映射（5个阶段1:1对应）:
PLM Phase 1 → QMS 计划和定义阶段
PLM Phase 2 → QMS 产品设计和开发阶段  
PLM Phase 3 → QMS 过程设计和开发阶段
PLM Phase 4 → QMS 产品和过程确认阶段
PLM Phase 5 → QMS 反馈、评定和纠正措施阶段
```

### 技术实现方案

**接口协议**：
- 主协议：RESTful API (JSON格式)
- 备选：SOAP WebService（如PLM系统仅支持）
- 文件传输：SFTP / MinIO对象存储

**认证方式**：
- API Key + Secret认证
- OAuth 2.0（如PLM支持）
- IP白名单限制

**数据同步策略**：
- 增量同步：基于时间戳/版本号
- 全量同步：每周执行一次对账
- 实时事件：关键业务事件推送

**异常处理**：
- 重试机制：3次重试，间隔递增（1min, 5min, 15min）
- 降级策略：接口失败时记录队列，人工处理
- 数据校验：同步前后数据一致性校验
- 错误通知：关键异常邮件/短信通知

### 风险与应对

**数据不一致风险**：
- 应对：建立主数据冲突解决规则，以PLM为主数据源
- 监控：每日数据对账报告，异常告警

**PLM系统API限制**：
- 应对：了解PLM系统的API限制和性能瓶颈
- 策略：批量操作、错峰同步、缓存机制

**版本兼容性**：
- 应对：API版本化管理，保持向后兼容
- 策略：建立集成测试环境，版本升级前充分测试

**业务流程冲突**：
- 应对：明确业务边界，制定争议解决机制
- 策略：建立跨系统业务流程规范和操作指南
