## ADDED Requirements

### Requirement: FMEA 关联管理

系统必须(SHALL)支持不良原因与 FMEA 失效模式的关联，实现 QMS 与 FMEA 的双向追溯。

#### Scenario: 关联 FMEA 失效模式

- **WHEN** 质量工程师编辑不良原因
- **AND** 切换到"FMEA 关联" Tab
- **AND** 点击"添加 FMEA 关联"按钮
- **THEN** 系统应显示 FMEA 选择器
- **AND** 选择器应支持按类型（PFMEA/DFMEA）筛选
- **AND** 选择器应支持按失效模式搜索
- **AND** 选择器应显示 RPN 值和颜色标记

#### Scenario: RPN 颜色标记

- **WHEN** 质量工程师查看 FMEA 关联列表
- **THEN** RPN >= 100 应显示为红色
- **AND** RPN >= 50 且 < 100 应显示为橙色
- **AND** RPN < 50 应显示为绿色

#### Scenario: 从 QMS 追溯到 FMEA

- **WHEN** 质量工程师查看不良原因详情
- **AND** 该原因已关联 FMEA
- **THEN** 应显示所有关联的 FMEA 失效模式
- **AND** 应支持点击跳转到 FMEA 系统（如有）

#### Scenario: 从 FMEA 追溯到 QMS

- **WHEN** FMEA 系统用户查看失效模式
- **AND** 该失效模式已关联 QMS 原因
- **THEN** 应显示所有关联的不良原因
- **AND** 应支持点击跳转到 QMS 系统

---

### Requirement: 严重等级自动升级流程

系统必须(SHALL)支持 CR 级不良现象自动触发升级流程（8D/QRQC/NCR）。

#### Scenario: CR 级自动显示升级配置

- **WHEN** 质量工程师编辑不良现象
- **AND** 选择严重等级为"CR"
- **THEN** 系统应自动显示升级流程配置区域
- **AND** 应默认勾选"自动升级"
- **AND** 应提供升级流程类型选择（8D/QRQC/NCR）

#### Scenario: 设置升级条件

- **WHEN** 质量工程师配置升级流程
- **THEN** 应支持设置升级条件
- **AND** 条件示例："立即升级"、"连续3次出现"、"单批次超过5个"
- **AND** 应提供常用条件的快捷选择

#### Scenario: 自动触发升级流程

- **WHEN** 检验员录入检验结果
- **AND** 检测到 CR 级不良现象
- **AND** 该现象配置了自动升级
- **AND** 满足升级条件
- **THEN** 系统应自动创建对应的升级任务（8D/QRQC/NCR）
- **AND** 应发送通知给相关责任人
- **AND** 应在检验结果中标记"已升级"

#### Scenario: 升级流程通知

- **WHEN** 升级流程被触发
- **THEN** 系统应通知以下人员：
  - 质量经理（必须）
  - 相关工序负责人（必须）
  - 质量工程师（可选）
- **AND** 通知应包含：不良现象、检验批次、升级类型、责任人

---

### Requirement: 智能推荐算法

系统必须(SHALL)基于历史数据和多维度评分，智能推荐可能的不良原因。

#### Scenario: 显示推荐面板

- **WHEN** 质量工程师在不良现象编辑页面
- **AND** 切换到"关联原因" Tab
- **THEN** 应显示推荐面板
- **AND** 推荐面板应显示在关联列表上方
- **AND** 应显示"推荐原因"标题和说明图标

#### Scenario: 推荐原因列表

- **WHEN** 推荐面板加载完成
- **THEN** 应显示最多 5 个推荐原因
- **AND** 每个推荐应显示：原因名称、评分、推荐理由
- **AND** 推荐应按评分降序排列
- **AND** 评分应清晰显示（如"85分"）

#### Scenario: 推荐理由说明

- **WHEN** 质量工程师查看推荐原因
- **THEN** 每个推荐应显示推荐理由
- **AND** 理由应包含以下维度（如适用）：
  - "历史数据显示高度相关"
  - "标记为高频原因"
  - "相似工序常见原因"
  - "近期频繁出现"

#### Scenario: 采纳推荐原因

- **WHEN** 质量工程师点击推荐原因的"采纳"按钮
- **THEN** 该原因应自动添加到关联列表
- **AND** 权重应根据评分自动设置（评分/10，向上取整）
- **AND** 推荐面板应刷新，移除已采纳的原因

#### Scenario: 忽略推荐原因

- **WHEN** 质量工程师点击推荐原因的"忽略"按钮
- **THEN** 该原因应从推荐列表中移除
- **AND** 系统应记录忽略操作（用于算法优化）
- **AND** 推荐面板应刷新

#### Scenario: 推荐算法综合评分

- **WHEN** 系统计算推荐评分
- **THEN** 应综合以下维度：
  - 历史关联权重（40%）
  - 高频原因标记（30%）
  - 工序相似度（20%）
  - 时间衰减（10%）
- **AND** 最终评分范围应为 0-100
- **AND** 评分应四舍五入到整数

---

### Requirement: 5M1E 体系完善

系统必须(SHALL)支持完整的 5M1E 原因分类体系，包含 Measurement（测量）类别。

#### Scenario: Measurement 类别显示

- **WHEN** 质量工程师查看不良原因页面
- **THEN** 左侧树应显示 6 个分类节点：
  - 人 (Man)
  - 机 (Machine)
  - 料 (Material)
  - 法 (Method)
  - 环 (Environment)
  - 测 (Measurement)

#### Scenario: 创建测量类原因

- **WHEN** 质量工程师新增不良原因
- **AND** 选择原因类别为"Measurement"
- **THEN** 保存后应在"测"节点下显示
- **AND** 应支持为测量类原因添加子原因

#### Scenario: 测量类原因示例

- **WHEN** 系统初始化时
- **THEN** 应提供测量类原因示例数据，如：
  - "量具精度不足"
  - "测量方法不当"
  - "测量人员技能不足"
  - "测量环境影响"
