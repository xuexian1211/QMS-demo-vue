# 项目上下文

## 项目目标
S_QMS（汽车零配件质量管理系统）是一个面向汽车零部件制造企业的质量管理系统。系统管理整个质量控制生命周期，包括：
- 来料检验（IQC）
- 过程质量控制（IPQC）
- 最终质量控制（FQC）
- 出货质量控制（OQC）
- 不合格品处置
- 供应商和客户管理
- 质量分析工具（SPC、FMEA、MSA）
- 文档和报表管理

## 技术栈
- **前端框架**: Vue 3（使用组合式 API `<script setup>`）
- **编程语言**: TypeScript 5.2+（严格模式）
- **UI 组件库**: Ant Design Vue 4.2+
- **构建工具**: Vite 5.0+
- **状态管理**: Pinia 2.1+
- **路由管理**: Vue Router 4.2+
- **HTTP 客户端**: Axios 1.6+
- **日期处理**: dayjs 1.11+
- **图表库**: ECharts 5.4+ 配合 vue-echarts 6.6+
- **运行环境**: Node.js 18+

## 项目约定

### 代码风格
- **Vue 组件**: 使用组合式 API 和 `<script setup lang="ts">` 语法
- **组件命名**: 使用 PascalCase 命名，与文件名保持一致（如 `UnitManagement.vue`）
- **TypeScript**: 启用严格模式，使用接口定义类型，避免使用 `any`
- **导入规范**: 使用 `@/` 别名进行绝对路径导入，优先使用命名导入而非默认导入
- **样式规范**: 使用 `<style scoped>` 作用域样式，采用类似 BEM 的命名约定
- **语言**: 代码和注释使用英文，面向用户的文本使用中文
- **日期处理**: 存储使用 ISO 字符串格式，UI 显示使用 dayjs 格式化

### 架构模式
- **布局模式**: 需要认证的路由使用 MainLayout 包装器，支持嵌套子路由
- **路由配置**: 基于文件的动态导入实现代码分割，使用路由守卫进行身份验证
- **状态管理**: 在 `src/stores/` 中按领域组织 Pinia stores
- **组件组织**:
  - `src/views/basic-data/` - 基础数据管理
  - `src/views/quality/` - 质量检验工作流
  - `src/views/production-quality/` - 生产质量流程
  - `src/views/inspection-model/` - 检验数据模型
  - `src/views/system/` - 系统管理
  - `src/views/tools/` - 质量分析工具（SPC、FMEA、MSA）
- **类型定义**: 在 `src/types/index.ts` 中集中定义接口
- **工具函数**: 辅助函数放在 `src/utils/` 中

### 测试策略
- **当前状态**: 尚未配置测试框架
- **计划方案**: 使用 Vitest 进行单元测试，使用 Cypress 进行端到端测试
- **测试位置**: `__tests__/` 目录或与源文件同级

### Git 工作流
- **当前状态**: 尚未初始化为 git 仓库
- **计划方案**: 功能分支工作流，使用约定式提交
- **提交格式**: `feat:`、`fix:`、`docs:` 等，提交信息使用英文
- **分支命名**: 使用 kebab-case（如 `feature/add-inspection-workflow`）

## 领域知识

### 质量检验类型
- **IQC**（来料检验）: 对供应商提供的原材料和零部件进行检验
- **IPQC**（过程检验）: 生产过程中的检验
- **FQC**（最终检验）: 成品入库前的检验
- **OQC**（出货检验）: 出货给客户前的最终检验

### 检验状态流转
- `pending`（待检验）→ `processing`（检验中）→ `qualified`（合格）或 `unqualified`（不合格）

### 异常处理流程
- 来料不合格处置单
- 过程不合格品处置单
- 成品不合格处置单
- 变化点申请单
- QRQC（快速反应质量控制）响应单

### 质量分析工具
- **SPC**（统计过程控制）: 过程监控和控制
- **FMEA**（失效模式与影响分析）: 风险评估和预防
- **MSA**（测量系统分析）: 量具能力和测量准确性分析

### 基础数据
- 物料分类和物料/产品
- 供应商和客户档案
- 生产班组和工艺路线
- 计量单位和存储地点
- 检验项目、检验方法和抽样方案

### 检验主数据管理

#### 缺陷分类管理
- **定义**: 用于对质量缺陷进行分类管理的树状结构数据
- **特性**: 支持多级分类（根分类 → 子分类 → 子子分类）
- **字段**: 分类编码、分类名称、父级分类、描述
- **关联**: 关联不良现象记录

#### 不良现象管理
- **定义**: 记录产品或过程中出现的质量异常现象
- **严重等级**:
  - CR (Critical) - 致命缺陷，用红色标记
  - MA (Major) - 主要缺陷，用橙色标记
  - MI (Minor) - 次要缺陷，用绿色标记
- **字段**: 现象编码、现象名称、所属分类、严重等级、工序类型、描述

#### 不良原因管理
- **定义**: 记录导致不良现象的根本原因
- **特性**: 支持树状结构展示原因层级
- **关联**: 与FMEA分析关联（第二阶段）
- **后续**: 现象 → 原因 → FMEA 知识库关联

#### 量检具类型管理
- **定义**: 管理测量仪器和检具的类型分类
- **特性**: 树状结构支持多级分类
- **配置**: 支持精度要求、MSA（测量系统分析）要求配置
- **用途**: 检验模板中选择量检具类型

#### 物料检验规格管理
- **定义**: 定义物料的检验项目和检验标准
- **数据类型**:
  - **计量型**: 需要数值测量，包含目标值、上限、下限、单位
  - **计数型**: 通过/不通过判断，包含标准描述、标准代码、期望值
- **唯一性**: 同一物料 + 检验项目组合唯一

#### 检验模板管理
- **定义**: 预定义的检验方案模板，支持复用
- **状态流转**: 草稿 → 审批中 → 已批准 → 作废
- **版本管理**: 支持版本历史记录
- **模板内容**:
  - 检验项目配置
  - 抽样规则配置
  - 检验方法配置
  - 量检具类型配置
  - IPQC频次配置（SPC开关、实验室检验开关）

## 架构模式

### 页面布局规范

#### 列表页面布局（JNPF风格）
```
┌─────────────────────────────────────────┐
│ 工具栏（新增、编辑、删除、导出等按钮）  │
├─────────────────────────────────────────┤
│ 搜索表单（多个搜索条件，inline布局）    │
├─────────────────────────────────────────┤
│ 数据表格（列展示、操作按钮）            │
└─────────────────────────────────────────┘
```

#### 详情页式返回布局
- 页面头部：返回按钮 + 标题 + 状态标签 + 操作按钮
- Tab页内容区：多个功能模块分组展示
- 返回按钮：返回列表页

#### 左右分栏布局
- 左侧：树状数据结构展示
- 右侧：对应详情或列表展示

### 多组织支持
- 所有数据模型包含 `orgId` 字段
- 支持数据按组织隔离
- 默认使用当前用户所属组织

## 重要约束
- 浏览器必须支持 ES2020 特性
- 无服务端渲染（仅单页应用）
- 客户端身份验证存储在 localStorage 中（演示用途）

## 外部依赖
- 当前未配置任何外部 API 或服务
- 所有数据似乎是模拟数据或存储在客户端
- 使用 Ant Design Vue 作为 UI 组件库（无自定义设计系统）

## 参照JNPF框架的设计模式（E:\Jworkspace\jnpf60-master\jnpf-web-monorepo-v6x\apps\web\src\views\extend），采用以下原则：

1. **统一的页面布局**
   - 工具栏 + 搜索表单 + 数据表格结构
   - 统一的操作按钮样式和位置
   - 统一的弹窗和提示组件

2. **组件化设计**
   - 提取可复用的表格组件
   - 统一的搜索表单组件
   - 标准的编辑/查看弹窗

3. **数据驱动**
   - 基于数据模型生成表格列
   - 动态的表单字段显示
   - 统一的验证规则