import{a as L,r as Y,m as se,c as re,o as y,e as A,x as e,q as t,h as d,y as ie,P as de,s,p as C,f as k,t as I,E as b,C as _}from"./index-BsO03Xlk.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"page-container"},me={class:"page-header"},ge={class:"search-form"},fe={__name:"ChangePointApplication",setup(De){const c=L({applicationNo:"",changeType:"",status:""}),m=Y([]),T=Y(!1),f=L({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条数据`}),$=[{title:"申请单号",dataIndex:"applicationNo",key:"applicationNo",width:140},{title:"变更标题",dataIndex:"title",key:"title"},{title:"变更类型",dataIndex:"changeType",key:"changeType",width:100},{title:"紧急程度",dataIndex:"urgencyLevel",key:"urgencyLevel",width:100},{title:"申请人",dataIndex:"applicant",key:"applicant",width:100},{title:"申请日期",dataIndex:"applicationDate",key:"applicationDate",width:120},{title:"计划实施日期",dataIndex:"plannedDate",key:"plannedDate",width:120},{title:"申请状态",dataIndex:"status",key:"status",width:100},{title:"审批人",dataIndex:"approver",key:"approver",width:100},{title:"操作",key:"action",width:250,fixed:"right"}],h=Y(!1),x=Y(!1),U=Y(),l=L({id:null,applicationNo:"",applicationDate:null,applicant:"",changeType:"design",urgencyLevel:"medium",impactScope:"product",title:"",relatedProducts:"",changeReason:"",changeContent:"",beforeChange:"",afterChange:"",riskAssessment:"",countermeasures:"",plannedDate:null,approver:"",approvalDate:null,implementationResult:"",verificationResult:"",remark:"",status:"pending"}),B={applicationDate:[{required:!0,message:"请选择申请日期",trigger:"change"}],applicant:[{required:!0,message:"请输入申请人姓名",trigger:"blur"}],changeType:[{required:!0,message:"请选择变更类型",trigger:"change"}],urgencyLevel:[{required:!0,message:"请选择紧急程度",trigger:"change"}],impactScope:[{required:!0,message:"请选择影响范围",trigger:"change"}],title:[{required:!0,message:"请输入变更标题",trigger:"blur"}],changeReason:[{required:!0,message:"请描述变更原因",trigger:"blur"}],changeContent:[{required:!0,message:"请描述变更内容",trigger:"blur"}],plannedDate:[{required:!0,message:"请选择计划实施日期",trigger:"change"}]},P=[{id:1,applicationNo:"CCN20240115001",applicationDate:"2024-01-15",applicant:"张三",changeType:"design",urgencyLevel:"high",impactScope:"product",title:"产品A外观设计变更",relatedProducts:"产品A, 产品A-1",changeReason:"客户反馈外观不够美观",changeContent:"调整产品外壳设计，增加圆角处理",beforeChange:"方形外壳，边角锐利",afterChange:"圆角设计，外观更美观",riskAssessment:"可能影响模具成本",countermeasures:"与模具厂商协商成本控制",plannedDate:"2024-02-01",approver:"李经理",approvalDate:"2024-01-16",implementationResult:"已实施，效果良好",verificationResult:"客户满意度提升",remark:"",status:"implemented"},{id:2,applicationNo:"CCN20240116001",applicationDate:"2024-01-16",applicant:"王五",changeType:"process",urgencyLevel:"medium",impactScope:"process",title:"焊接工艺参数优化",relatedProducts:"产品B, 产品C",changeReason:"提高焊接质量和效率",changeContent:"调整焊接电流和时间参数",beforeChange:"电流100A，时间5s",afterChange:"电流120A，时间4s",riskAssessment:"需要重新验证工艺",countermeasures:"进行小批量试生产验证",plannedDate:"2024-01-25",approver:"",approvalDate:null,implementationResult:"",verificationResult:"",remark:"等待审批",status:"pending"},{id:3,applicationNo:"CCN20240117001",applicationDate:"2024-01-17",applicant:"赵六",changeType:"material",urgencyLevel:"low",impactScope:"quality",title:"原材料供应商变更",relatedProducts:"产品D",changeReason:"原供应商涨价，寻找替代供应商",changeContent:"更换供应商B为供应商C",beforeChange:"供应商B，价格10元/kg",afterChange:"供应商C，价格9元/kg",riskAssessment:"质量可能存在风险",countermeasures:"进行材料性能测试",plannedDate:"2024-02-10",approver:"钱经理",approvalDate:"2024-01-18",implementationResult:"",verificationResult:"",remark:"质量测试未通过",status:"rejected"}],V=o=>({pending:"orange",approved:"green",rejected:"red",implemented:"blue"})[o]||"default",O=o=>({pending:"待审批",approved:"已批准",rejected:"已拒绝",implemented:"已实施"})[o]||o,E=o=>({design:"blue",process:"green",material:"orange",equipment:"purple",supplier:"cyan"})[o]||"default",F=o=>({design:"设计变更",process:"工艺变更",material:"材料变更",equipment:"设备变更",supplier:"供应商变更"})[o]||o,J=o=>({low:"green",medium:"orange",high:"red",urgent:"purple"})[o]||"default",Q=o=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[o]||o,M=()=>{T.value=!0,setTimeout(()=>{m.value=P,f.total=P.length,T.value=!1},500)},j=()=>{f.current=1,M()},G=()=>{c.applicationNo="",c.changeType="",c.status="",j()},H=o=>{f.current=o.current,f.pageSize=o.pageSize,M()},K=()=>{x.value=!1,h.value=!0,N()},W=o=>{x.value=!0,h.value=!0,Object.assign(l,{...o,applicationDate:o.applicationDate?b(o.applicationDate):null,plannedDate:o.plannedDate?b(o.plannedDate):null,approvalDate:o.approvalDate?b(o.approvalDate):null})},X=o=>{_.info("查看功能开发中...")},Z=o=>{o.status="approved",o.approvalDate=b().format("YYYY-MM-DD"),_.success("已批准申请")},ee=o=>{o.status="rejected",o.approvalDate=b().format("YYYY-MM-DD"),_.success("已拒绝申请")},ae=o=>{const a=m.value.findIndex(i=>i.id===o);a>-1&&(m.value.splice(a,1),f.total--,_.success("删除成功"))},te=async()=>{try{if(await U.value.validate(),x.value){const o=m.value.findIndex(a=>a.id===l.id);o>-1&&(m.value[o]={...l,applicationDate:l.applicationDate?l.applicationDate.format("YYYY-MM-DD"):null,plannedDate:l.plannedDate?l.plannedDate.format("YYYY-MM-DD"):null,approvalDate:l.approvalDate?l.approvalDate.format("YYYY-MM-DD"):null}),_.success("更新成功")}else{const o=Math.max(...m.value.map(g=>g.id))+1,a=`CCN${b().format("YYYYMMDD")}${String(o).padStart(3,"0")}`,i={...l,id:o,applicationNo:a,applicationDate:l.applicationDate?l.applicationDate.format("YYYY-MM-DD"):b().format("YYYY-MM-DD"),plannedDate:l.plannedDate?l.plannedDate.format("YYYY-MM-DD"):null,approvalDate:l.approvalDate?l.approvalDate.format("YYYY-MM-DD"):null,status:"pending"};m.value.unshift(i),f.total++,_.success("创建成功")}h.value=!1,N()}catch(o){console.error("表单验证失败:",o)}},le=()=>{h.value=!1,N()},N=()=>{var o;Object.assign(l,{id:null,applicationNo:"",applicationDate:null,applicant:"",changeType:"design",urgencyLevel:"medium",impactScope:"product",title:"",relatedProducts:"",changeReason:"",changeContent:"",beforeChange:"",afterChange:"",riskAssessment:"",countermeasures:"",plannedDate:null,approver:"",approvalDate:null,implementationResult:"",verificationResult:"",remark:"",status:"pending"}),(o=U.value)==null||o.resetFields()};return se(()=>{M()}),(o,a)=>{const i=s("a-button"),g=s("a-input"),u=s("a-form-item"),w=s("a-select"),z=s("a-form"),S=s("a-tag"),ne=s("a-popconfirm"),oe=s("a-space"),ue=s("a-table"),p=s("a-col"),q=s("a-date-picker"),D=s("a-row"),v=s("a-textarea"),pe=s("a-modal");return y(),re("div",ve,[A("div",me,[a[25]||(a[25]=A("h1",null,"变化点申请单",-1)),e(i,{type:"primary",onClick:K},{icon:t(()=>[e(ie(de))]),default:t(()=>[a[24]||(a[24]=d(" 新建申请单 ",-1))]),_:1})]),A("div",ge,[e(z,{layout:"inline",model:c},{default:t(()=>[e(u,{label:"申请单号"},{default:t(()=>[e(g,{value:c.applicationNo,"onUpdate:value":a[0]||(a[0]=n=>c.applicationNo=n),placeholder:"请输入申请单号"},null,8,["value"])]),_:1}),e(u,{label:"变更类型"},{default:t(()=>[e(w,{value:c.changeType,"onUpdate:value":a[1]||(a[1]=n=>c.changeType=n),placeholder:"请选择变更类型",style:{width:"150px"},options:[{value:"design",label:"设计变更"},{value:"process",label:"工艺变更"},{value:"material",label:"材料变更"},{value:"equipment",label:"设备变更"},{value:"supplier",label:"供应商变更"}]},null,8,["value"])]),_:1}),e(u,{label:"申请状态"},{default:t(()=>[e(w,{value:c.status,"onUpdate:value":a[2]||(a[2]=n=>c.status=n),placeholder:"请选择申请状态",style:{width:"120px"},options:[{value:"pending",label:"待审批"},{value:"approved",label:"已批准"},{value:"rejected",label:"已拒绝"},{value:"implemented",label:"已实施"}]},null,8,["value"])]),_:1}),e(u,null,{default:t(()=>[e(i,{type:"primary",onClick:j},{default:t(()=>[...a[26]||(a[26]=[d("查询",-1)])]),_:1}),e(i,{style:{"margin-left":"8px"},onClick:G},{default:t(()=>[...a[27]||(a[27]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(ue,{columns:$,"data-source":m.value,pagination:f,loading:T.value,onChange:H,"row-key":"id"},{bodyCell:t(({column:n,record:r})=>[n.key==="status"?(y(),C(S,{key:0,color:V(r.status)},{default:t(()=>[d(I(O(r.status)),1)]),_:2},1032,["color"])):k("",!0),n.key==="changeType"?(y(),C(S,{key:1,color:E(r.changeType)},{default:t(()=>[d(I(F(r.changeType)),1)]),_:2},1032,["color"])):k("",!0),n.key==="urgencyLevel"?(y(),C(S,{key:2,color:J(r.urgencyLevel)},{default:t(()=>[d(I(Q(r.urgencyLevel)),1)]),_:2},1032,["color"])):k("",!0),n.key==="action"?(y(),C(oe,{key:3},{default:t(()=>[e(i,{type:"link",size:"small",onClick:R=>W(r)},{default:t(()=>[...a[28]||(a[28]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(i,{type:"link",size:"small",onClick:R=>X(r)},{default:t(()=>[...a[29]||(a[29]=[d("查看",-1)])]),_:1},8,["onClick"]),r.status==="pending"?(y(),C(i,{key:0,type:"link",size:"small",onClick:R=>Z(r)},{default:t(()=>[...a[30]||(a[30]=[d(" 批准 ",-1)])]),_:1},8,["onClick"])):k("",!0),r.status==="pending"?(y(),C(i,{key:1,type:"link",size:"small",danger:"",onClick:R=>ee(r)},{default:t(()=>[...a[31]||(a[31]=[d(" 拒绝 ",-1)])]),_:1},8,["onClick"])):k("",!0),e(ne,{title:"确定要删除这个申请单吗？",onConfirm:R=>ae(r.id)},{default:t(()=>[e(i,{type:"link",size:"small",danger:""},{default:t(()=>[...a[32]||(a[32]=[d("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source","pagination","loading"]),e(pe,{visible:h.value,"onUpdate:visible":a[23]||(a[23]=n=>h.value=n),title:x.value?"编辑申请单":"新建申请单",width:"1200px",onOk:te,onCancel:le},{default:t(()=>[e(z,{ref_key:"formRef",ref:U,model:l,rules:B,layout:"vertical"},{default:t(()=>[e(D,{gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(u,{label:"申请单号",name:"applicationNo"},{default:t(()=>[e(g,{value:l.applicationNo,"onUpdate:value":a[3]||(a[3]=n=>l.applicationNo=n),placeholder:"系统自动生成",disabled:""},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(u,{label:"申请日期",name:"applicationDate"},{default:t(()=>[e(q,{value:l.applicationDate,"onUpdate:value":a[4]||(a[4]=n=>l.applicationDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(u,{label:"申请人",name:"applicant"},{default:t(()=>[e(g,{value:l.applicant,"onUpdate:value":a[5]||(a[5]=n=>l.applicant=n),placeholder:"请输入申请人姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(u,{label:"变更类型",name:"changeType"},{default:t(()=>[e(w,{value:l.changeType,"onUpdate:value":a[6]||(a[6]=n=>l.changeType=n),placeholder:"请选择变更类型",options:[{value:"design",label:"设计变更"},{value:"process",label:"工艺变更"},{value:"material",label:"材料变更"},{value:"equipment",label:"设备变更"},{value:"supplier",label:"供应商变更"}]},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(u,{label:"紧急程度",name:"urgencyLevel"},{default:t(()=>[e(w,{value:l.urgencyLevel,"onUpdate:value":a[7]||(a[7]=n=>l.urgencyLevel=n),placeholder:"请选择紧急程度",options:[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"},{value:"urgent",label:"紧急"}]},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(u,{label:"影响范围",name:"impactScope"},{default:t(()=>[e(w,{value:l.impactScope,"onUpdate:value":a[8]||(a[8]=n=>l.impactScope=n),placeholder:"请选择影响范围",options:[{value:"product",label:"产品"},{value:"process",label:"工艺"},{value:"quality",label:"质量"},{value:"all",label:"全部"}]},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(u,{label:"变更标题",name:"title"},{default:t(()=>[e(g,{value:l.title,"onUpdate:value":a[9]||(a[9]=n=>l.title=n),placeholder:"请输入变更标题"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(u,{label:"相关产品",name:"relatedProducts"},{default:t(()=>[e(g,{value:l.relatedProducts,"onUpdate:value":a[10]||(a[10]=n=>l.relatedProducts=n),placeholder:"请输入相关产品信息"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(u,{label:"变更原因",name:"changeReason"},{default:t(()=>[e(v,{value:l.changeReason,"onUpdate:value":a[11]||(a[11]=n=>l.changeReason=n),rows:3,placeholder:"请详细描述变更原因"},null,8,["value"])]),_:1}),e(u,{label:"变更内容",name:"changeContent"},{default:t(()=>[e(v,{value:l.changeContent,"onUpdate:value":a[12]||(a[12]=n=>l.changeContent=n),rows:4,placeholder:"请详细描述变更内容"},null,8,["value"])]),_:1}),e(D,{gutter:16},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(u,{label:"变更前状态",name:"beforeChange"},{default:t(()=>[e(v,{value:l.beforeChange,"onUpdate:value":a[13]||(a[13]=n=>l.beforeChange=n),rows:3,placeholder:"请描述变更前状态"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(u,{label:"变更后状态",name:"afterChange"},{default:t(()=>[e(v,{value:l.afterChange,"onUpdate:value":a[14]||(a[14]=n=>l.afterChange=n),rows:3,placeholder:"请描述变更后状态"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(u,{label:"风险评估",name:"riskAssessment"},{default:t(()=>[e(v,{value:l.riskAssessment,"onUpdate:value":a[15]||(a[15]=n=>l.riskAssessment=n),rows:3,placeholder:"请评估变更风险"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(u,{label:"应对措施",name:"countermeasures"},{default:t(()=>[e(v,{value:l.countermeasures,"onUpdate:value":a[16]||(a[16]=n=>l.countermeasures=n),rows:3,placeholder:"请制定应对措施"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:t(()=>[e(p,{span:8},{default:t(()=>[e(u,{label:"计划实施日期",name:"plannedDate"},{default:t(()=>[e(q,{value:l.plannedDate,"onUpdate:value":a[17]||(a[17]=n=>l.plannedDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(u,{label:"审批人",name:"approver"},{default:t(()=>[e(g,{value:l.approver,"onUpdate:value":a[18]||(a[18]=n=>l.approver=n),placeholder:"请输入审批人姓名"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:8},{default:t(()=>[e(u,{label:"审批日期",name:"approvalDate"},{default:t(()=>[e(q,{value:l.approvalDate,"onUpdate:value":a[19]||(a[19]=n=>l.approvalDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(u,{label:"实施结果",name:"implementationResult"},{default:t(()=>[e(v,{value:l.implementationResult,"onUpdate:value":a[20]||(a[20]=n=>l.implementationResult=n),rows:3,placeholder:"请描述实施结果"},null,8,["value"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(u,{label:"验证结果",name:"verificationResult"},{default:t(()=>[e(v,{value:l.verificationResult,"onUpdate:value":a[21]||(a[21]=n=>l.verificationResult=n),rows:3,placeholder:"请描述验证结果"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(u,{label:"备注",name:"remark"},{default:t(()=>[e(v,{value:l.remark,"onUpdate:value":a[22]||(a[22]=n=>l.remark=n),rows:2,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}},he=ce(fe,[["__scopeId","data-v-580a6b90"]]);export{he as default};
