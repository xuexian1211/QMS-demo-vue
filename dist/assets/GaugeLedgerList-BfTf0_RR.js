import{d as Ie,r as p,a as G,k as F,m as Re,c as P,e as d,x as t,q as a,s as i,t as I,o as N,y as b,P as Q,R as Te,S as qe,p as Y,w as J,G as Le,I as Se,h as c,f as Oe,M as H,C,E as le}from"./index-BsO03Xlk.js";import{_ as Ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ke={class:"page-container"},$e={class:"split-layout"},Ae={class:"left-panel"},Ee={class:"panel-header"},je={class:"search-box"},ze={class:"tree-container"},Ve={class:"tree-node-content"},Be={class:"node-title"},Ge={class:"node-actions"},Fe={class:"right-panel"},Pe={key:0,class:"empty-selection"},Qe={key:1,class:"content-wrapper"},Je={class:"right-header"},He={class:"header-info"},We={class:"category-title"},Xe={class:"category-meta"},Ze={class:"header-actions"},et={class:"ledger-search-box"},tt={class:"table-container"},at=Ie({__name:"GaugeLedgerList",setup(lt){const K=p(!1),W=p([]),$=p(""),h=p([]),A=p([]),E=p(!1),v=p([]),x=p([]),D=p(!1),j=p(!1),g=G({id:null,parentId:null,typeName:"",precision:.01,isMsaRequired:!1}),R=p("根节点"),U=p(!1),T=p(!1),u=G({id:null,gaugeNo:"",gaugeName:"",model:"",status:"In Use",nextCalDate:null,description:""}),s=G({gaugeNo:"",gaugeName:"",status:void 0,dateRange:[]}),q=F(()=>W.value),ne=F(()=>($.value,q.value)),f=F(()=>{if(h.value.length===0)return null;const n=(e,o)=>{for(const m of e){if(m.id===o)return m;if(m.children){const y=n(m.children,o);if(y)return y}}return null};return n(q.value,h.value[0])}),L=()=>{K.value=!0,setTimeout(()=>{W.value=[{id:301,typeName:"数显卡尺",parentId:null,precision:.01,isMsaRequired:!0,children:[{id:3011,typeName:"数显卡尺-A品牌",parentId:301,precision:.01,isMsaRequired:!0}]},{id:302,typeName:"塞尺",parentId:null,precision:.05,isMsaRequired:!1,children:[]}],A.value=[301],K.value=!1},500)},se=n=>{n.length>0?X(n[0]):v.value=[]},oe=()=>{j.value=!1,R.value="根类型",Object.assign(g,{id:null,parentId:null,typeName:"",precision:.01,isMsaRequired:!1}),S.value="新增根量检具类型",D.value=!0},ie=n=>{j.value=!1,R.value=n.typeName,Object.assign(g,{id:null,parentId:n.id,typeName:"",precision:n.precision,isMsaRequired:n.isMsaRequired}),S.value="新增子量检具类型",D.value=!0},ue=n=>{j.value=!0,R.value=n.parentId?"上级ID:"+n.parentId:"根类型",Object.assign(g,{...n}),S.value="编辑量检具类型",D.value=!0},de=n=>{H.confirm({title:"确认删除",content:`确定删除类型 ${n.typeName} 及其下属所有台账吗？`,okType:"danger",onOk(){C.success("类型已删除"),L(),h.value=[],v.value=[]}})},S=p(""),re=()=>{C.success("类型保存成功"),D.value=!1,L()},ce=[{title:"量具编号",dataIndex:"gaugeNo",key:"gaugeNo",width:120},{title:"量具名称",dataIndex:"gaugeName",key:"gaugeName",width:150},{title:"规格型号",dataIndex:"model",key:"model",width:120},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"下次校准",dataIndex:"nextCalDate",key:"nextCalDate",width:120},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:150}],X=n=>{E.value=!0,setTimeout(()=>{let e=[];if((n===301||n===3011)&&(e=[{id:1001,gaugeNo:"G-001",gaugeName:"数显卡尺01",model:"M-150",status:"In Use",nextCalDate:"2023-12-31",description:"产线A使用"},{id:1002,gaugeNo:"G-002",gaugeName:"数显卡尺02",model:"M-150",status:"Calibrating",nextCalDate:"2023-10-01",description:"送检中"}]),s.gaugeNo&&(e=e.filter(o=>o.gaugeNo.includes(s.gaugeNo))),s.gaugeName&&(e=e.filter(o=>o.gaugeName.includes(s.gaugeName))),s.status&&(e=e.filter(o=>o.status===s.status)),s.dateRange&&s.dateRange.length===2){const o=s.dateRange[0].format("YYYY-MM-DD"),m=s.dateRange[1].format("YYYY-MM-DD");e=e.filter(y=>y.nextCalDate>=o&&y.nextCalDate<=m)}v.value=e,E.value=!1},300)},Z=()=>{f.value&&X(f.value.id)},pe=()=>{s.gaugeNo="",s.gaugeName="",s.status=void 0,s.dateRange=[],Z()},ve=n=>{x.value=n},ge=()=>{var n;T.value=!1,Object.assign(u,{id:null,gaugeNo:"",gaugeName:((n=f.value)==null?void 0:n.typeName)||"",model:"",status:"In Use",nextCalDate:null,description:""}),U.value=!0},fe=n=>{T.value=!0;const e={...n};e.nextCalDate&&(e.nextCalDate=le(e.nextCalDate)),Object.assign(u,e),U.value=!0},me=n=>{H.confirm({title:"确认删除",content:`确定删除量具 ${n.gaugeNo} 吗？`,okType:"danger",onOk(){v.value=v.value.filter(e=>e.id!==n.id),C.success("删除成功")}})},_e=()=>{H.confirm({title:"确认批量删除",content:`确定删除选中的 ${x.value.length} 条记录吗？`,okType:"danger",onOk(){v.value=v.value.filter(n=>!x.value.includes(n.id)),x.value=[],C.success("批量删除成功")}})},ye=()=>{if(!u.gaugeNo||!u.gaugeName){C.warn("请填写必填项");return}const n={...u};if(n.nextCalDate&&(n.nextCalDate=le(n.nextCalDate).format("YYYY-MM-DD")),T.value){const e=v.value.findIndex(o=>o.id===u.id);e!==-1&&Object.assign(v.value[e],n)}else v.value.push({...n,id:Date.now()});C.success("台账保存成功"),U.value=!1},ke=()=>{C.success("导出任务已开始...")},Ne=n=>{switch(n){case"In Use":return"green";case"Calibrating":return"orange";case"Scrapped":return"red";default:return"default"}};return Re(()=>{L()}),(n,e)=>{const o=i("a-button"),m=i("a-tooltip"),y=i("a-space"),_=i("a-input"),be=i("a-tree"),ee=i("a-empty"),Ce=i("a-spin"),z=i("a-tag"),r=i("a-form-item"),w=i("a-select-option"),te=i("a-select"),xe=i("a-range-picker"),V=i("a-form"),De=i("a-table"),we=i("a-input-number"),Me=i("a-switch"),ae=i("a-modal"),M=i("a-col"),B=i("a-row"),he=i("a-date-picker"),Ue=i("a-textarea");return N(),P("div",Ke,[d("div",$e,[d("div",Ae,[d("div",Ee,[e[18]||(e[18]=d("span",{class:"panel-title"},"量检具类型",-1)),t(y,null,{default:a(()=>[t(m,{title:"新增根类型"},{default:a(()=>[t(o,{type:"primary",size:"small",shape:"circle",onClick:oe},{icon:a(()=>[t(b(Q))]),_:1})]),_:1}),t(m,{title:"刷新"},{default:a(()=>[t(o,{size:"small",shape:"circle",onClick:L},{icon:a(()=>[t(b(Te))]),_:1})]),_:1})]),_:1})]),d("div",je,[t(_,{value:$.value,"onUpdate:value":e[0]||(e[0]=l=>$.value=l),placeholder:"搜索类型","allow-clear":"",size:"small"},{prefix:a(()=>[t(b(qe))]),_:1},8,["value"])]),d("div",ze,[t(Ce,{spinning:K.value},{default:a(()=>[q.value.length>0?(N(),Y(be,{key:0,selectedKeys:h.value,"onUpdate:selectedKeys":e[1]||(e[1]=l=>h.value=l),expandedKeys:A.value,"onUpdate:expandedKeys":e[2]||(e[2]=l=>A.value=l),"tree-data":ne.value,"field-names":{children:"children",title:"typeName",key:"id"},"block-node":"",onSelect:se},{title:a(({typeName:l,data:k})=>[d("div",Ve,[d("span",Be,I(l),1),d("div",Ge,[t(b(Q),{class:"action-icon",title:"添加子类型",onClick:J(O=>ie(k),["stop"])},null,8,["onClick"]),t(b(Le),{class:"action-icon",title:"编辑",onClick:J(O=>ue(k),["stop"])},null,8,["onClick"]),t(b(Se),{class:"action-icon",title:"删除",onClick:J(O=>de(k),["stop"])},null,8,["onClick"])])])]),_:1},8,["selectedKeys","expandedKeys","tree-data"])):(N(),Y(ee,{key:1,description:"暂无类型数据",class:"empty-state"}))]),_:1},8,["spinning"])])]),d("div",Fe,[f.value?(N(),P("div",Qe,[d("div",Je,[d("div",He,[d("div",We,I(f.value.typeName),1),d("div",Xe,[t(z,{color:"blue"},{default:a(()=>[c("精度: "+I(f.value.precision),1)]),_:1}),t(z,{color:f.value.isMsaRequired?"orange":"green"},{default:a(()=>[c(I(f.value.isMsaRequired?"需MSA":"不需MSA"),1)]),_:1},8,["color"])])]),d("div",Ze,[t(o,{type:"primary",onClick:ge},{icon:a(()=>[t(b(Q))]),default:a(()=>[e[19]||(e[19]=c(" 新增设备 ",-1))]),_:1}),t(o,{danger:"",disabled:x.value.length===0,onClick:_e},{default:a(()=>[...e[20]||(e[20]=[c(" 批量删除 ",-1)])]),_:1},8,["disabled"]),t(o,{onClick:ke},{default:a(()=>[...e[21]||(e[21]=[c("导出",-1)])]),_:1})])]),d("div",et,[t(V,{layout:"inline",model:s},{default:a(()=>[t(r,{label:"量具编号"},{default:a(()=>[t(_,{value:s.gaugeNo,"onUpdate:value":e[3]||(e[3]=l=>s.gaugeNo=l),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),t(r,{label:"量具名称"},{default:a(()=>[t(_,{value:s.gaugeName,"onUpdate:value":e[4]||(e[4]=l=>s.gaugeName=l),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),t(r,{label:"状态"},{default:a(()=>[t(te,{value:s.status,"onUpdate:value":e[5]||(e[5]=l=>s.status=l),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(w,{value:"In Use"},{default:a(()=>[...e[22]||(e[22]=[c("在用",-1)])]),_:1}),t(w,{value:"Calibrating"},{default:a(()=>[...e[23]||(e[23]=[c("校准中",-1)])]),_:1}),t(w,{value:"Scrapped"},{default:a(()=>[...e[24]||(e[24]=[c("报废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(r,{label:"校准日期"},{default:a(()=>[t(xe,{value:s.dateRange,"onUpdate:value":e[6]||(e[6]=l=>s.dateRange=l)},null,8,["value"])]),_:1}),t(r,null,{default:a(()=>[t(o,{type:"primary",onClick:Z},{default:a(()=>[...e[25]||(e[25]=[c("查询",-1)])]),_:1}),t(o,{style:{"margin-left":"8px"},onClick:pe},{default:a(()=>[...e[26]||(e[26]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),d("div",tt,[t(De,{columns:ce,"data-source":v.value,loading:E.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:x.value,onChange:ve},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`}},{bodyCell:a(({column:l,record:k})=>[l.key==="status"?(N(),Y(z,{key:0,color:Ne(k.status)},{default:a(()=>[c(I(k.status),1)]),_:2},1032,["color"])):l.key==="action"?(N(),Y(y,{key:1},{default:a(()=>[t(o,{type:"link",size:"small",onClick:O=>fe(k)},{default:a(()=>[...e[27]||(e[27]=[c("编辑",-1)])]),_:1},8,["onClick"]),t(o,{type:"link",danger:"",size:"small",onClick:O=>me(k)},{default:a(()=>[...e[28]||(e[28]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):Oe("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])):(N(),P("div",Pe,[t(ee,{description:"请选择左侧类型查看台账"})]))])]),t(ae,{visible:D.value,"onUpdate:visible":e[10]||(e[10]=l=>D.value=l),title:S.value,onOk:re},{default:a(()=>[t(V,{layout:"vertical",model:g},{default:a(()=>[t(r,{label:"父级类型"},{default:a(()=>[t(_,{value:R.value,disabled:""},null,8,["value"])]),_:1}),t(r,{label:"类型名称",required:""},{default:a(()=>[t(_,{value:g.typeName,"onUpdate:value":e[7]||(e[7]=l=>g.typeName=l)},null,8,["value"])]),_:1}),t(r,{label:"精度/分辨率",required:""},{default:a(()=>[t(we,{value:g.precision,"onUpdate:value":e[8]||(e[8]=l=>g.precision=l),style:{width:"100%"},min:0,step:.01},null,8,["value"])]),_:1}),t(r,{label:"是否需MSA"},{default:a(()=>[t(Me,{checked:g.isMsaRequired,"onUpdate:checked":e[9]||(e[9]=l=>g.isMsaRequired=l),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),t(ae,{visible:U.value,"onUpdate:visible":e[17]||(e[17]=l=>U.value=l),title:T.value?"编辑量检具台账":"新增量检具台账",width:"600px",onOk:ye},{default:a(()=>[t(V,{layout:"vertical",model:u},{default:a(()=>[t(B,{gutter:16},{default:a(()=>[t(M,{span:12},{default:a(()=>[t(r,{label:"所属类型"},{default:a(()=>{var l;return[t(_,{value:(l=f.value)==null?void 0:l.typeName,disabled:""},null,8,["value"])]}),_:1})]),_:1}),t(M,{span:12},{default:a(()=>[t(r,{label:"量具编号",required:""},{default:a(()=>[t(_,{value:u.gaugeNo,"onUpdate:value":e[11]||(e[11]=l=>u.gaugeNo=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(B,{gutter:16},{default:a(()=>[t(M,{span:12},{default:a(()=>[t(r,{label:"量具名称",required:""},{default:a(()=>[t(_,{value:u.gaugeName,"onUpdate:value":e[12]||(e[12]=l=>u.gaugeName=l)},null,8,["value"])]),_:1})]),_:1}),t(M,{span:12},{default:a(()=>[t(r,{label:"规格型号"},{default:a(()=>[t(_,{value:u.model,"onUpdate:value":e[13]||(e[13]=l=>u.model=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(B,{gutter:16},{default:a(()=>[t(M,{span:12},{default:a(()=>[t(r,{label:"状态",required:""},{default:a(()=>[t(te,{value:u.status,"onUpdate:value":e[14]||(e[14]=l=>u.status=l)},{default:a(()=>[t(w,{value:"In Use"},{default:a(()=>[...e[29]||(e[29]=[c("在用",-1)])]),_:1}),t(w,{value:"Calibrating"},{default:a(()=>[...e[30]||(e[30]=[c("校准中",-1)])]),_:1}),t(w,{value:"Scrapped"},{default:a(()=>[...e[31]||(e[31]=[c("报废",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(M,{span:12},{default:a(()=>[t(r,{label:"下次校准日期"},{default:a(()=>[t(he,{value:u.nextCalDate,"onUpdate:value":e[15]||(e[15]=l=>u.nextCalDate=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(r,{label:"描述"},{default:a(()=>[t(Ue,{value:u.description,"onUpdate:value":e[16]||(e[16]=l=>u.description=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),ot=Ye(at,[["__scopeId","data-v-ef29aacb"]]);export{ot as default};
