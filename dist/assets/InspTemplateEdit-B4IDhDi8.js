import{d as Ne,r as g,k as L,j as Te,a as W,m as Re,c as I,e as O,x as a,f as b,q as l,s as r,p as _,t as y,a9 as qe,o as p,h as s,y as Y,K as Me,P as we,F as M,z as S,C as N,M as Z,u as Pe}from"./index-Ozo2vowX.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"page-container"},De={class:"page-header"},Le={class:"header-left"},Oe={class:"title-section"},Se={class:"page-title"},Ve={key:0,class:"header-actions"},Qe=Ne({__name:"InspTemplateEdit",setup(Ae){const V=Te(),F=Pe(),B=g(),z=g(),Q=g(!1),w=g(!1),E=g(!1),T=g([]),o=g([]),c=L(()=>V.path.includes("/view/")),G=L(()=>V.path.includes("/edit/")),ee=L(()=>c.value?"查看检验模板":G.value?"编辑检验模板":"新增检验模板"),A=g([{id:"1",name:"长度",defaultMethodId:"1",defaultMethodName:"卡尺测量",defaultGaugeId:"1",defaultGaugeName:"游标卡尺",defaultSpc:!0,defaultLab:!1},{id:"2",name:"外观",defaultMethodId:"2",defaultMethodName:"目视检查",defaultGaugeId:"",defaultGaugeName:"",defaultSpc:!1,defaultLab:!1},{id:"3",name:"硬度",defaultMethodId:"3",defaultMethodName:"硬度计测试",defaultGaugeId:"3",defaultGaugeName:"洛氏硬度计",defaultSpc:!0,defaultLab:!0}]),j=g([{code:"AQL-GB2828-L2-N-0.65",name:"AQL 0.65 Level II 正常"},{code:"AQL-GB2828-L2-S-0.65",name:"AQL 0.65 Level II 加严"},{code:"FULL",name:"全检"},{code:"FIXED-5",name:"固定抽检 5 件"}]),x=g([{id:"1",name:"卡尺测量"},{id:"2",name:"目视检查"},{id:"3",name:"硬度计测试"}]),H=g([{id:"1",name:"游标卡尺"},{id:"2",name:"千分尺"},{id:"3",name:"洛氏硬度计"}]);g([{id:"P1",name:"尺寸偏大",category:"尺寸类"},{id:"P2",name:"尺寸偏小",category:"尺寸类"},{id:"P3",name:"划伤",category:"外观类"},{id:"P4",name:"磕伤",category:"外观类"},{id:"P5",name:"硬度不足",category:"理化类"}]);const f=W({id:null,code:"",name:"",version:"V1.0",status:"Draft",inspType:void 0,remark:""}),ae={code:[{required:!0,message:"请输入模板编码",trigger:"blur"}],name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],inspType:[{required:!0,message:"请选择检验类型",trigger:"change"}]},d=W({id:null,inspItemId:void 0,inspItemName:"",characteristicClass:"Major",samplingRuleCode:void 0,samplingRuleName:"",inspMethodId:void 0,inspMethodName:"",gaugeTypeId:void 0,gaugeTypeName:"",freqType:"PER_BATCH",freqValue:1,freqUnit:"",spcEnabled:!1,labRequired:!1,remark:"",relatedPhenomenonIds:[],autoFilledHint:""}),le={inspItemId:[{required:!0,message:"请选择检验项目",trigger:"change"}],characteristicClass:[{required:!0,message:"请选择特性分类",trigger:"change"}],samplingRuleCode:[{required:!0,message:"请选择抽样规则",trigger:"change"}]},te=L(()=>{const n=[{title:"序号",key:"seq",width:60},{title:"检验项目",dataIndex:"inspItemName",key:"inspItemName",width:120},{title:"特性分类",dataIndex:"characteristicClass",key:"characteristicClass",width:90},{title:"抽样规则",dataIndex:"samplingRuleName",key:"samplingRuleName",width:150},{title:"检验方法",dataIndex:"inspMethodName",key:"inspMethodName",width:100},{title:"量检具",dataIndex:"gaugeTypeName",key:"gaugeTypeName",width:90},{title:"SPC",key:"spcEnabled",width:50},{title:"实验室",key:"labRequired",width:60}];return c.value||n.push({title:"操作",key:"action",width:180}),n}),de=n=>({DRAFT:"default",IN_APPROVAL:"processing",APPROVED:"success",OBSOLETE:"error"})[n]||"default",ne=n=>({DRAFT:"草稿",IN_APPROVAL:"审批中",APPROVED:"已批准",OBSOLETE:"已作废"})[n]||n,se=()=>{F.push("/inspection-model/insp-templates")},ue=async()=>{var n;try{Q.value=!0,await((n=B.value)==null?void 0:n.validate()),N.success("保存成功"),F.push("/inspection-model/insp-templates")}catch{N.error("请完善必填项")}finally{Q.value=!1}},oe=n=>{T.value=n},ie=()=>{Object.assign(d,{id:null,inspItemId:void 0,inspItemName:"",characteristicClass:"Major",samplingRuleCode:void 0,samplingRuleName:"",inspMethodId:void 0,inspMethodName:"",gaugeTypeId:void 0,gaugeTypeName:"",freqType:"PER_BATCH",freqValue:1,freqUnit:"",spcEnabled:!1,labRequired:!1,remark:"",relatedPhenomenonIds:[],autoFilledHint:""})},re=n=>{const e=A.value.find(v=>v.id===n);e&&(d.inspItemName=e.name,d.inspMethodId=e.defaultMethodId||void 0,d.inspMethodName=e.defaultMethodName||"",d.gaugeTypeId=e.defaultGaugeId||void 0,d.gaugeTypeName=e.defaultGaugeName||"",d.spcEnabled=e.defaultSpc??!1,d.labRequired=e.defaultLab??!1,d.autoFilledHint=`已从主数据自动带出默认配置（方法: ${e.defaultMethodName||"无"}, 量具: ${e.defaultGaugeName||"无"}）`)},pe=()=>{N.info("功能开发中：配置该检验项目关联的不良现象，用于检验执行时的防错过滤")},me=()=>{E.value=!1,ie(),w.value=!0},fe=n=>{E.value=!0,Object.assign(d,{...n}),w.value=!0},ve=n=>{Z.confirm({title:"确认删除",content:"确定删除该明细吗？",okType:"danger",onOk(){o.value=o.value.filter(e=>e.id!==n.id),N.success("删除成功")}})},ce=()=>{Z.confirm({title:"确认删除",content:`确定删除选中的 ${T.value.length} 条明细吗？`,okType:"danger",onOk(){o.value=o.value.filter(n=>!T.value.includes(n.id)),T.value=[],N.success("删除成功")}})},ge=async()=>{var n,e,v,P,R;try{if(await((n=z.value)==null?void 0:n.validate()),d.inspItemName=((e=A.value.find(u=>u.id===d.inspItemId))==null?void 0:e.name)||"",d.samplingRuleName=((v=j.value.find(u=>u.code===d.samplingRuleCode))==null?void 0:v.name)||"",d.inspMethodName=((P=x.value.find(u=>u.id===d.inspMethodId))==null?void 0:P.name)||"",d.gaugeTypeName=((R=H.value.find(u=>u.id===d.gaugeTypeId))==null?void 0:R.name)||"",E.value){const u=o.value.findIndex(i=>i.id===d.id);u>-1&&Object.assign(o.value[u],{...d})}else o.value.push({...d,id:Date.now().toString()});N.success("保存成功"),w.value=!1}catch{N.error("请完善必填项")}},_e=n=>{if(n>0){const e=o.value[n];o.value[n]=o.value[n-1],o.value[n-1]=e,o.value=[...o.value]}},ye=n=>{if(n<o.value.length-1){const e=o.value[n];o.value[n]=o.value[n+1],o.value[n+1]=e,o.value=[...o.value]}};return Re(()=>{const n=V.params.id;n&&(Object.assign(f,{id:n,code:"TPL-IQC-001",name:"IQC原材料检验模板",version:"V1.0",status:"Draft",inspType:"IQC",remark:"用于原材料来料检验"}),o.value=[{id:"d1",inspItemId:"1",inspItemName:"长度",samplingRuleId:"1",samplingRuleName:"AQL 0.65 Level II",inspMethodId:"1",inspMethodName:"卡尺测量",gaugeTypeId:"1",gaugeTypeName:"游标卡尺",freqType:"PerBatch",freqValue:1,freqUnit:"批",freqDesc:"1批",spcEnabled:!0,labRequired:!1},{id:"d2",inspItemId:"2",inspItemName:"外观",samplingRuleId:"2",samplingRuleName:"全检",inspMethodId:"2",inspMethodName:"目视检查",gaugeTypeId:"",gaugeTypeName:"",freqType:"PerBatch",freqValue:1,freqUnit:"批",freqDesc:"1批",spcEnabled:!1,labRequired:!1}])}),(n,e)=>{const v=r("a-button"),P=r("a-tag"),R=r("a-input"),u=r("a-form-item"),i=r("a-col"),m=r("a-select-option"),k=r("a-select"),C=r("a-row"),$=r("a-textarea"),K=r("a-form"),X=r("a-card"),J=r("a-space"),D=r("a-switch"),Ie=r("a-table"),be=r("a-divider"),ke=r("a-input-number"),Ce=r("a-alert"),he=r("a-modal");return p(),I("div",Ee,[O("div",De,[O("div",Le,[a(v,{type:"text",onClick:se,class:"back-button"},{icon:l(()=>[a(Y(Me))]),default:l(()=>[e[16]||(e[16]=s(" 返回 ",-1))]),_:1}),O("div",Oe,[O("h2",Se,y(ee.value),1),f.version?(p(),_(P,{key:0,color:"blue"},{default:l(()=>[s(y(f.version),1)]),_:1})):b("",!0),a(P,{color:de(f.status)},{default:l(()=>[s(y(ne(f.status)),1)]),_:1},8,["color"])])]),c.value?b("",!0):(p(),I("div",Ve,[a(v,{type:"primary",onClick:ue,loading:Q.value},{default:l(()=>[...e[17]||(e[17]=[s("保存",-1)])]),_:1},8,["loading"])]))]),a(X,{class:"form-card",title:"基本信息"},{default:l(()=>[a(K,{ref_key:"formRef",ref:B,model:f,rules:ae,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:l(()=>[a(C,{gutter:24},{default:l(()=>[a(i,{span:8},{default:l(()=>[a(u,{label:"模板编码",name:"code"},{default:l(()=>[a(R,{value:f.code,"onUpdate:value":e[0]||(e[0]=t=>f.code=t),disabled:c.value||G.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(i,{span:8},{default:l(()=>[a(u,{label:"模板名称",name:"name"},{default:l(()=>[a(R,{value:f.name,"onUpdate:value":e[1]||(e[1]=t=>f.name=t),disabled:c.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(i,{span:8},{default:l(()=>[a(u,{label:"检验类型",name:"inspType"},{default:l(()=>[a(k,{value:f.inspType,"onUpdate:value":e[2]||(e[2]=t=>f.inspType=t),disabled:c.value,placeholder:"请选择"},{default:l(()=>[a(m,{value:"IQC"},{default:l(()=>[...e[18]||(e[18]=[s("IQC来料检验",-1)])]),_:1}),a(m,{value:"IPQC"},{default:l(()=>[...e[19]||(e[19]=[s("IPQC过程检验",-1)])]),_:1}),a(m,{value:"FQC"},{default:l(()=>[...e[20]||(e[20]=[s("FQC成品检验",-1)])]),_:1}),a(m,{value:"OQC"},{default:l(()=>[...e[21]||(e[21]=[s("OQC出货检验",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:24},{default:l(()=>[a(i,{span:16},{default:l(()=>[a(u,{label:"备注",name:"remark","label-col":{span:3},"wrapper-col":{span:20}},{default:l(()=>[a($,{value:f.remark,"onUpdate:value":e[3]||(e[3]=t=>f.remark=t),disabled:c.value,rows:2,placeholder:"请输入备注"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(X,{class:"detail-card",title:"模板明细"},qe({default:l(()=>[a(Ie,{columns:te.value,"data-source":o.value,"row-key":"id",size:"small","row-selection":c.value?void 0:{selectedRowKeys:T.value,onChange:oe},pagination:!1},{bodyCell:l(({column:t,record:q,index:U})=>[t.key==="seq"?(p(),I(M,{key:0},[s(y(U+1),1)],64)):b("",!0),t.key==="spcEnabled"?(p(),_(D,{key:1,checked:q.spcEnabled,"onUpdate:checked":h=>q.spcEnabled=h,disabled:c.value,size:"small"},null,8,["checked","onUpdate:checked","disabled"])):b("",!0),t.key==="labRequired"?(p(),_(D,{key:2,checked:q.labRequired,"onUpdate:checked":h=>q.labRequired=h,disabled:c.value,size:"small"},null,8,["checked","onUpdate:checked","disabled"])):b("",!0),t.key==="action"?(p(),I(M,{key:3},[c.value?b("",!0):(p(),_(J,{key:0},{default:l(()=>[a(v,{type:"link",size:"small",onClick:h=>fe(q)},{default:l(()=>[...e[24]||(e[24]=[s("编辑",-1)])]),_:1},8,["onClick"]),a(v,{type:"link",danger:"",size:"small",onClick:h=>ve(q)},{default:l(()=>[...e[25]||(e[25]=[s("删除",-1)])]),_:1},8,["onClick"]),a(v,{type:"link",size:"small",disabled:U===0,onClick:h=>_e(U)},{default:l(()=>[...e[26]||(e[26]=[s("上移",-1)])]),_:1},8,["disabled","onClick"]),a(v,{type:"link",size:"small",disabled:U===o.value.length-1,onClick:h=>ye(U)},{default:l(()=>[...e[27]||(e[27]=[s("下移",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024))],64)):b("",!0)]),_:1},8,["columns","data-source","row-selection"])]),_:2},[c.value?void 0:{name:"extra",fn:l(()=>[a(J,null,{default:l(()=>[a(v,{type:"primary",size:"small",onClick:me},{icon:l(()=>[a(Y(we))]),default:l(()=>[e[22]||(e[22]=s("新增明细 ",-1))]),_:1}),a(v,{danger:"",size:"small",disabled:T.value.length===0,onClick:ce},{default:l(()=>[...e[23]||(e[23]=[s(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),_:1})]),key:"0"}]),1024),a(he,{visible:w.value,"onUpdate:visible":e[15]||(e[15]=t=>w.value=t),title:E.value?"编辑明细":"新增明细",width:"800px",onOk:ge},{default:l(()=>[a(K,{ref_key:"detailFormRef",ref:z,model:d,rules:le,layout:"vertical"},{default:l(()=>[a(C,{gutter:16},{default:l(()=>[a(i,{span:12},{default:l(()=>[a(u,{label:"检验项目",name:"inspItemId"},{default:l(()=>[a(k,{value:d.inspItemId,"onUpdate:value":e[4]||(e[4]=t=>d.inspItemId=t),placeholder:"请选择","show-search":"",onChange:re},{default:l(()=>[(p(!0),I(M,null,S(A.value,t=>(p(),_(m,{key:t.id,value:t.id},{default:l(()=>[s(y(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(i,{span:12},{default:l(()=>[a(u,{label:"特性分类",name:"characteristicClass"},{default:l(()=>[a(k,{value:d.characteristicClass,"onUpdate:value":e[5]||(e[5]=t=>d.characteristicClass=t),placeholder:"请选择"},{default:l(()=>[a(m,{value:"SC"},{default:l(()=>[...e[28]||(e[28]=[s("SC - 特殊特性",-1)])]),_:1}),a(m,{value:"CC"},{default:l(()=>[...e[29]||(e[29]=[s("CC - 关键特性",-1)])]),_:1}),a(m,{value:"Major"},{default:l(()=>[...e[30]||(e[30]=[s("Major - 主要",-1)])]),_:1}),a(m,{value:"Minor"},{default:l(()=>[...e[31]||(e[31]=[s("Minor - 次要",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:16},{default:l(()=>[a(i,{span:12},{default:l(()=>[a(u,{label:"抽样规则",name:"samplingRuleCode"},{default:l(()=>[a(k,{value:d.samplingRuleCode,"onUpdate:value":e[6]||(e[6]=t=>d.samplingRuleCode=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,S(j.value,t=>(p(),_(m,{key:t.code,value:t.code},{default:l(()=>[s(y(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(i,{span:12},{default:l(()=>[a(u,{label:"关联不良现象"},{default:l(()=>[a(v,{type:"dashed",onClick:pe},{default:l(()=>{var t;return[s("配置 ("+y(((t=d.relatedPhenomenonIds)==null?void 0:t.length)||0)+")",1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(C,{gutter:16},{default:l(()=>[a(i,{span:12},{default:l(()=>[a(u,{label:"检验方法",name:"inspMethodId"},{default:l(()=>[a(k,{value:d.inspMethodId,"onUpdate:value":e[7]||(e[7]=t=>d.inspMethodId=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,S(x.value,t=>(p(),_(m,{key:t.id,value:t.id},{default:l(()=>[s(y(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(i,{span:12},{default:l(()=>[a(u,{label:"量检具类型",name:"gaugeTypeId"},{default:l(()=>[a(k,{value:d.gaugeTypeId,"onUpdate:value":e[8]||(e[8]=t=>d.gaugeTypeId=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,S(H.value,t=>(p(),_(m,{key:t.id,value:t.id},{default:l(()=>[s(y(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(be,null,{default:l(()=>[...e[32]||(e[32]=[s("IPQC频次配置",-1)])]),_:1}),a(C,{gutter:16},{default:l(()=>[a(i,{span:8},{default:l(()=>[a(u,{label:"频次类型",name:"freqType"},{default:l(()=>[a(k,{value:d.freqType,"onUpdate:value":e[9]||(e[9]=t=>d.freqType=t),placeholder:"请选择"},{default:l(()=>[a(m,{value:"PerBatch"},{default:l(()=>[...e[33]||(e[33]=[s("每批",-1)])]),_:1}),a(m,{value:"PerHour"},{default:l(()=>[...e[34]||(e[34]=[s("每小时",-1)])]),_:1}),a(m,{value:"PerShift"},{default:l(()=>[...e[35]||(e[35]=[s("每班次",-1)])]),_:1}),a(m,{value:"PerQuantity"},{default:l(()=>[...e[36]||(e[36]=[s("每N件",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(i,{span:8},{default:l(()=>[a(u,{label:"频次值",name:"freqValue"},{default:l(()=>[a(ke,{value:d.freqValue,"onUpdate:value":e[10]||(e[10]=t=>d.freqValue=t),min:1,style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),a(i,{span:8},{default:l(()=>[a(u,{label:"单位",name:"freqUnit"},{default:l(()=>[a(R,{value:d.freqUnit,"onUpdate:value":e[11]||(e[11]=t=>d.freqUnit=t),placeholder:"如：件、小时"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:16},{default:l(()=>[a(i,{span:6},{default:l(()=>[a(u,{label:"SPC控制"},{default:l(()=>[a(D,{checked:d.spcEnabled,"onUpdate:checked":e[12]||(e[12]=t=>d.spcEnabled=t)},null,8,["checked"])]),_:1})]),_:1}),a(i,{span:6},{default:l(()=>[a(u,{label:"实验室检验"},{default:l(()=>[a(D,{checked:d.labRequired,"onUpdate:checked":e[13]||(e[13]=t=>d.labRequired=t)},null,8,["checked"])]),_:1})]),_:1}),a(i,{span:12},{default:l(()=>[d.autoFilledHint?(p(),_(Ce,{key:0,message:d.autoFilledHint,type:"info","show-icon":"",closable:""},null,8,["message"])):b("",!0)]),_:1})]),_:1}),a(u,{label:"备注",name:"remark"},{default:l(()=>[a($,{value:d.remark,"onUpdate:value":e[14]||(e[14]=t=>d.remark=t),rows:2,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),ze=Ue(Qe,[["__scopeId","data-v-9f506bdb"]]);export{ze as default};
