import{d as Z,r as _,a as T,m as ee,c as y,e as U,x as t,q as a,s as i,o as f,h as s,y as b,P as te,G as ae,I as le,R as oe,p as z,f as ne,F as de,t as se,M as R,C}from"./index-CAjnGs0g.js";import{E as ie}from"./ExportOutlined-CYgoHkM0.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"page-container"},me={class:"toolbar"},pe={class:"table-container"},fe={key:1},ve={key:2},ce={key:3},ge=Z({__name:"InspMethodList",setup(_e){const w=_(!1),r=_([]),m=_([]),n=T({methodName:"",attachmentId:"",orgId:void 0}),I=T({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),B=[{title:"方法名称",dataIndex:"methodName",key:"methodName",width:200},{title:"组织",dataIndex:"orgId",key:"orgId",width:120},{title:"附件ID",dataIndex:"attachmentId",key:"attachmentId",width:200},{title:"操作步骤",dataIndex:"operationText",key:"operationText",ellipsis:!0},{title:"操作",key:"action",width:150,fixed:"right"}],h=()=>{w.value=!0,setTimeout(()=>{let l=[{id:"201",orgId:null,methodName:"通用卡尺测量法",operationText:"1. 校零 2. 清洁工件 3. 测量关键尺寸 4.记录",attachmentId:"FILE_SOP_001.pdf"},{id:"202",orgId:1,methodName:"蓝牙卡尺测量法",operationText:"1. 开启蓝牙 2. 配对设备 3. 自动传输数据",attachmentId:"FILE_SOP_002.pdf"},{id:"203",orgId:null,methodName:"目视检查",operationText:"1. 明确判定标准 2. 在自然光条件下检查表面 3.记录",attachmentId:""}];n.methodName&&(l=l.filter(e=>e.methodName.includes(n.methodName))),n.attachmentId&&(l=l.filter(e=>(e.attachmentId||"").includes(n.attachmentId))),n.orgId!==void 0&&(n.orgId===null?l=l.filter(e=>e.orgId===null):l=l.filter(e=>e.orgId===n.orgId)),r.value=l,I.total=l.length,w.value=!1},300)},O=()=>{I.current=1,h()},F=()=>{n.methodName="",n.attachmentId="",n.orgId=void 0,O()},L=l=>{I.current=l.current,I.pageSize=l.pageSize,h()},M=l=>{m.value=l},k=_(!1),x=_(!1),S=_(),d=T({id:null,orgId:null,methodName:"",attachmentId:"",operationText:""}),V={methodName:[{required:!0,message:"请输入方法名称",trigger:"blur"},{validator:async(l,e)=>e&&r.value.some(v=>v.methodName===e&&v.orgId===d.orgId&&v.id!==d.id)?Promise.reject("该组织下已存在同名方法"):Promise.resolve(),trigger:"blur"}]},j=()=>{x.value=!1,Object.assign(d,{id:null,orgId:null,methodName:"",attachmentId:"",operationText:""}),k.value=!0},D=l=>{const e=l.id?l:r.value.find(u=>u.id===m.value[0]);e&&(x.value=!0,Object.assign(d,{...e}),k.value=!0)},$=l=>{R.confirm({title:"确认删除",content:`确定删除检验方法 ${l.methodName} 吗？`,okType:"danger",onOk(){r.value=r.value.filter(e=>e.id!==l.id),C.success("删除成功")}})},q=()=>{R.confirm({title:"确认批量删除",content:`确定删除选中的 ${m.value.length} 条记录吗？`,okType:"danger",onOk(){r.value=r.value.filter(l=>!m.value.includes(l.id)),m.value=[],C.success("删除成功")}})},K=()=>{S.value.validate().then(()=>{if(x.value){const l=r.value.findIndex(e=>e.id===d.id);l>-1&&Object.assign(r.value[l],d)}else r.value.push({...d,id:Date.now().toString()});C.success("保存成功"),k.value=!1,h()})},A=()=>{C.success("导出任务已开始")};return ee(()=>{h()}),(l,e)=>{const u=i("a-button"),v=i("a-space"),N=i("a-input"),p=i("a-form-item"),c=i("a-select-option"),E=i("a-select"),P=i("a-form"),G=i("a-card"),J=i("a-tag"),Q=i("a-divider"),H=i("a-table"),W=i("a-textarea"),X=i("a-modal");return f(),y("div",re,[U("div",me,[t(v,null,{default:a(()=>[t(u,{type:"primary",onClick:j},{icon:a(()=>[t(b(te))]),default:a(()=>[e[8]||(e[8]=s("新增 ",-1))]),_:1}),t(u,{disabled:m.value.length!==1,onClick:D},{icon:a(()=>[t(b(ae))]),default:a(()=>[e[9]||(e[9]=s("编辑 ",-1))]),_:1},8,["disabled"]),t(u,{danger:"",disabled:m.value.length===0,onClick:q},{icon:a(()=>[t(b(le))]),default:a(()=>[e[10]||(e[10]=s("删除 ",-1))]),_:1},8,["disabled"]),t(u,{onClick:A},{icon:a(()=>[t(b(ie))]),default:a(()=>[e[11]||(e[11]=s("导出 ",-1))]),_:1}),t(u,{onClick:h},{icon:a(()=>[t(b(oe))]),default:a(()=>[e[12]||(e[12]=s("刷新 ",-1))]),_:1})]),_:1})]),t(G,{class:"search-card",bordered:!1},{default:a(()=>[t(P,{layout:"inline",model:n},{default:a(()=>[t(p,{label:"方法名称"},{default:a(()=>[t(N,{value:n.methodName,"onUpdate:value":e[0]||(e[0]=o=>n.methodName=o),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(p,{label:"组织"},{default:a(()=>[t(E,{value:n.orgId,"onUpdate:value":e[1]||(e[1]=o=>n.orgId=o),placeholder:"请选择","allow-clear":"",style:{width:"150px"}},{default:a(()=>[t(c,{value:null},{default:a(()=>[...e[13]||(e[13]=[s("集团",-1)])]),_:1}),t(c,{value:1},{default:a(()=>[...e[14]||(e[14]=[s("合肥工厂",-1)])]),_:1}),t(c,{value:2},{default:a(()=>[...e[15]||(e[15]=[s("芜湖工厂",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"附件ID"},{default:a(()=>[t(N,{value:n.attachmentId,"onUpdate:value":e[2]||(e[2]=o=>n.attachmentId=o),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(p,null,{default:a(()=>[t(u,{type:"primary",onClick:O},{default:a(()=>[...e[16]||(e[16]=[s("查询",-1)])]),_:1}),t(u,{style:{"margin-left":"8px"},onClick:F},{default:a(()=>[...e[17]||(e[17]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),U("div",pe,[t(H,{columns:B,"data-source":r.value,loading:w.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:m.value,onChange:M},pagination:I,onChange:L},{bodyCell:a(({column:o,record:g})=>[o.key==="orgId"?(f(),y(de,{key:0},[g.orgId===null?(f(),z(J,{key:0,color:"blue"},{default:a(()=>[...e[18]||(e[18]=[s("集团",-1)])]),_:1})):g.orgId===1?(f(),y("span",fe,"合肥工厂")):g.orgId===2?(f(),y("span",ve,"芜湖工厂")):(f(),y("span",ce,"工厂"+se(g.orgId),1))],64)):o.key==="action"?(f(),z(v,{key:1},{default:a(()=>[t(u,{type:"link",size:"small",onClick:Y=>D(g)},{default:a(()=>[...e[19]||(e[19]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(Q,{type:"vertical"}),t(u,{type:"link",danger:"",size:"small",onClick:Y=>$(g)},{default:a(()=>[...e[20]||(e[20]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):ne("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(X,{visible:k.value,"onUpdate:visible":e[7]||(e[7]=o=>k.value=o),title:x.value?"编辑检验方法":"新增检验方法",width:"600px",onOk:K},{default:a(()=>[t(P,{ref_key:"formRef",ref:S,model:d,rules:V,layout:"vertical"},{default:a(()=>[t(p,{label:"组织",name:"orgId"},{default:a(()=>[t(E,{value:d.orgId,"onUpdate:value":e[3]||(e[3]=o=>d.orgId=o),placeholder:"请选择"},{default:a(()=>[t(c,{value:null},{default:a(()=>[...e[21]||(e[21]=[s("集团",-1)])]),_:1}),t(c,{value:1},{default:a(()=>[...e[22]||(e[22]=[s("合肥工厂",-1)])]),_:1}),t(c,{value:2},{default:a(()=>[...e[23]||(e[23]=[s("芜湖工厂",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"方法名称",name:"methodName"},{default:a(()=>[t(N,{value:d.methodName,"onUpdate:value":e[4]||(e[4]=o=>d.methodName=o),placeholder:"请输入方法名称"},null,8,["value"])]),_:1}),t(p,{label:"附件ID",name:"attachmentId"},{default:a(()=>[t(N,{value:d.attachmentId,"onUpdate:value":e[5]||(e[5]=o=>d.attachmentId=o),placeholder:"例如：FILE_SOP_001.pdf"},null,8,["value"])]),_:1}),t(p,{label:"操作步骤描述",name:"operationText"},{default:a(()=>[t(W,{value:d.operationText,"onUpdate:value":e[6]||(e[6]=o=>d.operationText=o),rows:6,placeholder:"请输入操作步骤"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),ye=ue(ge,[["__scopeId","data-v-eceb240e"]]);export{ye as default};
