import{d as _e,r as I,k as L,j as ye,a as V,m as Se,c as h,e as k,x as a,f as _,q as t,s as u,p as r,t as T,o,h as d,y as B,K as Ne,P as G,F as ge,u as ke,C as S}from"./index-BPMZt9Bz.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"page-container"},Ae={class:"page-header"},Ie={class:"header-left"},Te={class:"title-section"},Me={class:"page-title"},he={key:0,class:"header-actions"},Ee={key:0,class:"tab-toolbar"},Re={class:"detail-table-wrapper"},De={class:"detail-header"},xe={style:{"margin-bottom":"12px"}},we=_e({__name:"SamplingPlanEdit",setup(Ue){const j=ke(),E=ye(),O=I(),R=I(!1),q=I("rules"),y=L(()=>E.path.includes("/view/")),P=L(()=>E.path.includes("/edit/")),$=L(()=>y.value?"查看抽样方案":P.value?"编辑抽样方案":"新增抽样方案"),i=V({id:null,planCode:"",planName:"",samplingMethod:"STANDARD_BASED",standard:"",description:"",rules:[]}),X={planCode:[{required:!0,message:"请输入方案代码",trigger:"blur"}],planName:[{required:!0,message:"请输入方案名称",trigger:"blur"}],samplingMethod:[{required:!0,message:"请选择抽样方法",trigger:"change"}]},Y=n=>({STANDARD_BASED:"blue",FIXED_QUANTITY:"cyan",PERCENTAGE:"orange",FULL_INSPECTION:"green"})[n]||"default",K=n=>({STANDARD_BASED:"国标",FIXED_QUANTITY:"固定数量",PERCENTAGE:"百分比",FULL_INSPECTION:"全检"})[n]||n,H=[{title:"规则代码",dataIndex:"ruleCode",key:"ruleCode",width:150},{title:"规则名称",dataIndex:"ruleName",key:"ruleName",width:200},{title:"检验水平",key:"inspectionLevel",width:100},{title:"检验类型",key:"inspectionType",width:120},{title:"AQL值",dataIndex:"aqlValue",key:"aqlValue",width:80},{title:"操作",key:"action",width:150}],J=[{title:"批量下限",dataIndex:"batchSizeMin",key:"batchSizeMin"},{title:"批量上限",dataIndex:"batchSizeMax",key:"batchSizeMax"},{title:"样本量字码",dataIndex:"sampleSizeCode",key:"sampleSizeCode"},{title:"Ac(接收)",dataIndex:"acceptanceNumber",key:"acceptanceNumber"},{title:"Re(拒收)",dataIndex:"rejectionNumber",key:"rejectionNumber"}],W=[{title:"批量下限",key:"batchSizeMin",width:120},{title:"批量上限",key:"batchSizeMax",width:120},{title:"样本量字码",key:"sampleSizeCode",width:120},{title:"Ac(接收)",key:"acceptanceNumber",width:100},{title:"Re(拒收)",key:"rejectionNumber",width:100},{title:"操作",key:"action",width:80}],Z=n=>{switch(n){case"NORMAL":return"green";case"STRICT":return"red";case"REDUCED":return"orange";default:return"default"}},ee=n=>({NORMAL:"正常",STRICT:"加严",REDUCED:"放宽"})[n]||n,z=I(!1),A=I(!1),s=V({id:null,ruleCode:"",ruleName:"",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,sampleSize:null,sampleSizeRate:null,details:[]}),ae=()=>{A.value=!1,Object.assign(s,{id:null,ruleCode:"",ruleName:"",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,sampleSize:null,sampleSizeRate:null,details:[]}),z.value=!0},te=n=>{A.value=!0,Object.assign(s,{...n,details:[...n.details||[]]}),z.value=!0},le=()=>{s.details.push({id:Date.now(),batchSizeMin:1,batchSizeMax:10,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1})},ne=n=>{s.details.splice(n,1)},ie=()=>{if(!s.ruleCode||!s.ruleName){S.error("请填写必填项");return}if(i.samplingMethod==="FIXED_QUANTITY"&&!s.sampleSize){S.error("请输入样本量");return}if(i.samplingMethod==="PERCENTAGE"&&!s.sampleSizeRate){S.error("请输入样本量比率");return}if(i.samplingMethod==="STANDARD_BASED"&&s.details.length>0){const n=[...s.details].sort((e,m)=>e.batchSizeMin-m.batchSizeMin);for(let e=0;e<n.length-1;e++)if(n[e].batchSizeMax>=n[e+1].batchSizeMin){S.error(`批量范围存在重叠：[${n[e].batchSizeMin}-${n[e].batchSizeMax}] 与 [${n[e+1].batchSizeMin}-${n[e+1].batchSizeMax}]`);return}for(const e of s.details)if(e.rejectionNumber<=e.acceptanceNumber){S.error(`拒收数(Re)必须大于接收数(Ac)，当前 Ac=${e.acceptanceNumber}, Re=${e.rejectionNumber}`);return}}if(A.value){const n=i.rules.findIndex(e=>e.id===s.id);n!==-1&&Object.assign(i.rules[n],{...s,details:[...s.details]})}else i.rules.push({...s,id:Date.now().toString(),details:[...s.details]});z.value=!1,S.success(A.value?"规则已更新":"规则已添加")},se=n=>{i.rules.splice(n,1)},oe=()=>{j.push("/inspection-model/sampling-plans")},de=async()=>{var n;try{R.value=!0,await((n=O.value)==null?void 0:n.validate()),S.success("保存成功"),j.push("/inspection-model/sampling-plans")}catch{S.error("请完善必填项")}finally{R.value=!1}},ue=()=>{const n=E.params.id;if(n){const m={1:{id:"1",planCode:"AQL-GB2828",planName:"GB/T 2828.1-2012",samplingMethod:"STANDARD_BASED",standard:"GB/T 2828.1",description:"基于国标的AQL抽样",rules:[{id:"101",ruleCode:"GB-L2-N-0.65",ruleName:"Level II 正常 AQL 0.65",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:.65,details:[{id:1,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1},{id:2,batchSizeMin:9,batchSizeMax:15,sampleSizeCode:"B",acceptanceNumber:0,rejectionNumber:1},{id:3,batchSizeMin:16,batchSizeMax:25,sampleSizeCode:"C",acceptanceNumber:0,rejectionNumber:1}]},{id:"102",ruleCode:"GB-L2-S-0.65",ruleName:"Level II 加严 AQL 0.65",inspectionLevel:"II",inspectionType:"STRICT",aqlValue:.65,details:[{id:4,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1}]}]},2:{id:"2",planCode:"FIX-QTY",planName:"固定数量抽样",samplingMethod:"FIXED_QUANTITY",standard:"内部标准",description:"不管多少只抽5个",rules:[]},3:{id:"3",planCode:"PERCENT-10",planName:"10%抽样",samplingMethod:"PERCENTAGE",standard:"内部标准",description:"按数量10%抽",rules:[]}}[n];m&&Object.assign(i,m)}};return Se(()=>{ue()}),(n,e)=>{const m=u("a-button"),D=u("a-tag"),C=u("a-input"),c=u("a-form-item"),v=u("a-col"),b=u("a-select-option"),x=u("a-select"),N=u("a-row"),re=u("a-textarea"),F=u("a-form"),Q=u("a-card"),pe=u("a-space"),w=u("a-table"),me=u("a-empty"),ce=u("a-tab-pane"),ve=u("a-tabs"),M=u("a-alert"),g=u("a-input-number"),be=u("a-divider"),fe=u("a-modal");return o(),h("div",ze,[k("div",Ae,[k("div",Ie,[a(m,{type:"text",onClick:oe,class:"back-button"},{icon:t(()=>[a(B(Ne))]),default:t(()=>[e[14]||(e[14]=d(" 返回 ",-1))]),_:1}),k("div",Te,[k("h2",Me,T($.value),1),i.samplingMethod?(o(),r(D,{key:0,color:Y(i.samplingMethod)},{default:t(()=>[d(T(K(i.samplingMethod)),1)]),_:1},8,["color"])):_("",!0)])]),y.value?_("",!0):(o(),h("div",he,[a(m,{type:"primary",onClick:de,loading:R.value},{default:t(()=>[...e[15]||(e[15]=[d("保存",-1)])]),_:1},8,["loading"])]))]),a(Q,{class:"form-card",title:"基本信息"},{default:t(()=>[a(F,{ref_key:"formRef",ref:O,model:i,rules:X,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:t(()=>[a(N,{gutter:24},{default:t(()=>[a(v,{span:8},{default:t(()=>[a(c,{label:"方案代码",name:"planCode"},{default:t(()=>[a(C,{value:i.planCode,"onUpdate:value":e[0]||(e[0]=l=>i.planCode=l),disabled:y.value||P.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(v,{span:8},{default:t(()=>[a(c,{label:"方案名称",name:"planName"},{default:t(()=>[a(C,{value:i.planName,"onUpdate:value":e[1]||(e[1]=l=>i.planName=l),disabled:y.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(v,{span:8},{default:t(()=>[a(c,{label:"抽样方法",name:"samplingMethod"},{default:t(()=>[a(x,{value:i.samplingMethod,"onUpdate:value":e[2]||(e[2]=l=>i.samplingMethod=l),disabled:y.value,placeholder:"请选择"},{default:t(()=>[a(b,{value:"STANDARD_BASED"},{default:t(()=>[...e[16]||(e[16]=[d("国标/标准",-1)])]),_:1}),a(b,{value:"FIXED_QUANTITY"},{default:t(()=>[...e[17]||(e[17]=[d("固定数量",-1)])]),_:1}),a(b,{value:"PERCENTAGE"},{default:t(()=>[...e[18]||(e[18]=[d("百分比",-1)])]),_:1}),a(b,{value:"FULL_INSPECTION"},{default:t(()=>[...e[19]||(e[19]=[d("全检",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:24},{default:t(()=>[a(v,{span:8},{default:t(()=>[a(c,{label:"适用标准",name:"standard"},{default:t(()=>[a(C,{value:i.standard,"onUpdate:value":e[3]||(e[3]=l=>i.standard=l),disabled:y.value,placeholder:"如: GB/T 2828.1"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(N,{gutter:24},{default:t(()=>[a(v,{span:16},{default:t(()=>[a(c,{label:"描述",name:"description","label-col":{span:3},"wrapper-col":{span:20}},{default:t(()=>[a(re,{value:i.description,"onUpdate:value":e[4]||(e[4]=l=>i.description=l),disabled:y.value,rows:2,placeholder:"请输入描述"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(Q,{class:"tab-card"},{default:t(()=>[a(ve,{activeKey:q.value,"onUpdate:activeKey":e[5]||(e[5]=l=>q.value=l)},{default:t(()=>[a(ce,{key:"rules",tab:"抽样规则"},{default:t(()=>[y.value?_("",!0):(o(),h("div",Ee,[a(m,{type:"primary",size:"small",onClick:ae},{default:t(()=>[a(B(G)),e[20]||(e[20]=d(" 添加规则 ",-1))]),_:1})])),a(w,{columns:H,"data-source":i.rules,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:l,record:p,index:U})=>[l.key==="inspectionLevel"?(o(),r(D,{key:0,color:"blue"},{default:t(()=>[d(T(p.inspectionLevel),1)]),_:2},1024)):l.key==="inspectionType"?(o(),r(D,{key:1,color:Z(p.inspectionType)},{default:t(()=>[d(T(ee(p.inspectionType)),1)]),_:2},1032,["color"])):l.key==="action"?(o(),r(pe,{key:2},{default:t(()=>[a(m,{type:"link",size:"small",onClick:f=>te(p)},{default:t(()=>[...e[21]||(e[21]=[d("编辑",-1)])]),_:1},8,["onClick"]),y.value?_("",!0):(o(),r(m,{key:0,type:"link",danger:"",size:"small",onClick:f=>se(U)},{default:t(()=>[...e[22]||(e[22]=[d("删除",-1)])]),_:1},8,["onClick"]))]),_:2},1024)):_("",!0)]),expandedRowRender:t(({record:l})=>[k("div",Re,[k("div",De,"抽样明细 ("+T(l.ruleCode)+")",1),a(w,{columns:J,"data-source":l.details,"row-key":"id",size:"small",pagination:!1,bordered:""},null,8,["data-source"])])]),_:1},8,["data-source"]),i.rules.length===0?(o(),r(me,{key:1,description:"暂无抽样规则，请添加"})):_("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1}),a(fe,{visible:z.value,"onUpdate:visible":e[13]||(e[13]=l=>z.value=l),title:A.value?"编辑规则":"新增规则",width:"900px",onOk:ie},{default:t(()=>[a(F,{layout:"vertical",model:s},{default:t(()=>[a(N,{gutter:16},{default:t(()=>[a(v,{span:12},{default:t(()=>[a(c,{label:"规则代码",required:""},{default:t(()=>[a(C,{value:s.ruleCode,"onUpdate:value":e[6]||(e[6]=l=>s.ruleCode=l)},null,8,["value"])]),_:1})]),_:1}),a(v,{span:12},{default:t(()=>[a(c,{label:"规则名称",required:""},{default:t(()=>[a(C,{value:s.ruleName,"onUpdate:value":e[7]||(e[7]=l=>s.ruleName=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),i.samplingMethod==="STANDARD_BASED"?(o(),r(M,{key:0,message:"国标抽样模式",description:"需要配置检验水平、AQL值和抽样明细表",type:"info","show-icon":"",style:{"margin-bottom":"16px"}})):i.samplingMethod==="FIXED_QUANTITY"?(o(),r(M,{key:1,message:"固定数量抽样模式",description:"需要设置固定的样本数量",type:"success","show-icon":"",style:{"margin-bottom":"16px"}})):i.samplingMethod==="PERCENTAGE"?(o(),r(M,{key:2,message:"百分比抽样模式",description:"需要设置抽样比率（1-100%）",type:"warning","show-icon":"",style:{"margin-bottom":"16px"}})):i.samplingMethod==="FULL_INSPECTION"?(o(),r(M,{key:3,message:"全检模式",description:"无需配置额外参数",type:"default","show-icon":"",style:{"margin-bottom":"16px"}})):_("",!0),i.samplingMethod==="STANDARD_BASED"?(o(),r(N,{key:4,gutter:16},{default:t(()=>[a(v,{span:8},{default:t(()=>[a(c,{label:"检验水平"},{default:t(()=>[a(x,{value:s.inspectionLevel,"onUpdate:value":e[8]||(e[8]=l=>s.inspectionLevel=l)},{default:t(()=>[a(b,{value:"I"},{default:t(()=>[...e[23]||(e[23]=[d("I",-1)])]),_:1}),a(b,{value:"II"},{default:t(()=>[...e[24]||(e[24]=[d("II",-1)])]),_:1}),a(b,{value:"III"},{default:t(()=>[...e[25]||(e[25]=[d("III",-1)])]),_:1}),a(b,{value:"S1"},{default:t(()=>[...e[26]||(e[26]=[d("S1",-1)])]),_:1}),a(b,{value:"S2"},{default:t(()=>[...e[27]||(e[27]=[d("S2",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(v,{span:8},{default:t(()=>[a(c,{label:"检验类型"},{default:t(()=>[a(x,{value:s.inspectionType,"onUpdate:value":e[9]||(e[9]=l=>s.inspectionType=l)},{default:t(()=>[a(b,{value:"NORMAL"},{default:t(()=>[...e[28]||(e[28]=[d("正常检验",-1)])]),_:1}),a(b,{value:"STRICT"},{default:t(()=>[...e[29]||(e[29]=[d("加严检验",-1)])]),_:1}),a(b,{value:"REDUCED"},{default:t(()=>[...e[30]||(e[30]=[d("放宽检验",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(v,{span:8},{default:t(()=>[a(c,{label:"AQL值"},{default:t(()=>[a(g,{value:s.aqlValue,"onUpdate:value":e[10]||(e[10]=l=>s.aqlValue=l),min:0,step:.1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})):_("",!0),i.samplingMethod==="FIXED_QUANTITY"?(o(),r(N,{key:5,gutter:16},{default:t(()=>[a(v,{span:12},{default:t(()=>[a(c,{label:"样本量",required:""},{default:t(()=>[a(g,{value:s.sampleSize,"onUpdate:value":e[11]||(e[11]=l=>s.sampleSize=l),min:1,placeholder:"请输入样本数量",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})):_("",!0),i.samplingMethod==="PERCENTAGE"?(o(),r(N,{key:6,gutter:16},{default:t(()=>[a(v,{span:12},{default:t(()=>[a(c,{label:"样本量比率 (%)",required:""},{default:t(()=>[a(g,{value:s.sampleSizeRate,"onUpdate:value":e[12]||(e[12]=l=>s.sampleSizeRate=l),min:1,max:100,placeholder:"请输入1-100的整数",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})):_("",!0),i.samplingMethod==="STANDARD_BASED"?(o(),h(ge,{key:7},[a(be,null,{default:t(()=>[...e[31]||(e[31]=[d("抽样明细",-1)])]),_:1}),k("div",xe,[a(m,{type:"dashed",size:"small",onClick:le},{default:t(()=>[a(B(G)),e[32]||(e[32]=d(" 添加明细 ",-1))]),_:1})]),a(w,{columns:W,"data-source":s.details,pagination:!1,size:"small",bordered:""},{bodyCell:t(({column:l,record:p,index:U})=>[l.key==="batchSizeMin"?(o(),r(g,{key:0,value:p.batchSizeMin,"onUpdate:value":f=>p.batchSizeMin=f,min:1,size:"small",style:{width:"100%"}},null,8,["value","onUpdate:value"])):l.key==="batchSizeMax"?(o(),r(g,{key:1,value:p.batchSizeMax,"onUpdate:value":f=>p.batchSizeMax=f,min:1,size:"small",style:{width:"100%"}},null,8,["value","onUpdate:value"])):l.key==="sampleSizeCode"?(o(),r(C,{key:2,value:p.sampleSizeCode,"onUpdate:value":f=>p.sampleSizeCode=f,size:"small",placeholder:"A/B/C..."},null,8,["value","onUpdate:value"])):l.key==="acceptanceNumber"?(o(),r(g,{key:3,value:p.acceptanceNumber,"onUpdate:value":f=>p.acceptanceNumber=f,min:0,size:"small",style:{width:"100%"}},null,8,["value","onUpdate:value"])):l.key==="rejectionNumber"?(o(),r(g,{key:4,value:p.rejectionNumber,"onUpdate:value":f=>p.rejectionNumber=f,min:1,size:"small",style:{width:"100%"}},null,8,["value","onUpdate:value"])):l.key==="action"?(o(),r(m,{key:5,type:"link",danger:"",size:"small",onClick:f=>ne(U)},{default:t(()=>[...e[33]||(e[33]=[d("删除",-1)])]),_:1},8,["onClick"])):_("",!0)]),_:1},8,["data-source"])],64)):_("",!0)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),je=Ce(we,[["__scopeId","data-v-644b6f4a"]]);export{je as default};
