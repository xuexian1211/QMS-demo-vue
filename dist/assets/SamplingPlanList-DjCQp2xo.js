import{d as ke,r,a as Z,k as ee,m as Ne,c as M,e as i,x as l,q as a,s as o,p as T,t as k,o as _,y as N,P as le,R as Ie,S as ge,h as s,F as Se,z as xe,n as Le,H as Te,w as B,G as Re,I as we,f as Ae,u as ze,M as V,C as I}from"./index-BPMZt9Bz.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"page-container"},De={class:"split-layout"},Oe={class:"left-panel"},Pe={class:"panel-header"},Ue={class:"search-box"},he={class:"plan-list"},Be=["onClick"],Ve={class:"plan-item-header"},qe={class:"plan-code"},$e={class:"plan-name"},je={class:"plan-desc"},Fe={class:"plan-actions"},Qe={class:"right-panel"},Ge={key:1,class:"content-wrapper"},Xe={class:"right-header"},Ye={class:"header-info"},Ke={class:"plan-title"},He={class:"plan-meta"},We={class:"header-actions"},Je={class:"rules-table-container"},Ze={class:"detail-table-wrapper"},el={class:"detail-header"},ll={class:"detail-title"},al=ke({__name:"SamplingPlanList",setup(tl){const E=ze(),D=r(!1),c=r([]),R=r(""),S=r(void 0),C=r(null),O=r(!1),v=r([]),y=r([]),P=r(!1),q=r(!1),p=Z({id:null,planCode:"",planName:"",samplingMethod:"STANDARD_BASED",description:""}),$=ee(()=>{let n=c.value;if(R.value){const e=R.value.toLowerCase();n=n.filter(m=>m.planCode.toLowerCase().includes(e)||m.planName.toLowerCase().includes(e))}return S.value!==void 0&&(S.value===null?n=n.filter(e=>e.orgId===null):n=n.filter(e=>e.orgId===S.value)),n}),U=ee(()=>c.value.find(n=>n.id===C.value)),j=()=>{D.value=!0,setTimeout(()=>{c.value=[{id:1,planCode:"AQL-GB2828",planName:"GB/T 2828.1-2012",samplingMethod:"STANDARD_BASED",standard:"GB/T 2828.1",description:"基于国标的AQL抽样"},{id:2,planCode:"FIX-QTY",planName:"固定数量抽样",samplingMethod:"FIXED_QUANTITY",standard:"内部标准",description:"不管多少只抽5个"},{id:3,planCode:"PERCENT-10",planName:"10%抽样",samplingMethod:"PERCENTAGE",standard:"内部标准",description:"按数量10%抽"}],D.value=!1,c.value.length>0&&!C.value&&F(c.value[0])},500)},F=n=>{C.value=n.id,de(n.id)},ae=()=>{E.push("/inspection-model/sampling-plans/create")},te=n=>{E.push(`/inspection-model/sampling-plans/view/${n.id}`)},ne=n=>{E.push(`/inspection-model/sampling-plans/edit/${n.id}`)},se=n=>{V.confirm({title:"确认删除",content:`确定删除方案 ${n.planName} 吗？`,okType:"danger",onOk(){c.value=c.value.filter(e=>e.id!==n.id),C.value===n.id&&(C.value=null,v.value=[]),I.success("删除成功")}})},ie=()=>{if(!p.planCode||!p.planName){I.error("请填写必填项");return}if(q.value){const n=c.value.findIndex(e=>e.id===p.id);n!==-1&&Object.assign(c.value[n],{...p})}else c.value.push({...p,id:Date.now()});P.value=!1,I.success("保存成功")},oe=[{title:"规则代码",dataIndex:"ruleCode",key:"ruleCode"},{title:"规则名称",dataIndex:"ruleName",key:"ruleName"},{title:"检验水平",dataIndex:"inspectionLevel",key:"inspectionLevel",width:100},{title:"类型",dataIndex:"inspectionType",key:"inspectionType",width:100},{title:"AQL值",dataIndex:"aqlValue",key:"aqlValue",width:80},{title:"操作",key:"action",width:150}],Q=[{title:"批量下限",dataIndex:"batchSizeMin",key:"batchSizeMin"},{title:"批量上限",dataIndex:"batchSizeMax",key:"batchSizeMax"},{title:"样本量字码",dataIndex:"sampleSizeCode",key:"sampleSizeCode"},{title:"Ac(接收)",dataIndex:"acceptanceNumber",key:"acceptanceNumber"},{title:"Re(拒收)",dataIndex:"rejectionNumber",key:"rejectionNumber"}],de=n=>{O.value=!0,y.value=[],setTimeout(()=>{n===1?v.value=[{id:101,ruleCode:"GB-L2-N-0.65",ruleName:"Level II 正常 AQL 0.65",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:.65,details:[{id:1,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1},{id:2,batchSizeMin:9,batchSizeMax:15,sampleSizeCode:"B",acceptanceNumber:0,rejectionNumber:1},{id:3,batchSizeMin:16,batchSizeMax:25,sampleSizeCode:"C",acceptanceNumber:0,rejectionNumber:1}]},{id:102,ruleCode:"GB-L2-S-0.65",ruleName:"Level II 加严 AQL 0.65",inspectionLevel:"II",inspectionType:"STRICT",aqlValue:.65,details:[{id:4,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1}]}]:v.value=[],O.value=!1},300)},ue=n=>{y.value=n},pe=()=>{const n={id:Date.now(),ruleCode:"NEW-RULE",ruleName:"新规则",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,details:[]};v.value.push(n),I.success("已添加新规则")},re=()=>{V.confirm({title:"确认删除",content:`确定删除选中的 ${y.value.length} 条规则吗？`,okType:"danger",onOk(){v.value=v.value.filter(n=>!y.value.includes(n.id)),y.value=[],I.success("批量删除成功")}})},w=r(!1),b=r(!1),d=Z({id:null,ruleCode:"",ruleName:"",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,details:[]}),ve=n=>{b.value=!0,Object.assign(d,{...n,details:[...n.details||[]]}),w.value=!0},ce=()=>{if(b.value){const n=v.value.findIndex(e=>e.id===d.id);n!==-1&&Object.assign(v.value[n],{...d,details:[...d.details]}),I.success("规则已更新")}w.value=!1},me=n=>{V.confirm({title:"确认删除",content:`确定删除规则 ${n.ruleName} 吗？`,okType:"danger",onOk(){v.value=v.value.filter(e=>e.id!==n.id),I.success("删除成功")}})};return Ne(()=>{j()}),(n,e)=>{var J;const m=o("a-button"),G=o("a-tooltip"),X=o("a-space"),x=o("a-input"),u=o("a-select-option"),A=o("a-select"),Y=o("a-empty"),z=o("a-tag"),fe=o("a-spin"),h=o("a-table"),f=o("a-form-item"),_e=o("a-textarea"),K=o("a-form"),H=o("a-modal"),L=o("a-col"),W=o("a-row"),be=o("a-input-number"),Ce=o("a-divider");return _(),M("div",Ee,[i("div",De,[i("div",Oe,[i("div",Pe,[e[13]||(e[13]=i("span",{class:"panel-title"},"抽样方案",-1)),l(X,null,{default:a(()=>[l(G,{title:"新增方案"},{default:a(()=>[l(m,{type:"primary",size:"small",shape:"circle",onClick:ae},{icon:a(()=>[l(N(le))]),_:1})]),_:1}),l(G,{title:"刷新"},{default:a(()=>[l(m,{size:"small",shape:"circle",onClick:j},{icon:a(()=>[l(N(Ie))]),_:1})]),_:1})]),_:1})]),i("div",Ue,[l(x,{value:R.value,"onUpdate:value":e[0]||(e[0]=t=>R.value=t),placeholder:"搜索方案代码/名称","allow-clear":"",size:"small"},{prefix:a(()=>[l(N(ge))]),_:1},8,["value"]),l(A,{value:S.value,"onUpdate:value":e[1]||(e[1]=t=>S.value=t),placeholder:"组织过滤","allow-clear":"",size:"small",style:{width:"100%","margin-top":"8px"}},{default:a(()=>[l(u,{value:null},{default:a(()=>[...e[14]||(e[14]=[s("集团",-1)])]),_:1}),l(u,{value:1},{default:a(()=>[...e[15]||(e[15]=[s("合肥工厂",-1)])]),_:1}),l(u,{value:2},{default:a(()=>[...e[16]||(e[16]=[s("芜湖工厂",-1)])]),_:1})]),_:1},8,["value"])]),i("div",he,[l(fe,{spinning:D.value},{default:a(()=>[$.value.length===0?(_(),T(Y,{key:0,description:"暂无方案"})):(_(!0),M(Se,{key:1},xe($.value,t=>(_(),M("div",{key:t.id,class:Le(["plan-item",{active:C.value===t.id}]),onClick:g=>F(t)},[i("div",Ve,[i("span",qe,k(t.planCode),1),t.samplingMethod==="STANDARD_BASED"?(_(),T(z,{key:0,color:"blue"},{default:a(()=>[...e[17]||(e[17]=[s("国标",-1)])]),_:1})):(_(),T(z,{key:1,color:"cyan"},{default:a(()=>[...e[18]||(e[18]=[s("自定义",-1)])]),_:1}))]),i("div",$e,k(t.planName),1),i("div",je,k(t.description||"无描述"),1),i("div",Fe,[l(N(Te),{class:"action-icon",onClick:B(g=>te(t),["stop"])},null,8,["onClick"]),l(N(Re),{class:"action-icon",onClick:B(g=>ne(t),["stop"])},null,8,["onClick"]),l(N(we),{class:"action-icon",onClick:B(g=>se(t),["stop"])},null,8,["onClick"])])],10,Be))),128))]),_:1},8,["spinning"])])]),i("div",Qe,[C.value?(_(),M("div",Ge,[i("div",Xe,[i("div",Ye,[i("div",Ke,k((J=U.value)==null?void 0:J.planName),1),i("div",He,[l(z,null,{default:a(()=>{var t;return[s("代码: "+k((t=U.value)==null?void 0:t.planCode),1)]}),_:1}),l(z,null,{default:a(()=>{var t;return[s("标准: "+k(((t=U.value)==null?void 0:t.standard)||"-"),1)]}),_:1})])]),i("div",We,[l(m,{type:"primary",onClick:pe},{icon:a(()=>[l(N(le))]),default:a(()=>[e[19]||(e[19]=s(" 新增规则 ",-1))]),_:1}),l(m,{danger:"",disabled:y.value.length===0,onClick:re},{default:a(()=>[...e[20]||(e[20]=[s(" 批量删除 ",-1)])]),_:1},8,["disabled"])])]),i("div",Je,[l(h,{columns:oe,"data-source":v.value,loading:O.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:y.value,onChange:ue},pagination:!1,class:"rules-table"},{bodyCell:a(({column:t,record:g})=>[t.key==="action"?(_(),T(X,{key:0},{default:a(()=>[l(m,{type:"link",size:"small",onClick:ye=>ve(g)},{default:a(()=>[...e[21]||(e[21]=[s("编辑",-1)])]),_:1},8,["onClick"]),l(m,{type:"link",danger:"",size:"small",onClick:ye=>me(g)},{default:a(()=>[...e[22]||(e[22]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):Ae("",!0)]),expandedRowRender:a(({record:t})=>[i("div",Ze,[i("div",el,[i("span",ll,"抽样明细 ("+k(t.ruleCode)+")",1)]),l(h,{columns:Q,"data-source":t.details,"row-key":"id",size:"small",pagination:!1,bordered:!0},null,8,["data-source"])])]),_:1},8,["data-source","loading","row-selection"])])])):(_(),T(Y,{key:0,description:"请选择左侧方案查看规则",class:"empty-state"}))])]),l(H,{visible:P.value,"onUpdate:visible":e[6]||(e[6]=t=>P.value=t),title:q.value?"编辑抽样方案":"新增抽样方案",onOk:ie},{default:a(()=>[l(K,{layout:"vertical",model:p},{default:a(()=>[l(f,{label:"方案代码",required:""},{default:a(()=>[l(x,{value:p.planCode,"onUpdate:value":e[2]||(e[2]=t=>p.planCode=t)},null,8,["value"])]),_:1}),l(f,{label:"方案名称",required:""},{default:a(()=>[l(x,{value:p.planName,"onUpdate:value":e[3]||(e[3]=t=>p.planName=t)},null,8,["value"])]),_:1}),l(f,{label:"抽样方法",required:""},{default:a(()=>[l(A,{value:p.samplingMethod,"onUpdate:value":e[4]||(e[4]=t=>p.samplingMethod=t)},{default:a(()=>[l(u,{value:"STANDARD_BASED"},{default:a(()=>[...e[23]||(e[23]=[s("国标/标准",-1)])]),_:1}),l(u,{value:"FIXED_QUANTITY"},{default:a(()=>[...e[24]||(e[24]=[s("固定数量",-1)])]),_:1}),l(u,{value:"PERCENTAGE"},{default:a(()=>[...e[25]||(e[25]=[s("百分比",-1)])]),_:1}),l(u,{value:"FULL_INSPECTION"},{default:a(()=>[...e[26]||(e[26]=[s("全检",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(f,{label:"描述"},{default:a(()=>[l(_e,{value:p.description,"onUpdate:value":e[5]||(e[5]=t=>p.description=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),l(H,{visible:w.value,"onUpdate:visible":e[12]||(e[12]=t=>w.value=t),title:b.value?"编辑规则":"规则详情",width:"700px",onOk:ce},{default:a(()=>[l(K,{layout:"vertical",model:d},{default:a(()=>[l(W,{gutter:16},{default:a(()=>[l(L,{span:12},{default:a(()=>[l(f,{label:"规则代码",required:""},{default:a(()=>[l(x,{value:d.ruleCode,"onUpdate:value":e[7]||(e[7]=t=>d.ruleCode=t),disabled:!b.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(L,{span:12},{default:a(()=>[l(f,{label:"规则名称",required:""},{default:a(()=>[l(x,{value:d.ruleName,"onUpdate:value":e[8]||(e[8]=t=>d.ruleName=t),disabled:!b.value},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),l(W,{gutter:16},{default:a(()=>[l(L,{span:8},{default:a(()=>[l(f,{label:"检验水平"},{default:a(()=>[l(A,{value:d.inspectionLevel,"onUpdate:value":e[9]||(e[9]=t=>d.inspectionLevel=t),disabled:!b.value},{default:a(()=>[l(u,{value:"I"},{default:a(()=>[...e[27]||(e[27]=[s("I",-1)])]),_:1}),l(u,{value:"II"},{default:a(()=>[...e[28]||(e[28]=[s("II",-1)])]),_:1}),l(u,{value:"III"},{default:a(()=>[...e[29]||(e[29]=[s("III",-1)])]),_:1}),l(u,{value:"S1"},{default:a(()=>[...e[30]||(e[30]=[s("S1",-1)])]),_:1}),l(u,{value:"S2"},{default:a(()=>[...e[31]||(e[31]=[s("S2",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),l(L,{span:8},{default:a(()=>[l(f,{label:"检验类型"},{default:a(()=>[l(A,{value:d.inspectionType,"onUpdate:value":e[10]||(e[10]=t=>d.inspectionType=t),disabled:!b.value},{default:a(()=>[l(u,{value:"NORMAL"},{default:a(()=>[...e[32]||(e[32]=[s("正常检验",-1)])]),_:1}),l(u,{value:"STRICT"},{default:a(()=>[...e[33]||(e[33]=[s("加严检验",-1)])]),_:1}),l(u,{value:"REDUCED"},{default:a(()=>[...e[34]||(e[34]=[s("放宽检验",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),l(L,{span:8},{default:a(()=>[l(f,{label:"AQL值"},{default:a(()=>[l(be,{value:d.aqlValue,"onUpdate:value":e[11]||(e[11]=t=>d.aqlValue=t),disabled:!b.value,min:0,step:.1,style:{width:"100%"}},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),l(Ce,null,{default:a(()=>[...e[35]||(e[35]=[s("抽样明细",-1)])]),_:1}),l(h,{columns:Q,"data-source":d.details,pagination:!1,size:"small",bordered:""},null,8,["data-source"])]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),il=Me(al,[["__scopeId","data-v-43fed743"]]);export{il as default};
