import{u as be}from"./excel-B07CBqJs.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,a as U,k as ke,m as Ie,c as Ne,o as $,e as G,x as t,q as a,s,h as o,y as I,P as we,G as xe,I as Oe,Y as Te,R as Se,p as J,f as Q,t as y,M as h,C}from"./index-BsO03Xlk.js";import{E as Ee}from"./ExportOutlined-3X2_SK8n.js";const De={class:"page-container"},Me={class:"toolbar"},Ue={class:"table-container"},$e={__name:"MaterialCategory",setup(he){const E=f(!1),b=f(!1),V=f(!1),N=f(!1),m=f(!1),D=f(),c=f([]),i=U({categoryName:"",categoryCode:"",status:void 0}),r=U({id:"",categoryName:"",categoryCode:"",parentId:void 0,sortOrder:0,description:"",status:"1"}),W=[{title:"分类名称",dataIndex:"categoryName",key:"categoryName",width:150},{title:"分类编码",dataIndex:"categoryCode",key:"categoryCode",width:120},{title:"上级分类",dataIndex:"parentName",key:"parentName",width:120},{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,sorter:!0},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:150},{title:"操作",key:"action",width:180,fixed:"right"}],u=f([{id:"1",categoryName:"原材料",categoryCode:"RAW_MATERIAL",parentName:"无",parentId:null,sortOrder:1,description:"生产用原材料分类",status:"1",createTime:"2024-01-15 10:30:00",updateTime:"2024-01-15 10:30:00"},{id:"2",categoryName:"金属材料",categoryCode:"METAL",parentName:"原材料",parentId:"1",sortOrder:1,description:"各类金属材料",status:"1",createTime:"2024-01-15 10:35:00",updateTime:"2024-01-15 10:35:00"},{id:"3",categoryName:"非金属材料",categoryCode:"NON_METAL",parentName:"原材料",parentId:"1",sortOrder:2,description:"各类非金属材料",status:"1",createTime:"2024-01-15 10:40:00",updateTime:"2024-01-15 10:40:00"},{id:"4",categoryName:"半成品",categoryCode:"SEMI_FINISHED",parentName:"无",parentId:null,sortOrder:2,description:"生产过程中的半成品",status:"1",createTime:"2024-01-15 10:45:00",updateTime:"2024-01-15 10:45:00"},{id:"5",categoryName:"成品",categoryCode:"FINISHED",parentName:"无",parentId:null,sortOrder:3,description:"最终产品",status:"1",createTime:"2024-01-15 10:50:00",updateTime:"2024-01-15 10:50:00"}]),w=U({current:1,pageSize:20,total:5,showSizeChanger:!0,showQuickJumper:!0}),M=f([{title:"无",value:null,key:"null"},{title:"原材料",value:"1",key:"1",children:[{title:"金属材料",value:"2",key:"2"},{title:"非金属材料",value:"3",key:"3"}]},{title:"半成品",value:"4",key:"4"},{title:"成品",value:"5",key:"5"}]),g=f({}),Y={categoryName:[{required:!0,message:"请输入分类名称",trigger:"blur"}],categoryCode:[{required:!0,message:"请输入分类编码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"分类编码只能包含大写字母和下划线",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入排序号",trigger:"blur"}]},Z=ke(()=>m.value?"查看分类":N.value?"编辑分类":"新增分类"),X=l=>{c.value=l},z=()=>{w.current=1,k()},ee=()=>{Object.assign(i,{categoryName:"",categoryCode:"",status:void 0}),z()},te=l=>{w.current=l.current,w.pageSize=l.pageSize,k()},ae=()=>{N.value=!1,b.value=!0,A()},le=()=>{const l=u.value.find(e=>e.id===c.value[0]);l&&R(l)},R=l=>{N.value=!0,m.value=!1,b.value=!0,Object.assign(r,{...l,parentId:l.parentId})},oe=l=>{N.value=!0,m.value=!0,Object.assign(r,{...l,parentId:l.parentId}),b.value=!0},ne=l=>{h.confirm({title:"确认删除",content:`确定删除分类 ${l.categoryName} 吗？`,okType:"danger",onOk(){const e=u.value.findIndex(n=>n.id===l.id);e>-1&&(u.value.splice(e,1),C.success("删除成功"),k())}})},de=()=>{h.confirm({title:"确认批量删除",content:`确定删除选中的 ${c.value.length} 条记录吗？`,okType:"danger",onOk(){u.value=u.value.filter(l=>!c.value.includes(l.id)),c.value=[],C.success("删除成功")}})},re=async()=>{var l,e;try{if(await D.value.validate(),N.value){const n=u.value.findIndex(p=>p.id===r.id);if(n>-1){const p=r.parentId?(l=M.value.find(x=>x.value===r.parentId))==null?void 0:l.title:"无";u.value[n]={...r,parentName:p,updateTime:new Date().toLocaleString()},C.success("更新成功")}}else{const n=(Math.max(...u.value.map(O=>parseInt(O.id)))+1).toString(),p=r.parentId?(e=M.value.find(O=>O.value===r.parentId))==null?void 0:e.title:"无",x={...r,id:n,parentName:p,createTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString()};u.value.push(x),C.success("新增成功")}b.value=!1,k()}catch(n){console.error("表单验证失败:",n)}},se=()=>{b.value=!1,A()},A=()=>{var l;Object.assign(r,{id:"",categoryName:"",categoryCode:"",parentId:void 0,sortOrder:0,description:"",status:"1"}),(l=D.value)==null||l.resetFields()},ie=()=>{if(u.value.length===0){C.warning("暂无数据可导出");return}const l=[{title:"分类名称",dataIndex:"categoryName"},{title:"分类编码",dataIndex:"categoryCode"},{title:"上级分类",dataIndex:"parentName"},{title:"排序",dataIndex:"sortOrder"},{title:"状态",dataIndex:"status"},{title:"描述",dataIndex:"description"},{title:"创建时间",dataIndex:"createTime"}],{exportToCSV:e}=be();e(u.value,l,"物料分类"),C.success("导出成功")},ue=({key:l})=>{const e=l==="enable"?"1":"0",n=l==="enable"?"启用":"禁用";h.confirm({title:`确认批量${n}`,content:`确定${n}选中的 ${c.value.length} 条记录吗？`,onOk(){u.value.forEach(p=>{c.value.includes(p.id)&&(p.status=e)}),c.value=[],C.success(`批量${n}成功`)}})},k=()=>{E.value=!0,setTimeout(()=>{let l=[...u.value];i.categoryName&&(l=l.filter(e=>e.categoryName.includes(i.categoryName))),i.categoryCode&&(l=l.filter(e=>e.categoryCode.includes(i.categoryCode))),i.status!==void 0&&(l=l.filter(e=>e.status===i.status)),w.total=l.length,E.value=!1},300)};return Ie(()=>{k()}),(l,e)=>{const n=s("a-button"),p=s("a-menu-item"),x=s("a-menu"),O=s("a-dropdown"),B=s("a-space"),S=s("a-input"),v=s("a-form-item"),L=s("a-select-option"),ce=s("a-select"),F=s("a-form"),pe=s("a-card"),j=s("a-tag"),q=s("a-divider"),me=s("a-table"),ve=s("a-tree-select"),fe=s("a-input-number"),ge=s("a-textarea"),H=s("a-radio"),ye=s("a-radio-group"),K=s("a-modal"),_=s("a-descriptions-item"),_e=s("a-descriptions");return $(),Ne("div",De,[G("div",Me,[t(B,null,{default:a(()=>[t(n,{type:"primary",onClick:ae},{icon:a(()=>[t(I(we))]),default:a(()=>[e[11]||(e[11]=o("新增 ",-1))]),_:1}),t(n,{disabled:c.value.length!==1,onClick:le},{icon:a(()=>[t(I(xe))]),default:a(()=>[e[12]||(e[12]=o("编辑 ",-1))]),_:1},8,["disabled"]),t(n,{danger:"",disabled:c.value.length===0,onClick:de},{icon:a(()=>[t(I(Oe))]),default:a(()=>[e[13]||(e[13]=o("删除 ",-1))]),_:1},8,["disabled"]),t(O,{disabled:c.value.length===0},{overlay:a(()=>[t(x,{onClick:ue},{default:a(()=>[t(p,{key:"enable"},{default:a(()=>[...e[15]||(e[15]=[o("批量启用",-1)])]),_:1}),t(p,{key:"disable"},{default:a(()=>[...e[16]||(e[16]=[o("批量禁用",-1)])]),_:1})]),_:1})]),default:a(()=>[t(n,null,{default:a(()=>[e[14]||(e[14]=o("状态操作 ",-1)),t(I(Te))]),_:1})]),_:1},8,["disabled"]),t(n,{onClick:ie},{icon:a(()=>[t(I(Ee))]),default:a(()=>[e[17]||(e[17]=o("导出 ",-1))]),_:1}),t(n,{onClick:k},{icon:a(()=>[t(I(Se))]),default:a(()=>[e[18]||(e[18]=o("刷新 ",-1))]),_:1})]),_:1})]),t(pe,{class:"search-card",bordered:!1},{default:a(()=>[t(F,{layout:"inline",model:i},{default:a(()=>[t(v,{label:"分类名称"},{default:a(()=>[t(S,{value:i.categoryName,"onUpdate:value":e[0]||(e[0]=d=>i.categoryName=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(v,{label:"分类编码"},{default:a(()=>[t(S,{value:i.categoryCode,"onUpdate:value":e[1]||(e[1]=d=>i.categoryCode=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(v,{label:"状态"},{default:a(()=>[t(ce,{value:i.status,"onUpdate:value":e[2]||(e[2]=d=>i.status=d),style:{width:"120px"},placeholder:"请选择","allow-clear":""},{default:a(()=>[t(L,{value:"1"},{default:a(()=>[...e[19]||(e[19]=[o("启用",-1)])]),_:1}),t(L,{value:"0"},{default:a(()=>[...e[20]||(e[20]=[o("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(v,null,{default:a(()=>[t(n,{type:"primary",onClick:z},{default:a(()=>[...e[21]||(e[21]=[o("查询",-1)])]),_:1}),t(n,{style:{"margin-left":"8px"},onClick:ee},{default:a(()=>[...e[22]||(e[22]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),G("div",Ue,[t(me,{columns:W,"data-source":u.value,loading:E.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:c.value,onChange:X},pagination:w,onChange:te},{bodyCell:a(({column:d,record:T})=>[d.key==="status"?($(),J(j,{key:0,color:T.status==="1"?"green":"red"},{default:a(()=>[o(y(T.status==="1"?"启用":"禁用"),1)]),_:2},1032,["color"])):Q("",!0),d.key==="action"?($(),J(B,{key:1},{default:a(()=>[t(n,{type:"link",size:"small",onClick:P=>oe(T)},{default:a(()=>[...e[23]||(e[23]=[o("查看",-1)])]),_:1},8,["onClick"]),t(q,{type:"vertical"}),t(n,{type:"link",size:"small",onClick:P=>R(T)},{default:a(()=>[...e[24]||(e[24]=[o("编辑",-1)])]),_:1},8,["onClick"]),t(q,{type:"vertical"}),t(n,{type:"link",danger:"",size:"small",onClick:P=>ne(T)},{default:a(()=>[...e[25]||(e[25]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):Q("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(K,{visible:b.value,"onUpdate:visible":e[9]||(e[9]=d=>b.value=d),title:Z.value,width:"600px",onOk:re,onCancel:se,footer:m.value?null:void 0},{default:a(()=>[t(F,{ref_key:"formRef",ref:D,model:r,rules:Y,layout:"vertical"},{default:a(()=>[t(v,{label:"分类名称",name:"categoryName"},{default:a(()=>[t(S,{value:r.categoryName,"onUpdate:value":e[3]||(e[3]=d=>r.categoryName=d),placeholder:"请输入分类名称",disabled:m.value},null,8,["value","disabled"])]),_:1}),t(v,{label:"分类编码",name:"categoryCode"},{default:a(()=>[t(S,{value:r.categoryCode,"onUpdate:value":e[4]||(e[4]=d=>r.categoryCode=d),placeholder:"请输入分类编码",disabled:m.value},null,8,["value","disabled"])]),_:1}),t(v,{label:"上级分类",name:"parentId"},{default:a(()=>[t(ve,{value:r.parentId,"onUpdate:value":e[5]||(e[5]=d=>r.parentId=d),"tree-data":M.value,placeholder:"请选择上级分类","allow-clear":"","tree-default-expand-all":"",disabled:m.value},null,8,["value","tree-data","disabled"])]),_:1}),t(v,{label:"排序",name:"sortOrder"},{default:a(()=>[t(fe,{value:r.sortOrder,"onUpdate:value":e[6]||(e[6]=d=>r.sortOrder=d),placeholder:"请输入排序号",min:0,style:{width:"100%"},disabled:m.value},null,8,["value","disabled"])]),_:1}),t(v,{label:"描述",name:"description"},{default:a(()=>[t(ge,{value:r.description,"onUpdate:value":e[7]||(e[7]=d=>r.description=d),placeholder:"请输入分类描述",rows:3,disabled:m.value},null,8,["value","disabled"])]),_:1}),t(v,{label:"状态",name:"status"},{default:a(()=>[t(ye,{value:r.status,"onUpdate:value":e[8]||(e[8]=d=>r.status=d),disabled:m.value},{default:a(()=>[t(H,{value:"1"},{default:a(()=>[...e[26]||(e[26]=[o("启用",-1)])]),_:1}),t(H,{value:"0"},{default:a(()=>[...e[27]||(e[27]=[o("禁用",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","footer"]),t(K,{visible:V.value,"onUpdate:visible":e[10]||(e[10]=d=>V.value=d),title:"分类详情",width:"600px",footer:null},{default:a(()=>[t(_e,{column:2,bordered:""},{default:a(()=>[t(_,{label:"分类名称"},{default:a(()=>[o(y(g.value.categoryName),1)]),_:1}),t(_,{label:"分类编码"},{default:a(()=>[o(y(g.value.categoryCode),1)]),_:1}),t(_,{label:"上级分类"},{default:a(()=>[o(y(g.value.parentName||"无"),1)]),_:1}),t(_,{label:"排序"},{default:a(()=>[o(y(g.value.sortOrder),1)]),_:1}),t(_,{label:"状态"},{default:a(()=>[t(j,{color:g.value.status==="1"?"green":"red"},{default:a(()=>[o(y(g.value.status==="1"?"启用":"禁用"),1)]),_:1},8,["color"])]),_:1}),t(_,{label:"创建时间"},{default:a(()=>[o(y(g.value.createTime),1)]),_:1}),t(_,{label:"更新时间"},{default:a(()=>[o(y(g.value.updateTime),1)]),_:1}),t(_,{label:"描述",span:2},{default:a(()=>[o(y(g.value.description||"无"),1)]),_:1})]),_:1})]),_:1},8,["visible"])])}}},Be=Ce($e,[["__scopeId","data-v-b5aebc13"]]);export{Be as default};
