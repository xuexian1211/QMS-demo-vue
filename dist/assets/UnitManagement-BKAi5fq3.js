import{u as Ne}from"./excel-B07CBqJs.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as U,a as j,k as te,m as Ie,c as ae,o as C,e as le,x as t,q as a,s,h as n,y as I,P as Oe,G as Be,I as Fe,Y as Se,R as Me,p as M,f as V,t as v,F as De,z as Ee,M as L,C as k}from"./index-BhbkSrG8.js";import{E as $e}from"./ExportOutlined-iuxpVXnR.js";const ze={class:"page-container"},Ve={class:"toolbar"},Re={class:"table-container"},qe={__name:"UnitManagement",setup(je){const R=U(!1),w=U(!1),G=U(!1),O=U(!1),c=U(!1),q=U(),b=U([]),d=j({unitCode:"",unitName:"",unitType:void 0,status:void 0}),u=j({id:"",unitCode:"",unitName:"",unitType:void 0,baseUnitId:void 0,conversionFactor:1,isBaseUnit:"0",sortOrder:0,description:"",status:"1"}),ne=[{title:"单位编码",dataIndex:"unitCode",key:"unitCode",width:100},{title:"单位名称",dataIndex:"unitName",key:"unitName",width:120},{title:"单位类型",dataIndex:"unitType",key:"unitType",width:100},{title:"换算基准单位",dataIndex:"baseUnitName",key:"baseUnitName",width:120},{title:"换算系数",dataIndex:"conversionFactor",key:"conversionFactor",width:100,sorter:!0},{title:"基准单位",dataIndex:"isBaseUnit",key:"isBaseUnit",width:100},{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,sorter:!0},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:150},{title:"操作",key:"action",width:180,fixed:"right"}],r=U([{id:"1",unitCode:"KG",unitName:"千克",unitType:"weight",baseUnitId:null,baseUnitName:"无",conversionFactor:1,isBaseUnit:"1",sortOrder:1,description:"国际标准重量单位",status:"1",createTime:"2024-01-15 10:30:00",updateTime:"2024-01-15 10:30:00"},{id:"2",unitCode:"TON",unitName:"吨",unitType:"weight",baseUnitId:"1",baseUnitName:"千克",conversionFactor:1e3,isBaseUnit:"0",sortOrder:2,description:"重量单位，1吨=1000千克",status:"1",createTime:"2024-01-15 10:35:00",updateTime:"2024-01-15 10:35:00"},{id:"3",unitCode:"G",unitName:"克",unitType:"weight",baseUnitId:"1",baseUnitName:"千克",conversionFactor:.001,isBaseUnit:"0",sortOrder:3,description:"重量单位，1千克=1000克",status:"1",createTime:"2024-01-15 10:40:00",updateTime:"2024-01-15 10:40:00"},{id:"4",unitCode:"M",unitName:"米",unitType:"length",baseUnitId:null,baseUnitName:"无",conversionFactor:1,isBaseUnit:"1",sortOrder:1,description:"国际标准长度单位",status:"1",createTime:"2024-01-15 10:45:00",updateTime:"2024-01-15 10:45:00"},{id:"5",unitCode:"CM",unitName:"厘米",unitType:"length",baseUnitId:"4",baseUnitName:"米",conversionFactor:.01,isBaseUnit:"0",sortOrder:2,description:"长度单位，1米=100厘米",status:"1",createTime:"2024-01-15 10:50:00",updateTime:"2024-01-15 10:50:00"},{id:"6",unitCode:"PCS",unitName:"个",unitType:"count",baseUnitId:null,baseUnitName:"无",conversionFactor:1,isBaseUnit:"1",sortOrder:1,description:"数量单位",status:"1",createTime:"2024-01-15 10:55:00",updateTime:"2024-01-15 10:55:00"}]),B=j({current:1,pageSize:20,total:6,showSizeChanger:!0,showQuickJumper:!0}),f=U({}),ie=te(()=>r.value.filter(l=>l.isBaseUnit==="1")),ue={unitCode:[{required:!0,message:"请输入单位编码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"单位编码只能包含大写字母和下划线",trigger:"blur"}],unitName:[{required:!0,message:"请输入单位名称",trigger:"blur"}],unitType:[{required:!0,message:"请选择单位类型",trigger:"change"}],conversionFactor:[{required:!0,message:"请输入换算系数",trigger:"blur"}]},K=l=>({weight:"重量",length:"长度",volume:"体积",count:"数量",area:"面积",time:"时间"})[l]||"未知",P=l=>({weight:"purple",length:"blue",volume:"cyan",count:"green",area:"orange",time:"red"})[l]||"default",oe=l=>{if(!l)return"无";const e=r.value.find(o=>o.id===l);return e?e.unitName:"未知"},se=te(()=>c.value?"查看单位":O.value?"编辑单位":"新增单位"),de=l=>{b.value=l},A=()=>{B.current=1,N()},re=()=>{Object.assign(d,{unitCode:"",unitName:"",unitType:void 0,status:void 0}),A()},pe=l=>{B.current=l.current,B.pageSize=l.pageSize,N()},ve=()=>{O.value=!1,w.value=!0,Q()},fe=()=>{const l=r.value.find(e=>e.id===b.value[0]);l&&J(l)},J=l=>{O.value=!0,c.value=!1,w.value=!0,Object.assign(u,{...l})},me=l=>{O.value=!0,c.value=!0,Object.assign(u,{...l}),w.value=!0},ce=l=>{L.confirm({title:"确认删除",content:`确定删除单位 ${l.unitName} 吗？`,okType:"danger",onOk(){const e=r.value.findIndex(o=>o.id===l.id);e>-1&&(r.value.splice(e,1),k.success("删除成功"),N())}})},be=()=>{L.confirm({title:"确认批量删除",content:`确定删除选中的 ${b.value.length} 条记录吗？`,okType:"danger",onOk(){r.value=r.value.filter(l=>!b.value.includes(l.id)),b.value=[],k.success("删除成功")}})},_e=async()=>{var l,e;try{if(await q.value.validate(),O.value){const o=r.value.findIndex(_=>_.id===u.id);if(o>-1){const _=u.baseUnitId?(l=r.value.find(F=>F.id===u.baseUnitId))==null?void 0:l.unitName:"无";r.value[o]={...u,baseUnitName:_,updateTime:new Date().toLocaleString()},k.success("更新成功")}}else{const o=(Math.max(...r.value.map(S=>parseInt(S.id)))+1).toString(),_=u.baseUnitId?(e=r.value.find(S=>S.id===u.baseUnitId))==null?void 0:e.unitName:"无",F={...u,id:o,baseUnitName:_,createTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString()};r.value.push(F),k.success("新增成功")}w.value=!1,N()}catch(o){console.error("表单验证失败:",o)}},ge=()=>{w.value=!1,Q()},Q=()=>{var l;Object.assign(u,{id:"",unitCode:"",unitName:"",unitType:void 0,baseUnitId:void 0,conversionFactor:1,isBaseUnit:"0",sortOrder:0,description:"",status:"1"}),(l=q.value)==null||l.resetFields()},ye=()=>{if(r.value.length===0){k.warning("暂无数据可导出");return}const l=[{title:"单位编码",dataIndex:"unitCode"},{title:"单位名称",dataIndex:"unitName"},{title:"单位类型",dataIndex:"unitType"},{title:"换算基准单位",dataIndex:"baseUnitName"},{title:"换算系数",dataIndex:"conversionFactor"},{title:"状态",dataIndex:"status"},{title:"描述",dataIndex:"description"}],{exportToCSV:e}=Ne();e(r.value,l,"计量单位"),k.success("导出成功")},Ue=({key:l})=>{const e=l==="enable"?"1":"0",o=l==="enable"?"启用":"禁用";L.confirm({title:`确认批量${o}`,content:`确定${o}选中的 ${b.value.length} 条记录吗？`,onOk(){r.value.forEach(_=>{b.value.includes(_.id)&&(_.status=e)}),b.value=[],k.success(`批量${o}成功`)}})},N=()=>{R.value=!0,setTimeout(()=>{let l=[...r.value];d.unitCode&&(l=l.filter(e=>e.unitCode.includes(d.unitCode))),d.unitName&&(l=l.filter(e=>e.unitName.includes(d.unitName))),d.unitType&&(l=l.filter(e=>e.unitType===d.unitType)),d.status!==void 0&&(l=l.filter(e=>e.status===d.status)),B.total=l.length,R.value=!1},300)};return Ie(()=>{N()}),(l,e)=>{const o=s("a-button"),_=s("a-menu-item"),F=s("a-menu"),S=s("a-dropdown"),Y=s("a-space"),D=s("a-input"),m=s("a-form-item"),p=s("a-select-option"),E=s("a-select"),Z=s("a-form"),Te=s("a-card"),x=s("a-tag"),H=s("a-divider"),we=s("a-table"),T=s("a-col"),$=s("a-row"),W=s("a-input-number"),z=s("a-radio"),X=s("a-radio-group"),Ce=s("a-textarea"),h=s("a-modal"),g=s("a-descriptions-item"),ke=s("a-descriptions");return C(),ae("div",ze,[le("div",Ve,[t(Y,null,{default:a(()=>[t(o,{type:"primary",onClick:ve},{icon:a(()=>[t(I(Oe))]),default:a(()=>[e[15]||(e[15]=n("新增 ",-1))]),_:1}),t(o,{disabled:b.value.length!==1,onClick:fe},{icon:a(()=>[t(I(Be))]),default:a(()=>[e[16]||(e[16]=n("编辑 ",-1))]),_:1},8,["disabled"]),t(o,{danger:"",disabled:b.value.length===0,onClick:be},{icon:a(()=>[t(I(Fe))]),default:a(()=>[e[17]||(e[17]=n("删除 ",-1))]),_:1},8,["disabled"]),t(S,{disabled:b.value.length===0},{overlay:a(()=>[t(F,{onClick:Ue},{default:a(()=>[t(_,{key:"enable"},{default:a(()=>[...e[19]||(e[19]=[n("批量启用",-1)])]),_:1}),t(_,{key:"disable"},{default:a(()=>[...e[20]||(e[20]=[n("批量禁用",-1)])]),_:1})]),_:1})]),default:a(()=>[t(o,null,{default:a(()=>[e[18]||(e[18]=n("状态操作 ",-1)),t(I(Se))]),_:1})]),_:1},8,["disabled"]),t(o,{onClick:ye},{icon:a(()=>[t(I($e))]),default:a(()=>[e[21]||(e[21]=n("导出 ",-1))]),_:1}),t(o,{onClick:N},{icon:a(()=>[t(I(Me))]),default:a(()=>[e[22]||(e[22]=n("刷新 ",-1))]),_:1})]),_:1})]),t(Te,{class:"search-card",bordered:!1},{default:a(()=>[t(Z,{layout:"inline",model:d},{default:a(()=>[t(m,{label:"单位编码"},{default:a(()=>[t(D,{value:d.unitCode,"onUpdate:value":e[0]||(e[0]=i=>d.unitCode=i),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(m,{label:"单位名称"},{default:a(()=>[t(D,{value:d.unitName,"onUpdate:value":e[1]||(e[1]=i=>d.unitName=i),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(m,{label:"单位类型"},{default:a(()=>[t(E,{value:d.unitType,"onUpdate:value":e[2]||(e[2]=i=>d.unitType=i),style:{width:"120px"},placeholder:"请选择","allow-clear":""},{default:a(()=>[t(p,{value:"weight"},{default:a(()=>[...e[23]||(e[23]=[n("重量",-1)])]),_:1}),t(p,{value:"length"},{default:a(()=>[...e[24]||(e[24]=[n("长度",-1)])]),_:1}),t(p,{value:"volume"},{default:a(()=>[...e[25]||(e[25]=[n("体积",-1)])]),_:1}),t(p,{value:"count"},{default:a(()=>[...e[26]||(e[26]=[n("数量",-1)])]),_:1}),t(p,{value:"area"},{default:a(()=>[...e[27]||(e[27]=[n("面积",-1)])]),_:1}),t(p,{value:"time"},{default:a(()=>[...e[28]||(e[28]=[n("时间",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{label:"状态"},{default:a(()=>[t(E,{value:d.status,"onUpdate:value":e[3]||(e[3]=i=>d.status=i),style:{width:"100px"},placeholder:"请选择","allow-clear":""},{default:a(()=>[t(p,{value:"1"},{default:a(()=>[...e[29]||(e[29]=[n("启用",-1)])]),_:1}),t(p,{value:"0"},{default:a(()=>[...e[30]||(e[30]=[n("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(m,null,{default:a(()=>[t(o,{type:"primary",onClick:A},{default:a(()=>[...e[31]||(e[31]=[n("查询",-1)])]),_:1}),t(o,{style:{"margin-left":"8px"},onClick:re},{default:a(()=>[...e[32]||(e[32]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),le("div",Re,[t(we,{columns:ne,"data-source":r.value,loading:R.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:b.value,onChange:de},pagination:B,onChange:pe},{bodyCell:a(({column:i,record:y})=>[i.key==="unitType"?(C(),M(x,{key:0,color:P(y.unitType)},{default:a(()=>[n(v(K(y.unitType)),1)]),_:2},1032,["color"])):V("",!0),i.key==="status"?(C(),M(x,{key:1,color:y.status==="1"?"green":"red"},{default:a(()=>[n(v(y.status==="1"?"启用":"禁用"),1)]),_:2},1032,["color"])):V("",!0),i.key==="isBaseUnit"?(C(),M(x,{key:2,color:y.isBaseUnit==="1"?"blue":"default"},{default:a(()=>[n(v(y.isBaseUnit==="1"?"是":"否"),1)]),_:2},1032,["color"])):V("",!0),i.key==="action"?(C(),M(Y,{key:3},{default:a(()=>[t(o,{type:"link",size:"small",onClick:ee=>me(y)},{default:a(()=>[...e[33]||(e[33]=[n("查看",-1)])]),_:1},8,["onClick"]),t(H,{type:"vertical"}),t(o,{type:"link",size:"small",onClick:ee=>J(y)},{default:a(()=>[...e[34]||(e[34]=[n("编辑",-1)])]),_:1},8,["onClick"]),t(H,{type:"vertical"}),t(o,{type:"link",danger:"",size:"small",onClick:ee=>ce(y)},{default:a(()=>[...e[35]||(e[35]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):V("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(h,{visible:w.value,"onUpdate:visible":e[13]||(e[13]=i=>w.value=i),title:se.value,width:"600px",onOk:_e,onCancel:ge,footer:c.value?null:void 0},{default:a(()=>[t(Z,{ref_key:"formRef",ref:q,model:u,rules:ue,layout:"vertical"},{default:a(()=>[t($,{gutter:16},{default:a(()=>[t(T,{span:12},{default:a(()=>[t(m,{label:"单位编码",name:"unitCode"},{default:a(()=>[t(D,{value:u.unitCode,"onUpdate:value":e[4]||(e[4]=i=>u.unitCode=i),placeholder:"请输入单位编码",disabled:c.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(T,{span:12},{default:a(()=>[t(m,{label:"单位名称",name:"unitName"},{default:a(()=>[t(D,{value:u.unitName,"onUpdate:value":e[5]||(e[5]=i=>u.unitName=i),placeholder:"请输入单位名称",disabled:c.value},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t($,{gutter:16},{default:a(()=>[t(T,{span:12},{default:a(()=>[t(m,{label:"单位类型",name:"unitType"},{default:a(()=>[t(E,{value:u.unitType,"onUpdate:value":e[6]||(e[6]=i=>u.unitType=i),placeholder:"请选择单位类型",disabled:c.value},{default:a(()=>[t(p,{value:"weight"},{default:a(()=>[...e[36]||(e[36]=[n("重量",-1)])]),_:1}),t(p,{value:"length"},{default:a(()=>[...e[37]||(e[37]=[n("长度",-1)])]),_:1}),t(p,{value:"volume"},{default:a(()=>[...e[38]||(e[38]=[n("体积",-1)])]),_:1}),t(p,{value:"count"},{default:a(()=>[...e[39]||(e[39]=[n("数量",-1)])]),_:1}),t(p,{value:"area"},{default:a(()=>[...e[40]||(e[40]=[n("面积",-1)])]),_:1}),t(p,{value:"time"},{default:a(()=>[...e[41]||(e[41]=[n("时间",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),t(T,{span:12},{default:a(()=>[t(m,{label:"换算基准单位",name:"baseUnitId"},{default:a(()=>[t(E,{value:u.baseUnitId,"onUpdate:value":e[7]||(e[7]=i=>u.baseUnitId=i),placeholder:"请选择基准单位","allow-clear":"",disabled:c.value},{default:a(()=>[(C(!0),ae(De,null,Ee(ie.value,i=>(C(),M(p,{key:i.id,value:i.id},{default:a(()=>[n(v(i.unitName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t($,{gutter:16},{default:a(()=>[t(T,{span:12},{default:a(()=>[t(m,{label:"换算系数",name:"conversionFactor"},{default:a(()=>[t(W,{value:u.conversionFactor,"onUpdate:value":e[8]||(e[8]=i=>u.conversionFactor=i),placeholder:"请输入换算系数",min:0,precision:6,style:{width:"100%"},disabled:c.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(T,{span:12},{default:a(()=>[t(m,{label:"是否基准单位",name:"isBaseUnit"},{default:a(()=>[t(X,{value:u.isBaseUnit,"onUpdate:value":e[9]||(e[9]=i=>u.isBaseUnit=i),disabled:c.value},{default:a(()=>[t(z,{value:"1"},{default:a(()=>[...e[42]||(e[42]=[n("是",-1)])]),_:1}),t(z,{value:"0"},{default:a(()=>[...e[43]||(e[43]=[n("否",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t($,{gutter:16},{default:a(()=>[t(T,{span:12},{default:a(()=>[t(m,{label:"排序",name:"sortOrder"},{default:a(()=>[t(W,{value:u.sortOrder,"onUpdate:value":e[10]||(e[10]=i=>u.sortOrder=i),placeholder:"请输入排序号",min:0,style:{width:"100%"},disabled:c.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(T,{span:12},{default:a(()=>[t(m,{label:"状态",name:"status"},{default:a(()=>[t(X,{value:u.status,"onUpdate:value":e[11]||(e[11]=i=>u.status=i),disabled:c.value},{default:a(()=>[t(z,{value:"1"},{default:a(()=>[...e[44]||(e[44]=[n("启用",-1)])]),_:1}),t(z,{value:"0"},{default:a(()=>[...e[45]||(e[45]=[n("禁用",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(m,{label:"描述",name:"description"},{default:a(()=>[t(Ce,{value:u.description,"onUpdate:value":e[12]||(e[12]=i=>u.description=i),placeholder:"请输入单位描述",rows:3,disabled:c.value},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","footer"]),t(h,{visible:G.value,"onUpdate:visible":e[14]||(e[14]=i=>G.value=i),title:"单位详情",width:"600px",footer:null},{default:a(()=>[t(ke,{column:2,bordered:""},{default:a(()=>[t(g,{label:"单位编码"},{default:a(()=>[n(v(f.value.unitCode),1)]),_:1}),t(g,{label:"单位名称"},{default:a(()=>[n(v(f.value.unitName),1)]),_:1}),t(g,{label:"单位类型"},{default:a(()=>[t(x,{color:P(f.value.unitType)},{default:a(()=>[n(v(K(f.value.unitType)),1)]),_:1},8,["color"])]),_:1}),t(g,{label:"换算基准单位"},{default:a(()=>[n(v(oe(f.value.baseUnitId)),1)]),_:1}),t(g,{label:"换算系数"},{default:a(()=>[n(v(f.value.conversionFactor),1)]),_:1}),t(g,{label:"是否基准单位"},{default:a(()=>[t(x,{color:f.value.isBaseUnit==="1"?"blue":"default"},{default:a(()=>[n(v(f.value.isBaseUnit==="1"?"是":"否"),1)]),_:1},8,["color"])]),_:1}),t(g,{label:"排序"},{default:a(()=>[n(v(f.value.sortOrder),1)]),_:1}),t(g,{label:"状态"},{default:a(()=>[t(x,{color:f.value.status==="1"?"green":"red"},{default:a(()=>[n(v(f.value.status==="1"?"启用":"禁用"),1)]),_:1},8,["color"])]),_:1}),t(g,{label:"创建时间"},{default:a(()=>[n(v(f.value.createTime),1)]),_:1}),t(g,{label:"更新时间"},{default:a(()=>[n(v(f.value.updateTime),1)]),_:1}),t(g,{label:"描述",span:2},{default:a(()=>[n(v(f.value.description||"无"),1)]),_:1})]),_:1})]),_:1},8,["visible"])])}}},Ae=xe(qe,[["__scopeId","data-v-cc585030"]]);export{Ae as default};
