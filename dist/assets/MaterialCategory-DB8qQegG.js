import{u as $e}from"./excel-B07CBqJs.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as v,a as j,k as U,m as ze,c as Re,o as z,e as I,x as t,q as a,h as o,s as r,t as _,y as S,P as Ve,G as Ae,I as Le,Y as Be,R as Fe,p as q,f as H,M as P,C as w}from"./index-BPMZt9Bz.js";import{E as je}from"./ExportOutlined-D_JI9KKd.js";const qe={class:"page-container"},He={class:"split-layout"},Pe={class:"tree-panel"},Ge={class:"tree-header"},Je={class:"content-panel"},Qe={class:"toolbar"},We={class:"table-container"},Ye={__name:"MaterialCategory",setup(Ze){const R=v(!1),k=v(!1),G=v(!1),x=v(!1),f=v(!1),V=v(),m=v([]),A=v(""),g=v([]),h=v(""),c=j({categoryName:"",categoryCode:"",status:void 0}),s=j({id:"",categoryName:"",categoryCode:"",parentId:void 0,sortOrder:0,description:"",status:"1"}),de=[{title:"分类名称",dataIndex:"categoryName",key:"categoryName",width:150},{title:"分类编码",dataIndex:"categoryCode",key:"categoryCode",width:120},{title:"上级分类",dataIndex:"parentName",key:"parentName",width:120},{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,sorter:!0},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:150},{title:"操作",key:"action",width:180,fixed:"right"}],u=v([{id:"1",categoryName:"原材料",categoryCode:"RAW_MATERIAL",parentName:"无",parentId:null,sortOrder:1,description:"生产用原材料分类",status:"1",createTime:"2024-01-15 10:30:00",updateTime:"2024-01-15 10:30:00"},{id:"2",categoryName:"金属材料",categoryCode:"METAL",parentName:"原材料",parentId:"1",sortOrder:1,description:"各类金属材料",status:"1",createTime:"2024-01-15 10:35:00",updateTime:"2024-01-15 10:35:00"},{id:"3",categoryName:"非金属材料",categoryCode:"NON_METAL",parentName:"原材料",parentId:"1",sortOrder:2,description:"各类非金属材料",status:"1",createTime:"2024-01-15 10:40:00",updateTime:"2024-01-15 10:40:00"},{id:"4",categoryName:"半成品",categoryCode:"SEMI_FINISHED",parentName:"无",parentId:null,sortOrder:2,description:"生产过程中的半成品",status:"1",createTime:"2024-01-15 10:45:00",updateTime:"2024-01-15 10:45:00"},{id:"5",categoryName:"成品",categoryCode:"FINISHED",parentName:"无",parentId:null,sortOrder:3,description:"最终产品",status:"1",createTime:"2024-01-15 10:50:00",updateTime:"2024-01-15 10:50:00"}]),D=j({current:1,pageSize:20,total:5,showSizeChanger:!0,showQuickJumper:!0}),L=v([{title:"无",value:null,key:"null"},{title:"原材料",value:"1",key:"1",children:[{title:"金属材料",value:"2",key:"2"},{title:"非金属材料",value:"3",key:"3"}]},{title:"半成品",value:"4",key:"4"},{title:"成品",value:"5",key:"5"}]),J=U(()=>[{title:"全部分类",key:"all",children:[{title:"原材料",key:"1",children:[{title:"金属材料",key:"2"},{title:"非金属材料",key:"3"}]},{title:"半成品",key:"4"},{title:"成品",key:"5"}]}]),se=U(()=>(A.value,J.value)),Q=U(()=>{let l=[...u.value];if(g.value.length>0&&g.value[0]!=="all"){const e=g.value[0],n=E(e),i=[e,...n];l=l.filter(p=>i.includes(p.id))}return c.categoryName&&(l=l.filter(e=>e.categoryName.includes(c.categoryName))),c.categoryCode&&(l=l.filter(e=>e.categoryCode.includes(c.categoryCode))),c.status!==void 0&&(l=l.filter(e=>e.status===c.status)),l}),E=l=>{const e=u.value.filter(i=>i.parentId===l);let n=e.map(i=>i.id);return e.forEach(i=>{n=n.concat(E(i.id))}),n},b=v({}),re={categoryName:[{required:!0,message:"请输入分类名称",trigger:"blur"}],categoryCode:[{required:!0,message:"请输入分类编码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"分类编码只能包含大写字母和下划线",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入排序号",trigger:"blur"}]},ie=U(()=>f.value?"查看分类":x.value?"编辑分类":"新增分类"),ue=l=>{if(l.length===0||l[0]==="all")g.value=[],h.value="";else{g.value=l;const e=u.value.find(n=>n.id===l[0]);h.value=e?e.categoryName:""}},W=()=>{g.value=[],h.value=""},ce=(l,e)=>{if(e==="all")return;const n=u.value.find(i=>i.id===e);n&&(l==="addChild"?(x.value=!1,F(),s.parentId=e,k.value=!0):l==="edit"?B(n):l==="delete"&&Z(n))},pe=l=>{m.value=l},Y=()=>{D.current=1,T()},ve=()=>{Object.assign(c,{categoryName:"",categoryCode:"",status:void 0}),Y()},me=l=>{D.current=l.current,D.pageSize=l.pageSize,T()},fe=()=>{x.value=!1,k.value=!0,F(),g.value.length>0&&g.value[0]!=="all"&&(s.parentId=g.value[0])},ge=()=>{const l=u.value.find(e=>e.id===m.value[0]);l&&B(l)},B=l=>{x.value=!0,f.value=!1,k.value=!0,Object.assign(s,{...l,parentId:l.parentId})},ye=l=>{x.value=!0,f.value=!0,Object.assign(s,{...l,parentId:l.parentId}),k.value=!0},Z=l=>{const e=E(l.id).length,n=e>0?`分类"${l.categoryName}"下有 ${e} 个子分类，删除后子分类也将被删除`:`确定删除分类 ${l.categoryName} 吗？`;P.confirm({title:"确认删除",content:n,okType:"danger",onOk(){const i=[l.id,...E(l.id)];u.value=u.value.filter(p=>!i.includes(p.id)),w.success("删除成功"),T()}})},_e=()=>{P.confirm({title:"确认批量删除",content:`确定删除选中的 ${m.value.length} 条记录吗？`,okType:"danger",onOk(){u.value=u.value.filter(l=>!m.value.includes(l.id)),m.value=[],w.success("删除成功")}})},be=async()=>{var l,e;try{if(await V.value.validate(),x.value){const n=u.value.findIndex(i=>i.id===s.id);if(n>-1){const i=s.parentId?(l=L.value.find(p=>p.value===s.parentId))==null?void 0:l.title:"无";u.value[n]={...s,parentName:i,updateTime:new Date().toLocaleString()},w.success("更新成功")}}else{const n=(Math.max(...u.value.map(O=>parseInt(O.id)))+1).toString(),i=s.parentId?(e=L.value.find(O=>O.value===s.parentId))==null?void 0:e.title:"无",p={...s,id:n,parentName:i,createTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString()};u.value.push(p),w.success("新增成功")}k.value=!1,T()}catch(n){console.error("表单验证失败:",n)}},ke=()=>{k.value=!1,F()},F=()=>{var l;Object.assign(s,{id:"",categoryName:"",categoryCode:"",parentId:void 0,sortOrder:0,description:"",status:"1"}),(l=V.value)==null||l.resetFields()},Ce=()=>{if(u.value.length===0){w.warning("暂无数据可导出");return}const l=[{title:"分类名称",dataIndex:"categoryName"},{title:"分类编码",dataIndex:"categoryCode"},{title:"上级分类",dataIndex:"parentName"},{title:"排序",dataIndex:"sortOrder"},{title:"状态",dataIndex:"status"},{title:"描述",dataIndex:"description"},{title:"创建时间",dataIndex:"createTime"}],{exportToCSV:e}=$e();e(u.value,l,"物料分类"),w.success("导出成功")},Ie=({key:l})=>{const e=l==="enable"?"1":"0",n=l==="enable"?"启用":"禁用";P.confirm({title:`确认批量${n}`,content:`确定${n}选中的 ${m.value.length} 条记录吗？`,onOk(){u.value.forEach(i=>{m.value.includes(i.id)&&(i.status=e)}),m.value=[],w.success(`批量${n}成功`)}})},T=()=>{R.value=!0,setTimeout(()=>{D.total=Q.value.length,R.value=!1},300)};return ze(()=>{T()}),(l,e)=>{const n=r("a-button"),i=r("a-input-search"),p=r("a-menu-item"),O=r("a-menu"),K=r("a-dropdown"),Ne=r("a-tree"),X=r("a-space"),M=r("a-input"),y=r("a-form-item"),ee=r("a-select-option"),we=r("a-select"),te=r("a-form"),xe=r("a-card"),Te=r("a-alert"),ae=r("a-tag"),le=r("a-divider"),Oe=r("a-table"),Se=r("a-tree-select"),he=r("a-input-number"),De=r("a-textarea"),ne=r("a-radio"),Ee=r("a-radio-group"),oe=r("a-modal"),C=r("a-descriptions-item"),Me=r("a-descriptions");return z(),Re("div",qe,[I("div",He,[I("div",Pe,[I("div",Ge,[e[13]||(e[13]=I("span",{class:"tree-title"},"分类结构",-1)),t(n,{type:"link",size:"small",onClick:W},{default:a(()=>[...e[12]||(e[12]=[o("全部",-1)])]),_:1})]),t(i,{value:A.value,"onUpdate:value":e[0]||(e[0]=d=>A.value=d),placeholder:"搜索分类",style:{"margin-bottom":"12px"}},null,8,["value"]),t(Ne,{"tree-data":se.value,"show-line":!0,"default-expand-all":!0,"selected-keys":g.value,onSelect:ue},{title:a(({title:d,key:N})=>[t(K,{trigger:["contextmenu"]},{overlay:a(()=>[t(O,{onClick:({key:$})=>ce($,N)},{default:a(()=>[t(p,{key:"addChild"},{default:a(()=>[...e[14]||(e[14]=[o("新增子分类",-1)])]),_:1}),t(p,{key:"edit"},{default:a(()=>[...e[15]||(e[15]=[o("编辑此分类",-1)])]),_:1}),t(p,{key:"delete"},{default:a(()=>[...e[16]||(e[16]=[o("删除此分类",-1)])]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[I("span",null,_(d),1)]),_:2},1024)]),_:1},8,["tree-data","selected-keys"])]),I("div",Je,[I("div",Qe,[t(X,null,{default:a(()=>[t(n,{type:"primary",onClick:fe},{icon:a(()=>[t(S(Ve))]),default:a(()=>[e[17]||(e[17]=o("新增 ",-1))]),_:1}),t(n,{disabled:m.value.length!==1,onClick:ge},{icon:a(()=>[t(S(Ae))]),default:a(()=>[e[18]||(e[18]=o("编辑 ",-1))]),_:1},8,["disabled"]),t(n,{danger:"",disabled:m.value.length===0,onClick:_e},{icon:a(()=>[t(S(Le))]),default:a(()=>[e[19]||(e[19]=o("删除 ",-1))]),_:1},8,["disabled"]),t(K,{disabled:m.value.length===0},{overlay:a(()=>[t(O,{onClick:Ie},{default:a(()=>[t(p,{key:"enable"},{default:a(()=>[...e[21]||(e[21]=[o("批量启用",-1)])]),_:1}),t(p,{key:"disable"},{default:a(()=>[...e[22]||(e[22]=[o("批量禁用",-1)])]),_:1})]),_:1})]),default:a(()=>[t(n,null,{default:a(()=>[e[20]||(e[20]=o("状态操作 ",-1)),t(S(Be))]),_:1})]),_:1},8,["disabled"]),t(n,{onClick:Ce},{icon:a(()=>[t(S(je))]),default:a(()=>[e[23]||(e[23]=o("导出 ",-1))]),_:1}),t(n,{onClick:T},{icon:a(()=>[t(S(Fe))]),default:a(()=>[e[24]||(e[24]=o("刷新 ",-1))]),_:1})]),_:1})]),t(xe,{class:"search-card",bordered:!1},{default:a(()=>[t(te,{layout:"inline",model:c},{default:a(()=>[t(y,{label:"分类名称"},{default:a(()=>[t(M,{value:c.categoryName,"onUpdate:value":e[1]||(e[1]=d=>c.categoryName=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(y,{label:"分类编码"},{default:a(()=>[t(M,{value:c.categoryCode,"onUpdate:value":e[2]||(e[2]=d=>c.categoryCode=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(y,{label:"状态"},{default:a(()=>[t(we,{value:c.status,"onUpdate:value":e[3]||(e[3]=d=>c.status=d),style:{width:"120px"},placeholder:"请选择","allow-clear":""},{default:a(()=>[t(ee,{value:"1"},{default:a(()=>[...e[25]||(e[25]=[o("启用",-1)])]),_:1}),t(ee,{value:"0"},{default:a(()=>[...e[26]||(e[26]=[o("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(y,null,{default:a(()=>[t(n,{type:"primary",onClick:Y},{default:a(()=>[...e[27]||(e[27]=[o("查询",-1)])]),_:1}),t(n,{style:{"margin-left":"8px"},onClick:ve},{default:a(()=>[...e[28]||(e[28]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),I("div",We,[h.value?(z(),q(Te,{key:0,message:`当前查看分类：${h.value}`,type:"info","show-icon":"",closable:"",style:{"margin-bottom":"12px"},onClose:W},null,8,["message"])):H("",!0),t(Oe,{columns:de,"data-source":Q.value,loading:R.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:m.value,onChange:pe},pagination:D,onChange:me},{bodyCell:a(({column:d,record:N})=>[d.key==="status"?(z(),q(ae,{key:0,color:N.status==="1"?"green":"red"},{default:a(()=>[o(_(N.status==="1"?"启用":"禁用"),1)]),_:2},1032,["color"])):H("",!0),d.key==="action"?(z(),q(X,{key:1},{default:a(()=>[t(n,{type:"link",size:"small",onClick:$=>ye(N)},{default:a(()=>[...e[29]||(e[29]=[o("查看",-1)])]),_:1},8,["onClick"]),t(le,{type:"vertical"}),t(n,{type:"link",size:"small",onClick:$=>B(N)},{default:a(()=>[...e[30]||(e[30]=[o("编辑",-1)])]),_:1},8,["onClick"]),t(le,{type:"vertical"}),t(n,{type:"link",danger:"",size:"small",onClick:$=>Z(N)},{default:a(()=>[...e[31]||(e[31]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):H("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])]),t(oe,{visible:k.value,"onUpdate:visible":e[10]||(e[10]=d=>k.value=d),title:ie.value,width:"600px",onOk:be,onCancel:ke,footer:f.value?null:void 0},{default:a(()=>[t(te,{ref_key:"formRef",ref:V,model:s,rules:re,layout:"vertical"},{default:a(()=>[t(y,{label:"分类名称",name:"categoryName"},{default:a(()=>[t(M,{value:s.categoryName,"onUpdate:value":e[4]||(e[4]=d=>s.categoryName=d),placeholder:"请输入分类名称",disabled:f.value},null,8,["value","disabled"])]),_:1}),t(y,{label:"分类编码",name:"categoryCode"},{default:a(()=>[t(M,{value:s.categoryCode,"onUpdate:value":e[5]||(e[5]=d=>s.categoryCode=d),placeholder:"请输入分类编码",disabled:f.value},null,8,["value","disabled"])]),_:1}),t(y,{label:"上级分类",name:"parentId"},{default:a(()=>[t(Se,{value:s.parentId,"onUpdate:value":e[6]||(e[6]=d=>s.parentId=d),"tree-data":L.value,placeholder:"请选择上级分类","allow-clear":"","tree-default-expand-all":"",disabled:f.value},null,8,["value","tree-data","disabled"])]),_:1}),t(y,{label:"排序",name:"sortOrder"},{default:a(()=>[t(he,{value:s.sortOrder,"onUpdate:value":e[7]||(e[7]=d=>s.sortOrder=d),placeholder:"请输入排序号",min:0,style:{width:"100%"},disabled:f.value},null,8,["value","disabled"])]),_:1}),t(y,{label:"描述",name:"description"},{default:a(()=>[t(De,{value:s.description,"onUpdate:value":e[8]||(e[8]=d=>s.description=d),placeholder:"请输入分类描述",rows:3,disabled:f.value},null,8,["value","disabled"])]),_:1}),t(y,{label:"状态",name:"status"},{default:a(()=>[t(Ee,{value:s.status,"onUpdate:value":e[9]||(e[9]=d=>s.status=d),disabled:f.value},{default:a(()=>[t(ne,{value:"1"},{default:a(()=>[...e[32]||(e[32]=[o("启用",-1)])]),_:1}),t(ne,{value:"0"},{default:a(()=>[...e[33]||(e[33]=[o("禁用",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","footer"]),t(oe,{visible:G.value,"onUpdate:visible":e[11]||(e[11]=d=>G.value=d),title:"分类详情",width:"600px",footer:null},{default:a(()=>[t(Me,{column:2,bordered:""},{default:a(()=>[t(C,{label:"分类名称"},{default:a(()=>[o(_(b.value.categoryName),1)]),_:1}),t(C,{label:"分类编码"},{default:a(()=>[o(_(b.value.categoryCode),1)]),_:1}),t(C,{label:"上级分类"},{default:a(()=>[o(_(b.value.parentName||"无"),1)]),_:1}),t(C,{label:"排序"},{default:a(()=>[o(_(b.value.sortOrder),1)]),_:1}),t(C,{label:"状态"},{default:a(()=>[t(ae,{color:b.value.status==="1"?"green":"red"},{default:a(()=>[o(_(b.value.status==="1"?"启用":"禁用"),1)]),_:1},8,["color"])]),_:1}),t(C,{label:"创建时间"},{default:a(()=>[o(_(b.value.createTime),1)]),_:1}),t(C,{label:"更新时间"},{default:a(()=>[o(_(b.value.updateTime),1)]),_:1}),t(C,{label:"描述",span:2},{default:a(()=>[o(_(b.value.description||"无"),1)]),_:1})]),_:1})]),_:1},8,["visible"])])}}},at=Ue(Ye,[["__scopeId","data-v-0ec2aeee"]]);export{at as default};
