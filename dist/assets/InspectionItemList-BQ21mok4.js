import{d as Te,r as v,a as N,m as De,c as he,e as z,x as t,q as a,s as i,o as f,h as d,y as k,P as X,G as Se,I as Ue,R as Re,g as Ee,p as g,t as O,Y as ze,Z as Oe,a0 as Qe,f as h,u as $e,M as ee,C as b}from"./index-BsO03Xlk.js";import{u as Me}from"./excel-B07CBqJs.js";import{E as Ve}from"./ExportOutlined-3X2_SK8n.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"page-container"},Be={class:"toolbar"},Fe={class:"table-container"},Ae={style:{"margin-bottom":"8px"}},Ne=Te({__name:"InspectionItemList",setup(Le){const Q=$e(),$=v(!1),C=v(!1),c=v([]),y=v([]),o=N({code:"",name:"",dataType:void 0,method:"",unit:"",createTimeRange:void 0,status:void 0}),I=N({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),te=[{title:"项目编码",dataIndex:"code",key:"code",width:150},{title:"项目名称",dataIndex:"name",key:"name",width:200},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:100},{title:"单位",dataIndex:"unit",key:"unit",width:80},{title:"检验方法",dataIndex:"method",key:"method",width:150},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:200,fixed:"right"}],T=()=>{$.value=!0,setTimeout(()=>{let l=[{id:"1",code:"I-001",name:"长度",dataType:"Quantitative",unit:"mm",method:"卡尺测量",description:"测量工件长度"},{id:"2",code:"I-002",name:"外观",dataType:"Qualitative",unit:"",method:"目视",description:"检查表面是否有划痕"},{id:"3",code:"I-003",name:"硬度",dataType:"Quantitative",unit:"HRC",method:"硬度计",description:"表面硬度"}];o.code&&(l=l.filter(e=>e.code.includes(o.code))),o.name&&(l=l.filter(e=>e.name.includes(o.name))),o.dataType&&(l=l.filter(e=>e.dataType===o.dataType)),c.value=l,I.total=l.length,$.value=!1},300)},L=()=>{I.current=1,T()},ae=()=>{o.code="",o.name="",o.dataType=void 0,L()},le=l=>{I.current=l.current,I.pageSize=l.pageSize,T()},ne=l=>{y.value=l},M=v(!1),V=v(!1),P=v("basic"),j=v(),s=N({id:null,code:"",name:"",dataType:"Quantitative",unit:"",method:"",description:""}),oe={code:[{required:!0,message:"请输入项目编码",trigger:"blur"}],name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},de=()=>{Q.push("/inspection-model/inspection-items/create")},ie=l=>{Q.push(`/inspection-model/inspection-items/view/${l.id}`)},G=l=>{const e=l.id?l:c.value.find(u=>u.id===y.value[0]);e&&Q.push(`/inspection-model/inspection-items/edit/${e.id}`)},se=l=>{ee.confirm({title:"确认删除",content:`确定删除检验项目 ${l.name} 吗？`,okType:"danger",onOk(){c.value=c.value.filter(e=>e.id!==l.id),b.success("删除成功")}})},ue=()=>{ee.confirm({title:"确认批量删除",content:`确定删除选中的 ${y.value.length} 条记录吗？`,okType:"danger",onOk(){c.value=c.value.filter(l=>!y.value.includes(l.id)),y.value=[],b.success("删除成功")}})},re=()=>{j.value.validate().then(()=>{if(V.value){const l=c.value.findIndex(e=>e.id===s.id);l>-1&&Object.assign(c.value[l],s)}else c.value.push({...s,id:Date.now().toString()});b.success("保存成功"),M.value=!1,T()})},pe=()=>{if(c.value.length===0){b.warning("暂无数据可导出");return}const l=[{title:"项目编码",dataIndex:"code"},{title:"项目名称",dataIndex:"name"},{title:"数据类型",dataIndex:"dataType"},{title:"单位",dataIndex:"unit"},{title:"检验方法",dataIndex:"method"},{title:"描述",dataIndex:"description"}],{exportToCSV:e}=Me();e(c.value,l,"检验项目"),b.success("导出成功")};De(()=>{T()});const w=v([]),S=v(!1),K=v(!1),D=v([]),U=v([]),ve=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",dataIndex:"severity",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"}],ce=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",dataIndex:"severity",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:120}],me=l=>{b.info(`编辑关联: ${l.name}`)},H=l=>{switch(l){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}},fe=()=>{K.value=!0,setTimeout(()=>{D.value=[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"},{id:"103",code:"DEF-003",name:"裂纹",severity:"CR",description:"产品裂纹"},{id:"104",code:"DEF-004",name:"变形",severity:"MA",description:"产品变形"},{id:"105",code:"DEF-005",name:"色差",severity:"MI",description:"颜色不均匀"}];const l=w.value.map(e=>e.id);D.value=D.value.filter(e=>!l.includes(e.id)),U.value=[],K.value=!1},300),S.value=!0},ye=l=>{U.value=l},_e=()=>{const l=D.value.filter(e=>U.value.includes(e.id));w.value.push(...l),S.value=!1,b.success(`已添加 ${l.length} 个关联缺陷`)},ke=l=>{w.value=w.value.filter(e=>e.id!==l)};return(l,e)=>{const u=i("a-button"),R=i("a-space"),_=i("a-input"),r=i("a-form-item"),m=i("a-col"),x=i("a-select-option"),q=i("a-select"),E=i("a-row"),ge=i("a-range-picker"),J=i("a-form"),be=i("a-card"),B=i("a-tag"),Y=i("a-divider"),F=i("a-table"),we=i("a-textarea"),Z=i("a-tab-pane"),xe=i("a-empty"),Ce=i("a-tabs"),W=i("a-modal");return f(),he("div",qe,[z("div",Be,[t(R,null,{default:a(()=>[t(u,{type:"primary",onClick:de},{icon:a(()=>[t(k(X))]),default:a(()=>[e[17]||(e[17]=d("新增 ",-1))]),_:1}),t(u,{disabled:y.value.length!==1,onClick:G},{icon:a(()=>[t(k(Se))]),default:a(()=>[e[18]||(e[18]=d("编辑 ",-1))]),_:1},8,["disabled"]),t(u,{danger:"",disabled:y.value.length===0,onClick:ue},{icon:a(()=>[t(k(Ue))]),default:a(()=>[e[19]||(e[19]=d("删除 ",-1))]),_:1},8,["disabled"]),t(u,{onClick:pe},{icon:a(()=>[t(k(Ve))]),default:a(()=>[e[20]||(e[20]=d("导出 ",-1))]),_:1}),t(u,{onClick:T},{icon:a(()=>[t(k(Re))]),default:a(()=>[e[21]||(e[21]=d("刷新 ",-1))]),_:1})]),_:1})]),t(be,{class:"search-card",bordered:!1},{default:a(()=>[t(J,{model:o,"label-col":{span:24},"wrapper-col":{span:24}},{default:a(()=>[t(E,{gutter:16},{default:a(()=>[t(m,{span:6},{default:a(()=>[t(r,{label:"项目编码"},{default:a(()=>[t(_,{value:o.code,"onUpdate:value":e[0]||(e[0]=n=>o.code=n),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(r,{label:"项目名称"},{default:a(()=>[t(_,{value:o.name,"onUpdate:value":e[1]||(e[1]=n=>o.name=n),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(r,{label:"数据类型"},{default:a(()=>[t(q,{value:o.dataType,"onUpdate:value":e[2]||(e[2]=n=>o.dataType=n),style:{width:"100%"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(x,{value:"Quantitative"},{default:a(()=>[...e[22]||(e[22]=[d("计量型",-1)])]),_:1}),t(x,{value:"Qualitative"},{default:a(()=>[...e[23]||(e[23]=[d("计数型",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(r,{label:" ",colon:!1},{default:a(()=>[t(R,null,{default:a(()=>[t(u,{type:"primary",onClick:L},{default:a(()=>[...e[24]||(e[24]=[d("查询",-1)])]),_:1}),t(u,{onClick:ae},{default:a(()=>[...e[25]||(e[25]=[d("重置",-1)])]),_:1}),z("a",{onClick:e[3]||(e[3]=n=>C.value=!C.value),style:{"line-height":"32px"}},[d(O(C.value?"收起":"展开")+" ",1),C.value?(f(),g(k(Oe),{key:1})):(f(),g(k(ze),{key:0}))])]),_:1})]),_:1})]),_:1})]),_:1}),Ee(t(E,{gutter:16},{default:a(()=>[t(m,{span:6},{default:a(()=>[t(r,{label:"检验方法"},{default:a(()=>[t(_,{value:o.method,"onUpdate:value":e[4]||(e[4]=n=>o.method=n),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(r,{label:"单位"},{default:a(()=>[t(_,{value:o.unit,"onUpdate:value":e[5]||(e[5]=n=>o.unit=n),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(r,{label:"创建时间"},{default:a(()=>[t(ge,{value:o.createTimeRange,"onUpdate:value":e[6]||(e[6]=n=>o.createTimeRange=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(r,{label:"状态"},{default:a(()=>[t(q,{value:o.status,"onUpdate:value":e[7]||(e[7]=n=>o.status=n),style:{width:"100%"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(x,{value:"1"},{default:a(()=>[...e[26]||(e[26]=[d("启用",-1)])]),_:1}),t(x,{value:"0"},{default:a(()=>[...e[27]||(e[27]=[d("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},512),[[Qe,C.value]])]),_:1},8,["model"])]),_:1}),z("div",Fe,[t(F,{columns:te,"data-source":c.value,loading:$.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:y.value,onChange:ne},pagination:I,onChange:le},{bodyCell:a(({column:n,record:p})=>[n.key==="dataType"?(f(),g(B,{key:0,color:p.dataType==="Quantitative"?"blue":"purple"},{default:a(()=>[d(O(p.dataType==="Quantitative"?"计量型":"计数型"),1)]),_:2},1032,["color"])):h("",!0),n.key==="action"?(f(),g(R,{key:1},{default:a(()=>[t(u,{type:"link",size:"small",onClick:A=>ie(p)},{default:a(()=>[...e[28]||(e[28]=[d("查看",-1)])]),_:1},8,["onClick"]),t(Y,{type:"vertical"}),t(u,{type:"link",size:"small",onClick:A=>G(p)},{default:a(()=>[...e[29]||(e[29]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(Y,{type:"vertical"}),t(u,{type:"link",danger:"",size:"small",onClick:A=>se(p)},{default:a(()=>[...e[30]||(e[30]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):h("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(W,{visible:M.value,"onUpdate:visible":e[15]||(e[15]=n=>M.value=n),title:V.value?"编辑检验项目":"新增检验项目",width:"600px",onOk:re},{default:a(()=>[t(Ce,{activeKey:P.value,"onUpdate:activeKey":e[14]||(e[14]=n=>P.value=n)},{default:a(()=>[t(Z,{key:"basic",tab:"基本信息"},{default:a(()=>[t(J,{ref_key:"formRef",ref:j,model:s,rules:oe,layout:"vertical"},{default:a(()=>[t(E,{gutter:16},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(r,{label:"项目编码",name:"code"},{default:a(()=>[t(_,{value:s.code,"onUpdate:value":e[8]||(e[8]=n=>s.code=n),placeholder:"请输入",disabled:V.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(r,{label:"项目名称",name:"name"},{default:a(()=>[t(_,{value:s.name,"onUpdate:value":e[9]||(e[9]=n=>s.name=n),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(E,{gutter:16},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(r,{label:"数据类型",name:"dataType"},{default:a(()=>[t(q,{value:s.dataType,"onUpdate:value":e[10]||(e[10]=n=>s.dataType=n)},{default:a(()=>[t(x,{value:"Quantitative"},{default:a(()=>[...e[31]||(e[31]=[d("计量型",-1)])]),_:1}),t(x,{value:"Qualitative"},{default:a(()=>[...e[32]||(e[32]=[d("计数型",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(r,{label:"单位",name:"unit"},{default:a(()=>[t(_,{value:s.unit,"onUpdate:value":e[11]||(e[11]=n=>s.unit=n),placeholder:"计量型必填",disabled:s.dataType==="Qualitative"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(r,{label:"检验方法",name:"method"},{default:a(()=>[t(_,{value:s.method,"onUpdate:value":e[12]||(e[12]=n=>s.method=n),placeholder:"关联检验方法"},null,8,["value"])]),_:1}),t(r,{label:"描述",name:"description"},{default:a(()=>[t(we,{value:s.description,"onUpdate:value":e[13]||(e[13]=n=>s.description=n),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),t(Z,{key:"phenomenon",tab:"关联不良现象"},{default:a(()=>[z("div",Ae,[t(u,{type:"dashed",block:"",onClick:fe},{default:a(()=>[t(k(X)),e[33]||(e[33]=d(" 添加关联不良现象 ",-1))]),_:1})]),t(F,{columns:ce,"data-source":w.value,pagination:!1,size:"small","row-key":"id"},{bodyCell:a(({column:n,record:p,index:A})=>[n.key==="severity"?(f(),g(B,{key:0,color:H(p.severity)},{default:a(()=>[d(O(p.severity),1)]),_:2},1032,["color"])):n.key==="action"?(f(),g(R,{key:1},{default:a(()=>[t(u,{type:"link",size:"small",onClick:Ie=>me(p)},{default:a(()=>[...e[34]||(e[34]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(u,{type:"link",danger:"",size:"small",onClick:Ie=>ke(p.id)},{default:a(()=>[...e[35]||(e[35]=[d("移除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):h("",!0)]),_:1},8,["data-source"]),w.value.length===0?(f(),g(xe,{key:0,description:"尚未关联任何不良现象，点击上方按钮添加"})):h("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["visible","title"]),t(W,{visible:S.value,"onUpdate:visible":e[16]||(e[16]=n=>S.value=n),title:"选择不良现象",width:"600px",onOk:_e},{default:a(()=>[t(F,{columns:ve,"data-source":D.value,loading:K.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:U.value,onChange:ye}},{bodyCell:a(({column:n,record:p})=>[n.key==="severity"?(f(),g(B,{key:0,color:H(p.severity)},{default:a(()=>[d(O(p.severity),1)]),_:2},1032,["color"])):h("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),Je=Ke(Ne,[["__scopeId","data-v-263ca048"]]);export{Je as default};
