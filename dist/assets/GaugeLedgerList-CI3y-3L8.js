import{d as Te,r as f,a as V,k as F,m as qe,c as Q,e as p,x as a,q as t,s as d,t as S,o as b,y as I,P as J,R as Oe,S as Pe,p as A,w as H,G as Be,I as $e,h as r,f as Ge,M as W,C as x,E as g,u as Ke}from"./index-BPMZt9Bz.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"page-container"},Ve={class:"split-layout"},Fe={class:"left-panel"},Qe={class:"panel-header"},Je={class:"search-box"},He={class:"tree-container"},We={class:"tree-node-content"},Xe={class:"node-title"},Ze={class:"node-actions"},ea={class:"right-panel"},aa={key:0,class:"empty-selection"},ta={key:1,class:"content-wrapper"},la={class:"right-header"},na={class:"header-info"},sa={class:"category-title"},ua={class:"category-meta"},oa={class:"header-actions"},ia={class:"ledger-search-box"},da={class:"table-container"},ra=Te({__name:"GaugeLedgerList",setup(ca){const ue=Ke(),B=f(!1),X=f([]),$=f(""),U=f([]),G=f([]),K=f(!1),m=f([]),M=f([]),w=f(!1),z=f(!1),D=V({id:null,parentId:null,typeName:"",precision:.01,isMsaRequired:!1}),E=f("根节点"),Y=f(!1),L=f(!1),s=V({id:null,gaugeNo:"",gaugeName:"",model:"",manufacturer:"",serialNo:"",measureRange:"",resolution:.01,accuracy:"",calibrationCycle:12,lastCalDate:null,nextCalDate:null,status:"IN_USE",location:"",custodian:"",certificateNo:"",purchaseDate:null,description:""}),o=V({gaugeNo:"",gaugeName:"",status:void 0,dateRange:[]}),T=F(()=>X.value),oe=F(()=>($.value,T.value)),y=F(()=>{if(U.value.length===0)return null;const l=(e,u)=>{for(const c of e){if(c.id===u)return c;if(c.children){const N=l(c.children,u);if(N)return N}}return null};return l(T.value,U.value[0])}),q=()=>{B.value=!0,setTimeout(()=>{X.value=[{id:301,typeName:"数显卡尺",parentId:null,precision:.01,isMsaRequired:!0,children:[{id:3011,typeName:"数显卡尺-A品牌",parentId:301,precision:.01,isMsaRequired:!0}]},{id:302,typeName:"塞尺",parentId:null,precision:.05,isMsaRequired:!1,children:[]}],G.value=[301],B.value=!1},500)},ie=l=>{l.length>0?Z(l[0]):m.value=[]},de=()=>{z.value=!1,E.value="根类型",Object.assign(D,{id:null,parentId:null,typeName:"",precision:.01,isMsaRequired:!1}),O.value="新增根量检具类型",w.value=!0},re=l=>{z.value=!1,E.value=l.typeName,Object.assign(D,{id:null,parentId:l.id,typeName:"",precision:l.precision,isMsaRequired:l.isMsaRequired}),O.value="新增子量检具类型",w.value=!0},ce=l=>{z.value=!0,E.value=l.parentId?"上级ID:"+l.parentId:"根类型",Object.assign(D,{...l}),O.value="编辑量检具类型",w.value=!0},pe=l=>{W.confirm({title:"确认删除",content:`确定删除类型 ${l.typeName} 及其下属所有台账吗？`,okType:"danger",onOk(){x.success("类型已删除"),q(),U.value=[],m.value=[]}})},O=f(""),ve=()=>{x.success("类型保存成功"),w.value=!1,q()},fe=[{title:"量具编号",dataIndex:"gaugeNo",key:"gaugeNo",width:120},{title:"量具名称",dataIndex:"gaugeName",key:"gaugeName",width:140},{title:"规格型号",dataIndex:"model",key:"model",width:100},{title:"制造商",dataIndex:"manufacturer",key:"manufacturer",width:100},{title:"量程",dataIndex:"measureRange",key:"measureRange",width:100},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"校准状态",key:"calStatus",width:90},{title:"下次校准",dataIndex:"nextCalDate",key:"nextCalDate",width:110},{title:"保管人",dataIndex:"custodian",key:"custodian",width:80},{title:"操作",key:"action",width:180}],Z=l=>{K.value=!0,setTimeout(()=>{let e=[];if((l===301||l===3011)&&(e=[{id:1001,gaugeNo:"G-001",gaugeName:"数显卡尺01",model:"M-150",manufacturer:"三丰",serialNo:"SN2023001",measureRange:"0-150mm",resolution:.01,accuracy:"±0.02mm",calibrationCycle:12,lastCalDate:"2023-06-15",nextCalDate:"2024-06-15",status:"IN_USE",location:"产线A",custodian:"张三",certificateNo:"CAL-2023-0001",description:"产线A使用"},{id:1002,gaugeNo:"G-002",gaugeName:"数显卡尺02",model:"M-150",manufacturer:"三丰",serialNo:"SN2023002",measureRange:"0-150mm",resolution:.01,accuracy:"±0.02mm",calibrationCycle:12,lastCalDate:"2023-09-01",nextCalDate:g().add(10,"day").format("YYYY-MM-DD"),status:"IN_USE",location:"产线B",custodian:"李四",certificateNo:"CAL-2023-0002",description:"即将到期校准"},{id:1003,gaugeNo:"G-003",gaugeName:"数显卡尺03",model:"M-200",manufacturer:"三丰",serialNo:"SN2022003",measureRange:"0-200mm",resolution:.01,accuracy:"±0.03mm",calibrationCycle:12,lastCalDate:"2022-12-01",nextCalDate:"2023-12-01",status:"CALIBRATING",location:"计量室",custodian:"王五",certificateNo:"",description:"送外校准中"}]),o.gaugeNo&&(e=e.filter(u=>u.gaugeNo.includes(o.gaugeNo))),o.gaugeName&&(e=e.filter(u=>u.gaugeName.includes(o.gaugeName))),o.status&&(e=e.filter(u=>u.status===o.status)),o.dateRange&&o.dateRange.length===2){const u=o.dateRange[0].format("YYYY-MM-DD"),c=o.dateRange[1].format("YYYY-MM-DD");e=e.filter(N=>N.nextCalDate>=u&&N.nextCalDate<=c)}m.value=e,K.value=!1},300)},ee=()=>{y.value&&Z(y.value.id)},ge=()=>{o.gaugeNo="",o.gaugeName="",o.status=void 0,o.dateRange=[],ee()},me=l=>{M.value=l},_e=()=>{var l;L.value=!1,Object.assign(s,{id:null,gaugeNo:"",gaugeName:((l=y.value)==null?void 0:l.typeName)||"",model:"",manufacturer:"",serialNo:"",measureRange:"",resolution:.01,accuracy:"",calibrationCycle:12,lastCalDate:null,nextCalDate:null,status:"IN_USE",location:"",custodian:"",certificateNo:"",purchaseDate:null,description:""}),Y.value=!0},ye=l=>{L.value=!0;const e={...l};e.nextCalDate&&(e.nextCalDate=g(e.nextCalDate)),e.lastCalDate&&(e.lastCalDate=g(e.lastCalDate)),e.purchaseDate&&(e.purchaseDate=g(e.purchaseDate)),Object.assign(s,e),Y.value=!0},Ne=l=>{W.confirm({title:"确认删除",content:`确定删除量具 ${l.gaugeNo} 吗？`,okType:"danger",onOk(){m.value=m.value.filter(e=>e.id!==l.id),x.success("删除成功")}})},Ce=()=>{W.confirm({title:"确认批量删除",content:`确定删除选中的 ${M.value.length} 条记录吗？`,okType:"danger",onOk(){m.value=m.value.filter(l=>!M.value.includes(l.id)),M.value=[],x.success("批量删除成功")}})},De=()=>{if(!s.gaugeNo||!s.gaugeName){x.warn("请填写必填项");return}const l={...s};if(l.nextCalDate&&(l.nextCalDate=g(l.nextCalDate).format("YYYY-MM-DD")),l.lastCalDate&&(l.lastCalDate=g(l.lastCalDate).format("YYYY-MM-DD")),l.purchaseDate&&(l.purchaseDate=g(l.purchaseDate).format("YYYY-MM-DD")),L.value){const e=m.value.findIndex(u=>u.id===s.id);e!==-1&&Object.assign(m.value[e],l)}else m.value.push({...l,id:Date.now()});x.success("台账保存成功"),Y.value=!1},ke=()=>{x.success("导出任务已开始...")},be=l=>{const{onProgress:e,onSuccess:u}=l;e({percent:0}),setTimeout(()=>{var N,v;e({percent:100});const c=[{id:Date.now()+1,gaugeNo:"IMP-001",gaugeName:`${(N=y.value)==null?void 0:N.typeName} (导入1)`,model:"M-IMP-1",manufacturer:"Import Brand",status:"IN_USE",nextCalDate:g().add(6,"month").format("YYYY-MM-DD"),custodian:"用户A"},{id:Date.now()+2,gaugeNo:"IMP-002",gaugeName:`${(v=y.value)==null?void 0:v.typeName} (导入2)`,model:"M-IMP-2",manufacturer:"Import Brand",status:"IN_USE",nextCalDate:g().add(10,"month").format("YYYY-MM-DD"),custodian:"用户B"}];m.value.unshift(...c),u(!0),x.success(`成功导入 ${c.length} 条数据`)},1500)},xe=l=>{ue.push(`/inspection-model/gauge-ledgers/${l.id}`)},Ie=l=>{switch(l){case"IN_USE":return"green";case"CALIBRATING":return"orange";case"SEALED":return"gray";case"SCRAPPED":return"red";default:return"default"}},Me=l=>{switch(l){case"IN_USE":return"在用";case"CALIBRATING":return"校准中";case"SEALED":return"封存";case"SCRAPPED":return"报废";default:return l}},we=l=>{if(!l)return"default";const e=g(),c=g(l).diff(e,"day");return c<0?"red":c<=14?"orange":"green"},Re=l=>{if(!l)return"-";const e=g(),c=g(l).diff(e,"day");return c<0?"已过期":c<=14?"即将到期":"正常"};return qe(()=>{q()}),(l,e)=>{const u=d("a-button"),c=d("a-tooltip"),N=d("a-space"),v=d("a-input"),Se=d("a-tree"),ae=d("a-empty"),Ue=d("a-spin"),P=d("a-tag"),Ye=d("a-upload"),i=d("a-form-item"),k=d("a-select-option"),te=d("a-select"),he=d("a-range-picker"),j=d("a-form"),Ae=d("a-table"),le=d("a-input-number"),Ee=d("a-switch"),ne=d("a-modal"),_=d("a-col"),R=d("a-row"),se=d("a-date-picker"),Le=d("a-textarea");return b(),Q("div",je,[p("div",Ve,[p("div",Fe,[p("div",Qe,[e[24]||(e[24]=p("span",{class:"panel-title"},"量检具类型",-1)),a(N,null,{default:t(()=>[a(c,{title:"新增根类型"},{default:t(()=>[a(u,{type:"primary",size:"small",shape:"circle",onClick:de},{icon:t(()=>[a(I(J))]),_:1})]),_:1}),a(c,{title:"刷新"},{default:t(()=>[a(u,{size:"small",shape:"circle",onClick:q},{icon:t(()=>[a(I(Oe))]),_:1})]),_:1})]),_:1})]),p("div",Je,[a(v,{value:$.value,"onUpdate:value":e[0]||(e[0]=n=>$.value=n),placeholder:"搜索类型","allow-clear":"",size:"small"},{prefix:t(()=>[a(I(Pe))]),_:1},8,["value"])]),p("div",He,[a(Ue,{spinning:B.value},{default:t(()=>[T.value.length>0?(b(),A(Se,{key:0,selectedKeys:U.value,"onUpdate:selectedKeys":e[1]||(e[1]=n=>U.value=n),expandedKeys:G.value,"onUpdate:expandedKeys":e[2]||(e[2]=n=>G.value=n),"tree-data":oe.value,"field-names":{children:"children",title:"typeName",key:"id"},"block-node":"",onSelect:ie},{title:t(({typeName:n,data:C})=>[p("div",We,[p("span",Xe,S(n),1),p("div",Ze,[a(I(J),{class:"action-icon",title:"添加子类型",onClick:H(h=>re(C),["stop"])},null,8,["onClick"]),a(I(Be),{class:"action-icon",title:"编辑",onClick:H(h=>ce(C),["stop"])},null,8,["onClick"]),a(I($e),{class:"action-icon",title:"删除",onClick:H(h=>pe(C),["stop"])},null,8,["onClick"])])])]),_:1},8,["selectedKeys","expandedKeys","tree-data"])):(b(),A(ae,{key:1,description:"暂无类型数据",class:"empty-state"}))]),_:1},8,["spinning"])])]),p("div",ea,[y.value?(b(),Q("div",ta,[p("div",la,[p("div",na,[p("div",sa,S(y.value.typeName),1),p("div",ua,[a(P,{color:"blue"},{default:t(()=>[r("精度: "+S(y.value.precision),1)]),_:1}),a(P,{color:y.value.isMsaRequired?"orange":"green"},{default:t(()=>[r(S(y.value.isMsaRequired?"需MSA":"不需MSA"),1)]),_:1},8,["color"])])]),p("div",oa,[a(u,{type:"primary",onClick:_e},{icon:t(()=>[a(I(J))]),default:t(()=>[e[25]||(e[25]=r(" 新增设备 ",-1))]),_:1}),a(u,{danger:"",disabled:M.value.length===0,onClick:Ce},{default:t(()=>[...e[26]||(e[26]=[r(" 批量删除 ",-1)])]),_:1},8,["disabled"]),a(Ye,{"show-upload-list":!1,"custom-request":be},{default:t(()=>[a(u,null,{default:t(()=>[...e[27]||(e[27]=[r("导入",-1)])]),_:1})]),_:1}),a(u,{onClick:ke},{default:t(()=>[...e[28]||(e[28]=[r("导出",-1)])]),_:1})])]),p("div",ia,[a(j,{layout:"inline",model:o},{default:t(()=>[a(i,{label:"量具编号"},{default:t(()=>[a(v,{value:o.gaugeNo,"onUpdate:value":e[3]||(e[3]=n=>o.gaugeNo=n),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),a(i,{label:"量具名称"},{default:t(()=>[a(v,{value:o.gaugeName,"onUpdate:value":e[4]||(e[4]=n=>o.gaugeName=n),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),a(i,{label:"状态"},{default:t(()=>[a(te,{value:o.status,"onUpdate:value":e[5]||(e[5]=n=>o.status=n),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:t(()=>[a(k,{value:"IN_USE"},{default:t(()=>[...e[29]||(e[29]=[r("在用",-1)])]),_:1}),a(k,{value:"CALIBRATING"},{default:t(()=>[...e[30]||(e[30]=[r("校准中",-1)])]),_:1}),a(k,{value:"SEALED"},{default:t(()=>[...e[31]||(e[31]=[r("封存",-1)])]),_:1}),a(k,{value:"SCRAPPED"},{default:t(()=>[...e[32]||(e[32]=[r("报废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(i,{label:"校准日期"},{default:t(()=>[a(he,{value:o.dateRange,"onUpdate:value":e[6]||(e[6]=n=>o.dateRange=n)},null,8,["value"])]),_:1}),a(i,null,{default:t(()=>[a(u,{type:"primary",onClick:ee},{default:t(()=>[...e[33]||(e[33]=[r("查询",-1)])]),_:1}),a(u,{style:{"margin-left":"8px"},onClick:ge},{default:t(()=>[...e[34]||(e[34]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",da,[a(Ae,{columns:fe,"data-source":m.value,loading:K.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:M.value,onChange:me},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条`}},{bodyCell:t(({column:n,record:C})=>[n.key==="status"?(b(),A(P,{key:0,color:Ie(C.status)},{default:t(()=>[r(S(Me(C.status)),1)]),_:2},1032,["color"])):n.key==="calStatus"?(b(),A(P,{key:1,color:we(C.nextCalDate)},{default:t(()=>[r(S(Re(C.nextCalDate)),1)]),_:2},1032,["color"])):n.key==="action"?(b(),A(N,{key:2},{default:t(()=>[a(u,{type:"link",size:"small",onClick:h=>xe(C)},{default:t(()=>[...e[35]||(e[35]=[r("查看",-1)])]),_:1},8,["onClick"]),a(u,{type:"link",size:"small",onClick:h=>ye(C)},{default:t(()=>[...e[36]||(e[36]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(u,{type:"link",danger:"",size:"small",onClick:h=>Ne(C)},{default:t(()=>[...e[37]||(e[37]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):Ge("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])):(b(),Q("div",aa,[a(ae,{description:"请选择左侧类型查看台账"})]))])]),a(ne,{visible:w.value,"onUpdate:visible":e[10]||(e[10]=n=>w.value=n),title:O.value,onOk:ve},{default:t(()=>[a(j,{layout:"vertical",model:D},{default:t(()=>[a(i,{label:"父级类型"},{default:t(()=>[a(v,{value:E.value,disabled:""},null,8,["value"])]),_:1}),a(i,{label:"类型名称",required:""},{default:t(()=>[a(v,{value:D.typeName,"onUpdate:value":e[7]||(e[7]=n=>D.typeName=n)},null,8,["value"])]),_:1}),a(i,{label:"精度/分辨率",required:""},{default:t(()=>[a(le,{value:D.precision,"onUpdate:value":e[8]||(e[8]=n=>D.precision=n),style:{width:"100%"},min:0,step:.01},null,8,["value"])]),_:1}),a(i,{label:"是否需MSA"},{default:t(()=>[a(Ee,{checked:D.isMsaRequired,"onUpdate:checked":e[9]||(e[9]=n=>D.isMsaRequired=n),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(ne,{visible:Y.value,"onUpdate:visible":e[23]||(e[23]=n=>Y.value=n),title:L.value?"编辑量检具台账":"新增量检具台账",width:"700px",onOk:De},{default:t(()=>[a(j,{layout:"vertical",model:s},{default:t(()=>[a(R,{gutter:16},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(i,{label:"所属类型"},{default:t(()=>{var n;return[a(v,{value:(n=y.value)==null?void 0:n.typeName,disabled:""},null,8,["value"])]}),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(i,{label:"量具编号",required:""},{default:t(()=>[a(v,{value:s.gaugeNo,"onUpdate:value":e[11]||(e[11]=n=>s.gaugeNo=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(R,{gutter:16},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(i,{label:"量具名称",required:""},{default:t(()=>[a(v,{value:s.gaugeName,"onUpdate:value":e[12]||(e[12]=n=>s.gaugeName=n)},null,8,["value"])]),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(i,{label:"规格型号"},{default:t(()=>[a(v,{value:s.model,"onUpdate:value":e[13]||(e[13]=n=>s.model=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(R,{gutter:16},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(i,{label:"制造商"},{default:t(()=>[a(v,{value:s.manufacturer,"onUpdate:value":e[14]||(e[14]=n=>s.manufacturer=n)},null,8,["value"])]),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(i,{label:"量程范围"},{default:t(()=>[a(v,{value:s.measureRange,"onUpdate:value":e[15]||(e[15]=n=>s.measureRange=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(R,{gutter:16},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(i,{label:"分辨率"},{default:t(()=>[a(le,{value:s.resolution,"onUpdate:value":e[16]||(e[16]=n=>s.resolution=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(i,{label:"保管人"},{default:t(()=>[a(v,{value:s.custodian,"onUpdate:value":e[17]||(e[17]=n=>s.custodian=n)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(R,{gutter:16},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(i,{label:"存放位置"},{default:t(()=>[a(v,{value:s.location,"onUpdate:value":e[18]||(e[18]=n=>s.location=n)},null,8,["value"])]),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(i,{label:"状态",required:""},{default:t(()=>[a(te,{value:s.status,"onUpdate:value":e[19]||(e[19]=n=>s.status=n)},{default:t(()=>[a(k,{value:"IN_USE"},{default:t(()=>[...e[38]||(e[38]=[r("在用",-1)])]),_:1}),a(k,{value:"CALIBRATING"},{default:t(()=>[...e[39]||(e[39]=[r("校准中",-1)])]),_:1}),a(k,{value:"SEALED"},{default:t(()=>[...e[40]||(e[40]=[r("封存",-1)])]),_:1}),a(k,{value:"SCRAPPED"},{default:t(()=>[...e[41]||(e[41]=[r("报废",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(R,{gutter:16},{default:t(()=>[a(_,{span:12},{default:t(()=>[a(i,{label:"下次校准日期"},{default:t(()=>[a(se,{value:s.nextCalDate,"onUpdate:value":e[20]||(e[20]=n=>s.nextCalDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(_,{span:12},{default:t(()=>[a(i,{label:"购置日期"},{default:t(()=>[a(se,{value:s.purchaseDate,"onUpdate:value":e[21]||(e[21]=n=>s.purchaseDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(i,{label:"描述"},{default:t(()=>[a(Le,{value:s.description,"onUpdate:value":e[22]||(e[22]=n=>s.description=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),fa=ze(ra,[["__scopeId","data-v-6abaac22"]]);export{fa as default};
