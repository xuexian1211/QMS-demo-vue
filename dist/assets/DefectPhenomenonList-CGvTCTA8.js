import{d as Ue,r as s,a as ie,k as W,m as Ke,c as X,e as i,x as t,q as l,s as d,t as h,o as v,y as _,P as $,R as $e,S as ze,p as g,w as Y,G as Re,I as Ve,h as p,f as z,M as Z,C as f}from"./index-BsO03Xlk.js";import{u as je}from"./excel-B07CBqJs.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"page-container"},Be={class:"split-layout"},Le={class:"left-panel"},Ge={class:"panel-header"},He={class:"search-box"},Je={class:"tree-container"},Qe={class:"tree-node-content"},We={class:"node-title"},Xe={class:"node-actions"},Ye={class:"right-panel"},Ze={key:0,class:"empty-selection"},et={key:1,class:"content-wrapper"},tt={class:"right-header"},at={class:"header-info"},lt={class:"category-title"},nt={class:"category-meta"},ot={class:"desc"},st={class:"header-actions"},it={class:"table-container"},dt={style:{"margin-bottom":"12px"}},ut=Ue({__name:"DefectPhenomenonList",setup(ct){const R=s(!1),ee=s([]),V=s(""),I=s([]),j=s([]),q=s(!1),u=s([]),b=s([]),T=s(!1),F=s(!1),y=ie({id:null,parentId:null,categoryCode:"",categoryName:"",description:""}),A=s("根节点"),M=s(!1),D=s(!1),o=ie({id:null,code:"",name:"",severity:"MI",processType:"",description:""}),P=W(()=>ee.value),de=W(()=>(V.value,P.value)),x=W(()=>{if(I.value.length===0)return null;const a=(e,c)=>{for(const k of e){if(k.id===c)return k;if(k.children){const N=a(k.children,c);if(N)return N}}return null};return a(P.value,I.value[0])}),O=()=>{R.value=!0,setTimeout(()=>{ee.value=[{id:1,categoryCode:"DCAT-APP",categoryName:"外观缺陷",parentId:null,description:"产品表面相关缺陷",children:[{id:11,categoryCode:"DCAT-APP-CAST",categoryName:"铸造外观",parentId:1,description:"铸造特有"},{id:12,categoryCode:"DCAT-APP-MACH",categoryName:"机加外观",parentId:1,description:"机加特有"}]},{id:2,categoryCode:"DCAT-DIM",categoryName:"尺寸缺陷",parentId:null,description:"尺寸公差超差",children:[]},{id:3,categoryCode:"DCAT-FUNC",categoryName:"性能缺陷",parentId:null,description:"功能测试失效",children:[]}],j.value=[1],R.value=!1},500)},ue=a=>{a.length>0?fe(a[0]):u.value=[]},ce=()=>{F.value=!1,A.value="根分类",Object.assign(y,{id:null,parentId:null,categoryCode:"",categoryName:"",description:""}),S.value="新增缺陷分类",T.value=!0},re=a=>{F.value=!1,A.value=a.categoryName,Object.assign(y,{id:null,parentId:a.id,categoryCode:"",categoryName:"",description:""}),S.value="新增子缺陷分类",T.value=!0},pe=a=>{F.value=!0,A.value=a.parentId?"上级分类ID:"+a.parentId:"根分类",Object.assign(y,{...a}),S.value="编辑缺陷分类",T.value=!0},ve=a=>{Z.confirm({title:"确认删除",content:`确定删除分类 ${a.categoryName} 及其所有子类吗？`,okType:"danger",onOk(){f.success("分类已删除"),O(),I.value=[],u.value=[]}})},S=s(""),ye=()=>{f.success("分类保存成功"),T.value=!1,O()},me=[{title:"现象代码",dataIndex:"code",key:"code",width:120},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",dataIndex:"severity",key:"severity",width:100},{title:"适用工序",dataIndex:"processType",key:"processType",width:150},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:150}],fe=a=>{q.value=!0,setTimeout(()=>{a===1||a===11?u.value=[{id:101,code:"DEF-001",name:"表面划伤",severity:"MI",processType:"全工序",description:"可见划痕"},{id:102,code:"DEF-002",name:"气孔",severity:"MA",processType:"压铸",description:"表面密集气孔"}]:a===2?u.value=[{id:201,code:"DIM-001",name:"长度超差",severity:"MA",processType:"机加",description:""}]:u.value=[],q.value=!1},300)},Ce=a=>{b.value=a},_e=()=>{D.value=!1,Object.assign(o,{id:null,code:"",name:"",severity:"MI",processType:"",description:""}),M.value=!0},ge=a=>{D.value=!0,Object.assign(o,{...a}),M.value=!0},ke=a=>{Z.confirm({title:"确认删除",content:`确定删除不良现象 ${a.name} 吗？`,okType:"danger",onOk(){u.value=u.value.filter(e=>e.id!==a.id),f.success("删除成功")}})},he=()=>{Z.confirm({title:"确认批量删除",content:`确定删除选中的 ${b.value.length} 条记录吗？`,okType:"danger",onOk(){u.value=u.value.filter(a=>!b.value.includes(a.id)),b.value=[],f.success("批量删除成功")}})},be=()=>{if(!o.code||!o.name){f.warn("请填写必填项");return}if(D.value){const a=u.value.findIndex(e=>e.id===o.id);a!==-1&&Object.assign(u.value[a],{...o})}else u.value.push({...o,id:Date.now()});f.success("保存成功"),M.value=!1},Te=()=>{var c;if(u.value.length===0){f.warning("暂无数据可导出");return}const a=[{title:"现象代码",dataIndex:"code"},{title:"现象名称",dataIndex:"name"},{title:"严重等级",dataIndex:"severity"},{title:"适用工序",dataIndex:"processType"},{title:"描述",dataIndex:"description"}],{exportToCSV:e}=je();e(u.value,a,`不良现象_${((c=x.value)==null?void 0:c.categoryName)||"导出"}`),f.success("导出成功")},E=s(!1),B=s(!1),te=s([]),U=s([]),L=s([]),xe=[{title:"原因代码",dataIndex:"causeCode",key:"causeCode",width:120},{title:"原因名称",dataIndex:"causeName",key:"causeName",width:150},{title:"原因类别",key:"causeType",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],we=[{title:"原因代码",dataIndex:"causeCode",key:"causeCode",width:100},{title:"原因名称",dataIndex:"causeName",key:"causeName",width:150},{title:"原因类别",key:"causeType",width:80},{title:"描述",dataIndex:"description",key:"description"}],ae=a=>({Man:"blue",Machine:"cyan",Material:"orange",Method:"purple",Environment:"green"})[a]||"default",le=a=>({Man:"人",Machine:"机",Material:"料",Method:"法",Environment:"环"})[a]||a,Ie=()=>{B.value=!0,setTimeout(()=>{const a=(o.relatedCauses||[]).map(e=>e.id);te.value=L.value.filter(e=>!a.includes(e.id)),U.value=[],B.value=!1},200),E.value=!0},Me=a=>{U.value=a},Ne=()=>{const a=L.value.filter(e=>U.value.includes(e.id));o.relatedCauses||(o.relatedCauses=[]),o.relatedCauses.push(...a),E.value=!1,f.success(`已添加 ${a.length} 个不良原因`)},Ae=a=>{o.relatedCauses&&o.relatedCauses.splice(a,1)},De=a=>{switch(a){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}};return Ke(()=>{O(),L.value=[{id:"1",causeCode:"C-MAN-001",causeName:"操作不当",causeType:"Man",description:"员工未按SOP操作"},{id:"2",causeCode:"C-MAC-001",causeName:"设备故障",causeType:"Machine",description:"主轴跳动过大"},{id:"3",causeCode:"C-MAT-001",causeName:"原料杂质",causeType:"Material",description:"供应商来料含杂质"},{id:"4",causeCode:"C-MET-001",causeName:"工艺参数",causeType:"Method",description:"温度设置不当"},{id:"5",causeCode:"C-ENV-001",causeName:"环境温度",causeType:"Environment",description:"车间温度过高"}]}),(a,e)=>{const c=d("a-button"),k=d("a-tooltip"),N=d("a-space"),C=d("a-input"),Pe=d("a-tree"),G=d("a-empty"),Oe=d("a-spin"),K=d("a-tag"),H=d("a-table"),m=d("a-form-item"),ne=d("a-textarea"),oe=d("a-form"),J=d("a-modal"),Q=d("a-select-option"),Se=d("a-select"),se=d("a-tab-pane"),Ee=d("a-tabs");return v(),X("div",Fe,[i("div",Be,[i("div",Le,[i("div",Ge,[e[14]||(e[14]=i("span",{class:"panel-title"},"缺陷分类",-1)),t(N,null,{default:l(()=>[t(k,{title:"新增缺陷分类"},{default:l(()=>[t(c,{type:"primary",size:"small",shape:"circle",onClick:ce},{icon:l(()=>[t(_($))]),_:1})]),_:1}),t(k,{title:"刷新"},{default:l(()=>[t(c,{size:"small",shape:"circle",onClick:O},{icon:l(()=>[t(_($e))]),_:1})]),_:1})]),_:1})]),i("div",He,[t(C,{value:V.value,"onUpdate:value":e[0]||(e[0]=n=>V.value=n),placeholder:"搜索缺陷分类","allow-clear":"",size:"small"},{prefix:l(()=>[t(_(ze))]),_:1},8,["value"])]),i("div",Je,[t(Oe,{spinning:R.value},{default:l(()=>[P.value.length>0?(v(),g(Pe,{key:0,selectedKeys:I.value,"onUpdate:selectedKeys":e[1]||(e[1]=n=>I.value=n),expandedKeys:j.value,"onUpdate:expandedKeys":e[2]||(e[2]=n=>j.value=n),"tree-data":de.value,"field-names":{children:"children",title:"categoryName",key:"id"},"block-node":"",onSelect:ue},{title:l(({categoryName:n,data:r})=>[i("div",Qe,[i("span",We,h(n),1),i("div",Xe,[t(_($),{class:"action-icon",title:"添加子类",onClick:Y(w=>re(r),["stop"])},null,8,["onClick"]),t(_(Re),{class:"action-icon",title:"编辑",onClick:Y(w=>pe(r),["stop"])},null,8,["onClick"]),t(_(Ve),{class:"action-icon",title:"删除",onClick:Y(w=>ve(r),["stop"])},null,8,["onClick"])])])]),_:1},8,["selectedKeys","expandedKeys","tree-data"])):(v(),g(G,{key:1,description:"暂无缺陷分类数据",class:"empty-state"}))]),_:1},8,["spinning"])])]),i("div",Ye,[x.value?(v(),X("div",et,[i("div",tt,[i("div",at,[i("div",lt,h(x.value.categoryName),1),i("div",nt,[t(K,{color:"blue"},{default:l(()=>[p(h(x.value.categoryCode),1)]),_:1}),i("span",ot,h(x.value.description||"暂无描述"),1)])]),i("div",st,[t(c,{type:"primary",onClick:_e},{icon:l(()=>[t(_($))]),default:l(()=>[e[15]||(e[15]=p(" 新增现象 ",-1))]),_:1}),t(c,{danger:"",disabled:b.value.length===0,onClick:he},{default:l(()=>[...e[16]||(e[16]=[p(" 批量删除 ",-1)])]),_:1},8,["disabled"]),t(c,{onClick:Te},{default:l(()=>[...e[17]||(e[17]=[p("导出",-1)])]),_:1})])]),i("div",it,[t(H,{columns:me,"data-source":u.value,loading:q.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:b.value,onChange:Ce},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条`}},{bodyCell:l(({column:n,record:r})=>[n.key==="severity"?(v(),g(K,{key:0,color:De(r.severity)},{default:l(()=>[p(h(r.severity),1)]),_:2},1032,["color"])):n.key==="action"?(v(),g(N,{key:1},{default:l(()=>[t(c,{type:"link",size:"small",onClick:w=>ge(r)},{default:l(()=>[...e[18]||(e[18]=[p("编辑",-1)])]),_:1},8,["onClick"]),t(c,{type:"link",danger:"",size:"small",onClick:w=>ke(r)},{default:l(()=>[...e[19]||(e[19]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):z("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])):(v(),X("div",Ze,[t(G,{description:"请选择左侧分类查看不良现象"})]))])]),t(J,{visible:T.value,"onUpdate:visible":e[6]||(e[6]=n=>T.value=n),title:S.value,onOk:ye},{default:l(()=>[t(oe,{layout:"vertical",model:y},{default:l(()=>[t(m,{label:"父级分类"},{default:l(()=>[t(C,{value:A.value,disabled:""},null,8,["value"])]),_:1}),t(m,{label:"分类代码",required:""},{default:l(()=>[t(C,{value:y.categoryCode,"onUpdate:value":e[3]||(e[3]=n=>y.categoryCode=n)},null,8,["value"])]),_:1}),t(m,{label:"分类名称",required:""},{default:l(()=>[t(C,{value:y.categoryName,"onUpdate:value":e[4]||(e[4]=n=>y.categoryName=n)},null,8,["value"])]),_:1}),t(m,{label:"描述"},{default:l(()=>[t(ne,{value:y.description,"onUpdate:value":e[5]||(e[5]=n=>y.description=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),t(J,{visible:M.value,"onUpdate:visible":e[12]||(e[12]=n=>M.value=n),title:D.value?"编辑不良现象":"新增不良现象",onOk:be,width:"900px"},{default:l(()=>[t(Ee,null,{default:l(()=>[t(se,{key:"basic",tab:"基本信息"},{default:l(()=>[t(oe,{layout:"vertical",model:o},{default:l(()=>[t(m,{label:"所属分类"},{default:l(()=>{var n;return[t(C,{value:(n=x.value)==null?void 0:n.categoryName,disabled:""},null,8,["value"])]}),_:1}),t(m,{label:"现象代码",required:""},{default:l(()=>[t(C,{value:o.code,"onUpdate:value":e[7]||(e[7]=n=>o.code=n)},null,8,["value"])]),_:1}),t(m,{label:"现象名称",required:""},{default:l(()=>[t(C,{value:o.name,"onUpdate:value":e[8]||(e[8]=n=>o.name=n)},null,8,["value"])]),_:1}),t(m,{label:"严重等级",required:""},{default:l(()=>[t(Se,{value:o.severity,"onUpdate:value":e[9]||(e[9]=n=>o.severity=n)},{default:l(()=>[t(Q,{value:"CR"},{default:l(()=>[...e[20]||(e[20]=[p("致命 (CR)",-1)])]),_:1}),t(Q,{value:"MA"},{default:l(()=>[...e[21]||(e[21]=[p("主要 (MA)",-1)])]),_:1}),t(Q,{value:"MI"},{default:l(()=>[...e[22]||(e[22]=[p("次要 (MI)",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{label:"适用工序"},{default:l(()=>[t(C,{value:o.processType,"onUpdate:value":e[10]||(e[10]=n=>o.processType=n),placeholder:"如：压铸, 机加工"},null,8,["value"])]),_:1}),t(m,{label:"描述"},{default:l(()=>[t(ne,{value:o.description,"onUpdate:value":e[11]||(e[11]=n=>o.description=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),t(se,{key:"causes",tab:"关联原因"},{default:l(()=>[i("div",dt,[t(c,{type:"primary",size:"small",onClick:Ie},{default:l(()=>[t(_($)),e[23]||(e[23]=p(" 添加关联原因 ",-1))]),_:1})]),t(H,{columns:xe,"data-source":o.relatedCauses||[],"row-key":"id",size:"small",pagination:!1},{bodyCell:l(({column:n,record:r,index:w})=>[n.key==="causeType"?(v(),g(K,{key:0,color:ae(r.causeType)},{default:l(()=>[p(h(le(r.causeType)),1)]),_:2},1032,["color"])):n.key==="action"?(v(),g(c,{key:1,type:"link",danger:"",size:"small",onClick:rt=>Ae(w)},{default:l(()=>[...e[24]||(e[24]=[p("移除",-1)])]),_:1},8,["onClick"])):z("",!0)]),_:1},8,["data-source"]),!o.relatedCauses||o.relatedCauses.length===0?(v(),g(G,{key:0,description:"暂无关联原因"})):z("",!0)]),_:1})]),_:1})]),_:1},8,["visible","title"]),t(J,{visible:E.value,"onUpdate:visible":e[13]||(e[13]=n=>E.value=n),title:"选择不良原因",width:"800px",onOk:Ne},{default:l(()=>[t(H,{columns:we,"data-source":te.value,loading:B.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:U.value,onChange:Me}},{bodyCell:l(({column:n,record:r})=>[n.key==="causeType"?(v(),g(K,{key:0,color:ae(r.causeType)},{default:l(()=>[p(h(le(r.causeType)),1)]),_:2},1032,["color"])):z("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),mt=qe(ut,[["__scopeId","data-v-cfd03873"]]);export{mt as default};
