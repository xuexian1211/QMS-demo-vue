import{E as ee}from"./ExportOutlined-3X2_SK8n.js";import{d as te,r as m,a as le,m as ae,c as oe,e as v,x as t,q as e,s as u,o as g,h as a,y as L,I as ne,S as se,p as f,f as _,t as s,C as O,M as re}from"./index-BsO03Xlk.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"system-log"},de={class:"page-header"},pe={class:"search-section"},ce={style:{"white-space":"pre-wrap"}},me=te({__name:"SystemLog",setup(ge){const C=m(""),h=m(),I=m(),M=m(),S=m(!1),N=m(!1),o=m({}),k=le({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条记录`}),E=[{title:"日志ID",dataIndex:"id",key:"id",width:80},{title:"日志类型",dataIndex:"logType",key:"logType",width:100},{title:"日志级别",dataIndex:"level",key:"level",width:80},{title:"操作用户",dataIndex:"username",key:"username",width:100},{title:"操作模块",dataIndex:"module",key:"module",width:120},{title:"操作内容",dataIndex:"operation",key:"operation",width:200,ellipsis:!0},{title:"IP地址",dataIndex:"ip",key:"ip",width:120},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"执行时长",dataIndex:"duration",key:"duration",width:100,render:n=>`${n}ms`},{title:"操作时间",dataIndex:"createTime",key:"createTime",width:150},{title:"操作",key:"action",width:150,fixed:"right"}],b=m([{id:1001,logType:"login",level:"info",username:"admin",ip:"192.168.1.100",module:"用户认证",operation:"用户登录系统",method:"LoginController.login",url:"/api/auth/login",httpMethod:"POST",status:"success",duration:120,createTime:"2024-01-15 09:30:15",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",params:'{"username":"admin","password":"***"}',result:'{"code":200,"message":"登录成功","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"}',errorMsg:null},{id:1002,logType:"operation",level:"info",username:"admin",ip:"192.168.1.100",module:"系统管理",operation:"新增系统公告",method:"AnnouncementController.create",url:"/api/system/announcement",httpMethod:"POST",status:"success",duration:85,createTime:"2024-01-15 10:15:30",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",params:'{"title":"系统维护通知","content":"系统将于本周六进行维护"}',result:'{"code":200,"message":"创建成功","data":{"id":123}}',errorMsg:null},{id:1003,logType:"error",level:"error",username:"admin",ip:"192.168.1.100",module:"质量管理",operation:"查询检验单列表",method:"IQCController.getList",url:"/api/quality/iqc/list",httpMethod:"GET",status:"error",duration:2500,createTime:"2024-01-15 11:20:45",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",params:'{"page":1,"size":10}',result:null,errorMsg:"数据库连接超时: Connection timeout after 2500ms"},{id:1004,logType:"security",level:"warning",username:"unknown",ip:"192.168.1.200",module:"用户认证",operation:"登录失败",method:"LoginController.login",url:"/api/auth/login",httpMethod:"POST",status:"error",duration:50,createTime:"2024-01-15 12:05:20",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",params:'{"username":"test","password":"wrong"}',result:'{"code":401,"message":"用户名或密码错误"}',errorMsg:"用户名或密码错误"}]),w=()=>{k.current=1,x()},P=()=>{C.value="",h.value=void 0,I.value=void 0,M.value=void 0,w()},B=n=>{k.current=n.current,k.pageSize=n.pageSize,x()},K=n=>{o.value=n,N.value=!0},R=n=>{const l=b.value.findIndex(p=>p.id===n);l>-1&&(b.value.splice(l,1),O.success("删除成功"),x())},$=()=>{O.info("导出功能开发中...")},q=()=>{re.confirm({title:"确认清空",content:"确定要清空所有日志记录吗？此操作不可恢复！",okText:"确定",cancelText:"取消",okType:"danger",onOk(){b.value=[],O.success("日志已清空"),x()}})},x=()=>{S.value=!0,setTimeout(()=>{k.total=b.value.length,S.value=!1},500)},W=n=>({login:"blue",operation:"green",system:"purple",error:"red",security:"orange"})[n]||"default",A=n=>({login:"登录日志",operation:"操作日志",system:"系统日志",error:"错误日志",security:"安全日志"})[n]||n,J=n=>({info:"blue",warning:"orange",error:"red",debug:"purple"})[n]||"default",U=n=>({info:"信息",warning:"警告",error:"错误",debug:"调试"})[n]||n;return ae(()=>{x()}),(n,l)=>{const p=u("a-button"),V=u("a-space"),G=u("a-input"),T=u("a-col"),d=u("a-select-option"),D=u("a-select"),Q=u("a-range-picker"),X=u("a-row"),y=u("a-tag"),j=u("a-popconfirm"),F=u("a-table"),r=u("a-descriptions-item"),z=u("a-typography-paragraph"),H=u("a-descriptions"),Y=u("a-modal");return g(),oe("div",ie,[v("div",de,[l[7]||(l[7]=v("h2",null,"系统日志",-1)),t(V,null,{default:e(()=>[t(p,{onClick:$},{icon:e(()=>[t(L(ee))]),default:e(()=>[l[5]||(l[5]=a(" 导出日志 ",-1))]),_:1}),t(p,{type:"primary",danger:"",onClick:q},{icon:e(()=>[t(L(ne))]),default:e(()=>[l[6]||(l[6]=a(" 清空日志 ",-1))]),_:1})]),_:1})]),v("div",pe,[t(X,{gutter:16},{default:e(()=>[t(T,{span:5},{default:e(()=>[t(G,{value:C.value,"onUpdate:value":l[0]||(l[0]=i=>C.value=i),placeholder:"搜索操作内容/用户",onPressEnter:w},{prefix:e(()=>[t(L(se))]),_:1},8,["value"])]),_:1}),t(T,{span:4},{default:e(()=>[t(D,{value:h.value,"onUpdate:value":l[1]||(l[1]=i=>h.value=i),placeholder:"日志类型",allowClear:""},{default:e(()=>[t(d,{value:"login"},{default:e(()=>[...l[8]||(l[8]=[a("登录日志",-1)])]),_:1}),t(d,{value:"operation"},{default:e(()=>[...l[9]||(l[9]=[a("操作日志",-1)])]),_:1}),t(d,{value:"system"},{default:e(()=>[...l[10]||(l[10]=[a("系统日志",-1)])]),_:1}),t(d,{value:"error"},{default:e(()=>[...l[11]||(l[11]=[a("错误日志",-1)])]),_:1}),t(d,{value:"security"},{default:e(()=>[...l[12]||(l[12]=[a("安全日志",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(T,{span:4},{default:e(()=>[t(D,{value:I.value,"onUpdate:value":l[2]||(l[2]=i=>I.value=i),placeholder:"日志级别",allowClear:""},{default:e(()=>[t(d,{value:"info"},{default:e(()=>[...l[13]||(l[13]=[a("信息",-1)])]),_:1}),t(d,{value:"warning"},{default:e(()=>[...l[14]||(l[14]=[a("警告",-1)])]),_:1}),t(d,{value:"error"},{default:e(()=>[...l[15]||(l[15]=[a("错误",-1)])]),_:1}),t(d,{value:"debug"},{default:e(()=>[...l[16]||(l[16]=[a("调试",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(T,{span:6},{default:e(()=>[t(Q,{value:M.value,"onUpdate:value":l[3]||(l[3]=i=>M.value=i),"show-time":"",onChange:w},null,8,["value"])]),_:1}),t(T,{span:5},{default:e(()=>[t(p,{type:"primary",onClick:w},{default:e(()=>[...l[17]||(l[17]=[a("查询",-1)])]),_:1}),t(p,{style:{"margin-left":"8px"},onClick:P},{default:e(()=>[...l[18]||(l[18]=[a("重置",-1)])]),_:1})]),_:1})]),_:1})]),t(F,{columns:E,"data-source":b.value,pagination:k,loading:S.value,onChange:B,"row-key":"id",scroll:{x:1200}},{bodyCell:e(({column:i,record:c})=>[i.key==="logType"?(g(),f(y,{key:0,color:W(c.logType)},{default:e(()=>[a(s(A(c.logType)),1)]),_:2},1032,["color"])):_("",!0),i.key==="level"?(g(),f(y,{key:1,color:J(c.level)},{default:e(()=>[a(s(U(c.level)),1)]),_:2},1032,["color"])):_("",!0),i.key==="status"?(g(),f(y,{key:2,color:c.status==="success"?"green":"red"},{default:e(()=>[a(s(c.status==="success"?"成功":"失败"),1)]),_:2},1032,["color"])):_("",!0),i.key==="action"?(g(),f(V,{key:3},{default:e(()=>[t(p,{type:"link",size:"small",onClick:Z=>K(c)},{default:e(()=>[...l[19]||(l[19]=[a("查看详情",-1)])]),_:1},8,["onClick"]),t(j,{title:"确定要删除这条日志吗？",onConfirm:Z=>R(c.id)},{default:e(()=>[t(p,{type:"link",size:"small",danger:""},{default:e(()=>[...l[20]||(l[20]=[a("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["data-source","pagination","loading"]),t(Y,{open:N.value,"onUpdate:open":l[4]||(l[4]=i=>N.value=i),title:"日志详情",width:"900px",footer:null},{default:e(()=>[t(H,{column:2,bordered:""},{default:e(()=>[t(r,{label:"日志ID"},{default:e(()=>[a(s(o.value.id),1)]),_:1}),t(r,{label:"日志类型"},{default:e(()=>[t(y,{color:W(o.value.logType)},{default:e(()=>[a(s(A(o.value.logType)),1)]),_:1},8,["color"])]),_:1}),t(r,{label:"日志级别"},{default:e(()=>[t(y,{color:J(o.value.level)},{default:e(()=>[a(s(U(o.value.level)),1)]),_:1},8,["color"])]),_:1}),t(r,{label:"操作状态"},{default:e(()=>[t(y,{color:o.value.status==="success"?"green":"red"},{default:e(()=>[a(s(o.value.status==="success"?"成功":"失败"),1)]),_:1},8,["color"])]),_:1}),t(r,{label:"操作用户"},{default:e(()=>[a(s(o.value.username),1)]),_:1}),t(r,{label:"用户IP"},{default:e(()=>[a(s(o.value.ip),1)]),_:1}),t(r,{label:"操作模块"},{default:e(()=>[a(s(o.value.module),1)]),_:1}),t(r,{label:"操作方法"},{default:e(()=>[a(s(o.value.method),1)]),_:1}),t(r,{label:"请求URL"},{default:e(()=>[a(s(o.value.url),1)]),_:1}),t(r,{label:"请求方式"},{default:e(()=>[a(s(o.value.httpMethod),1)]),_:1}),t(r,{label:"操作时间"},{default:e(()=>[a(s(o.value.createTime),1)]),_:1}),t(r,{label:"执行时长"},{default:e(()=>[a(s(o.value.duration)+"ms",1)]),_:1}),t(r,{label:"操作内容",span:2},{default:e(()=>[v("div",ce,s(o.value.operation),1)]),_:1}),o.value.params?(g(),f(r,{key:0,label:"请求参数",span:2},{default:e(()=>[t(z,{copyable:""},{default:e(()=>[v("pre",null,s(JSON.stringify(JSON.parse(o.value.params),null,2)),1)]),_:1})]),_:1})):_("",!0),o.value.result?(g(),f(r,{key:1,label:"响应结果",span:2},{default:e(()=>[t(z,{copyable:""},{default:e(()=>[v("pre",null,s(JSON.stringify(JSON.parse(o.value.result),null,2)),1)]),_:1})]),_:1})):_("",!0),o.value.errorMsg?(g(),f(r,{key:2,label:"错误信息",span:2},{default:e(()=>[t(z,{copyable:"",class:"error-text"},{default:e(()=>[v("pre",null,s(o.value.errorMsg),1)]),_:1})]),_:1})):_("",!0),t(r,{label:"浏览器信息",span:2},{default:e(()=>[a(s(o.value.userAgent),1)]),_:1})]),_:1})]),_:1},8,["open"])])}}}),ye=ue(me,[["__scopeId","data-v-f67c962b"]]);export{ye as default};
