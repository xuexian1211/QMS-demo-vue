import{d as ke,r as v,a as se,l as he,p as w,q as t,s as o,o as f,e as S,x as e,h as d,y as $,P as ge,I as Se,R as Ie,f as D,c as j,t as z,F as de,z as Oe,M as ve,C as O,u as Qe,k as Ne,m as Ee,G as Be,Y as We}from"./index-BhbkSrG8.js";import{E as Ve}from"./ExportOutlined-iuxpVXnR.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as je}from"./excel-B07CBqJs.js";import{I as Ge}from"./ImportOutlined-Hi7XCNUY.js";const Ae={class:"spec-container"},Ke={class:"spec-toolbar"},He={key:0},Je={key:1},Ye={key:0},Xe=ke({__name:"MaterialSpecDrawer",props:{visible:{type:Boolean},materialInfo:{}},emits:["update:visible"],setup(P,{emit:Y}){const x=P,T=Y,h=v(!1),g=v([]),r=v([]),Q=v(!1),F=v(!1),q=v(),N=v([]),K=v([{id:"1",name:"长度",dataType:"Quantitative"},{id:"2",name:"外观",dataType:"Qualitative"},{id:"3",name:"硬度",dataType:"Quantitative"},{id:"4",name:"表面缺陷",dataType:"Qualitative"}]),k=[{title:"检验项目",dataIndex:"inspItemName",key:"inspItemName",width:150},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:100},{title:"规格值",key:"specValue",width:250},{title:"备注",dataIndex:"remark",key:"remark"},{title:"操作",key:"action",width:150,fixed:"right"}],s=se({id:null,inspItemId:void 0,inspItemName:"",dataType:"Quantitative",targetValue:void 0,upperLimit:void 0,lowerLimit:void 0,unit:"",standardDesc:"",standardCode:"",expectedValue:"",sampleImage:"",remark:""}),I={inspItemId:[{required:!0,message:"请选择检验项目",trigger:"change"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}],targetValue:[{required:!0,message:"请输入目标值",trigger:"blur",type:"number"}],standardDesc:[{required:!0,message:"请输入标准描述",trigger:"blur"}]};he(()=>x.visible,y=>{var l;y&&((l=x.materialInfo)!=null&&l.id)&&R()});const C=()=>{T("update:visible",!1)},R=()=>{h.value=!0,r.value=[],setTimeout(()=>{const y={1:[{id:"s1",inspItemId:"1",inspItemName:"长度",dataType:"Quantitative",targetValue:100,upperLimit:101,lowerLimit:99,unit:"mm",remark:""},{id:"s2",inspItemId:"2",inspItemName:"外观",dataType:"Qualitative",standardDesc:"无明显划痕、凹坑",standardCode:"STD-001",expectedValue:"OK",remark:""}],2:[{id:"s3",inspItemId:"3",inspItemName:"硬度",dataType:"Quantitative",targetValue:60,upperLimit:65,lowerLimit:55,unit:"HRC",remark:""}],3:[]};g.value=y[x.materialInfo.id]||[],h.value=!1},300)},G=y=>{r.value=y},B=()=>{Object.assign(s,{id:null,inspItemId:void 0,inspItemName:"",dataType:"Quantitative",targetValue:void 0,upperLimit:void 0,lowerLimit:void 0,unit:"",standardDesc:"",standardCode:"",expectedValue:"",sampleImage:"",remark:""}),N.value=[]},X=()=>{F.value=!1,B(),Q.value=!0},te=y=>{F.value=!0,Object.assign(s,{...y}),y.sampleImage?N.value=[{uid:"-1",name:"sample.png",status:"done",url:y.sampleImage}]:N.value=[],Q.value=!0},U=y=>{ve.confirm({title:"确认删除",content:"确定删除该检验规格吗？",okType:"danger",onOk(){g.value=g.value.filter(l=>l.id!==y.id),O.success("删除成功")}})},u=()=>{ve.confirm({title:"确认批量删除",content:`确定删除选中的 ${r.value.length} 条记录吗？`,okType:"danger",onOk(){g.value=g.value.filter(y=>!r.value.includes(y.id)),r.value=[],O.success("批量删除成功")}})},i=()=>{q.value.validate().then(()=>{if(s.dataType==="Quantitative"&&s.lowerLimit!==void 0&&s.upperLimit!==void 0&&s.lowerLimit>s.upperLimit){O.error("下限不能大于上限");return}const y=K.value.find(l=>l.id===s.inspItemId);if(s.inspItemName=(y==null?void 0:y.name)||"",F.value){const l=g.value.findIndex(L=>L.id===s.id);l>-1&&Object.assign(g.value[l],{...s})}else g.value.push({...s,id:Date.now().toString()});O.success("保存成功"),Q.value=!1}).catch(()=>{O.error("请完善必填项")})},p=()=>{O.success("导出任务已开始")},Z=y=>{const l=K.value.find(L=>L.id===y);l&&(s.dataType=l.dataType)},ue=()=>{s.dataType==="Quantitative"?(s.standardDesc="",s.standardCode="",s.expectedValue="",s.sampleImage="",N.value=[]):(s.targetValue=void 0,s.upperLimit=void 0,s.lowerLimit=void 0,s.unit="")},re=y=>{var l;N.value=y.fileList,y.file.status==="done"&&(s.sampleImage=((l=y.file.response)==null?void 0:l.url)||"")};return(y,l)=>{const L=o("a-button"),H=o("a-space"),pe=o("a-tag"),me=o("a-divider"),oe=o("a-table"),A=o("a-select-option"),ee=o("a-select"),V=o("a-form-item"),_=o("a-col"),J=o("a-row"),ae=o("a-input-number"),ce=o("a-input"),fe=o("a-textarea"),be=o("a-upload"),n=o("a-form"),a=o("a-modal"),b=o("a-drawer");return f(),w(b,{visible:P.visible,title:`物料检验规格 - ${P.materialInfo.code} ${P.materialInfo.name}`,width:"900px",destroyOnClose:!0,onClose:C},{default:t(()=>[S("div",Ae,[S("div",Ke,[e(H,null,{default:t(()=>[e(L,{type:"primary",onClick:X},{icon:t(()=>[e($(ge))]),default:t(()=>[l[11]||(l[11]=d("新增 ",-1))]),_:1}),e(L,{danger:"",disabled:r.value.length===0,onClick:u},{icon:t(()=>[e($(Se))]),default:t(()=>[l[12]||(l[12]=d("批量删除 ",-1))]),_:1},8,["disabled"]),e(L,{onClick:p},{icon:t(()=>[e($(Ve))]),default:t(()=>[l[13]||(l[13]=d("导出 ",-1))]),_:1}),e(L,{onClick:R},{icon:t(()=>[e($(Ie))]),default:t(()=>[l[14]||(l[14]=d("刷新 ",-1))]),_:1})]),_:1})]),e(oe,{columns:k,"data-source":g.value,loading:h.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:r.value,onChange:G},pagination:!1},{bodyCell:t(({column:c,record:M})=>[c.key==="dataType"?(f(),w(pe,{key:0,color:M.dataType==="Quantitative"?"blue":"purple"},{default:t(()=>[d(z(M.dataType==="Quantitative"?"计量型":"计数型"),1)]),_:2},1032,["color"])):D("",!0),c.key==="specValue"?(f(),j(de,{key:1},[M.dataType==="Quantitative"?(f(),j("span",He,z(M.targetValue)+" ("+z(M.lowerLimit)+" ~ "+z(M.upperLimit)+") "+z(M.unit),1)):(f(),j("span",Je,z(M.standardDesc),1))],64)):D("",!0),c.key==="action"?(f(),w(H,{key:2},{default:t(()=>[e(L,{type:"link",size:"small",onClick:ye=>te(M)},{default:t(()=>[...l[15]||(l[15]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(me,{type:"vertical"}),e(L,{type:"link",danger:"",size:"small",onClick:ye=>U(M)},{default:t(()=>[...l[16]||(l[16]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading","row-selection"])]),e(a,{visible:Q.value,"onUpdate:visible":l[10]||(l[10]=c=>Q.value=c),title:F.value?"编辑检验规格":"新增检验规格",width:"600px",onOk:i},{default:t(()=>[e(n,{ref_key:"specFormRef",ref:q,model:s,rules:I,layout:"vertical"},{default:t(()=>[e(J,{gutter:16},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(V,{label:"检验项目",name:"inspItemId"},{default:t(()=>[e(ee,{value:s.inspItemId,"onUpdate:value":l[0]||(l[0]=c=>s.inspItemId=c),placeholder:"请选择检验项目",onChange:Z},{default:t(()=>[(f(!0),j(de,null,Oe(K.value,c=>(f(),w(A,{key:c.id,value:c.id},{default:t(()=>[d(z(c.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(V,{label:"数据类型",name:"dataType"},{default:t(()=>[e(ee,{value:s.dataType,"onUpdate:value":l[1]||(l[1]=c=>s.dataType=c),placeholder:"请选择",onChange:ue},{default:t(()=>[e(A,{value:"Quantitative"},{default:t(()=>[...l[17]||(l[17]=[d("计量型",-1)])]),_:1}),e(A,{value:"Qualitative"},{default:t(()=>[...l[18]||(l[18]=[d("计数型",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),s.dataType==="Quantitative"?(f(),j(de,{key:0},[e(J,{gutter:16},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(V,{label:"目标值",name:"targetValue"},{default:t(()=>[e(ae,{value:s.targetValue,"onUpdate:value":l[2]||(l[2]=c=>s.targetValue=c),style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(_,{span:8},{default:t(()=>[e(V,{label:"上限",name:"upperLimit"},{default:t(()=>[e(ae,{value:s.upperLimit,"onUpdate:value":l[3]||(l[3]=c=>s.upperLimit=c),style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(_,{span:8},{default:t(()=>[e(V,{label:"下限",name:"lowerLimit"},{default:t(()=>[e(ae,{value:s.lowerLimit,"onUpdate:value":l[4]||(l[4]=c=>s.lowerLimit=c),style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(V,{label:"单位",name:"unit"},{default:t(()=>[e(ce,{value:s.unit,"onUpdate:value":l[5]||(l[5]=c=>s.unit=c),placeholder:"请输入单位"},null,8,["value"])]),_:1})],64)):(f(),j(de,{key:1},[e(V,{label:"标准描述",name:"standardDesc"},{default:t(()=>[e(fe,{value:s.standardDesc,"onUpdate:value":l[6]||(l[6]=c=>s.standardDesc=c),rows:3,placeholder:"请输入标准描述"},null,8,["value"])]),_:1}),e(J,{gutter:16},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(V,{label:"标准代码",name:"standardCode"},{default:t(()=>[e(ce,{value:s.standardCode,"onUpdate:value":l[7]||(l[7]=c=>s.standardCode=c),placeholder:"请输入标准代码"},null,8,["value"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(V,{label:"期望值",name:"expectedValue"},{default:t(()=>[e(ce,{value:s.expectedValue,"onUpdate:value":l[8]||(l[8]=c=>s.expectedValue=c),placeholder:"如：OK/NG"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(V,{label:"样板图"},{default:t(()=>[e(be,{"list-type":"picture-card","max-count":1,"file-list":N.value,onChange:re},{default:t(()=>[N.value.length===0?(f(),j("div",Ye,[e($(ge)),l[19]||(l[19]=S("div",{style:{"margin-top":"8px"}},"上传",-1))])):D("",!0)]),_:1},8,["file-list"])]),_:1})],64)),e(V,{label:"备注",name:"remark"},{default:t(()=>[e(fe,{value:s.remark,"onUpdate:value":l[9]||(l[9]=c=>s.remark=c),rows:2,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1},8,["visible","title"])}}}),Ze=Ce(Xe,[["__scopeId","data-v-98269829"]]),et={class:"route-container"},tt={class:"route-toolbar"},at={class:"route-count"},lt={key:3,class:"no-config"},nt=ke({__name:"MaterialRouteDrawer",props:{visible:{type:Boolean},materialInfo:{}},emits:["update:visible"],setup(P,{emit:Y}){const x=P,T=Y,h=Qe(),g=v(!1),r=v([]),Q=[{title:"路线编码",dataIndex:"code",key:"code",width:150},{title:"路线名称",dataIndex:"name",key:"name",width:200},{title:"版本",dataIndex:"version",key:"version",width:80},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"工序数",dataIndex:"stepCount",key:"stepCount",width:80},{title:"操作",key:"action",width:100}],F=[{title:"序号",dataIndex:"opSeq",key:"opSeq",width:80},{title:"工序名称",dataIndex:"opName",key:"opName",width:150},{title:"工作中心",dataIndex:"workCenter",key:"workCenter",width:120},{title:"检验配置",key:"inspConfig",width:180},{title:"工序描述",dataIndex:"description",key:"description"}];he(()=>x.visible,I=>{var C;I&&((C=x.materialInfo)!=null&&C.id)&&k()});const q=()=>{T("update:visible",!1)},N=I=>({Active:"success",Draft:"default",Obsolete:"error"})[I]||"default",K=I=>({Active:"生效",Draft:"草稿",Obsolete:"失效"})[I]||I,k=()=>{g.value=!0,setTimeout(()=>{const I={1:[{id:"r1",code:"PR-001",name:"铝锭标准工艺",version:"V1.0",status:"Active",stepCount:3,steps:[{id:"s1",opSeq:10,opName:"熔炼",workCenter:"WC-01",description:"铝液熔炼",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s2",opSeq:20,opName:"浇铸",workCenter:"WC-02",description:"连续浇铸",hasFirstInsp:!1,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s3",opSeq:30,opName:"冷却切割",workCenter:"WC-03",description:"冷却定型切割",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]}],2:[{id:"r2",code:"PR-002",name:"壳体加工工艺",version:"V1.0",status:"Active",stepCount:4,steps:[{id:"s4",opSeq:10,opName:"压铸",workCenter:"WC-10",description:"高压压铸",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s5",opSeq:20,opName:"去毛刺",workCenter:"WC-11",description:"人工去毛刺",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!1},{id:"s6",opSeq:30,opName:"机加工",workCenter:"WC-12",description:"CNC加工",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s7",opSeq:40,opName:"抛光",workCenter:"WC-13",description:"表面抛光",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]},{id:"r3",code:"PR-003",name:"壳体加工工艺V2",version:"V2.0",status:"Draft",stepCount:3,steps:[{id:"s8",opSeq:10,opName:"压铸",workCenter:"WC-10",description:"高压压铸",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s9",opSeq:20,opName:"机加工",workCenter:"WC-12",description:"CNC加工",hasFirstInsp:!1,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s10",opSeq:30,opName:"抛光",workCenter:"WC-13",description:"表面抛光",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]}],3:[]};r.value=I[x.materialInfo.id]||[],g.value=!1},300)},s=I=>{h.push(`/basic-data/process-routes?code=${I.code}`),q()};return(I,C)=>{const R=o("a-button"),G=o("a-space"),B=o("a-tag"),X=o("a-table"),te=o("a-drawer");return f(),w(te,{visible:P.visible,title:`工艺路线 - ${P.materialInfo.code} ${P.materialInfo.name}`,width:"900px",destroyOnClose:!0,onClose:q},{default:t(()=>[S("div",et,[S("div",tt,[e(G,null,{default:t(()=>[e(R,{onClick:k},{icon:t(()=>[e($(Ie))]),default:t(()=>[C[0]||(C[0]=d("刷新 ",-1))]),_:1})]),_:1}),S("span",at,"共 "+z(r.value.length)+" 条工艺路线",1)]),e(X,{columns:Q,"data-source":r.value,loading:g.value,"row-key":"id",size:"middle",pagination:!1},{bodyCell:t(({column:U,record:u})=>[U.key==="status"?(f(),w(B,{key:0,color:N(u.status)},{default:t(()=>[d(z(K(u.status)),1)]),_:2},1032,["color"])):D("",!0),U.key==="action"?(f(),w(G,{key:1},{default:t(()=>[e(R,{type:"link",size:"small",onClick:i=>s(u)},{default:t(()=>[...C[1]||(C[1]=[d("查看详情",-1)])]),_:1},8,["onClick"])]),_:2},1024)):D("",!0)]),expandedRowRender:t(({record:U})=>[e(X,{columns:F,"data-source":U.steps,pagination:!1,size:"small","show-header":!0},{bodyCell:t(({column:u,record:i})=>[u.key==="inspConfig"?(f(),w(G,{key:0},{default:t(()=>[i.hasFirstInsp?(f(),w(B,{key:0,color:"blue",size:"small"},{default:t(()=>[...C[2]||(C[2]=[d("首检",-1)])]),_:1})):D("",!0),i.hasPatrolInsp?(f(),w(B,{key:1,color:"green",size:"small"},{default:t(()=>[...C[3]||(C[3]=[d("巡检",-1)])]),_:1})):D("",!0),i.hasFinalInsp?(f(),w(B,{key:2,color:"orange",size:"small"},{default:t(()=>[...C[4]||(C[4]=[d("末检",-1)])]),_:1})):D("",!0),!i.hasFirstInsp&&!i.hasPatrolInsp&&!i.hasFinalInsp?(f(),j("span",lt,"-")):D("",!0)]),_:2},1024)):D("",!0)]),_:1},8,["data-source"])]),_:1},8,["data-source","loading"])])]),_:1},8,["visible","title"])}}}),ot=Ce(nt,[["__scopeId","data-v-fe322cff"]]),it={class:"plan-container"},st={class:"plan-toolbar"},dt=ke({__name:"MaterialInspPlanDrawer",props:{visible:{type:Boolean},materialInfo:{},inspType:{}},emits:["update:visible"],setup(P,{emit:Y}){const x=P,T=Y,h=v(!1),g=v([]),r=v(!1),Q=v(!1),F=v(),q=Ne(()=>`${{IQC:"IQC来料检验",FQC:"FQC成品检验",OQC:"OQC出货检验"}[x.inspType]}方案 - ${x.materialInfo.code} ${x.materialInfo.name}`),N=v([{id:"p1",code:"IQC-001",name:"来料标准检验方案"},{id:"p2",code:"IQC-002",name:"来料加严检验方案"},{id:"p3",code:"FQC-001",name:"成品标准检验方案"},{id:"p4",code:"FQC-002",name:"成品全检方案"},{id:"p5",code:"OQC-001",name:"出货抽样检验方案"}]),K=[{title:"方案编码",dataIndex:"planCode",key:"planCode",width:150},{title:"方案名称",dataIndex:"planName",key:"planName",width:200},{title:"优先级",dataIndex:"priority",key:"priority",width:80},{title:"默认",key:"isDefault",width:80},{title:"备注",dataIndex:"remark",key:"remark"},{title:"操作",key:"action",width:120}],k=se({id:null,planId:void 0,priority:1,isDefault:!1,remark:""}),s={planId:[{required:!0,message:"请选择检验方案",trigger:"change"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur",type:"number"}]};he(()=>x.visible,u=>{var i;u&&((i=x.materialInfo)!=null&&i.id)&&R()});const I=()=>{T("update:visible",!1)},C=(u,i)=>{const p=N.value.find(Z=>Z.id===i.value);return p?p.code.toLowerCase().includes(u.toLowerCase())||p.name.toLowerCase().includes(u.toLowerCase()):!1},R=()=>{h.value=!0,setTimeout(()=>{const i={1:{IQC:[{id:"b1",planId:"p1",planCode:"IQC-001",planName:"来料标准检验方案",priority:1,isDefault:!0,remark:""},{id:"b2",planId:"p2",planCode:"IQC-002",planName:"来料加严检验方案",priority:2,isDefault:!1,remark:"供应商质量问题时启用"}],FQC:[],OQC:[]},2:{IQC:[],FQC:[{id:"b3",planId:"p3",planCode:"FQC-001",planName:"成品标准检验方案",priority:1,isDefault:!0,remark:""}],OQC:[]},3:{IQC:[],FQC:[{id:"b4",planId:"p4",planCode:"FQC-002",planName:"成品全检方案",priority:1,isDefault:!0,remark:""}],OQC:[{id:"b5",planId:"p5",planCode:"OQC-001",planName:"出货抽样检验方案",priority:1,isDefault:!0,remark:""}]}}[x.materialInfo.id]||{};g.value=i[x.inspType]||[],h.value=!1},300)},G=()=>{Object.assign(k,{id:null,planId:void 0,priority:1,isDefault:!1,remark:""})},B=()=>{Q.value=!1,G(),r.value=!0},X=u=>{Q.value=!0,Object.assign(k,{...u}),r.value=!0},te=u=>{ve.confirm({title:"确认删除",content:`确定删除与 ${u.planName} 的绑定吗？`,okType:"danger",onOk(){g.value=g.value.filter(i=>i.id!==u.id),O.success("删除成功")}})},U=()=>{F.value.validate().then(()=>{const u=N.value.find(i=>i.id===k.planId);if(k.isDefault&&g.value.forEach(i=>{i.isDefault=!1}),Q.value){const i=g.value.findIndex(p=>p.id===k.id);i>-1&&Object.assign(g.value[i],{...k,planCode:u==null?void 0:u.code,planName:u==null?void 0:u.name})}else g.value.push({...k,id:Date.now().toString(),planCode:u==null?void 0:u.code,planName:u==null?void 0:u.name});O.success("保存成功"),r.value=!1}).catch(()=>{O.error("请完善必填项")})};return(u,i)=>{const p=o("a-button"),Z=o("a-space"),ue=o("a-tag"),re=o("a-table"),y=o("a-empty"),l=o("a-select-option"),L=o("a-select"),H=o("a-form-item"),pe=o("a-input-number"),me=o("a-switch"),oe=o("a-textarea"),A=o("a-form"),ee=o("a-modal"),V=o("a-drawer");return f(),w(V,{visible:P.visible,title:q.value,width:"800px",destroyOnClose:!0,onClose:I},{default:t(()=>[S("div",it,[S("div",st,[e(Z,null,{default:t(()=>[e(p,{type:"primary",onClick:B},{icon:t(()=>[e($(ge))]),default:t(()=>[i[5]||(i[5]=d("新增绑定 ",-1))]),_:1}),e(p,{onClick:R},{icon:t(()=>[e($(Ie))]),default:t(()=>[i[6]||(i[6]=d("刷新 ",-1))]),_:1})]),_:1})]),e(re,{columns:K,"data-source":g.value,loading:h.value,"row-key":"id",size:"middle",pagination:!1},{bodyCell:t(({column:_,record:J})=>[_.key==="isDefault"?(f(),j(de,{key:0},[J.isDefault?(f(),w(ue,{key:0,color:"gold"},{default:t(()=>[...i[7]||(i[7]=[d("默认",-1)])]),_:1})):D("",!0)],64)):D("",!0),_.key==="action"?(f(),w(Z,{key:1},{default:t(()=>[e(p,{type:"link",size:"small",onClick:ae=>X(J)},{default:t(()=>[...i[8]||(i[8]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(p,{type:"link",danger:"",size:"small",onClick:ae=>te(J)},{default:t(()=>[...i[9]||(i[9]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading"]),g.value.length===0&&!h.value?(f(),w(y,{key:0,description:"暂无绑定的检验方案"},{default:t(()=>[e(p,{type:"primary",onClick:B},{default:t(()=>[...i[10]||(i[10]=[d("新增绑定",-1)])]),_:1})]),_:1})):D("",!0)]),e(ee,{visible:r.value,"onUpdate:visible":i[4]||(i[4]=_=>r.value=_),title:Q.value?"编辑绑定":"新增绑定",width:"500px",onOk:U},{default:t(()=>[e(A,{ref_key:"formRef",ref:F,model:k,rules:s,layout:"vertical"},{default:t(()=>[e(H,{label:"检验方案",name:"planId"},{default:t(()=>[e(L,{value:k.planId,"onUpdate:value":i[0]||(i[0]=_=>k.planId=_),placeholder:"请选择检验方案","show-search":"","filter-option":C},{default:t(()=>[(f(!0),j(de,null,Oe(N.value,_=>(f(),w(l,{key:_.id,value:_.id},{default:t(()=>[d(z(_.code)+" - "+z(_.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(H,{label:"优先级",name:"priority"},{default:t(()=>[e(pe,{value:k.priority,"onUpdate:value":i[1]||(i[1]=_=>k.priority=_),min:1,max:99,style:{width:"100%"},placeholder:"数字越小优先级越高"},null,8,["value"])]),_:1}),e(H,{label:"设为默认"},{default:t(()=>[e(me,{checked:k.isDefault,"onUpdate:checked":i[2]||(i[2]=_=>k.isDefault=_)},null,8,["checked"]),i[11]||(i[11]=S("span",{style:{"margin-left":"8px",color:"#666"}},"默认方案将在创建检验任务时自动选择",-1))]),_:1}),e(H,{label:"备注",name:"remark"},{default:t(()=>[e(oe,{value:k.remark,"onUpdate:value":i[3]||(i[3]=_=>k.remark=_),rows:2,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1},8,["visible","title"])}}}),ut=Ce(dt,[["__scopeId","data-v-4ffe032f"]]),rt={class:"page-container"},pt={class:"split-layout"},mt={class:"tree-panel"},ct={class:"tree-header"},vt={class:"content-panel"},ft={class:"toolbar"},yt={class:"table-container"},_t=ke({__name:"MaterialProduct",setup(P){const Y=Qe(),x=v(!1),T=v([]),h=v([]),g=v(),r=se({orgId:void 0,code:"",name:"",category:void 0}),Q=v(""),F=v([]),q=v(""),N=v([{key:"all",title:"全部分类",children:[{key:"Raw",title:"原材料"},{key:"Semi",title:"半成品"},{key:"Finish",title:"成品"}]}]),K=n=>{if(n.length===0||n[0]==="all")F.value=[],q.value="";else{F.value=n;const a={Raw:"原材料",Semi:"半成品",Finish:"成品"};q.value=a[n[0]]||n[0]}},k=()=>{F.value=[],q.value=""},s=Ne(()=>{let n=[...T.value];return F.value.length>0&&F.value[0]!=="all"&&(n=n.filter(a=>a.category===F.value[0])),n}),I=se({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),C=[{title:"所属组织",dataIndex:"orgId",key:"orgId",width:100},{title:"物料编码",dataIndex:"code",key:"code",width:120},{title:"物料名称",dataIndex:"name",key:"name",width:150},{title:"规格型号",dataIndex:"spec",key:"spec",width:120},{title:"分类",dataIndex:"category",key:"category",width:80},{title:"单位",dataIndex:"unit",key:"unit",width:60},{title:"来源",dataIndex:"source",key:"source",width:60},{title:"工艺路线数",key:"routeCount",width:100},{title:"操作",key:"action",width:280,fixed:"right"}],R=()=>{x.value=!0,setTimeout(()=>{let n=[{id:"1",orgId:"Group",code:"M001",name:"铝锭",spec:"ADC12",category:"Raw",unit:"kg",source:"Buy",routeCount:1},{id:"2",orgId:"1",code:"P001",name:"发动机壳体",spec:"V1.0",category:"Semi",unit:"pcs",source:"Make",routeCount:2},{id:"3",orgId:"2",code:"F001",name:"电动车电机",spec:"500W",category:"Finish",unit:"set",source:"Make",routeCount:0}];r.orgId&&r.orgId.length>0&&(n=n.filter(a=>r.orgId.includes(a.orgId))),r.code&&(n=n.filter(a=>a.code.includes(r.code))),r.name&&(n=n.filter(a=>a.name.includes(r.name))),r.category&&(n=n.filter(a=>a.category===r.category)),T.value=n,I.total=n.length,x.value=!1},300)},G=()=>{I.current=1,R()},B=()=>{r.orgId=void 0,r.code="",r.name="",r.category=void 0,G()},X=n=>{I.current=n.current,I.pageSize=n.pageSize,R()},te=n=>{h.value=n},U=v(!1),u=v(!1),i=v(),p=se({id:null,orgId:"Group",code:"",name:"",spec:"",category:void 0,unit:"",source:"Buy",remark:""}),Z={code:[{required:!0,message:"请输入物料编码",trigger:"blur"}],name:[{required:!0,message:"请输入物料名称",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}]},ue=()=>{u.value=!1,Object.assign(p,{id:null,orgId:"Group",code:"",name:"",spec:"",category:void 0,unit:"",source:"Buy",remark:""}),U.value=!0},re=n=>{const a=n.id?n:T.value.find(b=>b.id===h.value[0]);a&&(u.value=!0,Object.assign(p,{...a}),U.value=!0)},y=n=>{Y.push(`/basic-data/material/view/${n.id}`)},l=n=>{Y.push(`/basic-data/material/edit/${n.id}`)},L=n=>{ve.confirm({title:"确认删除",content:`确定删除物料 ${n.name} 吗？`,okType:"danger",onOk(){T.value=T.value.filter(a=>a.id!==n.id),O.success("删除成功")}})},H=()=>{ve.confirm({title:"确认批量删除",content:`确定删除选中的 ${h.value.length} 条记录吗？`,okType:"danger",onOk(){T.value=T.value.filter(n=>!h.value.includes(n.id)),h.value=[],O.success("删除成功")}})},pe=()=>{i.value.validate().then(()=>{if(u.value){const n=T.value.findIndex(a=>a.id===p.id);n>-1&&Object.assign(T.value[n],p)}else T.value.push({...p,id:Date.now().toString()});O.success("保存成功"),U.value=!1,R()})},me=()=>{if(T.value.length===0){O.warning("暂无数据可导出");return}const n=[{title:"物料编码",dataIndex:"code"},{title:"物料名称",dataIndex:"name"},{title:"规格型号",dataIndex:"spec"},{title:"分类",dataIndex:"category"},{title:"单位",dataIndex:"unit"},{title:"来源",dataIndex:"source"}],{exportToCSV:a}=je();a(T.value,n,"物料档案"),O.success("导出成功")},oe=v(!1),A=se({id:"",code:"",name:""}),ee=v(!1),V=n=>{Object.assign(A,{id:n.id,code:n.code,name:n.name}),ee.value=!0},_=v(!1),J=v("IQC");Ee(()=>{R()});const ae=n=>({Group:"集团",1:"合肥工厂",2:"芜湖工厂"})[n]||"未知",ce=n=>({Group:"purple",1:"blue",2:"cyan"})[n]||"default",fe=({key:n})=>{var a;n==="template"?O.success("导入模板下载功能（物料编码、名称、规格、分类、单位、来源等列）"):n==="upload"&&((a=g.value)==null||a.click())},be=n=>{var b;const a=(b=n.target.files)==null?void 0:b[0];a&&(O.info(`正在解析文件: ${a.name}`),setTimeout(()=>{O.success("导入完成（前端模拟），共处理 0 条数据")},1e3),n.target.value="")};return(n,a)=>{const b=o("a-button"),c=o("a-input-search"),M=o("a-tree"),ye=o("a-menu-item"),$e=o("a-menu"),Re=o("a-dropdown"),De=o("a-space"),W=o("a-select-option"),_e=o("a-select"),E=o("a-form-item"),ie=o("a-input"),Te=o("a-form"),Ue=o("a-card"),Le=o("a-alert"),Pe=o("a-tag"),Fe=o("a-divider"),qe=o("a-table"),le=o("a-col"),we=o("a-row"),ze=o("a-textarea"),Me=o("a-modal");return f(),j("div",rt,[S("div",pt,[S("div",mt,[S("div",ct,[a[17]||(a[17]=S("span",{class:"tree-title"},"物料分类",-1)),e(b,{type:"link",size:"small",onClick:k},{default:t(()=>[...a[16]||(a[16]=[d("清除筛选",-1)])]),_:1})]),e(c,{value:Q.value,"onUpdate:value":a[0]||(a[0]=m=>Q.value=m),placeholder:"搜索分类",style:{"margin-bottom":"8px"}},null,8,["value"]),e(M,{"tree-data":N.value,"show-line":!0,"default-expand-all":!0,"selected-keys":F.value,onSelect:K},null,8,["tree-data","selected-keys"])]),S("div",vt,[S("div",ft,[e(De,null,{default:t(()=>[e(b,{type:"primary",onClick:ue},{icon:t(()=>[e($(ge))]),default:t(()=>[a[18]||(a[18]=d("新增 ",-1))]),_:1}),e(b,{disabled:h.value.length!==1,onClick:re},{icon:t(()=>[e($(Be))]),default:t(()=>[a[19]||(a[19]=d("编辑 ",-1))]),_:1},8,["disabled"]),e(b,{danger:"",disabled:h.value.length===0,onClick:H},{icon:t(()=>[e($(Se))]),default:t(()=>[a[20]||(a[20]=d("删除 ",-1))]),_:1},8,["disabled"]),e(Re,null,{overlay:t(()=>[e($e,{onClick:fe},{default:t(()=>[e(ye,{key:"template"},{default:t(()=>[...a[22]||(a[22]=[d("下载导入模板",-1)])]),_:1}),e(ye,{key:"upload"},{default:t(()=>[...a[23]||(a[23]=[d("上传Excel文件",-1)])]),_:1})]),_:1})]),default:t(()=>[e(b,null,{icon:t(()=>[e($(Ge))]),default:t(()=>[a[21]||(a[21]=d("导入 ",-1)),e($(We))]),_:1})]),_:1}),e(b,{onClick:me},{icon:t(()=>[e($(Ve))]),default:t(()=>[a[24]||(a[24]=d("导出 ",-1))]),_:1}),e(b,{onClick:R},{icon:t(()=>[e($(Ie))]),default:t(()=>[a[25]||(a[25]=d("刷新 ",-1))]),_:1})]),_:1})]),S("input",{ref_key:"importFileRef",ref:g,type:"file",accept:".xlsx,.xls,.csv",style:{display:"none"},onChange:be},null,544),e(Ue,{class:"search-card",bordered:!1},{default:t(()=>[e(Te,{layout:"inline",model:r},{default:t(()=>[e(E,{label:"所属组织"},{default:t(()=>[e(_e,{value:r.orgId,"onUpdate:value":a[1]||(a[1]=m=>r.orgId=m),style:{width:"140px"},placeholder:"全部","allow-clear":"",mode:"multiple","max-tag-count":1},{default:t(()=>[e(W,{value:"Group"},{default:t(()=>[...a[26]||(a[26]=[d("集团",-1)])]),_:1}),e(W,{value:"1"},{default:t(()=>[...a[27]||(a[27]=[d("合肥工厂",-1)])]),_:1}),e(W,{value:"2"},{default:t(()=>[...a[28]||(a[28]=[d("芜湖工厂",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(E,{label:"物料编码"},{default:t(()=>[e(ie,{value:r.code,"onUpdate:value":a[2]||(a[2]=m=>r.code=m),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),e(E,{label:"物料名称"},{default:t(()=>[e(ie,{value:r.name,"onUpdate:value":a[3]||(a[3]=m=>r.name=m),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),e(E,null,{default:t(()=>[e(b,{type:"primary",onClick:G},{default:t(()=>[...a[29]||(a[29]=[d("查询",-1)])]),_:1}),e(b,{style:{"margin-left":"8px"},onClick:B},{default:t(()=>[...a[30]||(a[30]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),S("div",yt,[q.value?(f(),w(Le,{key:0,message:`当前筛选分类：${q.value}`,type:"info","show-icon":"",closable:"",style:{"margin-bottom":"12px"},onClose:k},null,8,["message"])):D("",!0),e(qe,{columns:C,"data-source":s.value,loading:x.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:h.value,onChange:te},pagination:I,onChange:X},{bodyCell:t(({column:m,record:ne})=>[m.key==="orgId"?(f(),w(Pe,{key:0,color:ce(ne.orgId)},{default:t(()=>[d(z(ae(ne.orgId)),1)]),_:2},1032,["color"])):D("",!0),m.key==="routeCount"?(f(),w(b,{key:1,type:"link",size:"small",onClick:xe=>V(ne)},{default:t(()=>[d(z(ne.routeCount||0),1)]),_:2},1032,["onClick"])):D("",!0),m.key==="action"?(f(),w(De,{key:2},{default:t(()=>[e(b,{type:"link",size:"small",onClick:xe=>y(ne)},{default:t(()=>[...a[31]||(a[31]=[d("查看",-1)])]),_:1},8,["onClick"]),e(Fe,{type:"vertical"}),e(b,{type:"link",size:"small",onClick:xe=>l(ne)},{default:t(()=>[...a[32]||(a[32]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(Fe,{type:"vertical"}),e(b,{type:"link",danger:"",size:"small",onClick:xe=>L(ne)},{default:t(()=>[...a[33]||(a[33]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])]),e(Me,{visible:U.value,"onUpdate:visible":a[12]||(a[12]=m=>U.value=m),title:u.value?"编辑物料档案":"新增物料档案",width:"700px",onOk:pe},{default:t(()=>[e(Te,{ref_key:"formRef",ref:i,model:p,rules:Z,layout:"vertical"},{default:t(()=>[e(we,{gutter:16},{default:t(()=>[e(le,{span:8},{default:t(()=>[e(E,{label:"所属组织",name:"orgId"},{default:t(()=>[e(_e,{value:p.orgId,"onUpdate:value":a[4]||(a[4]=m=>p.orgId=m),placeholder:"请选择"},{default:t(()=>[e(W,{value:"Group"},{default:t(()=>[...a[34]||(a[34]=[d("集团（全局）",-1)])]),_:1}),e(W,{value:"1"},{default:t(()=>[...a[35]||(a[35]=[d("合肥工厂",-1)])]),_:1}),e(W,{value:"2"},{default:t(()=>[...a[36]||(a[36]=[d("芜湖工厂",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(le,{span:8},{default:t(()=>[e(E,{label:"物料编码",name:"code"},{default:t(()=>[e(ie,{value:p.code,"onUpdate:value":a[5]||(a[5]=m=>p.code=m),placeholder:"请输入",disabled:u.value},null,8,["value","disabled"])]),_:1})]),_:1}),e(le,{span:8},{default:t(()=>[e(E,{label:"物料名称",name:"name"},{default:t(()=>[e(ie,{value:p.name,"onUpdate:value":a[6]||(a[6]=m=>p.name=m),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(we,{gutter:16},{default:t(()=>[e(le,{span:12},{default:t(()=>[e(E,{label:"物料分类",name:"category"},{default:t(()=>[e(_e,{value:p.category,"onUpdate:value":a[7]||(a[7]=m=>p.category=m),placeholder:"请选择"},{default:t(()=>[e(W,{value:"Raw"},{default:t(()=>[...a[37]||(a[37]=[d("原材料",-1)])]),_:1}),e(W,{value:"Semi"},{default:t(()=>[...a[38]||(a[38]=[d("半成品",-1)])]),_:1}),e(W,{value:"Finish"},{default:t(()=>[...a[39]||(a[39]=[d("成品",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(le,{span:12},{default:t(()=>[e(E,{label:"单位",name:"unit"},{default:t(()=>[e(ie,{value:p.unit,"onUpdate:value":a[8]||(a[8]=m=>p.unit=m),placeholder:"如：kg, pcs"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(we,{gutter:16},{default:t(()=>[e(le,{span:12},{default:t(()=>[e(E,{label:"规格型号",name:"spec"},{default:t(()=>[e(ie,{value:p.spec,"onUpdate:value":a[9]||(a[9]=m=>p.spec=m),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(le,{span:12},{default:t(()=>[e(E,{label:"来源",name:"source"},{default:t(()=>[e(_e,{value:p.source,"onUpdate:value":a[10]||(a[10]=m=>p.source=m)},{default:t(()=>[e(W,{value:"Make"},{default:t(()=>[...a[40]||(a[40]=[d("自制",-1)])]),_:1}),e(W,{value:"Buy"},{default:t(()=>[...a[41]||(a[41]=[d("外购",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(E,{label:"备注",name:"remark"},{default:t(()=>[e(ze,{value:p.remark,"onUpdate:value":a[11]||(a[11]=m=>p.remark=m),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),e(Ze,{visible:oe.value,"onUpdate:visible":a[13]||(a[13]=m=>oe.value=m),materialInfo:A},null,8,["visible","materialInfo"]),e(ot,{visible:ee.value,"onUpdate:visible":a[14]||(a[14]=m=>ee.value=m),materialInfo:A},null,8,["visible","materialInfo"]),e(ut,{visible:_.value,"onUpdate:visible":a[15]||(a[15]=m=>_.value=m),materialInfo:A,inspType:J.value},null,8,["visible","materialInfo","inspType"])])}}}),wt=Ce(_t,[["__scopeId","data-v-e006ba1c"]]);export{wt as default};
