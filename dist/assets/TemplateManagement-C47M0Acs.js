import{d as Ne,r as v,a as J,m as xe,c as Q,e as g,x as t,q as a,s as r,o as m,h as s,y as H,P as te,S as $e,p as k,f as w,t as f,F as Ue,z as Ie,C as D}from"./index-BhbkSrG8.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"template-management"},Se={class:"page-header"},Ve={class:"search-section"},Re={class:"template-editor"},Pe={class:"editor-toolbar"},Ee={class:"template-content"},Le={class:"preview-content"},Oe={class:"preview-form"},Be={key:0,class:"preview-result"},Me={class:"preview-text"},qe=Ne({__name:"TemplateManagement",setup(Fe){const P=v(""),E=v(),L=v(),O=v(!1),N=v(!1),B=v(!1),M=v(!1),S=v(!1),q=v(),p=v({}),V=v(""),I=J({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条记录`}),ae=[{title:"模板ID",dataIndex:"id",key:"id",width:80},{title:"模板名称",dataIndex:"templateName",key:"templateName",width:150},{title:"模板类型",dataIndex:"templateType",key:"templateType",width:100},{title:"模板分类",dataIndex:"category",key:"category",width:120},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:150},{title:"操作",key:"action",width:250,fixed:"right"}],le=[{title:"变量名",dataIndex:"variableName",key:"variableName"},{title:"变量类型",dataIndex:"variableType",key:"variableType"},{title:"变量描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],o=J({templateName:"",templateType:"",description:"",category:"",status:"active",content:"",variables:[]}),b=J({variables:[],values:{}}),ne={templateName:[{required:!0,message:"请输入模板名称",trigger:"blur"}],templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"}]},c=v([{id:3001,templateName:"检验报告模板",templateType:"print",category:"质量检验",status:"active",description:"用于生成来料检验报告的标准模板",content:"检验报告\n检验单号：${inspectionNo}\n物料名称：${materialName}\n检验结果：${result}\n检验时间：${inspectionDate}",createTime:"2024-01-10 10:00:00",updateTime:"2024-01-15 14:30:00",creator:"admin"},{id:3002,templateName:"系统登录消息模板",templateType:"message",category:"系统通知",status:"active",description:"用户登录成功后的系统消息模板",content:"欢迎${userName}登录系统！\n登录时间：${loginTime}\n登录IP：${loginIP}",createTime:"2024-01-08 14:20:00",updateTime:"2024-01-14 09:15:00",creator:"admin"},{id:3003,templateName:"工作空间模板",templateType:"space",category:"工作空间",status:"active",description:"新用户注册时的默认工作空间配置",content:"个人工作空间\n用户：${userName}\n创建时间：${createTime}\n默认权限：${permissions}",createTime:"2024-01-05 16:45:00",updateTime:"2024-01-12 11:20:00",creator:"admin"},{id:3004,templateName:"月度报表邮件模板",templateType:"email",category:"报表邮件",status:"inactive",description:"月度质量分析报表的邮件发送模板",content:"月度质量分析报表\n尊敬的${recipient}：\n附件是${month}的质量分析报表，请查收。\n统计时间：${dateRange}\n总检验批次：${totalBatches}",createTime:"2024-01-03 10:30:00",updateTime:"2024-01-10 15:45:00",creator:"admin"}]),F=()=>{I.current=1,x()},se=()=>{P.value="",E.value=void 0,L.value=void 0,F()},oe=l=>{I.current=l.current,I.pageSize=l.pageSize,x()},ie=()=>{S.value=!1,K(),N.value=!0},ue=l=>{S.value=!0,Object.assign(o,{...l,variables:l.variables||[]}),N.value=!0},de=l=>{p.value=l,B.value=!0},re=l=>{b.variables=l.variables||[],b.values={},b.content=l.content,V.value="",M.value=!0},pe=l=>{const e={...l,id:Date.now(),templateName:l.templateName+"_副本",createTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString()};c.value.unshift(e),D.success("模板复制成功"),x()},ve=l=>{const e=c.value.findIndex(i=>i.id===l);e>-1&&(c.value.splice(e,1),D.success("删除成功"),x())},me=l=>{const e=c.value.findIndex(i=>i.id===l.id);e>-1&&(c.value[e].status=l.status==="active"?"inactive":"active",D.success("状态更新成功"))},fe=async()=>{try{if(await q.value.validate(),S.value){const l=c.value.findIndex(e=>e.id===o.id);l>-1&&(c.value[l]={...o,updateTime:new Date().toLocaleString()},D.success("更新成功"))}else{const l={...o,id:Date.now(),createTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString(),creator:"admin"};c.value.unshift(l),D.success("创建成功")}N.value=!1,x()}catch(l){console.error("表单验证失败:",l)}},ce=()=>{N.value=!1,K()},ye=l=>{l==="print"?o.variables=[{variableName:"inspectionNo",variableType:"string",description:"检验单号"},{variableName:"materialName",variableType:"string",description:"物料名称"}]:l==="message"&&(o.variables=[{variableName:"userName",variableType:"string",description:"用户名"},{variableName:"loginTime",variableType:"date",description:"登录时间"}])},R=l=>{o.content+=`\${${l}}`},ge=()=>{o.variables.push({variableName:"",variableType:"string",description:""})},be=l=>{o.variables.splice(l,1)},_e=()=>{let l=b.content;Object.keys(b.values).forEach(e=>{const i=b.values[e]||`[${e}]`;l=l.replace(new RegExp(`\\$\\{${e}\\}`,"g"),i)}),V.value=l},x=()=>{O.value=!0,setTimeout(()=>{I.total=c.value.length,O.value=!1},500)},K=()=>{var l;Object.assign(o,{templateName:"",templateType:"",description:"",category:"",status:"active",content:"",variables:[]}),(l=q.value)==null||l.resetFields()},W=l=>({space:"blue",print:"green",message:"orange",email:"purple",report:"cyan"})[l]||"default",X=l=>({space:"空间模板",print:"打印模板",message:"消息模板",email:"邮件模板",report:"报表模板"})[l]||l;return xe(()=>{x()}),(l,e)=>{const i=r("a-button"),j=r("a-space"),$=r("a-input"),T=r("a-col"),u=r("a-select-option"),z=r("a-select"),A=r("a-row"),Y=r("a-tag"),Te=r("a-switch"),ke=r("a-popconfirm"),Z=r("a-table"),_=r("a-form-item"),h=r("a-textarea"),ee=r("a-form"),G=r("a-modal"),y=r("a-descriptions-item"),we=r("a-badge"),Ce=r("a-descriptions");return m(),Q("div",De,[g("div",Se,[e[17]||(e[17]=g("h2",null,"系统模板管理",-1)),t(j,null,{default:a(()=>[t(i,{type:"primary",onClick:ie},{icon:a(()=>[t(H(te))]),default:a(()=>[e[16]||(e[16]=s(" 新建模板 ",-1))]),_:1})]),_:1})]),g("div",Ve,[t(A,{gutter:16},{default:a(()=>[t(T,{span:5},{default:a(()=>[t($,{value:P.value,"onUpdate:value":e[0]||(e[0]=n=>P.value=n),placeholder:"搜索模板名称/描述",onPressEnter:F},{prefix:a(()=>[t(H($e))]),_:1},8,["value"])]),_:1}),t(T,{span:4},{default:a(()=>[t(z,{value:E.value,"onUpdate:value":e[1]||(e[1]=n=>E.value=n),placeholder:"模板类型",allowClear:""},{default:a(()=>[t(u,{value:"space"},{default:a(()=>[...e[18]||(e[18]=[s("空间模板",-1)])]),_:1}),t(u,{value:"print"},{default:a(()=>[...e[19]||(e[19]=[s("打印模板",-1)])]),_:1}),t(u,{value:"message"},{default:a(()=>[...e[20]||(e[20]=[s("消息模板",-1)])]),_:1}),t(u,{value:"email"},{default:a(()=>[...e[21]||(e[21]=[s("邮件模板",-1)])]),_:1}),t(u,{value:"report"},{default:a(()=>[...e[22]||(e[22]=[s("报表模板",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(T,{span:4},{default:a(()=>[t(z,{value:L.value,"onUpdate:value":e[2]||(e[2]=n=>L.value=n),placeholder:"状态",allowClear:""},{default:a(()=>[t(u,{value:"active"},{default:a(()=>[...e[23]||(e[23]=[s("启用",-1)])]),_:1}),t(u,{value:"inactive"},{default:a(()=>[...e[24]||(e[24]=[s("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(T,{span:5},{default:a(()=>[t(i,{type:"primary",onClick:F},{default:a(()=>[...e[25]||(e[25]=[s("查询",-1)])]),_:1}),t(i,{style:{"margin-left":"8px"},onClick:se},{default:a(()=>[...e[26]||(e[26]=[s("重置",-1)])]),_:1})]),_:1})]),_:1})]),t(Z,{columns:ae,"data-source":c.value,pagination:I,loading:O.value,onChange:oe,"row-key":"id"},{bodyCell:a(({column:n,record:d})=>[n.key==="templateType"?(m(),k(Y,{key:0,color:W(d.templateType)},{default:a(()=>[s(f(X(d.templateType)),1)]),_:2},1032,["color"])):w("",!0),n.key==="status"?(m(),k(Te,{key:1,checked:d.status==="active",onChange:C=>me(d)},null,8,["checked","onChange"])):w("",!0),n.key==="action"?(m(),k(j,{key:2},{default:a(()=>[t(i,{type:"link",size:"small",onClick:C=>de(d)},{default:a(()=>[...e[27]||(e[27]=[s("查看",-1)])]),_:1},8,["onClick"]),t(i,{type:"link",size:"small",onClick:C=>ue(d)},{default:a(()=>[...e[28]||(e[28]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(i,{type:"link",size:"small",onClick:C=>re(d)},{default:a(()=>[...e[29]||(e[29]=[s("预览",-1)])]),_:1},8,["onClick"]),t(i,{type:"link",size:"small",onClick:C=>pe(d)},{default:a(()=>[...e[30]||(e[30]=[s("复制",-1)])]),_:1},8,["onClick"]),t(ke,{title:"确定要删除这个模板吗？",onConfirm:C=>ve(d.id)},{default:a(()=>[t(i,{type:"link",size:"small",danger:""},{default:a(()=>[...e[31]||(e[31]=[s("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):w("",!0)]),_:1},8,["data-source","pagination","loading"]),t(G,{open:N.value,"onUpdate:open":e[13]||(e[13]=n=>N.value=n),title:S.value?"编辑模板":"新建模板",width:"900px",onOk:fe,onCancel:ce},{default:a(()=>[t(ee,{ref_key:"formRef",ref:q,model:o,rules:ne,layout:"vertical"},{default:a(()=>[t(A,{gutter:16},{default:a(()=>[t(T,{span:12},{default:a(()=>[t(_,{label:"模板名称",name:"templateName"},{default:a(()=>[t($,{value:o.templateName,"onUpdate:value":e[3]||(e[3]=n=>o.templateName=n),placeholder:"请输入模板名称"},null,8,["value"])]),_:1})]),_:1}),t(T,{span:12},{default:a(()=>[t(_,{label:"模板类型",name:"templateType"},{default:a(()=>[t(z,{value:o.templateType,"onUpdate:value":e[4]||(e[4]=n=>o.templateType=n),placeholder:"请选择模板类型",onChange:ye},{default:a(()=>[t(u,{value:"space"},{default:a(()=>[...e[32]||(e[32]=[s("空间模板",-1)])]),_:1}),t(u,{value:"print"},{default:a(()=>[...e[33]||(e[33]=[s("打印模板",-1)])]),_:1}),t(u,{value:"message"},{default:a(()=>[...e[34]||(e[34]=[s("消息模板",-1)])]),_:1}),t(u,{value:"email"},{default:a(()=>[...e[35]||(e[35]=[s("邮件模板",-1)])]),_:1}),t(u,{value:"report"},{default:a(()=>[...e[36]||(e[36]=[s("报表模板",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(_,{label:"模板描述",name:"description"},{default:a(()=>[t(h,{value:o.description,"onUpdate:value":e[5]||(e[5]=n=>o.description=n),rows:2,placeholder:"请输入模板描述"},null,8,["value"])]),_:1}),t(A,{gutter:16},{default:a(()=>[t(T,{span:12},{default:a(()=>[t(_,{label:"模板分类",name:"category"},{default:a(()=>[t($,{value:o.category,"onUpdate:value":e[6]||(e[6]=n=>o.category=n),placeholder:"请输入模板分类"},null,8,["value"])]),_:1})]),_:1}),t(T,{span:12},{default:a(()=>[t(_,{label:"状态",name:"status"},{default:a(()=>[t(z,{value:o.status,"onUpdate:value":e[7]||(e[7]=n=>o.status=n),placeholder:"请选择状态"},{default:a(()=>[t(u,{value:"active"},{default:a(()=>[...e[37]||(e[37]=[s("启用",-1)])]),_:1}),t(u,{value:"inactive"},{default:a(()=>[...e[38]||(e[38]=[s("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(_,{label:"模板内容",name:"content"},{default:a(()=>[g("div",Re,[g("div",Pe,[t(j,null,{default:a(()=>[t(i,{size:"small",onClick:e[8]||(e[8]=n=>R("title"))},{default:a(()=>[...e[39]||(e[39]=[s("插入标题变量",-1)])]),_:1}),t(i,{size:"small",onClick:e[9]||(e[9]=n=>R("date"))},{default:a(()=>[...e[40]||(e[40]=[s("插入日期变量",-1)])]),_:1}),t(i,{size:"small",onClick:e[10]||(e[10]=n=>R("user"))},{default:a(()=>[...e[41]||(e[41]=[s("插入用户变量",-1)])]),_:1}),t(i,{size:"small",onClick:e[11]||(e[11]=n=>R("content"))},{default:a(()=>[...e[42]||(e[42]=[s("插入内容变量",-1)])]),_:1})]),_:1})]),t(h,{value:o.content,"onUpdate:value":e[12]||(e[12]=n=>o.content=n),rows:8,placeholder:"请输入模板内容，支持变量格式：${变量名}"},null,8,["value"])])]),_:1}),t(_,{label:"变量定义"},{default:a(()=>[t(Z,{columns:le,"data-source":o.variables,pagination:!1,size:"small"},{bodyCell:a(({column:n,record:d,index:C})=>[n.key==="variableName"?(m(),k($,{key:0,value:d.variableName,"onUpdate:value":U=>d.variableName=U,placeholder:"变量名"},null,8,["value","onUpdate:value"])):w("",!0),n.key==="variableType"?(m(),k(z,{key:1,value:d.variableType,"onUpdate:value":U=>d.variableType=U,placeholder:"变量类型"},{default:a(()=>[t(u,{value:"string"},{default:a(()=>[...e[43]||(e[43]=[s("字符串",-1)])]),_:1}),t(u,{value:"number"},{default:a(()=>[...e[44]||(e[44]=[s("数字",-1)])]),_:1}),t(u,{value:"date"},{default:a(()=>[...e[45]||(e[45]=[s("日期",-1)])]),_:1}),t(u,{value:"boolean"},{default:a(()=>[...e[46]||(e[46]=[s("布尔值",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])):w("",!0),n.key==="description"?(m(),k($,{key:2,value:d.description,"onUpdate:value":U=>d.description=U,placeholder:"变量描述"},null,8,["value","onUpdate:value"])):w("",!0),n.key==="action"?(m(),k(i,{key:3,type:"link",size:"small",danger:"",onClick:U=>be(C)},{default:a(()=>[...e[47]||(e[47]=[s("删除",-1)])]),_:1},8,["onClick"])):w("",!0)]),_:1},8,["data-source"]),t(i,{type:"dashed",style:{width:"100%","margin-top":"8px"},onClick:ge},{icon:a(()=>[t(H(te))]),default:a(()=>[e[48]||(e[48]=s(" 添加变量 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),t(G,{open:B.value,"onUpdate:open":e[14]||(e[14]=n=>B.value=n),title:"模板详情",width:"800px",footer:null},{default:a(()=>[t(Ce,{column:2,bordered:""},{default:a(()=>[t(y,{label:"模板ID"},{default:a(()=>[s(f(p.value.id),1)]),_:1}),t(y,{label:"模板名称"},{default:a(()=>[s(f(p.value.templateName),1)]),_:1}),t(y,{label:"模板类型"},{default:a(()=>[t(Y,{color:W(p.value.templateType)},{default:a(()=>[s(f(X(p.value.templateType)),1)]),_:1},8,["color"])]),_:1}),t(y,{label:"模板分类"},{default:a(()=>[s(f(p.value.category),1)]),_:1}),t(y,{label:"状态"},{default:a(()=>[t(we,{status:p.value.status==="active"?"success":"default",text:p.value.status==="active"?"启用":"禁用"},null,8,["status","text"])]),_:1}),t(y,{label:"创建时间"},{default:a(()=>[s(f(p.value.createTime),1)]),_:1}),t(y,{label:"更新时间"},{default:a(()=>[s(f(p.value.updateTime),1)]),_:1}),t(y,{label:"创建人"},{default:a(()=>[s(f(p.value.creator),1)]),_:1}),t(y,{label:"模板描述",span:2},{default:a(()=>[s(f(p.value.description),1)]),_:1}),t(y,{label:"模板内容",span:2},{default:a(()=>[g("pre",Ee,f(p.value.content),1)]),_:1})]),_:1})]),_:1},8,["open"]),t(G,{open:M.value,"onUpdate:open":e[15]||(e[15]=n=>M.value=n),title:"模板预览",width:"800px",footer:null},{default:a(()=>[g("div",Le,[g("div",Oe,[t(ee,{layout:"vertical"},{default:a(()=>[(m(!0),Q(Ue,null,Ie(b.variables,n=>(m(),k(_,{key:n.variableName,label:n.description||n.variableName},{default:a(()=>[t($,{value:b.values[n.variableName],"onUpdate:value":d=>b.values[n.variableName]=d,placeholder:`请输入${n.description||n.variableName}`},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label"]))),128)),t(_,null,{default:a(()=>[t(i,{type:"primary",onClick:_e},{default:a(()=>[...e[49]||(e[49]=[s("生成预览",-1)])]),_:1})]),_:1})]),_:1})]),V.value?(m(),Q("div",Be,[e[50]||(e[50]=g("h4",null,"预览结果：",-1)),g("div",Me,f(V.value),1)])):w("",!0)])]),_:1},8,["open"])])}}}),Ge=ze(qe,[["__scopeId","data-v-c45c2997"]]);export{Ge as default};
