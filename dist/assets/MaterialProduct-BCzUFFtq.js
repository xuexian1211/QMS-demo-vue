import{d as pe,r as _,a as ne,l as _e,p as D,q as t,s as i,o as y,e as B,x as e,h as s,y as U,P as re,I as ke,R as me,f as F,c as M,t as L,F as oe,z as ge,M as ue,C as $,u as Ce,k as be,m as we,G as xe}from"./index-C4MSyl8P.js";import{E as Ie}from"./ExportOutlined-DcG7ybSt.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as he}from"./excel-B07CBqJs.js";const De={class:"spec-container"},Te={class:"spec-toolbar"},Fe={key:0},Qe={key:1},Se={key:0},Oe=pe({__name:"MaterialSpecDrawer",props:{visible:{type:Boolean},materialInfo:{}},emits:["update:visible"],setup(R,{emit:G}){const w=R,h=G,x=_(!1),u=_([]),g=_([]),V=_(!1),Q=_(!1),E=_(),S=_([]),j=_([{id:"1",name:"长度",dataType:"Quantitative"},{id:"2",name:"外观",dataType:"Qualitative"},{id:"3",name:"硬度",dataType:"Quantitative"},{id:"4",name:"表面缺陷",dataType:"Qualitative"}]),C=[{title:"检验项目",dataIndex:"inspItemName",key:"inspItemName",width:150},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:100},{title:"规格值",key:"specValue",width:250},{title:"备注",dataIndex:"remark",key:"remark"},{title:"操作",key:"action",width:150,fixed:"right"}],n=ne({id:null,inspItemId:void 0,inspItemName:"",dataType:"Quantitative",targetValue:void 0,upperLimit:void 0,lowerLimit:void 0,unit:"",standardDesc:"",standardCode:"",expectedValue:"",sampleImage:"",remark:""}),b={inspItemId:[{required:!0,message:"请选择检验项目",trigger:"change"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}],targetValue:[{required:!0,message:"请输入目标值",trigger:"blur",type:"number"}],standardDesc:[{required:!0,message:"请输入标准描述",trigger:"blur"}]};_e(()=>w.visible,v=>{var l;v&&((l=w.materialInfo)!=null&&l.id)&&f()});const I=()=>{h("update:visible",!1)},f=()=>{x.value=!0,g.value=[],setTimeout(()=>{const v={1:[{id:"s1",inspItemId:"1",inspItemName:"长度",dataType:"Quantitative",targetValue:100,upperLimit:101,lowerLimit:99,unit:"mm",remark:""},{id:"s2",inspItemId:"2",inspItemName:"外观",dataType:"Qualitative",standardDesc:"无明显划痕、凹坑",standardCode:"STD-001",expectedValue:"OK",remark:""}],2:[{id:"s3",inspItemId:"3",inspItemName:"硬度",dataType:"Quantitative",targetValue:60,upperLimit:65,lowerLimit:55,unit:"HRC",remark:""}],3:[]};u.value=v[w.materialInfo.id]||[],x.value=!1},300)},A=v=>{g.value=v},P=()=>{Object.assign(n,{id:null,inspItemId:void 0,inspItemName:"",dataType:"Quantitative",targetValue:void 0,upperLimit:void 0,lowerLimit:void 0,unit:"",standardDesc:"",standardCode:"",expectedValue:"",sampleImage:"",remark:""}),S.value=[]},H=()=>{Q.value=!1,P(),V.value=!0},te=v=>{Q.value=!0,Object.assign(n,{...v}),v.sampleImage?S.value=[{uid:"-1",name:"sample.png",status:"done",url:v.sampleImage}]:S.value=[],V.value=!0},W=v=>{ue.confirm({title:"确认删除",content:"确定删除该检验规格吗？",okType:"danger",onOk(){u.value=u.value.filter(l=>l.id!==v.id),$.success("删除成功")}})},p=()=>{ue.confirm({title:"确认批量删除",content:`确定删除选中的 ${g.value.length} 条记录吗？`,okType:"danger",onOk(){u.value=u.value.filter(v=>!g.value.includes(v.id)),g.value=[],$.success("批量删除成功")}})},o=()=>{E.value.validate().then(()=>{if(n.dataType==="Quantitative"&&n.lowerLimit!==void 0&&n.upperLimit!==void 0&&n.lowerLimit>n.upperLimit){$.error("下限不能大于上限");return}const v=j.value.find(l=>l.id===n.inspItemId);if(n.inspItemName=(v==null?void 0:v.name)||"",Q.value){const l=u.value.findIndex(N=>N.id===n.id);l>-1&&Object.assign(u.value[l],{...n})}else u.value.push({...n,id:Date.now().toString()});$.success("保存成功"),V.value=!1}).catch(()=>{$.error("请完善必填项")})},O=()=>{$.success("导出任务已开始")},J=v=>{const l=j.value.find(N=>N.id===v);l&&(n.dataType=l.dataType)},le=()=>{n.dataType==="Quantitative"?(n.standardDesc="",n.standardCode="",n.expectedValue="",n.sampleImage="",S.value=[]):(n.targetValue=void 0,n.upperLimit=void 0,n.lowerLimit=void 0,n.unit="")},X=v=>{var l;S.value=v.fileList,v.file.status==="done"&&(n.sampleImage=((l=v.file.response)==null?void 0:l.url)||"")};return(v,l)=>{const N=i("a-button"),K=i("a-space"),r=i("a-tag"),a=i("a-divider"),T=i("a-table"),Y=i("a-select-option"),q=i("a-select"),k=i("a-form-item"),m=i("a-col"),z=i("a-row"),Z=i("a-input-number"),ie=i("a-input"),se=i("a-textarea"),ve=i("a-upload"),ee=i("a-form"),de=i("a-modal"),fe=i("a-drawer");return y(),D(fe,{visible:R.visible,title:`物料检验规格 - ${R.materialInfo.code} ${R.materialInfo.name}`,width:"900px",destroyOnClose:!0,onClose:I},{default:t(()=>[B("div",De,[B("div",Te,[e(K,null,{default:t(()=>[e(N,{type:"primary",onClick:H},{icon:t(()=>[e(U(re))]),default:t(()=>[l[11]||(l[11]=s("新增 ",-1))]),_:1}),e(N,{danger:"",disabled:g.value.length===0,onClick:p},{icon:t(()=>[e(U(ke))]),default:t(()=>[l[12]||(l[12]=s("批量删除 ",-1))]),_:1},8,["disabled"]),e(N,{onClick:O},{icon:t(()=>[e(U(Ie))]),default:t(()=>[l[13]||(l[13]=s("导出 ",-1))]),_:1}),e(N,{onClick:f},{icon:t(()=>[e(U(me))]),default:t(()=>[l[14]||(l[14]=s("刷新 ",-1))]),_:1})]),_:1})]),e(T,{columns:C,"data-source":u.value,loading:x.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:g.value,onChange:A},pagination:!1},{bodyCell:t(({column:c,record:d})=>[c.key==="dataType"?(y(),D(r,{key:0,color:d.dataType==="Quantitative"?"blue":"purple"},{default:t(()=>[s(L(d.dataType==="Quantitative"?"计量型":"计数型"),1)]),_:2},1032,["color"])):F("",!0),c.key==="specValue"?(y(),M(oe,{key:1},[d.dataType==="Quantitative"?(y(),M("span",Fe,L(d.targetValue)+" ("+L(d.lowerLimit)+" ~ "+L(d.upperLimit)+") "+L(d.unit),1)):(y(),M("span",Qe,L(d.standardDesc),1))],64)):F("",!0),c.key==="action"?(y(),D(K,{key:2},{default:t(()=>[e(N,{type:"link",size:"small",onClick:ae=>te(d)},{default:t(()=>[...l[15]||(l[15]=[s("编辑",-1)])]),_:1},8,["onClick"]),e(a,{type:"vertical"}),e(N,{type:"link",danger:"",size:"small",onClick:ae=>W(d)},{default:t(()=>[...l[16]||(l[16]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):F("",!0)]),_:1},8,["data-source","loading","row-selection"])]),e(de,{visible:V.value,"onUpdate:visible":l[10]||(l[10]=c=>V.value=c),title:Q.value?"编辑检验规格":"新增检验规格",width:"600px",onOk:o},{default:t(()=>[e(ee,{ref_key:"specFormRef",ref:E,model:n,rules:b,layout:"vertical"},{default:t(()=>[e(z,{gutter:16},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(k,{label:"检验项目",name:"inspItemId"},{default:t(()=>[e(q,{value:n.inspItemId,"onUpdate:value":l[0]||(l[0]=c=>n.inspItemId=c),placeholder:"请选择检验项目",onChange:J},{default:t(()=>[(y(!0),M(oe,null,ge(j.value,c=>(y(),D(Y,{key:c.id,value:c.id},{default:t(()=>[s(L(c.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(k,{label:"数据类型",name:"dataType"},{default:t(()=>[e(q,{value:n.dataType,"onUpdate:value":l[1]||(l[1]=c=>n.dataType=c),placeholder:"请选择",onChange:le},{default:t(()=>[e(Y,{value:"Quantitative"},{default:t(()=>[...l[17]||(l[17]=[s("计量型",-1)])]),_:1}),e(Y,{value:"Qualitative"},{default:t(()=>[...l[18]||(l[18]=[s("计数型",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),n.dataType==="Quantitative"?(y(),M(oe,{key:0},[e(z,{gutter:16},{default:t(()=>[e(m,{span:8},{default:t(()=>[e(k,{label:"目标值",name:"targetValue"},{default:t(()=>[e(Z,{value:n.targetValue,"onUpdate:value":l[2]||(l[2]=c=>n.targetValue=c),style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(m,{span:8},{default:t(()=>[e(k,{label:"上限",name:"upperLimit"},{default:t(()=>[e(Z,{value:n.upperLimit,"onUpdate:value":l[3]||(l[3]=c=>n.upperLimit=c),style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(m,{span:8},{default:t(()=>[e(k,{label:"下限",name:"lowerLimit"},{default:t(()=>[e(Z,{value:n.lowerLimit,"onUpdate:value":l[4]||(l[4]=c=>n.lowerLimit=c),style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(k,{label:"单位",name:"unit"},{default:t(()=>[e(ie,{value:n.unit,"onUpdate:value":l[5]||(l[5]=c=>n.unit=c),placeholder:"请输入单位"},null,8,["value"])]),_:1})],64)):(y(),M(oe,{key:1},[e(k,{label:"标准描述",name:"standardDesc"},{default:t(()=>[e(se,{value:n.standardDesc,"onUpdate:value":l[6]||(l[6]=c=>n.standardDesc=c),rows:3,placeholder:"请输入标准描述"},null,8,["value"])]),_:1}),e(z,{gutter:16},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(k,{label:"标准代码",name:"standardCode"},{default:t(()=>[e(ie,{value:n.standardCode,"onUpdate:value":l[7]||(l[7]=c=>n.standardCode=c),placeholder:"请输入标准代码"},null,8,["value"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(k,{label:"期望值",name:"expectedValue"},{default:t(()=>[e(ie,{value:n.expectedValue,"onUpdate:value":l[8]||(l[8]=c=>n.expectedValue=c),placeholder:"如：OK/NG"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(k,{label:"样板图"},{default:t(()=>[e(ve,{"list-type":"picture-card","max-count":1,"file-list":S.value,onChange:X},{default:t(()=>[S.value.length===0?(y(),M("div",Se,[e(U(re)),l[19]||(l[19]=B("div",{style:{"margin-top":"8px"}},"上传",-1))])):F("",!0)]),_:1},8,["file-list"])]),_:1})],64)),e(k,{label:"备注",name:"remark"},{default:t(()=>[e(se,{value:n.remark,"onUpdate:value":l[9]||(l[9]=c=>n.remark=c),rows:2,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1},8,["visible","title"])}}}),Ne=ce(Oe,[["__scopeId","data-v-98269829"]]),Ve={class:"route-container"},$e={class:"route-toolbar"},Re={class:"route-count"},Ue={key:3,class:"no-config"},Le=pe({__name:"MaterialRouteDrawer",props:{visible:{type:Boolean},materialInfo:{}},emits:["update:visible"],setup(R,{emit:G}){const w=R,h=G,x=Ce(),u=_(!1),g=_([]),V=[{title:"路线编码",dataIndex:"code",key:"code",width:150},{title:"路线名称",dataIndex:"name",key:"name",width:200},{title:"版本",dataIndex:"version",key:"version",width:80},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"工序数",dataIndex:"stepCount",key:"stepCount",width:80},{title:"操作",key:"action",width:100}],Q=[{title:"序号",dataIndex:"opSeq",key:"opSeq",width:80},{title:"工序名称",dataIndex:"opName",key:"opName",width:150},{title:"工作中心",dataIndex:"workCenter",key:"workCenter",width:120},{title:"检验配置",key:"inspConfig",width:180},{title:"工序描述",dataIndex:"description",key:"description"}];_e(()=>w.visible,b=>{var I;b&&((I=w.materialInfo)!=null&&I.id)&&C()});const E=()=>{h("update:visible",!1)},S=b=>({Active:"success",Draft:"default",Obsolete:"error"})[b]||"default",j=b=>({Active:"生效",Draft:"草稿",Obsolete:"失效"})[b]||b,C=()=>{u.value=!0,setTimeout(()=>{const b={1:[{id:"r1",code:"PR-001",name:"铝锭标准工艺",version:"V1.0",status:"Active",stepCount:3,steps:[{id:"s1",opSeq:10,opName:"熔炼",workCenter:"WC-01",description:"铝液熔炼",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s2",opSeq:20,opName:"浇铸",workCenter:"WC-02",description:"连续浇铸",hasFirstInsp:!1,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s3",opSeq:30,opName:"冷却切割",workCenter:"WC-03",description:"冷却定型切割",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]}],2:[{id:"r2",code:"PR-002",name:"壳体加工工艺",version:"V1.0",status:"Active",stepCount:4,steps:[{id:"s4",opSeq:10,opName:"压铸",workCenter:"WC-10",description:"高压压铸",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s5",opSeq:20,opName:"去毛刺",workCenter:"WC-11",description:"人工去毛刺",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!1},{id:"s6",opSeq:30,opName:"机加工",workCenter:"WC-12",description:"CNC加工",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s7",opSeq:40,opName:"抛光",workCenter:"WC-13",description:"表面抛光",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]},{id:"r3",code:"PR-003",name:"壳体加工工艺V2",version:"V2.0",status:"Draft",stepCount:3,steps:[{id:"s8",opSeq:10,opName:"压铸",workCenter:"WC-10",description:"高压压铸",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s9",opSeq:20,opName:"机加工",workCenter:"WC-12",description:"CNC加工",hasFirstInsp:!1,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"s10",opSeq:30,opName:"抛光",workCenter:"WC-13",description:"表面抛光",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]}],3:[]};g.value=b[w.materialInfo.id]||[],u.value=!1},300)},n=b=>{x.push(`/basic-data/process-routes?code=${b.code}`),E()};return(b,I)=>{const f=i("a-button"),A=i("a-space"),P=i("a-tag"),H=i("a-table"),te=i("a-drawer");return y(),D(te,{visible:R.visible,title:`工艺路线 - ${R.materialInfo.code} ${R.materialInfo.name}`,width:"900px",destroyOnClose:!0,onClose:E},{default:t(()=>[B("div",Ve,[B("div",$e,[e(A,null,{default:t(()=>[e(f,{onClick:C},{icon:t(()=>[e(U(me))]),default:t(()=>[I[0]||(I[0]=s("刷新 ",-1))]),_:1})]),_:1}),B("span",Re,"共 "+L(g.value.length)+" 条工艺路线",1)]),e(H,{columns:V,"data-source":g.value,loading:u.value,"row-key":"id",size:"middle",pagination:!1},{bodyCell:t(({column:W,record:p})=>[W.key==="status"?(y(),D(P,{key:0,color:S(p.status)},{default:t(()=>[s(L(j(p.status)),1)]),_:2},1032,["color"])):F("",!0),W.key==="action"?(y(),D(A,{key:1},{default:t(()=>[e(f,{type:"link",size:"small",onClick:o=>n(p)},{default:t(()=>[...I[1]||(I[1]=[s("查看详情",-1)])]),_:1},8,["onClick"])]),_:2},1024)):F("",!0)]),expandedRowRender:t(({record:W})=>[e(H,{columns:Q,"data-source":W.steps,pagination:!1,size:"small","show-header":!0},{bodyCell:t(({column:p,record:o})=>[p.key==="inspConfig"?(y(),D(A,{key:0},{default:t(()=>[o.hasFirstInsp?(y(),D(P,{key:0,color:"blue",size:"small"},{default:t(()=>[...I[2]||(I[2]=[s("首检",-1)])]),_:1})):F("",!0),o.hasPatrolInsp?(y(),D(P,{key:1,color:"green",size:"small"},{default:t(()=>[...I[3]||(I[3]=[s("巡检",-1)])]),_:1})):F("",!0),o.hasFinalInsp?(y(),D(P,{key:2,color:"orange",size:"small"},{default:t(()=>[...I[4]||(I[4]=[s("末检",-1)])]),_:1})):F("",!0),!o.hasFirstInsp&&!o.hasPatrolInsp&&!o.hasFinalInsp?(y(),M("span",Ue,"-")):F("",!0)]),_:2},1024)):F("",!0)]),_:1},8,["data-source"])]),_:1},8,["data-source","loading"])])]),_:1},8,["visible","title"])}}}),Pe=ce(Le,[["__scopeId","data-v-fe322cff"]]),qe={class:"plan-container"},ze={class:"plan-toolbar"},Me=pe({__name:"MaterialInspPlanDrawer",props:{visible:{type:Boolean},materialInfo:{},inspType:{}},emits:["update:visible"],setup(R,{emit:G}){const w=R,h=G,x=_(!1),u=_([]),g=_(!1),V=_(!1),Q=_(),E=be(()=>`${{IQC:"IQC来料检验",FQC:"FQC成品检验",OQC:"OQC出货检验"}[w.inspType]}方案 - ${w.materialInfo.code} ${w.materialInfo.name}`),S=_([{id:"p1",code:"IQC-001",name:"来料标准检验方案"},{id:"p2",code:"IQC-002",name:"来料加严检验方案"},{id:"p3",code:"FQC-001",name:"成品标准检验方案"},{id:"p4",code:"FQC-002",name:"成品全检方案"},{id:"p5",code:"OQC-001",name:"出货抽样检验方案"}]),j=[{title:"方案编码",dataIndex:"planCode",key:"planCode",width:150},{title:"方案名称",dataIndex:"planName",key:"planName",width:200},{title:"优先级",dataIndex:"priority",key:"priority",width:80},{title:"默认",key:"isDefault",width:80},{title:"备注",dataIndex:"remark",key:"remark"},{title:"操作",key:"action",width:120}],C=ne({id:null,planId:void 0,priority:1,isDefault:!1,remark:""}),n={planId:[{required:!0,message:"请选择检验方案",trigger:"change"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur",type:"number"}]};_e(()=>w.visible,p=>{var o;p&&((o=w.materialInfo)!=null&&o.id)&&f()});const b=()=>{h("update:visible",!1)},I=(p,o)=>{const O=S.value.find(J=>J.id===o.value);return O?O.code.toLowerCase().includes(p.toLowerCase())||O.name.toLowerCase().includes(p.toLowerCase()):!1},f=()=>{x.value=!0,setTimeout(()=>{const o={1:{IQC:[{id:"b1",planId:"p1",planCode:"IQC-001",planName:"来料标准检验方案",priority:1,isDefault:!0,remark:""},{id:"b2",planId:"p2",planCode:"IQC-002",planName:"来料加严检验方案",priority:2,isDefault:!1,remark:"供应商质量问题时启用"}],FQC:[],OQC:[]},2:{IQC:[],FQC:[{id:"b3",planId:"p3",planCode:"FQC-001",planName:"成品标准检验方案",priority:1,isDefault:!0,remark:""}],OQC:[]},3:{IQC:[],FQC:[{id:"b4",planId:"p4",planCode:"FQC-002",planName:"成品全检方案",priority:1,isDefault:!0,remark:""}],OQC:[{id:"b5",planId:"p5",planCode:"OQC-001",planName:"出货抽样检验方案",priority:1,isDefault:!0,remark:""}]}}[w.materialInfo.id]||{};u.value=o[w.inspType]||[],x.value=!1},300)},A=()=>{Object.assign(C,{id:null,planId:void 0,priority:1,isDefault:!1,remark:""})},P=()=>{V.value=!1,A(),g.value=!0},H=p=>{V.value=!0,Object.assign(C,{...p}),g.value=!0},te=p=>{ue.confirm({title:"确认删除",content:`确定删除与 ${p.planName} 的绑定吗？`,okType:"danger",onOk(){u.value=u.value.filter(o=>o.id!==p.id),$.success("删除成功")}})},W=()=>{Q.value.validate().then(()=>{const p=S.value.find(o=>o.id===C.planId);if(C.isDefault&&u.value.forEach(o=>{o.isDefault=!1}),V.value){const o=u.value.findIndex(O=>O.id===C.id);o>-1&&Object.assign(u.value[o],{...C,planCode:p==null?void 0:p.code,planName:p==null?void 0:p.name})}else u.value.push({...C,id:Date.now().toString(),planCode:p==null?void 0:p.code,planName:p==null?void 0:p.name});$.success("保存成功"),g.value=!1}).catch(()=>{$.error("请完善必填项")})};return(p,o)=>{const O=i("a-button"),J=i("a-space"),le=i("a-tag"),X=i("a-table"),v=i("a-empty"),l=i("a-select-option"),N=i("a-select"),K=i("a-form-item"),r=i("a-input-number"),a=i("a-switch"),T=i("a-textarea"),Y=i("a-form"),q=i("a-modal"),k=i("a-drawer");return y(),D(k,{visible:R.visible,title:E.value,width:"800px",destroyOnClose:!0,onClose:b},{default:t(()=>[B("div",qe,[B("div",ze,[e(J,null,{default:t(()=>[e(O,{type:"primary",onClick:P},{icon:t(()=>[e(U(re))]),default:t(()=>[o[5]||(o[5]=s("新增绑定 ",-1))]),_:1}),e(O,{onClick:f},{icon:t(()=>[e(U(me))]),default:t(()=>[o[6]||(o[6]=s("刷新 ",-1))]),_:1})]),_:1})]),e(X,{columns:j,"data-source":u.value,loading:x.value,"row-key":"id",size:"middle",pagination:!1},{bodyCell:t(({column:m,record:z})=>[m.key==="isDefault"?(y(),M(oe,{key:0},[z.isDefault?(y(),D(le,{key:0,color:"gold"},{default:t(()=>[...o[7]||(o[7]=[s("默认",-1)])]),_:1})):F("",!0)],64)):F("",!0),m.key==="action"?(y(),D(J,{key:1},{default:t(()=>[e(O,{type:"link",size:"small",onClick:Z=>H(z)},{default:t(()=>[...o[8]||(o[8]=[s("编辑",-1)])]),_:1},8,["onClick"]),e(O,{type:"link",danger:"",size:"small",onClick:Z=>te(z)},{default:t(()=>[...o[9]||(o[9]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):F("",!0)]),_:1},8,["data-source","loading"]),u.value.length===0&&!x.value?(y(),D(v,{key:0,description:"暂无绑定的检验方案"},{default:t(()=>[e(O,{type:"primary",onClick:P},{default:t(()=>[...o[10]||(o[10]=[s("新增绑定",-1)])]),_:1})]),_:1})):F("",!0)]),e(q,{visible:g.value,"onUpdate:visible":o[4]||(o[4]=m=>g.value=m),title:V.value?"编辑绑定":"新增绑定",width:"500px",onOk:W},{default:t(()=>[e(Y,{ref_key:"formRef",ref:Q,model:C,rules:n,layout:"vertical"},{default:t(()=>[e(K,{label:"检验方案",name:"planId"},{default:t(()=>[e(N,{value:C.planId,"onUpdate:value":o[0]||(o[0]=m=>C.planId=m),placeholder:"请选择检验方案","show-search":"","filter-option":I},{default:t(()=>[(y(!0),M(oe,null,ge(S.value,m=>(y(),D(l,{key:m.id,value:m.id},{default:t(()=>[s(L(m.code)+" - "+L(m.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(K,{label:"优先级",name:"priority"},{default:t(()=>[e(r,{value:C.priority,"onUpdate:value":o[1]||(o[1]=m=>C.priority=m),min:1,max:99,style:{width:"100%"},placeholder:"数字越小优先级越高"},null,8,["value"])]),_:1}),e(K,{label:"设为默认"},{default:t(()=>[e(a,{checked:C.isDefault,"onUpdate:checked":o[2]||(o[2]=m=>C.isDefault=m)},null,8,["checked"]),o[11]||(o[11]=B("span",{style:{"margin-left":"8px",color:"#666"}},"默认方案将在创建检验任务时自动选择",-1))]),_:1}),e(K,{label:"备注",name:"remark"},{default:t(()=>[e(T,{value:C.remark,"onUpdate:value":o[3]||(o[3]=m=>C.remark=m),rows:2,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1},8,["visible","title"])}}}),Be=ce(Me,[["__scopeId","data-v-4ffe032f"]]),Ee={class:"page-container"},We={class:"toolbar"},je={class:"table-container"},Ae=pe({__name:"MaterialProduct",setup(R){const G=Ce(),w=_(!1),h=_([]),x=_([]),u=ne({code:"",name:"",category:void 0}),g=ne({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),V=[{title:"物料编码",dataIndex:"code",key:"code",width:120},{title:"物料名称",dataIndex:"name",key:"name",width:150},{title:"规格型号",dataIndex:"spec",key:"spec",width:120},{title:"分类",dataIndex:"category",key:"category",width:80},{title:"单位",dataIndex:"unit",key:"unit",width:60},{title:"来源",dataIndex:"source",key:"source",width:60},{title:"工艺路线数",key:"routeCount",width:100},{title:"操作",key:"action",width:280,fixed:"right"}],Q=()=>{w.value=!0,setTimeout(()=>{let r=[{id:"1",code:"M001",name:"铝锭",spec:"ADC12",category:"Raw",unit:"kg",source:"Buy",routeCount:1},{id:"2",code:"P001",name:"发动机壳体",spec:"V1.0",category:"Semi",unit:"pcs",source:"Make",routeCount:2},{id:"3",code:"F001",name:"电动车电机",spec:"500W",category:"Finish",unit:"set",source:"Make",routeCount:0}];u.code&&(r=r.filter(a=>a.code.includes(u.code))),u.name&&(r=r.filter(a=>a.name.includes(u.name))),u.category&&(r=r.filter(a=>a.category===u.category)),h.value=r,g.total=r.length,w.value=!1},300)},E=()=>{g.current=1,Q()},S=()=>{u.code="",u.name="",u.category=void 0,E()},j=r=>{g.current=r.current,g.pageSize=r.pageSize,Q()},C=r=>{x.value=r},n=_(!1),b=_(!1),I=_(),f=ne({id:null,code:"",name:"",spec:"",category:void 0,unit:"",source:"Buy",remark:""}),A={code:[{required:!0,message:"请输入物料编码",trigger:"blur"}],name:[{required:!0,message:"请输入物料名称",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}]},P=()=>{b.value=!1,Object.assign(f,{id:null,code:"",name:"",spec:"",category:void 0,unit:"",source:"Buy",remark:""}),n.value=!0},H=r=>{const a=r.id?r:h.value.find(T=>T.id===x.value[0]);a&&(b.value=!0,Object.assign(f,{...a}),n.value=!0)},te=r=>{G.push(`/basic-data/material/view/${r.id}`)},W=r=>{G.push(`/basic-data/material/edit/${r.id}`)},p=r=>{ue.confirm({title:"确认删除",content:`确定删除物料 ${r.name} 吗？`,okType:"danger",onOk(){h.value=h.value.filter(a=>a.id!==r.id),$.success("删除成功")}})},o=()=>{ue.confirm({title:"确认批量删除",content:`确定删除选中的 ${x.value.length} 条记录吗？`,okType:"danger",onOk(){h.value=h.value.filter(r=>!x.value.includes(r.id)),x.value=[],$.success("删除成功")}})},O=()=>{I.value.validate().then(()=>{if(b.value){const r=h.value.findIndex(a=>a.id===f.id);r>-1&&Object.assign(h.value[r],f)}else h.value.push({...f,id:Date.now().toString()});$.success("保存成功"),n.value=!1,Q()})},J=()=>{if(h.value.length===0){$.warning("暂无数据可导出");return}const r=[{title:"物料编码",dataIndex:"code"},{title:"物料名称",dataIndex:"name"},{title:"规格型号",dataIndex:"spec"},{title:"分类",dataIndex:"category"},{title:"单位",dataIndex:"unit"},{title:"来源",dataIndex:"source"}],{exportToCSV:a}=he();a(h.value,r,"物料档案"),$.success("导出成功")},le=_(!1),X=ne({id:"",code:"",name:""}),v=_(!1),l=r=>{Object.assign(X,{id:r.id,code:r.code,name:r.name}),v.value=!0},N=_(!1),K=_("IQC");return we(()=>{Q()}),(r,a)=>{const T=i("a-button"),Y=i("a-space"),q=i("a-input"),k=i("a-form-item"),m=i("a-select-option"),z=i("a-select"),Z=i("a-form"),ie=i("a-card"),se=i("a-divider"),ve=i("a-table"),ee=i("a-col"),de=i("a-row"),fe=i("a-textarea"),c=i("a-modal");return y(),M("div",Ee,[B("div",We,[e(Y,null,{default:t(()=>[e(T,{type:"primary",onClick:P},{icon:t(()=>[e(U(re))]),default:t(()=>[a[14]||(a[14]=s("新增 ",-1))]),_:1}),e(T,{disabled:x.value.length!==1,onClick:H},{icon:t(()=>[e(U(xe))]),default:t(()=>[a[15]||(a[15]=s("编辑 ",-1))]),_:1},8,["disabled"]),e(T,{danger:"",disabled:x.value.length===0,onClick:o},{icon:t(()=>[e(U(ke))]),default:t(()=>[a[16]||(a[16]=s("删除 ",-1))]),_:1},8,["disabled"]),e(T,{onClick:J},{icon:t(()=>[e(U(Ie))]),default:t(()=>[a[17]||(a[17]=s("导出 ",-1))]),_:1}),e(T,{onClick:Q},{icon:t(()=>[e(U(me))]),default:t(()=>[a[18]||(a[18]=s("刷新 ",-1))]),_:1})]),_:1})]),e(ie,{class:"search-card",bordered:!1},{default:t(()=>[e(Z,{layout:"inline",model:u},{default:t(()=>[e(k,{label:"物料编码"},{default:t(()=>[e(q,{value:u.code,"onUpdate:value":a[0]||(a[0]=d=>u.code=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),e(k,{label:"物料名称"},{default:t(()=>[e(q,{value:u.name,"onUpdate:value":a[1]||(a[1]=d=>u.name=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),e(k,{label:"物料分类"},{default:t(()=>[e(z,{value:u.category,"onUpdate:value":a[2]||(a[2]=d=>u.category=d),style:{width:"150px"},"allow-clear":"",placeholder:"请选择"},{default:t(()=>[e(m,{value:"Raw"},{default:t(()=>[...a[19]||(a[19]=[s("原材料",-1)])]),_:1}),e(m,{value:"Semi"},{default:t(()=>[...a[20]||(a[20]=[s("半成品",-1)])]),_:1}),e(m,{value:"Finish"},{default:t(()=>[...a[21]||(a[21]=[s("成品",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(k,null,{default:t(()=>[e(T,{type:"primary",onClick:E},{default:t(()=>[...a[22]||(a[22]=[s("查询",-1)])]),_:1}),e(T,{style:{"margin-left":"8px"},onClick:S},{default:t(()=>[...a[23]||(a[23]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),B("div",je,[e(ve,{columns:V,"data-source":h.value,loading:w.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:x.value,onChange:C},pagination:g,onChange:j},{bodyCell:t(({column:d,record:ae})=>[d.key==="routeCount"?(y(),D(T,{key:0,type:"link",size:"small",onClick:ye=>l(ae)},{default:t(()=>[s(L(ae.routeCount||0),1)]),_:2},1032,["onClick"])):F("",!0),d.key==="action"?(y(),D(Y,{key:1},{default:t(()=>[e(T,{type:"link",size:"small",onClick:ye=>te(ae)},{default:t(()=>[...a[24]||(a[24]=[s("查看",-1)])]),_:1},8,["onClick"]),e(se,{type:"vertical"}),e(T,{type:"link",size:"small",onClick:ye=>W(ae)},{default:t(()=>[...a[25]||(a[25]=[s("编辑",-1)])]),_:1},8,["onClick"]),e(se,{type:"vertical"}),e(T,{type:"link",danger:"",size:"small",onClick:ye=>p(ae)},{default:t(()=>[...a[26]||(a[26]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):F("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),e(c,{visible:n.value,"onUpdate:visible":a[10]||(a[10]=d=>n.value=d),title:b.value?"编辑物料档案":"新增物料档案",width:"700px",onOk:O},{default:t(()=>[e(Z,{ref_key:"formRef",ref:I,model:f,rules:A,layout:"vertical"},{default:t(()=>[e(de,{gutter:16},{default:t(()=>[e(ee,{span:12},{default:t(()=>[e(k,{label:"物料编码",name:"code"},{default:t(()=>[e(q,{value:f.code,"onUpdate:value":a[3]||(a[3]=d=>f.code=d),placeholder:"请输入",disabled:b.value},null,8,["value","disabled"])]),_:1})]),_:1}),e(ee,{span:12},{default:t(()=>[e(k,{label:"物料名称",name:"name"},{default:t(()=>[e(q,{value:f.name,"onUpdate:value":a[4]||(a[4]=d=>f.name=d),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(de,{gutter:16},{default:t(()=>[e(ee,{span:12},{default:t(()=>[e(k,{label:"物料分类",name:"category"},{default:t(()=>[e(z,{value:f.category,"onUpdate:value":a[5]||(a[5]=d=>f.category=d),placeholder:"请选择"},{default:t(()=>[e(m,{value:"Raw"},{default:t(()=>[...a[27]||(a[27]=[s("原材料",-1)])]),_:1}),e(m,{value:"Semi"},{default:t(()=>[...a[28]||(a[28]=[s("半成品",-1)])]),_:1}),e(m,{value:"Finish"},{default:t(()=>[...a[29]||(a[29]=[s("成品",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(ee,{span:12},{default:t(()=>[e(k,{label:"单位",name:"unit"},{default:t(()=>[e(q,{value:f.unit,"onUpdate:value":a[6]||(a[6]=d=>f.unit=d),placeholder:"如：kg, pcs"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(de,{gutter:16},{default:t(()=>[e(ee,{span:12},{default:t(()=>[e(k,{label:"规格型号",name:"spec"},{default:t(()=>[e(q,{value:f.spec,"onUpdate:value":a[7]||(a[7]=d=>f.spec=d),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),e(ee,{span:12},{default:t(()=>[e(k,{label:"来源",name:"source"},{default:t(()=>[e(z,{value:f.source,"onUpdate:value":a[8]||(a[8]=d=>f.source=d)},{default:t(()=>[e(m,{value:"Make"},{default:t(()=>[...a[30]||(a[30]=[s("自制",-1)])]),_:1}),e(m,{value:"Buy"},{default:t(()=>[...a[31]||(a[31]=[s("外购",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(k,{label:"备注",name:"remark"},{default:t(()=>[e(fe,{value:f.remark,"onUpdate:value":a[9]||(a[9]=d=>f.remark=d),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),e(Ne,{visible:le.value,"onUpdate:visible":a[11]||(a[11]=d=>le.value=d),materialInfo:X},null,8,["visible","materialInfo"]),e(Pe,{visible:v.value,"onUpdate:visible":a[12]||(a[12]=d=>v.value=d),materialInfo:X},null,8,["visible","materialInfo"]),e(Be,{visible:N.value,"onUpdate:visible":a[13]||(a[13]=d=>N.value=d),materialInfo:X,inspType:K.value},null,8,["visible","materialInfo","inspType"])])}}}),Xe=ce(Ae,[["__scopeId","data-v-38e71736"]]);export{Xe as default};
