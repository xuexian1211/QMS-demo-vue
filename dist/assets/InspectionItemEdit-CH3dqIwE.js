import{d as ie,r,k as x,j as ce,a as re,m as ue,c as g,e as k,x as t,f as p,q as a,s as n,p as _,t as I,o as i,h as c,y as B,K as pe,P as me,F as fe,u as ve,C as U}from"./index-C4MSyl8P.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"page-container"},be={class:"page-header"},Te={class:"header-left"},ge={class:"title-section"},ke={class:"page-title"},Ie={key:0,class:"header-actions"},De={key:0,class:"tab-toolbar"},we=ie({__name:"InspectionItemEdit",setup(he){const V=ve(),D=ce(),N=r(),w=r(!1),F=r("defects"),d=x(()=>D.path.includes("/view/")),M=x(()=>D.path.includes("/edit/")),q=x(()=>d.value?"查看检验项目":M.value?"编辑检验项目":"新增检验项目"),o=re({id:null,code:"",name:"",dataType:"QUANTITATIVE",method:"",tool:"",description:"",relatedDefects:[]}),L={code:[{required:!0,message:"请输入项目编码",trigger:"blur"}],name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},O=l=>l==="QUANTITATIVE"?"blue":"purple",j=l=>l==="QUANTITATIVE"?"计量型":"计数型",P=[{title:"现象代码",dataIndex:"code",key:"code",width:120},{title:"现象名称",dataIndex:"name",key:"name",width:180},{title:"严重等级",key:"severity",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],$=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"}],Q=l=>{switch(l){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}},y=r(!1),h=r(!1),R=r([]),b=r([]),A=r([]),G=()=>{h.value=!0,setTimeout(()=>{const l=o.relatedDefects.map(e=>e.id);R.value=A.value.filter(e=>!l.includes(e.id)),b.value=[],h.value=!1},200),y.value=!0},H=l=>{b.value=l},J=()=>{const l=A.value.filter(e=>b.value.includes(e.id));o.relatedDefects.push(...l),y.value=!1,U.success(`已添加 ${l.length} 个不良现象`)},W=l=>{o.relatedDefects.splice(l,1)},X=()=>{V.push("/inspection-model/inspection-items")},Y=async()=>{var l;try{w.value=!0,await((l=N.value)==null?void 0:l.validate()),U.success("保存成功"),V.push("/inspection-model/inspection-items")}catch{U.error("请完善必填项")}finally{w.value=!1}},Z=()=>{A.value=[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"},{id:"103",code:"DEF-003",name:"裂纹",severity:"CR",description:"产品裂纹"},{id:"104",code:"DEF-004",name:"变形",severity:"MA",description:"产品变形"},{id:"105",code:"DEF-005",name:"色差",severity:"MI",description:"颜色不均匀"}];const l=D.params.id;if(l){const u={1:{id:"1",code:"IT-001",name:"外观检查",dataType:"QUALITATIVE",method:"目视检查",tool:"放大镜",description:"检查产品表面外观",relatedDefects:[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"}]},2:{id:"2",code:"IT-002",name:"尺寸测量",dataType:"QUANTITATIVE",method:"卡尺测量",tool:"三坐标",description:"测量产品关键尺寸",relatedDefects:[]},3:{id:"3",code:"IT-003",name:"硬度检测",dataType:"QUANTITATIVE",method:"硬度计测量",tool:"洛氏硬度计",description:"检测材料硬度",relatedDefects:[]}}[l];u&&Object.assign(o,u)}};return ue(()=>{Z()}),(l,e)=>{const u=n("a-button"),C=n("a-tag"),T=n("a-input"),m=n("a-form-item"),f=n("a-col"),S=n("a-select-option"),ee=n("a-select"),E=n("a-row"),te=n("a-textarea"),ae=n("a-form"),K=n("a-card"),z=n("a-table"),oe=n("a-empty"),le=n("a-tab-pane"),se=n("a-tabs"),ne=n("a-modal");return i(),g("div",ye,[k("div",be,[k("div",Te,[t(u,{type:"text",onClick:X,class:"back-button"},{icon:a(()=>[t(B(pe))]),default:a(()=>[e[8]||(e[8]=c(" 返回 ",-1))]),_:1}),k("div",ge,[k("h2",ke,I(q.value),1),o.dataType?(i(),_(C,{key:0,color:O(o.dataType)},{default:a(()=>[c(I(j(o.dataType)),1)]),_:1},8,["color"])):p("",!0)])]),d.value?p("",!0):(i(),g("div",Ie,[t(u,{type:"primary",onClick:Y,loading:w.value},{default:a(()=>[...e[9]||(e[9]=[c("保存",-1)])]),_:1},8,["loading"])]))]),t(K,{class:"form-card",title:"基本信息"},{default:a(()=>[t(ae,{ref_key:"formRef",ref:N,model:o,rules:L,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[t(E,{gutter:24},{default:a(()=>[t(f,{span:8},{default:a(()=>[t(m,{label:"项目编码",name:"code"},{default:a(()=>[t(T,{value:o.code,"onUpdate:value":e[0]||(e[0]=s=>o.code=s),disabled:d.value||M.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(m,{label:"项目名称",name:"name"},{default:a(()=>[t(T,{value:o.name,"onUpdate:value":e[1]||(e[1]=s=>o.name=s),disabled:d.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(m,{label:"数据类型",name:"dataType"},{default:a(()=>[t(ee,{value:o.dataType,"onUpdate:value":e[2]||(e[2]=s=>o.dataType=s),disabled:d.value,placeholder:"请选择"},{default:a(()=>[t(S,{value:"QUANTITATIVE"},{default:a(()=>[...e[10]||(e[10]=[c("计量型",-1)])]),_:1}),t(S,{value:"QUALITATIVE"},{default:a(()=>[...e[11]||(e[11]=[c("计数型",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(E,{gutter:24},{default:a(()=>[t(f,{span:8},{default:a(()=>[t(m,{label:"检验方法",name:"method"},{default:a(()=>[t(T,{value:o.method,"onUpdate:value":e[3]||(e[3]=s=>o.method=s),disabled:d.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(f,{span:8},{default:a(()=>[t(m,{label:"检验工具",name:"tool"},{default:a(()=>[t(T,{value:o.tool,"onUpdate:value":e[4]||(e[4]=s=>o.tool=s),disabled:d.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(E,{gutter:24},{default:a(()=>[t(f,{span:16},{default:a(()=>[t(m,{label:"描述",name:"description","label-col":{span:3},"wrapper-col":{span:20}},{default:a(()=>[t(te,{value:o.description,"onUpdate:value":e[5]||(e[5]=s=>o.description=s),disabled:d.value,rows:2,placeholder:"请输入描述"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(K,{class:"tab-card"},{default:a(()=>[t(se,{activeKey:F.value,"onUpdate:activeKey":e[6]||(e[6]=s=>F.value=s)},{default:a(()=>[t(le,{key:"defects",tab:"关联不良现象"},{default:a(()=>[d.value?p("",!0):(i(),g("div",De,[t(u,{type:"primary",size:"small",onClick:G},{default:a(()=>[t(B(me)),e[12]||(e[12]=c(" 添加关联 ",-1))]),_:1})])),t(z,{columns:P,"data-source":o.relatedDefects,"row-key":"id",size:"small",pagination:!1},{bodyCell:a(({column:s,record:v,index:de})=>[s.key==="severity"?(i(),_(C,{key:0,color:Q(v.severity)},{default:a(()=>[c(I(v.severity),1)]),_:2},1032,["color"])):s.key==="action"?(i(),g(fe,{key:1},[d.value?p("",!0):(i(),_(u,{key:0,type:"link",danger:"",size:"small",onClick:Ae=>W(de)},{default:a(()=>[...e[13]||(e[13]=[c("移除",-1)])]),_:1},8,["onClick"]))],64)):p("",!0)]),_:1},8,["data-source"]),o.relatedDefects.length===0?(i(),_(oe,{key:1,description:"暂无关联不良现象，请添加"})):p("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1}),t(ne,{visible:y.value,"onUpdate:visible":e[7]||(e[7]=s=>y.value=s),title:"选择不良现象",width:"600px",onOk:J},{default:a(()=>[t(z,{columns:$,"data-source":R.value,loading:h.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:b.value,onChange:H}},{bodyCell:a(({column:s,record:v})=>[s.key==="severity"?(i(),_(C,{key:0,color:Q(v.severity)},{default:a(()=>[c(I(v.severity),1)]),_:2},1032,["color"])):p("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),xe=_e(we,[["__scopeId","data-v-f1a0b0a2"]]);export{xe as default};
