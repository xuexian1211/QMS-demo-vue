import{d as he,r as y,a as P,m as Se,c as J,e as $,x as t,q as a,s as u,o as p,h as i,y as g,P as Q,G as xe,I as qe,R as Ne,p as m,f as b,t as E,F as Oe,z as Ue,u as Pe,M as H,C as F}from"./index-CAjnGs0g.js";import{O as Fe}from"./OperationInspConfigModal-DvdKS86l.js";import{E as ze}from"./ExportOutlined-CYgoHkM0.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"page-container"},Ve={class:"toolbar"},$e={class:"table-container"},Ee={style:{"margin-bottom":"8px"}},Me=he({__name:"ProcessRoute",setup(Te){const M=Pe(),z=y(!1),v=y([]),_=y([]),r=P({code:"",name:"",material:""}),C=P({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),X=[{title:"路线编码",dataIndex:"code",key:"code",width:150},{title:"路线名称",dataIndex:"name",key:"name",width:200},{title:"关联物料",dataIndex:"material",key:"material",width:150},{title:"版本",dataIndex:"version",key:"version",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:150,fixed:"right"}],Y=[{title:"序号",dataIndex:"opSeq",key:"opSeq",width:60},{title:"工序名称",dataIndex:"opName",key:"opName",width:120},{title:"工作中心",dataIndex:"workCenter",key:"workCenter",width:100},{title:"检验配置",key:"inspConfig",width:180},{title:"工序描述",dataIndex:"description",key:"description"}],T=y([{id:"1",code:"M001",name:"铝锭"},{id:"2",code:"P001",name:"发动机壳体"},{id:"3",code:"F001",name:"电动车电机"}]),Z=(n,e)=>{const o=T.value.find(S=>S.id===e.value);return o?o.code.toLowerCase().includes(n.toLowerCase())||o.name.toLowerCase().includes(n.toLowerCase()):!1},w=()=>{z.value=!0,setTimeout(()=>{let n=[{id:"1",code:"PR-001",name:"壳体加工工艺",materialId:"2",version:"V1.0",status:"Active",description:"压铸机加工",steps:[{id:101,opSeq:10,opName:"熔炼",workCenter:"WC-01",description:"铝液熔炼",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:102,opSeq:20,opName:"压铸",workCenter:"WC-02",description:"高压压铸",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:103,opSeq:30,opName:"去毛刺",workCenter:"WC-03",description:"人工去毛刺",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}]},{id:"2",code:"PR-002",name:"电机组装工艺",materialId:"3",version:"V1.0",status:"Draft",description:"",steps:[{id:201,opSeq:10,opName:"绕线",workCenter:"WC-10",description:"",hasFirstInsp:!0,hasPatrolInsp:!1,hasFinalInsp:!1},{id:202,opSeq:20,opName:"总装",workCenter:"WC-11",description:"",hasFirstInsp:!1,hasPatrolInsp:!0,hasFinalInsp:!0}]}];r.code&&(n=n.filter(e=>e.code.includes(r.code))),r.name&&(n=n.filter(e=>e.name.includes(r.name))),v.value=n,C.total=n.length,z.value=!1},300)},A=()=>{C.current=1,w()},ee=()=>{r.code="",r.name="",r.material="",A()},te=n=>{C.current=n.current,C.pageSize=n.pageSize,w()},ae=n=>{_.value=n},ne=n=>{switch(n){case"Active":return"green";case"Draft":return"orange";case"Obsolete":return"default";default:return"blue"}},le=n=>{switch(n){case"Active":return"生效";case"Draft":return"草稿";case"Obsolete":return"失效";default:return n}},I=y(!1),h=y(!1),q=y("basic"),B=y(),s=P({id:null,code:"",name:"",materialId:void 0,version:"V1.0",status:"Draft",description:"",steps:[]}),se={code:[{required:!0,message:"请输入路线编码",trigger:"blur"}],name:[{required:!0,message:"请输入路线名称",trigger:"blur"}],materialId:[{required:!0,message:"请选择关联物料",trigger:"change"}]},oe=[{title:"序号",dataIndex:"opSeq",key:"opSeq",width:80},{title:"工序名称",dataIndex:"opName",key:"opName",width:150},{title:"工作中心",dataIndex:"workCenter",key:"workCenter",width:120},{title:"检验配置",key:"inspConfig",width:180},{title:"工序描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],ie=()=>{h.value=!1,q.value="basic",Object.assign(s,{id:null,code:"",name:"",material:"",version:"V1.0",status:"Draft",description:"",steps:[]}),I.value=!0},de=n=>{const e=n.id?n:v.value.find(o=>o.id===_.value[0]);e&&(h.value=!0,q.value="basic",Object.assign(s,{...e,steps:e.steps.map(o=>({...o}))}),I.value=!0)},ue=n=>{M.push(`/basic-data/process-route/view/${n.id}`)},re=n=>{M.push(`/basic-data/process-route/edit/${n.id}`)},pe=n=>{H.confirm({title:"确认删除",content:`确定删除工艺路线 ${n.name} 吗？`,okType:"danger",onOk(){v.value=v.value.filter(e=>e.id!==n.id),F.success("删除成功")}})},me=()=>{H.confirm({title:"确认批量删除",content:`确定删除选中的 ${_.value.length} 条记录吗？`,okType:"danger",onOk(){v.value=v.value.filter(n=>!_.value.includes(n.id)),_.value=[],F.success("删除成功")}})},ve=()=>{B.value.validate().then(()=>{if(h.value){const n=v.value.findIndex(e=>e.id===s.id);n>-1&&Object.assign(v.value[n],{...s,steps:[...s.steps]})}else v.value.push({...s,steps:[...s.steps],id:Date.now().toString()});F.success("保存成功"),I.value=!1,w()})},ce=()=>{F.success("导出任务已开始")},fe=()=>{s.steps.push({id:Date.now(),opSeq:(s.steps.length+1)*10,opName:"",workCenter:"",description:""})},ke=n=>{s.steps.splice(n,1)},R=y(!1),K=P({id:"",opSeq:0,opName:"",routeId:""}),ye=n=>{Object.assign(K,{id:String(n.id),opSeq:n.opSeq,opName:n.opName,routeId:s.id||""}),R.value=!0},_e=n=>{const e=s.steps.find(o=>String(o.id)===n.operationId);e&&(e.hasFirstInsp=n.firstInspPlans.length>0,e.hasPatrolInsp=n.patrolInspPlans.length>0,e.hasFinalInsp=n.finalInspPlans.length>0)};return Se(()=>{w()}),(n,e)=>{const o=u("a-button"),S=u("a-space"),f=u("a-input"),c=u("a-form-item"),L=u("a-form"),ge=u("a-card"),N=u("a-tag"),W=u("a-divider"),D=u("a-table"),x=u("a-col"),V=u("a-row"),O=u("a-select-option"),j=u("a-select"),be=u("a-textarea"),G=u("a-tab-pane"),Ce=u("a-input-number"),we=u("a-tabs"),Ie=u("a-modal");return p(),J("div",De,[$("div",Ve,[t(S,null,{default:a(()=>[t(o,{type:"primary",onClick:ie},{icon:a(()=>[t(g(Q))]),default:a(()=>[e[12]||(e[12]=i("新增 ",-1))]),_:1}),t(o,{disabled:_.value.length!==1,onClick:de},{icon:a(()=>[t(g(xe))]),default:a(()=>[e[13]||(e[13]=i("编辑 ",-1))]),_:1},8,["disabled"]),t(o,{danger:"",disabled:_.value.length===0,onClick:me},{icon:a(()=>[t(g(qe))]),default:a(()=>[e[14]||(e[14]=i("删除 ",-1))]),_:1},8,["disabled"]),t(o,{onClick:ce},{icon:a(()=>[t(g(ze))]),default:a(()=>[e[15]||(e[15]=i("导出 ",-1))]),_:1}),t(o,{onClick:w},{icon:a(()=>[t(g(Ne))]),default:a(()=>[e[16]||(e[16]=i("刷新 ",-1))]),_:1})]),_:1})]),t(ge,{class:"search-card",bordered:!1},{default:a(()=>[t(L,{layout:"inline",model:r},{default:a(()=>[t(c,{label:"路线编码"},{default:a(()=>[t(f,{value:r.code,"onUpdate:value":e[0]||(e[0]=l=>r.code=l),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(c,{label:"路线名称"},{default:a(()=>[t(f,{value:r.name,"onUpdate:value":e[1]||(e[1]=l=>r.name=l),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(c,{label:"关联物料"},{default:a(()=>[t(f,{value:r.material,"onUpdate:value":e[2]||(e[2]=l=>r.material=l),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(c,null,{default:a(()=>[t(o,{type:"primary",onClick:A},{default:a(()=>[...e[17]||(e[17]=[i("查询",-1)])]),_:1}),t(o,{style:{"margin-left":"8px"},onClick:ee},{default:a(()=>[...e[18]||(e[18]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),$("div",$e,[t(D,{columns:X,"data-source":v.value,loading:z.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:_.value,onChange:ae},pagination:C,onChange:te},{bodyCell:a(({column:l,record:d})=>[l.key==="status"?(p(),m(N,{key:0,color:ne(d.status)},{default:a(()=>[i(E(le(d.status)),1)]),_:2},1032,["color"])):b("",!0),l.key==="action"?(p(),m(S,{key:1},{default:a(()=>[t(o,{type:"link",size:"small",onClick:U=>ue(d)},{default:a(()=>[...e[19]||(e[19]=[i("查看",-1)])]),_:1},8,["onClick"]),t(W,{type:"vertical"}),t(o,{type:"link",size:"small",onClick:U=>re(d)},{default:a(()=>[...e[20]||(e[20]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(W,{type:"vertical"}),t(o,{type:"link",danger:"",size:"small",onClick:U=>pe(d)},{default:a(()=>[...e[21]||(e[21]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):b("",!0)]),expandedRowRender:a(({record:l})=>[t(D,{columns:Y,"data-source":l.steps,pagination:!1,size:"small"},null,8,["data-source"])]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(Ie,{visible:I.value,"onUpdate:visible":e[10]||(e[10]=l=>I.value=l),title:h.value?"编辑工艺路线":"新增工艺路线",width:"800px",onOk:ve},{default:a(()=>[t(we,{activeKey:q.value,"onUpdate:activeKey":e[9]||(e[9]=l=>q.value=l)},{default:a(()=>[t(G,{key:"basic",tab:"基本信息"},{default:a(()=>[t(L,{ref_key:"formRef",ref:B,model:s,rules:se,layout:"vertical"},{default:a(()=>[t(V,{gutter:16},{default:a(()=>[t(x,{span:12},{default:a(()=>[t(c,{label:"路线编码",name:"code"},{default:a(()=>[t(f,{value:s.code,"onUpdate:value":e[3]||(e[3]=l=>s.code=l),placeholder:"请输入",disabled:h.value},null,8,["value","disabled"])]),_:1})]),_:1}),t(x,{span:12},{default:a(()=>[t(c,{label:"路线名称",name:"name"},{default:a(()=>[t(f,{value:s.name,"onUpdate:value":e[4]||(e[4]=l=>s.name=l),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(V,{gutter:16},{default:a(()=>[t(x,{span:12},{default:a(()=>[t(c,{label:"关联物料",name:"materialId"},{default:a(()=>[t(j,{value:s.materialId,"onUpdate:value":e[5]||(e[5]=l=>s.materialId=l),"show-search":"",placeholder:"请选择物料","filter-option":Z},{default:a(()=>[(p(!0),J(Oe,null,Ue(T.value,l=>(p(),m(O,{key:l.id,value:l.id},{default:a(()=>[i(E(l.code)+" - "+E(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(x,{span:12},{default:a(()=>[t(c,{label:"版本号",name:"version"},{default:a(()=>[t(f,{value:s.version,"onUpdate:value":e[6]||(e[6]=l=>s.version=l),placeholder:"如：V1.0"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(V,{gutter:16},{default:a(()=>[t(x,{span:12},{default:a(()=>[t(c,{label:"状态",name:"status"},{default:a(()=>[t(j,{value:s.status,"onUpdate:value":e[7]||(e[7]=l=>s.status=l)},{default:a(()=>[t(O,{value:"Draft"},{default:a(()=>[...e[22]||(e[22]=[i("草稿",-1)])]),_:1}),t(O,{value:"Active"},{default:a(()=>[...e[23]||(e[23]=[i("生效",-1)])]),_:1}),t(O,{value:"Obsolete"},{default:a(()=>[...e[24]||(e[24]=[i("失效",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(c,{label:"描述",name:"description"},{default:a(()=>[t(be,{value:s.description,"onUpdate:value":e[8]||(e[8]=l=>s.description=l),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),t(G,{key:"steps",tab:"工序明细"},{default:a(()=>[$("div",Ee,[t(o,{type:"dashed",block:"",onClick:fe},{default:a(()=>[t(g(Q)),e[25]||(e[25]=i(" 添加工序 ",-1))]),_:1})]),t(D,{columns:oe,"data-source":s.steps,pagination:!1,size:"small","row-key":"id"},{bodyCell:a(({column:l,record:d,index:U})=>[l.key==="opSeq"?(p(),m(Ce,{key:0,value:d.opSeq,"onUpdate:value":k=>d.opSeq=k,min:1,style:{width:"60px"}},null,8,["value","onUpdate:value"])):l.key==="opName"?(p(),m(f,{key:1,value:d.opName,"onUpdate:value":k=>d.opName=k},null,8,["value","onUpdate:value"])):l.key==="workCenter"?(p(),m(f,{key:2,value:d.workCenter,"onUpdate:value":k=>d.workCenter=k},null,8,["value","onUpdate:value"])):l.key==="description"?(p(),m(f,{key:3,value:d.description,"onUpdate:value":k=>d.description=k},null,8,["value","onUpdate:value"])):l.key==="inspConfig"?(p(),m(S,{key:4},{default:a(()=>[d.hasFirstInsp?(p(),m(N,{key:0,color:"blue",size:"small"},{default:a(()=>[...e[26]||(e[26]=[i("首检",-1)])]),_:1})):b("",!0),d.hasPatrolInsp?(p(),m(N,{key:1,color:"green",size:"small"},{default:a(()=>[...e[27]||(e[27]=[i("巡检",-1)])]),_:1})):b("",!0),d.hasFinalInsp?(p(),m(N,{key:2,color:"orange",size:"small"},{default:a(()=>[...e[28]||(e[28]=[i("末检",-1)])]),_:1})):b("",!0),t(o,{type:"link",size:"small",onClick:k=>ye(d)},{default:a(()=>[...e[29]||(e[29]=[i("配置",-1)])]),_:1},8,["onClick"])]),_:2},1024)):l.key==="action"?(p(),m(o,{key:5,type:"link",danger:"",size:"small",onClick:k=>ke(U)},{default:a(()=>[...e[30]||(e[30]=[i("移除",-1)])]),_:1},8,["onClick"])):b("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["visible","title"]),t(Fe,{visible:R.value,"onUpdate:visible":e[11]||(e[11]=l=>R.value=l),operationInfo:K,onSave:_e},null,8,["visible","operationInfo"])])}}}),We=Re(Me,[["__scopeId","data-v-692d8440"]]);export{We as default};
