import{d as Ie,r as g,k as V,j as qe,a as X,m as he,c as _,e as E,x as a,f as I,q as l,s as r,p as y,t as k,a8 as Te,o as p,h as u,y as Y,K as Ce,P as Re,F as N,z as Q,M as Z,C as w,u as Ne}from"./index-C4MSyl8P.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"page-container"},Me={class:"page-header"},De={class:"header-left"},Pe={class:"title-section"},Oe={class:"page-title"},Ve={key:0,class:"header-actions"},Ee=Ie({__name:"InspTemplateEdit",setup(Qe){const S=qe(),B=Ne(),x=g(),F=g(),z=g(!1),U=g(!1),P=g(!1),q=g([]),o=g([]),v=V(()=>S.path.includes("/view/")),L=V(()=>S.path.includes("/edit/")),ee=V(()=>v.value?"查看检验模板":L.value?"编辑检验模板":"新增检验模板"),$=g([{id:"1",name:"长度"},{id:"2",name:"外观"},{id:"3",name:"硬度"}]),A=g([{id:"1",name:"AQL 0.65 Level II"},{id:"2",name:"全检"}]),j=g([{id:"1",name:"卡尺测量"},{id:"2",name:"目视检查"}]),K=g([{id:"1",name:"游标卡尺"},{id:"2",name:"千分尺"}]),m=X({id:null,code:"",name:"",version:"V1.0",status:"Draft",inspType:void 0,remark:""}),ae={code:[{required:!0,message:"请输入模板编码",trigger:"blur"}],name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],inspType:[{required:!0,message:"请选择检验类型",trigger:"change"}]},n=X({id:null,inspItemId:void 0,inspItemName:"",samplingRuleId:void 0,samplingRuleName:"",inspMethodId:void 0,inspMethodName:"",gaugeTypeId:void 0,gaugeTypeName:"",freqType:"PerBatch",freqValue:1,freqUnit:"",spcEnabled:!1,labRequired:!1,remark:""}),le={inspItemId:[{required:!0,message:"请选择检验项目",trigger:"change"}]},te=V(()=>{const d=[{title:"序号",key:"seq",width:60},{title:"检验项目",dataIndex:"inspItemName",key:"inspItemName",width:120},{title:"抽样规则",dataIndex:"samplingRuleName",key:"samplingRuleName",width:150},{title:"检验方法",dataIndex:"inspMethodName",key:"inspMethodName",width:120},{title:"量检具类型",dataIndex:"gaugeTypeName",key:"gaugeTypeName",width:100},{title:"频次",dataIndex:"freqDesc",key:"freqDesc",width:100},{title:"SPC",key:"spcEnabled",width:60},{title:"实验室",key:"labRequired",width:70}];return v.value||d.push({title:"操作",key:"action",width:180}),d}),ne=d=>({Draft:"default",Pending:"processing",Approved:"success",Obsolete:"error"})[d]||"default",de=d=>({Draft:"草稿",Pending:"审批中",Approved:"已批准",Obsolete:"作废"})[d]||d,se=()=>{B.push("/inspection-model/insp-templates")},ue=async()=>{var d;try{z.value=!0,await((d=x.value)==null?void 0:d.validate()),w.success("保存成功"),B.push("/inspection-model/insp-templates")}catch{w.error("请完善必填项")}finally{z.value=!1}},oe=d=>{q.value=d},ie=()=>{Object.assign(n,{id:null,inspItemId:void 0,inspItemName:"",samplingRuleId:void 0,samplingRuleName:"",inspMethodId:void 0,inspMethodName:"",gaugeTypeId:void 0,gaugeTypeName:"",freqType:"PerBatch",freqValue:1,freqUnit:"",spcEnabled:!1,labRequired:!1,remark:""})},re=()=>{P.value=!1,ie(),U.value=!0},pe=d=>{P.value=!0,Object.assign(n,{...d}),U.value=!0},me=d=>{Z.confirm({title:"确认删除",content:"确定删除该明细吗？",okType:"danger",onOk(){o.value=o.value.filter(e=>e.id!==d.id),w.success("删除成功")}})},fe=()=>{Z.confirm({title:"确认删除",content:`确定删除选中的 ${q.value.length} 条明细吗？`,okType:"danger",onOk(){o.value=o.value.filter(d=>!q.value.includes(d.id)),q.value=[],w.success("删除成功")}})},ve=async()=>{var d,e,c,M,h;try{await((d=F.value)==null?void 0:d.validate()),n.inspItemName=((e=$.value.find(s=>s.id===n.inspItemId))==null?void 0:e.name)||"",n.samplingRuleName=((c=A.value.find(s=>s.id===n.samplingRuleId))==null?void 0:c.name)||"",n.inspMethodName=((M=j.value.find(s=>s.id===n.inspMethodId))==null?void 0:M.name)||"",n.gaugeTypeName=((h=K.value.find(s=>s.id===n.gaugeTypeId))==null?void 0:h.name)||"";const i=n.freqValue?`${n.freqValue}${n.freqUnit||""}`:"";if(P.value){const s=o.value.findIndex(f=>f.id===n.id);s>-1&&Object.assign(o.value[s],{...n,freqDesc:i})}else o.value.push({...n,id:Date.now().toString(),freqDesc:i});w.success("保存成功"),U.value=!1}catch{w.error("请完善必填项")}},ce=d=>{if(d>0){const e=o.value[d];o.value[d]=o.value[d-1],o.value[d-1]=e,o.value=[...o.value]}},ge=d=>{if(d<o.value.length-1){const e=o.value[d];o.value[d]=o.value[d+1],o.value[d+1]=e,o.value=[...o.value]}};return he(()=>{const d=S.params.id;d&&(Object.assign(m,{id:d,code:"TPL-IQC-001",name:"IQC原材料检验模板",version:"V1.0",status:"Draft",inspType:"IQC",remark:"用于原材料来料检验"}),o.value=[{id:"d1",inspItemId:"1",inspItemName:"长度",samplingRuleId:"1",samplingRuleName:"AQL 0.65 Level II",inspMethodId:"1",inspMethodName:"卡尺测量",gaugeTypeId:"1",gaugeTypeName:"游标卡尺",freqType:"PerBatch",freqValue:1,freqUnit:"批",freqDesc:"1批",spcEnabled:!0,labRequired:!1},{id:"d2",inspItemId:"2",inspItemName:"外观",samplingRuleId:"2",samplingRuleName:"全检",inspMethodId:"2",inspMethodName:"目视检查",gaugeTypeId:"",gaugeTypeName:"",freqType:"PerBatch",freqValue:1,freqUnit:"批",freqDesc:"1批",spcEnabled:!1,labRequired:!1}])}),(d,e)=>{const c=r("a-button"),M=r("a-tag"),h=r("a-input"),i=r("a-form-item"),s=r("a-col"),f=r("a-select-option"),T=r("a-select"),C=r("a-row"),H=r("a-textarea"),G=r("a-form"),J=r("a-card"),W=r("a-space"),O=r("a-switch"),_e=r("a-table"),ye=r("a-divider"),ke=r("a-input-number"),be=r("a-modal");return p(),_("div",Ue,[E("div",Me,[E("div",De,[a(c,{type:"text",onClick:se,class:"back-button"},{icon:l(()=>[a(Y(Ce))]),default:l(()=>[e[15]||(e[15]=u(" 返回 ",-1))]),_:1}),E("div",Pe,[E("h2",Oe,k(ee.value),1),m.version?(p(),y(M,{key:0,color:"blue"},{default:l(()=>[u(k(m.version),1)]),_:1})):I("",!0),a(M,{color:ne(m.status)},{default:l(()=>[u(k(de(m.status)),1)]),_:1},8,["color"])])]),v.value?I("",!0):(p(),_("div",Ve,[a(c,{type:"primary",onClick:ue,loading:z.value},{default:l(()=>[...e[16]||(e[16]=[u("保存",-1)])]),_:1},8,["loading"])]))]),a(J,{class:"form-card",title:"基本信息"},{default:l(()=>[a(G,{ref_key:"formRef",ref:x,model:m,rules:ae,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:l(()=>[a(C,{gutter:24},{default:l(()=>[a(s,{span:8},{default:l(()=>[a(i,{label:"模板编码",name:"code"},{default:l(()=>[a(h,{value:m.code,"onUpdate:value":e[0]||(e[0]=t=>m.code=t),disabled:v.value||L.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(s,{span:8},{default:l(()=>[a(i,{label:"模板名称",name:"name"},{default:l(()=>[a(h,{value:m.name,"onUpdate:value":e[1]||(e[1]=t=>m.name=t),disabled:v.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(s,{span:8},{default:l(()=>[a(i,{label:"检验类型",name:"inspType"},{default:l(()=>[a(T,{value:m.inspType,"onUpdate:value":e[2]||(e[2]=t=>m.inspType=t),disabled:v.value,placeholder:"请选择"},{default:l(()=>[a(f,{value:"IQC"},{default:l(()=>[...e[17]||(e[17]=[u("IQC来料检验",-1)])]),_:1}),a(f,{value:"IPQC"},{default:l(()=>[...e[18]||(e[18]=[u("IPQC过程检验",-1)])]),_:1}),a(f,{value:"FQC"},{default:l(()=>[...e[19]||(e[19]=[u("FQC成品检验",-1)])]),_:1}),a(f,{value:"OQC"},{default:l(()=>[...e[20]||(e[20]=[u("OQC出货检验",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:24},{default:l(()=>[a(s,{span:16},{default:l(()=>[a(i,{label:"备注",name:"remark","label-col":{span:3},"wrapper-col":{span:20}},{default:l(()=>[a(H,{value:m.remark,"onUpdate:value":e[3]||(e[3]=t=>m.remark=t),disabled:v.value,rows:2,placeholder:"请输入备注"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(J,{class:"detail-card",title:"模板明细"},Te({default:l(()=>[a(_e,{columns:te.value,"data-source":o.value,"row-key":"id",size:"small","row-selection":v.value?void 0:{selectedRowKeys:q.value,onChange:oe},pagination:!1},{bodyCell:l(({column:t,record:R,index:D})=>[t.key==="seq"?(p(),_(N,{key:0},[u(k(D+1),1)],64)):I("",!0),t.key==="spcEnabled"?(p(),y(O,{key:1,checked:R.spcEnabled,"onUpdate:checked":b=>R.spcEnabled=b,disabled:v.value,size:"small"},null,8,["checked","onUpdate:checked","disabled"])):I("",!0),t.key==="labRequired"?(p(),y(O,{key:2,checked:R.labRequired,"onUpdate:checked":b=>R.labRequired=b,disabled:v.value,size:"small"},null,8,["checked","onUpdate:checked","disabled"])):I("",!0),t.key==="action"?(p(),_(N,{key:3},[v.value?I("",!0):(p(),y(W,{key:0},{default:l(()=>[a(c,{type:"link",size:"small",onClick:b=>pe(R)},{default:l(()=>[...e[23]||(e[23]=[u("编辑",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",danger:"",size:"small",onClick:b=>me(R)},{default:l(()=>[...e[24]||(e[24]=[u("删除",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",size:"small",disabled:D===0,onClick:b=>ce(D)},{default:l(()=>[...e[25]||(e[25]=[u("上移",-1)])]),_:1},8,["disabled","onClick"]),a(c,{type:"link",size:"small",disabled:D===o.value.length-1,onClick:b=>ge(D)},{default:l(()=>[...e[26]||(e[26]=[u("下移",-1)])]),_:1},8,["disabled","onClick"])]),_:2},1024))],64)):I("",!0)]),_:1},8,["columns","data-source","row-selection"])]),_:2},[v.value?void 0:{name:"extra",fn:l(()=>[a(W,null,{default:l(()=>[a(c,{type:"primary",size:"small",onClick:re},{icon:l(()=>[a(Y(Re))]),default:l(()=>[e[21]||(e[21]=u("新增明细 ",-1))]),_:1}),a(c,{danger:"",size:"small",disabled:q.value.length===0,onClick:fe},{default:l(()=>[...e[22]||(e[22]=[u(" 批量删除 ",-1)])]),_:1},8,["disabled"])]),_:1})]),key:"0"}]),1024),a(be,{visible:U.value,"onUpdate:visible":e[14]||(e[14]=t=>U.value=t),title:P.value?"编辑明细":"新增明细",width:"800px",onOk:ve},{default:l(()=>[a(G,{ref_key:"detailFormRef",ref:F,model:n,rules:le,layout:"vertical"},{default:l(()=>[a(C,{gutter:16},{default:l(()=>[a(s,{span:12},{default:l(()=>[a(i,{label:"检验项目",name:"inspItemId"},{default:l(()=>[a(T,{value:n.inspItemId,"onUpdate:value":e[4]||(e[4]=t=>n.inspItemId=t),placeholder:"请选择","show-search":""},{default:l(()=>[(p(!0),_(N,null,Q($.value,t=>(p(),y(f,{key:t.id,value:t.id},{default:l(()=>[u(k(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(s,{span:12},{default:l(()=>[a(i,{label:"抽样规则",name:"samplingRuleId"},{default:l(()=>[a(T,{value:n.samplingRuleId,"onUpdate:value":e[5]||(e[5]=t=>n.samplingRuleId=t),placeholder:"请选择"},{default:l(()=>[(p(!0),_(N,null,Q(A.value,t=>(p(),y(f,{key:t.id,value:t.id},{default:l(()=>[u(k(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:16},{default:l(()=>[a(s,{span:12},{default:l(()=>[a(i,{label:"检验方法",name:"inspMethodId"},{default:l(()=>[a(T,{value:n.inspMethodId,"onUpdate:value":e[6]||(e[6]=t=>n.inspMethodId=t),placeholder:"请选择"},{default:l(()=>[(p(!0),_(N,null,Q(j.value,t=>(p(),y(f,{key:t.id,value:t.id},{default:l(()=>[u(k(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(s,{span:12},{default:l(()=>[a(i,{label:"量检具类型",name:"gaugeTypeId"},{default:l(()=>[a(T,{value:n.gaugeTypeId,"onUpdate:value":e[7]||(e[7]=t=>n.gaugeTypeId=t),placeholder:"请选择"},{default:l(()=>[(p(!0),_(N,null,Q(K.value,t=>(p(),y(f,{key:t.id,value:t.id},{default:l(()=>[u(k(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(ye,null,{default:l(()=>[...e[27]||(e[27]=[u("IPQC频次配置",-1)])]),_:1}),a(C,{gutter:16},{default:l(()=>[a(s,{span:8},{default:l(()=>[a(i,{label:"频次类型",name:"freqType"},{default:l(()=>[a(T,{value:n.freqType,"onUpdate:value":e[8]||(e[8]=t=>n.freqType=t),placeholder:"请选择"},{default:l(()=>[a(f,{value:"PerBatch"},{default:l(()=>[...e[28]||(e[28]=[u("每批",-1)])]),_:1}),a(f,{value:"PerHour"},{default:l(()=>[...e[29]||(e[29]=[u("每小时",-1)])]),_:1}),a(f,{value:"PerShift"},{default:l(()=>[...e[30]||(e[30]=[u("每班次",-1)])]),_:1}),a(f,{value:"PerQuantity"},{default:l(()=>[...e[31]||(e[31]=[u("每N件",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(s,{span:8},{default:l(()=>[a(i,{label:"频次值",name:"freqValue"},{default:l(()=>[a(ke,{value:n.freqValue,"onUpdate:value":e[9]||(e[9]=t=>n.freqValue=t),min:1,style:{width:"100%"},placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),a(s,{span:8},{default:l(()=>[a(i,{label:"单位",name:"freqUnit"},{default:l(()=>[a(h,{value:n.freqUnit,"onUpdate:value":e[10]||(e[10]=t=>n.freqUnit=t),placeholder:"如：件、小时"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:16},{default:l(()=>[a(s,{span:8},{default:l(()=>[a(i,{label:"SPC控制"},{default:l(()=>[a(O,{checked:n.spcEnabled,"onUpdate:checked":e[11]||(e[11]=t=>n.spcEnabled=t)},null,8,["checked"])]),_:1})]),_:1}),a(s,{span:8},{default:l(()=>[a(i,{label:"实验室检验"},{default:l(()=>[a(O,{checked:n.labRequired,"onUpdate:checked":e[12]||(e[12]=t=>n.labRequired=t)},null,8,["checked"])]),_:1})]),_:1})]),_:1}),a(i,{label:"备注",name:"remark"},{default:l(()=>[a(H,{value:n.remark,"onUpdate:value":e[13]||(e[13]=t=>n.remark=t),rows:2,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),Be=we(Ee,[["__scopeId","data-v-60197d67"]]);export{Be as default};
