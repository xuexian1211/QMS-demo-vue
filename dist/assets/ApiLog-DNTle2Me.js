import{E as ae}from"./ExportOutlined-CzqX03Sm.js";import{d as le,r as _,a as se,k as ne,m as oe,c as J,e as c,x as e,q as t,s as r,o as m,h as o,y as E,I as ue,S as re,p as y,f as g,t as n,n as ie,C as O,M as pe}from"./index-D0CfuKge.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"api-log"},me={class:"page-header"},ve={class:"search-section"},fe={class:"stats-section"},_e=le({__name:"ApiLog",setup(ge){const S=_(""),A=_(),z=_(),M=_(),P=_(!1),B=_(!1),s=_({}),b=se({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条记录`}),W=[{title:"请求ID",dataIndex:"id",key:"id",width:80},{title:"接口名称",dataIndex:"apiName",key:"apiName",width:150},{title:"请求方式",dataIndex:"method",key:"method",width:80},{title:"请求URL",dataIndex:"url",key:"url",width:250,ellipsis:!0},{title:"状态码",dataIndex:"status",key:"status",width:80},{title:"响应时间",dataIndex:"responseTime",key:"responseTime",width:100},{title:"客户端IP",dataIndex:"clientIp",key:"clientIp",width:120},{title:"请求时间",dataIndex:"requestTime",key:"requestTime",width:150},{title:"操作",key:"action",width:150,fixed:"right"}],v=_([{id:2001,apiName:"用户登录接口",method:"POST",url:"/api/auth/login",status:200,responseTime:120,clientIp:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",requestTime:"2024-01-15 09:30:15",responseTimeFull:"2024-01-15 09:30:15",requestHeaders:'{"Content-Type":"application/json","User-Agent":"Mozilla/5.0"}',requestParams:null,requestBody:'{"username":"admin","password":"***"}',responseHeaders:'{"Content-Type":"application/json","Content-Length":156}',responseBody:'{"code":200,"message":"登录成功","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"}',errorMsg:null},{id:2002,apiName:"获取检验单列表",method:"GET",url:"/api/quality/iqc/list?page=1&size=10",status:200,responseTime:85,clientIp:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",requestTime:"2024-01-15 10:15:30",responseTimeFull:"2024-01-15 10:15:30",requestHeaders:'{"Authorization":"Bearer ***","User-Agent":"Mozilla/5.0"}',requestParams:'{"page":1,"size":10}',requestBody:null,responseHeaders:'{"Content-Type":"application/json","Content-Length":1234}',responseBody:'{"code":200,"data":{"total":50,"list":[...]}}',errorMsg:null},{id:2003,apiName:"创建检验单",method:"POST",url:"/api/quality/iqc/create",status:400,responseTime:2500,clientIp:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",requestTime:"2024-01-15 11:20:45",responseTimeFull:"2024-01-15 11:20:48",requestHeaders:'{"Content-Type":"application/json","Authorization":"Bearer ***"}',requestParams:null,requestBody:'{"materialName":"测试物料","supplierId":123}',responseHeaders:'{"Content-Type":"application/json","Content-Length":89}',responseBody:'{"code":400,"message":"参数验证失败","errors":["supplierId不能为空"]}',errorMsg:"参数验证失败: supplierId不能为空"},{id:2004,apiName:"获取系统配置",method:"GET",url:"/api/system/config",status:500,responseTime:3200,clientIp:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",requestTime:"2024-01-15 12:05:20",responseTimeFull:"2024-01-15 12:05:23",requestHeaders:'{"Authorization":"Bearer ***","User-Agent":"Mozilla/5.0"}',requestParams:null,requestBody:null,responseHeaders:'{"Content-Type":"application/json","Content-Length":156}',responseBody:'{"code":500,"message":"服务器内部错误"}',errorMsg:"数据库连接异常: Connection refused"}]),C=ne(()=>{const l=v.value.length,a=v.value.filter(T=>T.status>=200&&T.status<300).length,d=l-a,x=Math.round(v.value.reduce((T,p)=>T+p.responseTime,0)/l);return{totalRequests:l,successRate:l>0?Math.round(a/l*100):0,avgResponseTime:x,errorRequests:d}}),q=()=>{b.current=1,k()},D=()=>{S.value="",A.value=void 0,z.value=void 0,M.value=void 0,q()},V=l=>{b.current=l.current,b.pageSize=l.pageSize,k()},j=l=>{s.value=l,B.value=!0},G=l=>{const a=v.value.findIndex(d=>d.id===l);a>-1&&(v.value.splice(a,1),O.success("删除成功"),k())},F=()=>{O.info("导出功能开发中...")},K=()=>{pe.confirm({title:"确认清空",content:"确定要清空所有接口日志吗？此操作不可恢复！",okText:"确定",cancelText:"取消",okType:"danger",onOk(){v.value=[],O.success("日志已清空"),k()}})},k=()=>{P.value=!0,setTimeout(()=>{b.total=v.value.length,P.value=!1},500)},L=l=>({GET:"green",POST:"blue",PUT:"orange",DELETE:"red",PATCH:"purple"})[l]||"default",R=l=>l>=200&&l<300?"green":l>=300&&l<400?"blue":l>=400&&l<500?"orange":l>=500?"red":"default",$=l=>l<100?"response-time-fast":l<500?"response-time-normal":l<2e3?"response-time-slow":"response-time-very-slow";return oe(()=>{k()}),(l,a)=>{const d=r("a-button"),x=r("a-space"),T=r("a-input"),p=r("a-col"),U=r("a-select"),Q=r("a-range-picker"),H=r("a-row"),I=r("a-statistic"),w=r("a-card"),N=r("a-tag"),X=r("a-popconfirm"),Y=r("a-table"),u=r("a-descriptions-item"),h=r("a-typography-paragraph"),Z=r("a-descriptions"),ee=r("a-modal");return m(),J("div",ce,[c("div",me,[a[7]||(a[7]=c("h2",null,"接口日志",-1)),e(x,null,{default:t(()=>[e(d,{onClick:F},{icon:t(()=>[e(E(ae))]),default:t(()=>[a[5]||(a[5]=o(" 导出日志 ",-1))]),_:1}),e(d,{type:"primary",danger:"",onClick:K},{icon:t(()=>[e(E(ue))]),default:t(()=>[a[6]||(a[6]=o(" 清空日志 ",-1))]),_:1})]),_:1})]),c("div",ve,[e(H,{gutter:16},{default:t(()=>[e(p,{span:5},{default:t(()=>[e(T,{value:S.value,"onUpdate:value":a[0]||(a[0]=i=>S.value=i),placeholder:"搜索接口名称/URL",onPressEnter:q},{prefix:t(()=>[e(E(re))]),_:1},8,["value"])]),_:1}),e(p,{span:4},{default:t(()=>[e(U,{value:A.value,"onUpdate:value":a[1]||(a[1]=i=>A.value=i),placeholder:"请求方式",allowClear:"",options:[{value:"GET",label:"GET"},{value:"POST",label:"POST"},{value:"PUT",label:"PUT"},{value:"DELETE",label:"DELETE"},{value:"PATCH",label:"PATCH"}]},null,8,["value"])]),_:1}),e(p,{span:4},{default:t(()=>[e(U,{value:z.value,"onUpdate:value":a[2]||(a[2]=i=>z.value=i),placeholder:"响应状态",allowClear:"",options:[{value:"200",label:"200 成功"},{value:"201",label:"201 创建"},{value:"400",label:"400 请求错误"},{value:"401",label:"401 未授权"},{value:"403",label:"403 禁止访问"},{value:"404",label:"404 未找到"},{value:"500",label:"500 服务器错误"}]},null,8,["value"])]),_:1}),e(p,{span:6},{default:t(()=>[e(Q,{value:M.value,"onUpdate:value":a[3]||(a[3]=i=>M.value=i),"show-time":"",onChange:q},null,8,["value"])]),_:1}),e(p,{span:5},{default:t(()=>[e(d,{type:"primary",onClick:q},{default:t(()=>[...a[8]||(a[8]=[o("查询",-1)])]),_:1}),e(d,{style:{"margin-left":"8px"},onClick:D},{default:t(()=>[...a[9]||(a[9]=[o("重置",-1)])]),_:1})]),_:1})]),_:1})]),c("div",fe,[e(H,{gutter:16},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[e(I,{title:"总请求量",value:C.value.totalRequests,"value-style":{color:"#3f8600"}},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[e(I,{title:"成功率",value:C.value.successRate,suffix:"%","value-style":{color:"#3f8600"}},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[e(I,{title:"平均响应时间",value:C.value.avgResponseTime,suffix:"ms","value-style":{color:"#1890ff"}},null,8,["value"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[e(I,{title:"错误请求",value:C.value.errorRequests,"value-style":{color:"#cf1322"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),e(Y,{columns:W,"data-source":v.value,pagination:b,loading:P.value,onChange:V,"row-key":"id",scroll:{x:1400}},{bodyCell:t(({column:i,record:f})=>[i.key==="method"?(m(),y(N,{key:0,color:L(f.method)},{default:t(()=>[o(n(f.method),1)]),_:2},1032,["color"])):g("",!0),i.key==="status"?(m(),y(N,{key:1,color:R(f.status)},{default:t(()=>[o(n(f.status),1)]),_:2},1032,["color"])):g("",!0),i.key==="responseTime"?(m(),J("span",{key:2,class:ie($(f.responseTime))},n(f.responseTime)+"ms ",3)):g("",!0),i.key==="action"?(m(),y(x,{key:3},{default:t(()=>[e(d,{type:"link",size:"small",onClick:te=>j(f)},{default:t(()=>[...a[10]||(a[10]=[o("查看详情",-1)])]),_:1},8,["onClick"]),e(X,{title:"确定要删除这条日志吗？",onConfirm:te=>G(f.id)},{default:t(()=>[e(d,{type:"link",size:"small",danger:""},{default:t(()=>[...a[11]||(a[11]=[o("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):g("",!0)]),_:1},8,["data-source","pagination","loading"]),e(ee,{open:B.value,"onUpdate:open":a[4]||(a[4]=i=>B.value=i),title:"接口调用详情",width:"1000px",footer:null},{default:t(()=>[e(Z,{column:2,bordered:""},{default:t(()=>[e(u,{label:"请求ID"},{default:t(()=>[o(n(s.value.id),1)]),_:1}),e(u,{label:"接口名称"},{default:t(()=>[o(n(s.value.apiName),1)]),_:1}),e(u,{label:"请求方式"},{default:t(()=>[e(N,{color:L(s.value.method)},{default:t(()=>[o(n(s.value.method),1)]),_:1},8,["color"])]),_:1}),e(u,{label:"请求URL"},{default:t(()=>[o(n(s.value.url),1)]),_:1}),e(u,{label:"响应状态"},{default:t(()=>[e(N,{color:R(s.value.status)},{default:t(()=>[o(n(s.value.status),1)]),_:1},8,["color"])]),_:1}),e(u,{label:"响应时间"},{default:t(()=>[o(n(s.value.responseTime)+"ms",1)]),_:1}),e(u,{label:"客户端IP"},{default:t(()=>[o(n(s.value.clientIp),1)]),_:1}),e(u,{label:"用户代理"},{default:t(()=>[o(n(s.value.userAgent),1)]),_:1}),e(u,{label:"请求时间"},{default:t(()=>[o(n(s.value.requestTime),1)]),_:1}),e(u,{label:"响应时间"},{default:t(()=>[o(n(s.value.responseTimeFull),1)]),_:1}),e(u,{label:"请求头",span:2},{default:t(()=>[e(h,{copyable:""},{default:t(()=>[c("pre",null,n(JSON.stringify(JSON.parse(s.value.requestHeaders),null,2)),1)]),_:1})]),_:1}),s.value.requestParams?(m(),y(u,{key:0,label:"请求参数",span:2},{default:t(()=>[e(h,{copyable:""},{default:t(()=>[c("pre",null,n(JSON.stringify(JSON.parse(s.value.requestParams),null,2)),1)]),_:1})]),_:1})):g("",!0),s.value.requestBody?(m(),y(u,{key:1,label:"请求体",span:2},{default:t(()=>[e(h,{copyable:""},{default:t(()=>[c("pre",null,n(s.value.requestBody),1)]),_:1})]),_:1})):g("",!0),e(u,{label:"响应头",span:2},{default:t(()=>[e(h,{copyable:""},{default:t(()=>[c("pre",null,n(JSON.stringify(JSON.parse(s.value.responseHeaders),null,2)),1)]),_:1})]),_:1}),s.value.responseBody?(m(),y(u,{key:2,label:"响应体",span:2},{default:t(()=>[e(h,{copyable:""},{default:t(()=>[c("pre",null,n(JSON.stringify(JSON.parse(s.value.responseBody),null,2)),1)]),_:1})]),_:1})):g("",!0),s.value.errorMsg?(m(),y(u,{key:3,label:"错误信息",span:2},{default:t(()=>[e(h,{copyable:"",class:"error-text"},{default:t(()=>[c("pre",null,n(s.value.errorMsg),1)]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1},8,["open"])])}}}),be=de(_e,[["__scopeId","data-v-c5289f18"]]);export{be as default};
