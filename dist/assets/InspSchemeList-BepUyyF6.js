import{x as t,N as ce,d as pe,a as R,r as P,m as me,c as S,q as a,s as u,C as c,o as p,e as E,h as s,y as N,S as fe,P as ve,a8 as _e,p as g,f as T,t as x,F,Y as ye,z as ke,u as he,M as L}from"./index-Ozo2vowX.js";import{g as Ce,s as ge,a as Oe,o as we,d as be,c as Se}from"./inspScheme-DkHmZ4go.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function M(m){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?Object(arguments[r]):{},f=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(o).filter(function(v){return Object.getOwnPropertyDescriptor(o,v).enumerable}))),f.forEach(function(v){Pe(m,v,o[v])})}return m}function Pe(m,r,o){return r in m?Object.defineProperty(m,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):m[r]=o,m}var V=function(r,o){var f=M({},r,o.attrs);return t(ce,M({},f,{icon:Ie}),null)};V.displayName="LinkOutlined";V.inheritAttrs=!1;const Te={class:"insp-scheme-list"},xe={class:"search-area"},Le={class:"action-area"},Ae={key:0},Re={key:1,style:{color:"#999"}},Ve=pe({__name:"InspSchemeList",setup(m){const r=he(),o=R({schemeCode:"",schemeName:"",status:void 0}),f=P([]),v=P(!1),y=R({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条`}),B=[{title:"方案编码",dataIndex:"schemeCode",key:"schemeCode",width:150},{title:"方案名称",dataIndex:"schemeName",key:"schemeName",width:200},{title:"版本",dataIndex:"version",key:"version",width:100},{title:"状态",key:"status",width:120},{title:"源模板",key:"sourceTemplate",width:200},{title:"创建人",dataIndex:"creator",key:"creator",width:120},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"操作",key:"action",fixed:"right",width:250}],O=P(!1),U=P([]),i=R({templateId:"",schemeCode:"",schemeName:"",description:""}),k=async()=>{v.value=!0;try{const n={...o,page:y.current,pageSize:y.pageSize},e=await Ce(n);e.data.success&&(f.value=e.data.data.list,y.total=e.data.data.total)}catch{c.error("加载数据失败")}finally{v.value=!1}},$=()=>{y.current=1,k()},j=()=>{Object.assign(o,{schemeCode:"",schemeName:"",status:void 0}),$()},q=n=>{y.current=n.current,y.pageSize=n.pageSize,k()},J=()=>{r.push("/inspection-model/insp-plans/create")},Q=()=>{O.value=!0},Y=async()=>{if(!i.templateId||!i.schemeCode||!i.schemeName){c.warning("请填写必填项");return}try{const n=await Se(i.templateId,{schemeCode:i.schemeCode,schemeName:i.schemeName,description:i.description});n.data.success&&(c.success("创建成功"),O.value=!1,r.push(`/inspection-model/insp-plans/edit/${n.data.data.id}`))}catch{c.error("创建失败")}},G=n=>{r.push(`/inspection-model/insp-plans/edit/${n.id}`)},H=n=>{r.push(`/inspection-model/insp-plans/${n.id}/strategies`)},W=async n=>{L.confirm({title:"确认提交审批？",content:"提交后将无法编辑，请确认",onOk:async()=>{try{await ge(n.id),c.success("提交成功"),k()}catch{c.error("提交失败")}}})},X=async n=>{L.confirm({title:"确认审批通过？",onOk:async()=>{try{await Oe(n.id),c.success("审批成功"),k()}catch{c.error("审批失败")}}})},Z=async n=>{L.confirm({title:"确认作废？",content:"作废后将无法使用",onOk:async()=>{try{await we(n.id),c.success("作废成功"),k()}catch{c.error("作废失败")}}})},K=n=>{r.push(`/inspection-model/insp-plans/copy/${n.id}`)},ee=async n=>{L.confirm({title:"确认删除？",content:"删除后无法恢复",okText:"确认",okType:"danger",onOk:async()=>{try{await be(n.id),c.success("删除成功"),k()}catch{c.error("删除失败")}}})},te=n=>({DRAFT:"default",IN_APPROVAL:"processing",APPROVED:"success",OBSOLETE:"error"})[n]||"default",ae=n=>({DRAFT:"草稿",IN_APPROVAL:"审批中",APPROVED:"已批准",OBSOLETE:"已作废"})[n]||n;return me(()=>{k()}),(n,e)=>{const I=u("a-input"),_=u("a-form-item"),w=u("a-select-option"),z=u("a-select"),h=u("a-button"),A=u("a-space"),D=u("a-form"),ne=u("a-tag"),le=u("a-tooltip"),b=u("a-menu-item"),oe=u("a-menu"),se=u("a-dropdown"),re=u("a-table"),ie=u("a-card"),ue=u("a-textarea"),de=u("a-modal");return p(),S("div",Te,[t(ie,{bordered:!1},{default:a(()=>[E("div",xe,[t(D,{layout:"inline",model:o},{default:a(()=>[t(_,{label:"方案编码"},{default:a(()=>[t(I,{value:o.schemeCode,"onUpdate:value":e[0]||(e[0]=l=>o.schemeCode=l),placeholder:"请输入方案编码","allow-clear":""},null,8,["value"])]),_:1}),t(_,{label:"方案名称"},{default:a(()=>[t(I,{value:o.schemeName,"onUpdate:value":e[1]||(e[1]=l=>o.schemeName=l),placeholder:"请输入方案名称","allow-clear":""},null,8,["value"])]),_:1}),t(_,{label:"状态"},{default:a(()=>[t(z,{value:o.status,"onUpdate:value":e[2]||(e[2]=l=>o.status=l),placeholder:"请选择状态","allow-clear":"",style:{width:"150px"}},{default:a(()=>[t(w,{value:"DRAFT"},{default:a(()=>[...e[9]||(e[9]=[s("草稿",-1)])]),_:1}),t(w,{value:"IN_APPROVAL"},{default:a(()=>[...e[10]||(e[10]=[s("审批中",-1)])]),_:1}),t(w,{value:"APPROVED"},{default:a(()=>[...e[11]||(e[11]=[s("已批准",-1)])]),_:1}),t(w,{value:"OBSOLETE"},{default:a(()=>[...e[12]||(e[12]=[s("已作废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(_,null,{default:a(()=>[t(A,null,{default:a(()=>[t(h,{type:"primary",onClick:$},{icon:a(()=>[t(N(fe))]),default:a(()=>[e[13]||(e[13]=s(" 查询 ",-1))]),_:1}),t(h,{onClick:j},{default:a(()=>[...e[14]||(e[14]=[s("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),E("div",Le,[t(A,null,{default:a(()=>[t(h,{type:"primary",onClick:J},{icon:a(()=>[t(N(ve))]),default:a(()=>[e[15]||(e[15]=s(" 新建方案 ",-1))]),_:1}),t(h,{onClick:Q},{icon:a(()=>[t(N(_e))]),default:a(()=>[e[16]||(e[16]=s(" 从模板创建 ",-1))]),_:1})]),_:1})]),t(re,{columns:B,"data-source":f.value,loading:v.value,pagination:y,onChange:q,"row-key":"id"},{bodyCell:a(({column:l,record:d})=>[l.key==="status"?(p(),g(ne,{key:0,color:te(d.status)},{default:a(()=>[s(x(ae(d.status)),1)]),_:2},1032,["color"])):l.key==="sourceTemplate"?(p(),S(F,{key:1},[d.sourceTemplateName?(p(),S("span",Ae,[s(x(d.sourceTemplateName)+" ",1),t(le,{title:"查看模板"},{default:a(()=>[t(N(V),{style:{"margin-left":"8px",cursor:"pointer"}})]),_:1})])):(p(),S("span",Re,"独立创建"))],64)):l.key==="action"?(p(),g(A,{key:2},{default:a(()=>[t(h,{type:"link",size:"small",onClick:C=>G(d)},{default:a(()=>[...e[17]||(e[17]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(h,{type:"link",size:"small",onClick:C=>H(d)},{default:a(()=>[...e[18]||(e[18]=[s("策略绑定",-1)])]),_:1},8,["onClick"]),t(se,null,{overlay:a(()=>[t(oe,null,{default:a(()=>[d.status==="DRAFT"?(p(),g(b,{key:0,onClick:C=>W(d)},{default:a(()=>[...e[19]||(e[19]=[s(" 提交审批 ",-1)])]),_:1},8,["onClick"])):T("",!0),d.status==="IN_APPROVAL"?(p(),g(b,{key:1,onClick:C=>X(d)},{default:a(()=>[...e[20]||(e[20]=[s(" 审批通过 ",-1)])]),_:1},8,["onClick"])):T("",!0),d.status==="APPROVED"?(p(),g(b,{key:2,onClick:C=>Z(d)},{default:a(()=>[...e[21]||(e[21]=[s(" 作废 ",-1)])]),_:1},8,["onClick"])):T("",!0),t(b,{onClick:C=>K(d)},{default:a(()=>[...e[22]||(e[22]=[s("复制",-1)])]),_:1},8,["onClick"]),t(b,{danger:"",onClick:C=>ee(d)},{default:a(()=>[...e[23]||(e[23]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[t(h,{type:"link",size:"small"},{default:a(()=>[e[24]||(e[24]=s(" 更多 ",-1)),t(N(ye))]),_:1})]),_:2},1024)]),_:2},1024)):T("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),t(de,{open:O.value,"onUpdate:open":e[7]||(e[7]=l=>O.value=l),title:"从模板创建检验方案",onOk:Y,onCancel:e[8]||(e[8]=l=>O.value=!1),width:"600px"},{default:a(()=>[t(D,{model:i,"label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[t(_,{label:"选择模板",required:""},{default:a(()=>[t(z,{value:i.templateId,"onUpdate:value":e[3]||(e[3]=l=>i.templateId=l),placeholder:"请选择检验模板"},{default:a(()=>[(p(!0),S(F,null,ke(U.value,l=>(p(),g(w,{key:l.id,value:l.id},{default:a(()=>[s(x(l.templateName)+" ("+x(l.version)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(_,{label:"方案编码",required:""},{default:a(()=>[t(I,{value:i.schemeCode,"onUpdate:value":e[4]||(e[4]=l=>i.schemeCode=l),placeholder:"请输入方案编码"},null,8,["value"])]),_:1}),t(_,{label:"方案名称",required:""},{default:a(()=>[t(I,{value:i.schemeName,"onUpdate:value":e[5]||(e[5]=l=>i.schemeName=l),placeholder:"请输入方案名称"},null,8,["value"])]),_:1}),t(_,{label:"描述"},{default:a(()=>[t(ue,{value:i.description,"onUpdate:value":e[6]||(e[6]=l=>i.description=l),rows:3,placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}}),Ee=Ne(Ve,[["__scopeId","data-v-be207078"]]);export{Ee as default};
