import{a as A,r as y,k as pe,m as ce,c as E,o as M,e as Y,x as e,q as a,h as i,y as I,P as me,s as d,R as fe,p as P,f as ve,t as V,F as De,C as _,E as C}from"./index-CAjnGs0g.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as be}from"./ExportOutlined-CYgoHkM0.js";const ye={class:"product-disposal-container"},_e={class:"toolbar"},Ce={class:"table-container"},Ne={__name:"ProductDisposal",setup(ke){const u=A({disposalNo:"",inspectionNo:"",productCode:"",status:""}),m=y([]),T=y(!1),v=A({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条数据`}),$=[{title:"处置单号",dataIndex:"disposalNo",key:"disposalNo",width:140},{title:"检验单号",dataIndex:"inspectionNo",key:"inspectionNo",width:140},{title:"产品编码",dataIndex:"productCode",key:"productCode",width:120},{title:"产品名称",dataIndex:"productName",key:"productName"},{title:"不合格数量",dataIndex:"defectQuantity",key:"defectQuantity",width:100},{title:"处置方式",dataIndex:"disposalMethod",key:"disposalMethod",width:100},{title:"处理状态",dataIndex:"status",key:"status",width:100},{title:"处置日期",dataIndex:"disposalDate",key:"disposalDate",width:120},{title:"操作",key:"action",width:200,fixed:"right"}],g=y(!1),N=y(!1),U=y(),l=A({id:null,disposalNo:"",inspectionNo:"",disposalDate:null,status:"pending",productCode:"",productName:"",batchNo:"",productionDate:null,quantity:null,unit:"",defectDescription:"",defectQuantity:null,causeAnalysis:"",responsibleDept:"",disposalMethod:"rework",disposalDescription:"",expectedCompletionTime:null,processor:"",reviewer:"",remarks:""}),j={inspectionNo:[{required:!0,message:"请输入检验单号",trigger:"blur"}],disposalDate:[{required:!0,message:"请选择处置日期",trigger:"change"}],productCode:[{required:!0,message:"请输入产品编码",trigger:"blur"}],productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],defectDescription:[{required:!0,message:"请描述不合格情况",trigger:"blur"}],causeAnalysis:[{required:!0,message:"请分析不合格原因",trigger:"blur"}],disposalMethod:[{required:!0,message:"请选择处置方法",trigger:"change"}]},F=[{id:1,disposalNo:"FQCD20240115001",inspectionNo:"FQC20240115001",disposalDate:"2024-01-15",status:"completed",productCode:"PROD001",productName:"产品A",batchNo:"BATCH001",productionDate:"2024-01-14",quantity:1e3,unit:"件",defectDescription:"外观有划痕，尺寸偏差",defectQuantity:50,causeAnalysis:"包装不当，工装磨损",responsibleDept:"production",disposalMethod:"rework",disposalDescription:"重新加工处理",expectedCompletionTime:"2024-01-16",processor:"李四",reviewer:"王五",remarks:"已处理完成"},{id:2,disposalNo:"FQCD20240116001",inspectionNo:"FQC20240116001",disposalDate:"2024-01-16",status:"processing",productCode:"PROD002",productName:"产品B",batchNo:"BATCH002",productionDate:"2024-01-15",quantity:500,unit:"件",defectDescription:"功能失效，性能不达标",defectQuantity:30,causeAnalysis:"元器件质量问题",responsibleDept:"technology",disposalMethod:"scrap",disposalDescription:"报废处理",expectedCompletionTime:"2024-01-17",processor:"赵六",reviewer:"",remarks:"正在处理中"},{id:3,disposalNo:"FQCD20240117001",inspectionNo:"FQC20240117001",disposalDate:"2024-01-17",status:"pending",productCode:"PROD003",productName:"产品C",batchNo:"BATCH003",productionDate:"2024-01-16",quantity:800,unit:"件",defectDescription:"颜色偏差，轻微瑕疵",defectQuantity:20,causeAnalysis:"涂料批次差异",responsibleDept:"quality",disposalMethod:"special",disposalDescription:"特采处理",expectedCompletionTime:"2024-01-18",processor:"",reviewer:"",remarks:"待处理"}],H=s=>({pending:"orange",processing:"blue",completed:"green"})[s]||"default",J=s=>({pending:"待处理",processing:"处理中",completed:"已完成"})[s]||s,G=s=>({rework:"orange",scrap:"red",return:"blue",special:"green"})[s]||"default",K=s=>({rework:"返工",scrap:"报废",return:"退货",special:"特采"})[s]||s,k=()=>{T.value=!0,setTimeout(()=>{m.value=F,v.total=F.length,T.value=!1},500)},S=()=>{v.current=1,k()},L=()=>{u.disposalNo="",u.inspectionNo="",u.productCode="",u.status="",S()},W=s=>{v.current=s.current,v.pageSize=s.pageSize,k()},X=()=>{k()},Z=()=>{_.info("导出功能开发中...")},ee=()=>{N.value=!1,g.value=!0,h()},te=s=>{_.info("查看功能开发中...")},ae=s=>{N.value=!0,g.value=!0,Object.assign(l,{...s,disposalDate:s.disposalDate?C(s.disposalDate):null,productionDate:s.productionDate?C(s.productionDate):null,expectedCompletionTime:s.expectedCompletionTime?C(s.expectedCompletionTime):null})},le=s=>{const t=m.value.findIndex(p=>p.id===s);t>-1&&(m.value.splice(t,1),v.total--,_.success("删除成功"))},oe=async()=>{try{if(await U.value.validate(),N.value){const s=m.value.findIndex(t=>t.id===l.id);s>-1&&(m.value[s]={...l,disposalDate:l.disposalDate?l.disposalDate.format("YYYY-MM-DD"):null,productionDate:l.productionDate?l.productionDate.format("YYYY-MM-DD"):null,expectedCompletionTime:l.expectedCompletionTime?l.expectedCompletionTime.format("YYYY-MM-DD"):null}),_.success("更新成功")}else{const s=Math.max(...m.value.map(r=>r.id))+1,t=`FQCD${C().format("YYYYMMDD")}${String(s).padStart(3,"0")}`,p={...l,id:s,disposalNo:t,disposalDate:l.disposalDate?l.disposalDate.format("YYYY-MM-DD"):C().format("YYYY-MM-DD"),productionDate:l.productionDate?l.productionDate.format("YYYY-MM-DD"):null,expectedCompletionTime:l.expectedCompletionTime?l.expectedCompletionTime.format("YYYY-MM-DD"):null};m.value.unshift(p),v.total++,_.success("创建成功")}g.value=!1,h()}catch(s){console.error("表单验证失败:",s)}},se=()=>{g.value=!1,h()},h=()=>{var s;Object.assign(l,{id:null,disposalNo:"",inspectionNo:"",disposalDate:null,status:"pending",productCode:"",productName:"",batchNo:"",productionDate:null,quantity:null,unit:"",defectDescription:"",defectQuantity:null,causeAnalysis:"",responsibleDept:"",disposalMethod:"rework",disposalDescription:"",expectedCompletionTime:null,processor:"",reviewer:"",remarks:""}),(s=U.value)==null||s.resetFields()},ne=pe(()=>N.value?"编辑成品不合格处置单":"新建成品不合格处置单");return ce(()=>{k()}),(s,t)=>{const p=d("a-button"),r=d("a-input"),n=d("a-form-item"),q=d("a-select"),R=d("a-form"),f=d("a-card"),O=d("a-tag"),de=d("a-popconfirm"),ie=d("a-table"),c=d("a-col"),b=d("a-row"),Q=d("a-date-picker"),B=d("a-input-number"),x=d("a-textarea"),w=d("a-radio"),ue=d("a-radio-group"),re=d("a-modal");return M(),E("div",ye,[t[37]||(t[37]=Y("div",{class:"page-header"},[Y("h1",{class:"page-title"},"成品不合格处理单")],-1)),Y("div",_e,[e(p,{type:"primary",onClick:ee},{icon:a(()=>[e(I(me))]),default:a(()=>[t[25]||(t[25]=i(" 新建处置单 ",-1))]),_:1}),e(p,{onClick:X},{icon:a(()=>[e(I(fe))]),default:a(()=>[t[26]||(t[26]=i(" 刷新 ",-1))]),_:1}),e(p,{onClick:Z},{icon:a(()=>[e(I(be))]),default:a(()=>[t[27]||(t[27]=i(" 导出 ",-1))]),_:1})]),e(f,{class:"search-card"},{default:a(()=>[e(R,{model:u,layout:"inline"},{default:a(()=>[e(n,{label:"处置单号"},{default:a(()=>[e(r,{value:u.disposalNo,"onUpdate:value":t[0]||(t[0]=o=>u.disposalNo=o),placeholder:"请输入处置单号","allow-clear":""},null,8,["value"])]),_:1}),e(n,{label:"检验单号"},{default:a(()=>[e(r,{value:u.inspectionNo,"onUpdate:value":t[1]||(t[1]=o=>u.inspectionNo=o),placeholder:"请输入检验单号","allow-clear":""},null,8,["value"])]),_:1}),e(n,{label:"产品编码"},{default:a(()=>[e(r,{value:u.productCode,"onUpdate:value":t[2]||(t[2]=o=>u.productCode=o),placeholder:"请输入产品编码","allow-clear":""},null,8,["value"])]),_:1}),e(n,{label:"处理状态"},{default:a(()=>[e(q,{value:u.status,"onUpdate:value":t[3]||(t[3]=o=>u.status=o),placeholder:"请选择状态","allow-clear":"",style:{width:"120px"},options:[{value:"pending",label:"待处理"},{value:"processing",label:"处理中"},{value:"completed",label:"已完成"}]},null,8,["value"])]),_:1}),e(n,null,{default:a(()=>[e(p,{type:"primary",onClick:S},{default:a(()=>[...t[28]||(t[28]=[i("查询",-1)])]),_:1}),e(p,{style:{"margin-left":"8px"},onClick:L},{default:a(()=>[...t[29]||(t[29]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),Y("div",Ce,[e(ie,{columns:$,"data-source":m.value,pagination:v,loading:T.value,onChange:W,"row-key":"id"},{bodyCell:a(({column:o,record:D})=>[o.key==="status"?(M(),P(O,{key:0,color:H(D.status)},{default:a(()=>[i(V(J(D.status)),1)]),_:2},1032,["color"])):o.key==="disposalMethod"?(M(),P(O,{key:1,color:G(D.disposalMethod)},{default:a(()=>[i(V(K(D.disposalMethod)),1)]),_:2},1032,["color"])):o.key==="action"?(M(),E(De,{key:2},[e(p,{type:"link",size:"small",onClick:z=>te(D)},{default:a(()=>[...t[30]||(t[30]=[i("查看",-1)])]),_:1},8,["onClick"]),e(p,{type:"link",size:"small",onClick:z=>ae(D)},{default:a(()=>[...t[31]||(t[31]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(de,{title:"确定要删除这条记录吗？",onConfirm:z=>le(D.id)},{default:a(()=>[e(p,{type:"link",size:"small",danger:""},{default:a(()=>[...t[32]||(t[32]=[i("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])],64)):ve("",!0)]),_:1},8,["data-source","pagination","loading"])]),e(re,{open:g.value,"onUpdate:open":t[24]||(t[24]=o=>g.value=o),title:ne.value,width:"900px",onOk:oe,onCancel:se},{default:a(()=>[e(R,{ref_key:"formRef",ref:U,model:l,rules:j,layout:"vertical",class:"modal-form"},{default:a(()=>[e(f,{title:"基本信息",class:"form-card"},{default:a(()=>[e(b,{gutter:16},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(n,{label:"处置单号",name:"disposalNo"},{default:a(()=>[e(r,{value:l.disposalNo,"onUpdate:value":t[4]||(t[4]=o=>l.disposalNo=o),placeholder:"系统自动生成",disabled:""},null,8,["value"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(n,{label:"检验单号",name:"inspectionNo"},{default:a(()=>[e(r,{value:l.inspectionNo,"onUpdate:value":t[5]||(t[5]=o=>l.inspectionNo=o),placeholder:"请输入检验单号"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(n,{label:"处置日期",name:"disposalDate"},{default:a(()=>[e(Q,{value:l.disposalDate,"onUpdate:value":t[6]||(t[6]=o=>l.disposalDate=o),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(n,{label:"处理状态",name:"status"},{default:a(()=>[e(q,{value:l.status,"onUpdate:value":t[7]||(t[7]=o=>l.status=o),placeholder:"请选择状态",options:[{value:"pending",label:"待处理"},{value:"processing",label:"处理中"},{value:"completed",label:"已完成"}]},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{title:"产品信息",class:"form-card"},{default:a(()=>[e(b,{gutter:16},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(n,{label:"产品编码",name:"productCode"},{default:a(()=>[e(r,{value:l.productCode,"onUpdate:value":t[8]||(t[8]=o=>l.productCode=o),placeholder:"请输入产品编码"},null,8,["value"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(n,{label:"产品名称",name:"productName"},{default:a(()=>[e(r,{value:l.productName,"onUpdate:value":t[9]||(t[9]=o=>l.productName=o),placeholder:"请输入产品名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(n,{label:"批次号",name:"batchNo"},{default:a(()=>[e(r,{value:l.batchNo,"onUpdate:value":t[10]||(t[10]=o=>l.batchNo=o),placeholder:"请输入批次号"},null,8,["value"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(n,{label:"生产日期",name:"productionDate"},{default:a(()=>[e(Q,{value:l.productionDate,"onUpdate:value":t[11]||(t[11]=o=>l.productionDate=o),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(n,{label:"数量",name:"quantity"},{default:a(()=>[e(B,{value:l.quantity,"onUpdate:value":t[12]||(t[12]=o=>l.quantity=o),style:{width:"100%"},min:0},null,8,["value"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(n,{label:"单位",name:"unit"},{default:a(()=>[e(r,{value:l.unit,"onUpdate:value":t[13]||(t[13]=o=>l.unit=o),placeholder:"请输入单位"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{title:"不合格描述",class:"form-card"},{default:a(()=>[e(n,{label:"不合格描述",name:"defectDescription"},{default:a(()=>[e(x,{value:l.defectDescription,"onUpdate:value":t[14]||(t[14]=o=>l.defectDescription=o),rows:4,placeholder:"请详细描述不合格情况"},null,8,["value"])]),_:1}),e(n,{label:"不合格数量",name:"defectQuantity"},{default:a(()=>[e(B,{value:l.defectQuantity,"onUpdate:value":t[15]||(t[15]=o=>l.defectQuantity=o),style:{width:"100%"},min:0},null,8,["value"])]),_:1})]),_:1}),e(f,{title:"原因分析",class:"form-card"},{default:a(()=>[e(n,{label:"原因分析",name:"causeAnalysis"},{default:a(()=>[e(x,{value:l.causeAnalysis,"onUpdate:value":t[16]||(t[16]=o=>l.causeAnalysis=o),rows:4,placeholder:"请分析不合格原因"},null,8,["value"])]),_:1}),e(n,{label:"责任部门",name:"responsibleDept"},{default:a(()=>[e(q,{value:l.responsibleDept,"onUpdate:value":t[17]||(t[17]=o=>l.responsibleDept=o),placeholder:"请选择责任部门",options:[{value:"production",label:"生产部"},{value:"quality",label:"品质部"},{value:"technology",label:"技术部"},{value:"equipment",label:"设备部"}]},null,8,["value"])]),_:1})]),_:1}),e(f,{title:"处置方案",class:"form-card"},{default:a(()=>[e(n,{label:"处置方法",name:"disposalMethod"},{default:a(()=>[e(ue,{value:l.disposalMethod,"onUpdate:value":t[18]||(t[18]=o=>l.disposalMethod=o)},{default:a(()=>[e(w,{value:"rework"},{default:a(()=>[...t[33]||(t[33]=[i("返工",-1)])]),_:1}),e(w,{value:"scrap"},{default:a(()=>[...t[34]||(t[34]=[i("报废",-1)])]),_:1}),e(w,{value:"return"},{default:a(()=>[...t[35]||(t[35]=[i("退货",-1)])]),_:1}),e(w,{value:"special"},{default:a(()=>[...t[36]||(t[36]=[i("特采",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(n,{label:"处置说明",name:"disposalDescription"},{default:a(()=>[e(x,{value:l.disposalDescription,"onUpdate:value":t[19]||(t[19]=o=>l.disposalDescription=o),rows:3,placeholder:"请说明处置方案"},null,8,["value"])]),_:1}),e(n,{label:"预计完成时间",name:"expectedCompletionTime"},{default:a(()=>[e(Q,{value:l.expectedCompletionTime,"onUpdate:value":t[20]||(t[20]=o=>l.expectedCompletionTime=o),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(f,{title:"人员信息",class:"form-card"},{default:a(()=>[e(b,{gutter:16},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(n,{label:"处理人",name:"processor"},{default:a(()=>[e(r,{value:l.processor,"onUpdate:value":t[21]||(t[21]=o=>l.processor=o),placeholder:"请输入处理人"},null,8,["value"])]),_:1})]),_:1}),e(c,{span:12},{default:a(()=>[e(n,{label:"审核人",name:"reviewer"},{default:a(()=>[e(r,{value:l.reviewer,"onUpdate:value":t[22]||(t[22]=o=>l.reviewer=o),placeholder:"请输入审核人"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{title:"备注",class:"form-card"},{default:a(()=>[e(n,{label:"备注",name:"remarks"},{default:a(()=>[e(x,{value:l.remarks,"onUpdate:value":t[23]||(t[23]=o=>l.remarks=o),rows:3,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Ye=ge(Ne,[["__scopeId","data-v-5c9d4ae4"]]);export{Ye as default};
