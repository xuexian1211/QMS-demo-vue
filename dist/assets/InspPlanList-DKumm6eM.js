import{d as Z,r as R,a as D,m as ee,c as te,e as L,x as t,q as n,s as d,o as P,h as s,y as C,P as ae,G as ne,I as le,R as se,p as S,f as F,t as oe,Y as ie,u as de,C as _,M as A}from"./index-CAjnGs0g.js";import{E as ue}from"./ExportOutlined-CYgoHkM0.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"page-container"},me={class:"toolbar"},ce={class:"table-container"},fe=Z({__name:"InspPlanList",setup(ve){const O=de(),T=R(!1),r=R([]),v=R([]),l=D({planCode:"",planName:"",version:"",status:void 0}),y=D({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),$=[{title:"方案编码",dataIndex:"planCode",key:"planCode",width:180},{title:"方案名称",dataIndex:"planName",key:"planName",width:250},{title:"版本",dataIndex:"version",key:"version",width:80},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"检验类型",dataIndex:"inspType",key:"inspType",width:100},{title:"关联模板",dataIndex:"templateName",key:"templateName",width:150},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:160},{title:"操作",key:"action",width:200,fixed:"right"}],B=a=>({DRAFT:"default",IN_APPROVAL:"processing",APPROVED:"success",OBSOLETE:"error"})[a]||"default",g=a=>({DRAFT:"草稿",IN_APPROVAL:"审批中",APPROVED:"已批准",OBSOLETE:"已作废"})[a]||a,b=()=>{T.value=!0,setTimeout(()=>{let a=[{id:"601",planCode:"IP-HFC-CASTING",planName:"合肥工厂-压铸件通用方案",version:"V1.0",status:"APPROVED",inspType:"IPQC",templateName:"IPQC过程检验模板",updateTime:"2026-01-10 10:00"},{id:"602",planCode:"IQC-A-L1",planName:"来料抽样加严L1",version:"V1.2",status:"DRAFT",inspType:"IQC",templateName:"IQC原材料检验模板",updateTime:"2026-01-12 14:30"},{id:"603",planCode:"FQC-MOTOR-001",planName:"电机成品检验方案",version:"V2.0",status:"IN_APPROVAL",inspType:"FQC",templateName:"FQC成品检验模板",updateTime:"2026-01-11 09:15"},{id:"604",planCode:"OQC-EXPORT-001",planName:"出口产品检验方案",version:"V1.0",status:"OBSOLETE",inspType:"OQC",templateName:"OQC出货检验模板",updateTime:"2025-12-20 16:00"}];l.planCode&&(a=a.filter(e=>e.planCode.includes(l.planCode))),l.planName&&(a=a.filter(e=>e.planName.includes(l.planName))),l.version&&(a=a.filter(e=>e.version.includes(l.version))),l.status&&(a=a.filter(e=>e.status===l.status)),r.value=a,y.total=a.length,T.value=!1},300)},x=()=>{y.current=1,b()},Q=()=>{l.planCode="",l.planName="",l.version="",l.status=void 0,x()},M=a=>{y.current=a.current,y.pageSize=a.pageSize,b()},h=a=>{v.value=a},z=()=>{O.push("/inspection-model/insp-plans/create")},U=a=>{O.push(`/inspection-model/insp-plans/view/${a.id}`)},E=a=>{const e=a!=null&&a.id?a:r.value.find(o=>o.id===v.value[0]);if(e){if(e.status!=="DRAFT"){_.warning("只有草稿状态的方案可以编辑");return}O.push(`/inspection-model/insp-plans/edit/${e.id}`)}},j=()=>{const a=r.value.filter(e=>v.value.includes(e.id)&&e.status==="DRAFT");if(a.length===0){_.warning("只有草稿状态的方案可以删除");return}A.confirm({title:"确认删除",content:`确定删除选中的 ${a.length} 条草稿方案吗？`,okType:"danger",onOk(){r.value=r.value.filter(e=>!a.map(o=>o.id).includes(e.id)),v.value=[],_.success("删除成功")}})},q=(a,e)=>{if(e==="copy"){_.success(`方案 ${a.planCode} 已复制`);return}if(e==="delete"){A.confirm({title:"确认删除",content:`确定删除方案 ${a.planName} 吗？`,okType:"danger",onOk(){r.value=r.value.filter(f=>f.id!==a.id),_.success("删除成功")}});return}const c={submit:"IN_APPROVAL",approve:"APPROVED",obsolete:"OBSOLETE"}[e];c&&A.confirm({title:"确认操作",content:`确定将方案 ${a.planName} 的状态变更为 ${g(c)} 吗？`,onOk(){a.status=c,_.success("状态变更成功")}})},G=()=>{const a=["方案编码","方案名称","版本","状态","检验类型","关联模板","更新时间"],e=r.value.map(i=>[i.planCode,i.planName,i.version,g(i.status),i.inspType,i.templateName,i.updateTime]),o=`<table><thead><tr>${a.map(i=>`<th>${i}</th>`).join("")}</tr></thead><tbody>${e.map(i=>`<tr>${i.map(w=>`<td>${String(w).replace(/&/g,"&amp;").replace(/</g,"&lt;")}</td>`).join("")}</tr>`).join("")}</tbody></table>`,c=new Blob(["\uFEFF"+o],{type:"application/vnd.ms-excel"}),f=URL.createObjectURL(c),m=document.createElement("a");m.href=f,m.download="检验方案.xls",m.click(),URL.revokeObjectURL(f),_.success("导出成功")};return ee(()=>{b()}),(a,e)=>{const o=d("a-button"),c=d("a-space"),f=d("a-input"),m=d("a-form-item"),i=d("a-select-option"),w=d("a-select"),K=d("a-form"),H=d("a-card"),J=d("a-tag"),I=d("a-divider"),k=d("a-menu-item"),V=d("a-menu-divider"),X=d("a-menu"),Y=d("a-dropdown"),W=d("a-table");return P(),te("div",re,[L("div",me,[t(c,null,{default:n(()=>[t(o,{type:"primary",onClick:z},{icon:n(()=>[t(C(ae))]),default:n(()=>[e[4]||(e[4]=s("新增 ",-1))]),_:1}),t(o,{disabled:v.value.length!==1,onClick:E},{icon:n(()=>[t(C(ne))]),default:n(()=>[e[5]||(e[5]=s("编辑 ",-1))]),_:1},8,["disabled"]),t(o,{danger:"",disabled:v.value.length===0,onClick:j},{icon:n(()=>[t(C(le))]),default:n(()=>[e[6]||(e[6]=s("删除 ",-1))]),_:1},8,["disabled"]),t(o,{onClick:G},{icon:n(()=>[t(C(ue))]),default:n(()=>[e[7]||(e[7]=s("导出 ",-1))]),_:1}),t(o,{onClick:b},{icon:n(()=>[t(C(se))]),default:n(()=>[e[8]||(e[8]=s("刷新 ",-1))]),_:1})]),_:1})]),t(H,{class:"search-card",bordered:!1},{default:n(()=>[t(K,{layout:"inline",model:l},{default:n(()=>[t(m,{label:"方案编码"},{default:n(()=>[t(f,{value:l.planCode,"onUpdate:value":e[0]||(e[0]=u=>l.planCode=u),placeholder:"请输入","allow-clear":"",style:{width:"160px"}},null,8,["value"])]),_:1}),t(m,{label:"方案名称"},{default:n(()=>[t(f,{value:l.planName,"onUpdate:value":e[1]||(e[1]=u=>l.planName=u),placeholder:"请输入","allow-clear":"",style:{width:"200px"}},null,8,["value"])]),_:1}),t(m,{label:"版本"},{default:n(()=>[t(f,{value:l.version,"onUpdate:value":e[2]||(e[2]=u=>l.version=u),placeholder:"如：V1.0","allow-clear":"",style:{width:"100px"}},null,8,["value"])]),_:1}),t(m,{label:"状态"},{default:n(()=>[t(w,{value:l.status,"onUpdate:value":e[3]||(e[3]=u=>l.status=u),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:n(()=>[t(i,{value:"DRAFT"},{default:n(()=>[...e[9]||(e[9]=[s("草稿",-1)])]),_:1}),t(i,{value:"IN_APPROVAL"},{default:n(()=>[...e[10]||(e[10]=[s("审批中",-1)])]),_:1}),t(i,{value:"APPROVED"},{default:n(()=>[...e[11]||(e[11]=[s("已批准",-1)])]),_:1}),t(i,{value:"OBSOLETE"},{default:n(()=>[...e[12]||(e[12]=[s("已作废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(m,null,{default:n(()=>[t(o,{type:"primary",onClick:x},{default:n(()=>[...e[13]||(e[13]=[s("查询",-1)])]),_:1}),t(o,{style:{"margin-left":"8px"},onClick:Q},{default:n(()=>[...e[14]||(e[14]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),L("div",ce,[t(W,{columns:$,"data-source":r.value,loading:T.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:v.value,onChange:h},pagination:y,onChange:M},{bodyCell:n(({column:u,record:p})=>[u.key==="status"?(P(),S(J,{key:0,color:B(p.status)},{default:n(()=>[s(oe(g(p.status)),1)]),_:2},1032,["color"])):F("",!0),u.key==="action"?(P(),S(c,{key:1},{default:n(()=>[t(o,{type:"link",size:"small",onClick:N=>U(p)},{default:n(()=>[...e[15]||(e[15]=[s("查看",-1)])]),_:1},8,["onClick"]),t(I,{type:"vertical"}),t(o,{type:"link",size:"small",onClick:N=>E(p),disabled:p.status!=="DRAFT"},{default:n(()=>[...e[16]||(e[16]=[s("编辑",-1)])]),_:1},8,["onClick","disabled"]),t(I,{type:"vertical"}),t(Y,null,{overlay:n(()=>[t(X,{onClick:N=>q(p,N.key)},{default:n(()=>[t(k,{key:"submit",disabled:p.status!=="DRAFT"},{default:n(()=>[...e[18]||(e[18]=[s("提交审批",-1)])]),_:1},8,["disabled"]),t(k,{key:"approve",disabled:p.status!=="IN_APPROVAL"},{default:n(()=>[...e[19]||(e[19]=[s("审批通过",-1)])]),_:1},8,["disabled"]),t(k,{key:"obsolete",disabled:p.status==="OBSOLETE"},{default:n(()=>[...e[20]||(e[20]=[s("作废",-1)])]),_:1},8,["disabled"]),t(V),t(k,{key:"copy"},{default:n(()=>[...e[21]||(e[21]=[s("复制方案",-1)])]),_:1}),t(V),t(k,{key:"delete",danger:"",disabled:p.status!=="DRAFT"},{default:n(()=>[...e[22]||(e[22]=[s("删除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onClick"])]),default:n(()=>[t(o,{type:"link",size:"small"},{default:n(()=>[e[17]||(e[17]=s(" 更多 ",-1)),t(C(ie))]),_:1})]),_:2},1024)]),_:2},1024)):F("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])}}}),ke=pe(fe,[["__scopeId","data-v-993f23ee"]]);export{ke as default};
