import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{k as J,r as m,a as K,l as se,p as c,o as d,q as a,e as de,x as l,f as y,s as u,h as o,y as T,P as A,c as Q,t as V,F as $,z as ue,C as g}from"./index-C4MSyl8P.js";const re={class:"config-container"},fe={__name:"OperationInspConfigModal",props:{visible:{type:Boolean,default:!1},operationInfo:{type:Object,default:()=>({id:"",opSeq:0,opName:"",routeId:""})}},emits:["update:visible","save"],setup(B,{emit:W}){const q=B,w=W,D=J({get:()=>q.visible,set:n=>w("update:visible",n)}),k=m([]),r=m([]),C=m([]),U=m(!1),P=m(!1),b=m("first"),M=m(),x=m([{id:"ip1",code:"IPQC-FIRST-001",name:"首件检验方案"},{id:"ip2",code:"IPQC-PATROL-001",name:"巡检方案-标准"},{id:"ip3",code:"IPQC-PATROL-002",name:"巡检方案-加严"},{id:"ip4",code:"IPQC-FINAL-001",name:"末件检验方案"}]),j=[{title:"方案编码",dataIndex:"planCode",key:"planCode",width:180},{title:"方案名称",dataIndex:"planName",key:"planName"},{title:"操作",key:"action",width:80}],X=[{title:"方案编码",dataIndex:"planCode",key:"planCode",width:180},{title:"方案名称",dataIndex:"planName",key:"planName"},{title:"频次",key:"frequency",width:120},{title:"操作",key:"action",width:140}],s=K({planId:void 0,freqValue:1,freqUnit:"小时"}),Y={planId:[{required:!0,message:"请选择检验方案",trigger:"change"}]},Z=J(()=>({first:"新增首检方案",patrol:"新增巡检方案",final:"新增末检方案"})[b.value]),p=K({id:"",freqValue:1,freqUnit:"小时"});se(()=>q.visible,n=>{var e;n&&((e=q.operationInfo)!=null&&e.id)&&ae()});const E=()=>{w("update:visible",!1)},h=()=>{w("save",{operationId:q.operationInfo.id,firstInspPlans:k.value,patrolInspPlans:r.value,finalInspPlans:C.value}),g.success("配置已保存"),E()},ee=(n,e)=>{const i=x.value.find(I=>I.id===e.value);return i?i.code.toLowerCase().includes(n.toLowerCase())||i.name.toLowerCase().includes(n.toLowerCase()):!1},ae=()=>{const e={101:{first:[{id:"c1",planId:"ip1",planCode:"IPQC-FIRST-001",planName:"首件检验方案"}],patrol:[{id:"c2",planId:"ip2",planCode:"IPQC-PATROL-001",planName:"巡检方案-标准",freqValue:2,freqUnit:"小时"}],final:[]},102:{first:[{id:"c3",planId:"ip1",planCode:"IPQC-FIRST-001",planName:"首件检验方案"}],patrol:[{id:"c4",planId:"ip2",planCode:"IPQC-PATROL-001",planName:"巡检方案-标准",freqValue:50,freqUnit:"件"}],final:[]}}[q.operationInfo.id]||{first:[],patrol:[],final:[]};k.value=e.first,r.value=e.patrol,C.value=e.final},O=n=>{b.value=n,Object.assign(s,{planId:void 0,freqValue:1,freqUnit:"小时"}),U.value=!0},le=()=>{var n;(n=M.value)==null||n.validate().then(()=>{const e=x.value.find(I=>I.id===s.planId),i={id:Date.now().toString(),planId:s.planId,planCode:e==null?void 0:e.code,planName:e==null?void 0:e.name,freqValue:s.freqValue,freqUnit:s.freqUnit};b.value==="first"?k.value.push(i):b.value==="patrol"?r.value.push(i):C.value.push(i),g.success("添加成功"),U.value=!1}).catch(()=>{g.error("请选择检验方案")})},N=(n,e)=>{n==="first"?k.value=k.value.filter(i=>i.id!==e.id):n==="patrol"?r.value=r.value.filter(i=>i.id!==e.id):C.value=C.value.filter(i=>i.id!==e.id),g.success("删除成功")},te=n=>{Object.assign(p,{id:n.id,freqValue:n.freqValue,freqUnit:n.freqUnit}),P.value=!0},ne=()=>{const n=r.value.findIndex(e=>e.id===p.id);n>-1&&(r.value[n].freqValue=p.freqValue,r.value[n].freqUnit=p.freqUnit),g.success("频次已更新"),P.value=!1};return(n,e)=>{const i=u("a-button"),I=u("a-table"),z=u("a-empty"),F=u("a-card"),ie=u("a-space"),f=u("a-select-option"),R=u("a-select"),_=u("a-form-item"),G=u("a-input-number"),H=u("a-form"),S=u("a-modal");return d(),c(S,{visible:D.value,"onUpdate:visible":e[10]||(e[10]=t=>D.value=t),title:`工序检验配置 - ${B.operationInfo.opName}`,width:"800px",destroyOnClose:!0,onCancel:E,onOk:h},{default:a(()=>[de("div",re,[l(F,{size:"small",title:"首检方案",class:"config-section"},{extra:a(()=>[l(i,{type:"primary",size:"small",ghost:"",onClick:e[0]||(e[0]=t=>O("first"))},{default:a(()=>[l(T(A)),e[11]||(e[11]=o(" 新增 ",-1))]),_:1})]),default:a(()=>[l(I,{columns:j,"data-source":k.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:a(({column:t,record:v})=>[t.key==="action"?(d(),c(i,{key:0,type:"link",danger:"",size:"small",onClick:L=>N("first",v)},{default:a(()=>[...e[12]||(e[12]=[o("删除",-1)])]),_:1},8,["onClick"])):y("",!0)]),_:1},8,["data-source"]),k.value.length===0?(d(),c(z,{key:0,description:"暂无配置"})):y("",!0)]),_:1}),l(F,{size:"small",title:"巡检方案",class:"config-section"},{extra:a(()=>[l(i,{type:"primary",size:"small",ghost:"",onClick:e[1]||(e[1]=t=>O("patrol"))},{default:a(()=>[l(T(A)),e[13]||(e[13]=o(" 新增 ",-1))]),_:1})]),default:a(()=>[l(I,{columns:X,"data-source":r.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:a(({column:t,record:v})=>[t.key==="frequency"?(d(),Q($,{key:0},[o(" 每 "+V(v.freqValue)+" "+V(v.freqUnit),1)],64)):y("",!0),t.key==="action"?(d(),c(ie,{key:1},{default:a(()=>[l(i,{type:"link",size:"small",onClick:L=>te(v)},{default:a(()=>[...e[14]||(e[14]=[o("编辑频次",-1)])]),_:1},8,["onClick"]),l(i,{type:"link",danger:"",size:"small",onClick:L=>N("patrol",v)},{default:a(()=>[...e[15]||(e[15]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):y("",!0)]),_:1},8,["data-source"]),r.value.length===0?(d(),c(z,{key:0,description:"暂无配置"})):y("",!0)]),_:1}),l(F,{size:"small",title:"末检方案",class:"config-section"},{extra:a(()=>[l(i,{type:"primary",size:"small",ghost:"",onClick:e[2]||(e[2]=t=>O("final"))},{default:a(()=>[l(T(A)),e[16]||(e[16]=o(" 新增 ",-1))]),_:1})]),default:a(()=>[l(I,{columns:j,"data-source":C.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:a(({column:t,record:v})=>[t.key==="action"?(d(),c(i,{key:0,type:"link",danger:"",size:"small",onClick:L=>N("final",v)},{default:a(()=>[...e[17]||(e[17]=[o("删除",-1)])]),_:1},8,["onClick"])):y("",!0)]),_:1},8,["data-source"]),C.value.length===0?(d(),c(z,{key:0,description:"暂无配置"})):y("",!0)]),_:1})]),l(S,{visible:U.value,"onUpdate:visible":e[6]||(e[6]=t=>U.value=t),title:Z.value,width:"500px",onOk:le},{default:a(()=>[l(H,{ref_key:"addFormRef",ref:M,model:s,rules:Y,layout:"vertical"},{default:a(()=>[l(_,{label:"检验方案",name:"planId"},{default:a(()=>[l(R,{value:s.planId,"onUpdate:value":e[3]||(e[3]=t=>s.planId=t),placeholder:"请选择检验方案","show-search":"","filter-option":ee},{default:a(()=>[(d(!0),Q($,null,ue(x.value,t=>(d(),c(f,{key:t.id,value:t.id},{default:a(()=>[o(V(t.code)+" - "+V(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),b.value==="patrol"?(d(),Q($,{key:0},[l(_,{label:"频次值",name:"freqValue"},{default:a(()=>[l(G,{value:s.freqValue,"onUpdate:value":e[4]||(e[4]=t=>s.freqValue=t),min:1,style:{width:"100%"},placeholder:"请输入频次"},null,8,["value"])]),_:1}),l(_,{label:"频次单位",name:"freqUnit"},{default:a(()=>[l(R,{value:s.freqUnit,"onUpdate:value":e[5]||(e[5]=t=>s.freqUnit=t),placeholder:"请选择单位"},{default:a(()=>[l(f,{value:"件"},{default:a(()=>[...e[18]||(e[18]=[o("件",-1)])]),_:1}),l(f,{value:"小时"},{default:a(()=>[...e[19]||(e[19]=[o("小时",-1)])]),_:1}),l(f,{value:"班次"},{default:a(()=>[...e[20]||(e[20]=[o("班次",-1)])]),_:1}),l(f,{value:"批次"},{default:a(()=>[...e[21]||(e[21]=[o("批次",-1)])]),_:1})]),_:1},8,["value"])]),_:1})],64)):y("",!0)]),_:1},8,["model"])]),_:1},8,["visible","title"]),l(S,{visible:P.value,"onUpdate:visible":e[9]||(e[9]=t=>P.value=t),title:"编辑巡检频次",width:"400px",onOk:ne},{default:a(()=>[l(H,{layout:"vertical"},{default:a(()=>[l(_,{label:"频次值"},{default:a(()=>[l(G,{value:p.freqValue,"onUpdate:value":e[7]||(e[7]=t=>p.freqValue=t),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),l(_,{label:"频次单位"},{default:a(()=>[l(R,{value:p.freqUnit,"onUpdate:value":e[8]||(e[8]=t=>p.freqUnit=t)},{default:a(()=>[l(f,{value:"件"},{default:a(()=>[...e[22]||(e[22]=[o("件",-1)])]),_:1}),l(f,{value:"小时"},{default:a(()=>[...e[23]||(e[23]=[o("小时",-1)])]),_:1}),l(f,{value:"班次"},{default:a(()=>[...e[24]||(e[24]=[o("班次",-1)])]),_:1}),l(f,{value:"批次"},{default:a(()=>[...e[25]||(e[25]=[o("批次",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["visible"])]),_:1},8,["visible","title"])}}},me=oe(fe,[["__scopeId","data-v-fd814f8e"]]);export{me as O};
