import{d as ye,r as v,a as J,k as Z,m as ke,c as M,e as s,x as l,q as a,s as o,p as T,t as y,o as _,y as k,P as ee,R as Ne,S as Ie,F as ge,z as Se,n as Le,h as i,H as Te,w as U,G as xe,I as Re,f as Ae,u as Me,M as B,C as N}from"./index-C4MSyl8P.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"page-container"},Ee={class:"split-layout"},De={class:"left-panel"},he={class:"panel-header"},Oe={class:"search-box"},Pe={class:"plan-list"},Ue=["onClick"],Be={class:"plan-item-header"},Ve={class:"plan-code"},qe={class:"plan-name"},$e={class:"plan-desc"},je={class:"plan-actions"},Qe={class:"right-panel"},Fe={key:1,class:"content-wrapper"},Ge={class:"right-header"},Xe={class:"header-info"},Ye={class:"plan-title"},Ke={class:"plan-meta"},He={class:"header-actions"},We={class:"rules-table-container"},Je={class:"detail-table-wrapper"},Ze={class:"detail-header"},el={class:"detail-title"},ll=ye({__name:"SamplingPlanList",setup(al){const w=Me(),z=v(!1),r=v([]),x=v(""),b=v(null),E=v(!1),c=v([]),C=v([]),D=v(!1),V=v(!1),u=J({id:null,planCode:"",planName:"",samplingMethod:"STANDARD_BASED",description:""}),q=Z(()=>{if(!x.value)return r.value;const n=x.value.toLowerCase();return r.value.filter(e=>e.planCode.toLowerCase().includes(n)||e.planName.toLowerCase().includes(n))}),h=Z(()=>r.value.find(n=>n.id===b.value)),$=()=>{z.value=!0,setTimeout(()=>{r.value=[{id:1,planCode:"AQL-GB2828",planName:"GB/T 2828.1-2012",samplingMethod:"STANDARD_BASED",standard:"GB/T 2828.1",description:"基于国标的AQL抽样"},{id:2,planCode:"FIX-QTY",planName:"固定数量抽样",samplingMethod:"FIXED_QUANTITY",standard:"内部标准",description:"不管多少只抽5个"},{id:3,planCode:"PERCENT-10",planName:"10%抽样",samplingMethod:"PERCENTAGE",standard:"内部标准",description:"按数量10%抽"}],z.value=!1,r.value.length>0&&!b.value&&j(r.value[0])},500)},j=n=>{b.value=n.id,oe(n.id)},le=()=>{w.push("/inspection-model/sampling-plans/create")},ae=n=>{w.push(`/inspection-model/sampling-plans/view/${n.id}`)},te=n=>{w.push(`/inspection-model/sampling-plans/edit/${n.id}`)},ne=n=>{B.confirm({title:"确认删除",content:`确定删除方案 ${n.planName} 吗？`,okType:"danger",onOk(){r.value=r.value.filter(e=>e.id!==n.id),b.value===n.id&&(b.value=null,c.value=[]),N.success("删除成功")}})},se=()=>{if(!u.planCode||!u.planName){N.error("请填写必填项");return}if(V.value){const n=r.value.findIndex(e=>e.id===u.id);n!==-1&&Object.assign(r.value[n],{...u})}else r.value.push({...u,id:Date.now()});D.value=!1,N.success("保存成功")},ie=[{title:"规则代码",dataIndex:"ruleCode",key:"ruleCode"},{title:"规则名称",dataIndex:"ruleName",key:"ruleName"},{title:"检验水平",dataIndex:"inspectionLevel",key:"inspectionLevel",width:100},{title:"类型",dataIndex:"inspectionType",key:"inspectionType",width:100},{title:"AQL值",dataIndex:"aqlValue",key:"aqlValue",width:80},{title:"操作",key:"action",width:150}],Q=[{title:"批量下限",dataIndex:"batchSizeMin",key:"batchSizeMin"},{title:"批量上限",dataIndex:"batchSizeMax",key:"batchSizeMax"},{title:"样本量字码",dataIndex:"sampleSizeCode",key:"sampleSizeCode"},{title:"Ac(接收)",dataIndex:"acceptanceNumber",key:"acceptanceNumber"},{title:"Re(拒收)",dataIndex:"rejectionNumber",key:"rejectionNumber"}],oe=n=>{E.value=!0,C.value=[],setTimeout(()=>{n===1?c.value=[{id:101,ruleCode:"GB-L2-N-0.65",ruleName:"Level II 正常 AQL 0.65",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:.65,details:[{id:1,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1},{id:2,batchSizeMin:9,batchSizeMax:15,sampleSizeCode:"B",acceptanceNumber:0,rejectionNumber:1},{id:3,batchSizeMin:16,batchSizeMax:25,sampleSizeCode:"C",acceptanceNumber:0,rejectionNumber:1}]},{id:102,ruleCode:"GB-L2-S-0.65",ruleName:"Level II 加严 AQL 0.65",inspectionLevel:"II",inspectionType:"STRICT",aqlValue:.65,details:[{id:4,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1}]}]:c.value=[],E.value=!1},300)},de=n=>{C.value=n},ue=()=>{const n={id:Date.now(),ruleCode:"NEW-RULE",ruleName:"新规则",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,details:[]};c.value.push(n),N.success("已添加新规则")},pe=()=>{B.confirm({title:"确认删除",content:`确定删除选中的 ${C.value.length} 条规则吗？`,okType:"danger",onOk(){c.value=c.value.filter(n=>!C.value.includes(n.id)),C.value=[],N.success("批量删除成功")}})},R=v(!1),f=v(!1),d=J({id:null,ruleCode:"",ruleName:"",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,details:[]}),re=n=>{f.value=!0,Object.assign(d,{...n,details:[...n.details||[]]}),R.value=!0},ce=()=>{if(f.value){const n=c.value.findIndex(e=>e.id===d.id);n!==-1&&Object.assign(c.value[n],{...d,details:[...d.details]}),N.success("规则已更新")}R.value=!1},ve=n=>{B.confirm({title:"确认删除",content:`确定删除规则 ${n.ruleName} 吗？`,okType:"danger",onOk(){c.value=c.value.filter(e=>e.id!==n.id),N.success("删除成功")}})};return ke(()=>{$()}),(n,e)=>{var W;const I=o("a-button"),F=o("a-tooltip"),G=o("a-space"),S=o("a-input"),X=o("a-empty"),A=o("a-tag"),me=o("a-spin"),O=o("a-table"),m=o("a-form-item"),p=o("a-select-option"),P=o("a-select"),_e=o("a-textarea"),Y=o("a-form"),K=o("a-modal"),L=o("a-col"),H=o("a-row"),fe=o("a-input-number"),be=o("a-divider");return _(),M("div",ze,[s("div",Ee,[s("div",De,[s("div",he,[e[12]||(e[12]=s("span",{class:"panel-title"},"抽样方案",-1)),l(G,null,{default:a(()=>[l(F,{title:"新增方案"},{default:a(()=>[l(I,{type:"primary",size:"small",shape:"circle",onClick:le},{icon:a(()=>[l(k(ee))]),_:1})]),_:1}),l(F,{title:"刷新"},{default:a(()=>[l(I,{size:"small",shape:"circle",onClick:$},{icon:a(()=>[l(k(Ne))]),_:1})]),_:1})]),_:1})]),s("div",Oe,[l(S,{value:x.value,"onUpdate:value":e[0]||(e[0]=t=>x.value=t),placeholder:"搜索方案代码/名称","allow-clear":"",size:"small"},{prefix:a(()=>[l(k(Ie))]),_:1},8,["value"])]),s("div",Pe,[l(me,{spinning:z.value},{default:a(()=>[q.value.length===0?(_(),T(X,{key:0,description:"暂无方案"})):(_(!0),M(ge,{key:1},Se(q.value,t=>(_(),M("div",{key:t.id,class:Le(["plan-item",{active:b.value===t.id}]),onClick:g=>j(t)},[s("div",Be,[s("span",Ve,y(t.planCode),1),t.samplingMethod==="STANDARD_BASED"?(_(),T(A,{key:0,color:"blue"},{default:a(()=>[...e[13]||(e[13]=[i("国标",-1)])]),_:1})):(_(),T(A,{key:1,color:"cyan"},{default:a(()=>[...e[14]||(e[14]=[i("自定义",-1)])]),_:1}))]),s("div",qe,y(t.planName),1),s("div",$e,y(t.description||"无描述"),1),s("div",je,[l(k(Te),{class:"action-icon",onClick:U(g=>ae(t),["stop"])},null,8,["onClick"]),l(k(xe),{class:"action-icon",onClick:U(g=>te(t),["stop"])},null,8,["onClick"]),l(k(Re),{class:"action-icon",onClick:U(g=>ne(t),["stop"])},null,8,["onClick"])])],10,Ue))),128))]),_:1},8,["spinning"])])]),s("div",Qe,[b.value?(_(),M("div",Fe,[s("div",Ge,[s("div",Xe,[s("div",Ye,y((W=h.value)==null?void 0:W.planName),1),s("div",Ke,[l(A,null,{default:a(()=>{var t;return[i("代码: "+y((t=h.value)==null?void 0:t.planCode),1)]}),_:1}),l(A,null,{default:a(()=>{var t;return[i("标准: "+y(((t=h.value)==null?void 0:t.standard)||"-"),1)]}),_:1})])]),s("div",He,[l(I,{type:"primary",onClick:ue},{icon:a(()=>[l(k(ee))]),default:a(()=>[e[15]||(e[15]=i(" 新增规则 ",-1))]),_:1}),l(I,{danger:"",disabled:C.value.length===0,onClick:pe},{default:a(()=>[...e[16]||(e[16]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"])])]),s("div",We,[l(O,{columns:ie,"data-source":c.value,loading:E.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:C.value,onChange:de},pagination:!1,class:"rules-table"},{bodyCell:a(({column:t,record:g})=>[t.key==="action"?(_(),T(G,{key:0},{default:a(()=>[l(I,{type:"link",size:"small",onClick:Ce=>re(g)},{default:a(()=>[...e[17]||(e[17]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(I,{type:"link",danger:"",size:"small",onClick:Ce=>ve(g)},{default:a(()=>[...e[18]||(e[18]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):Ae("",!0)]),expandedRowRender:a(({record:t})=>[s("div",Je,[s("div",Ze,[s("span",el,"抽样明细 ("+y(t.ruleCode)+")",1)]),l(O,{columns:Q,"data-source":t.details,"row-key":"id",size:"small",pagination:!1,bordered:!0},null,8,["data-source"])])]),_:1},8,["data-source","loading","row-selection"])])])):(_(),T(X,{key:0,description:"请选择左侧方案查看规则",class:"empty-state"}))])]),l(K,{visible:D.value,"onUpdate:visible":e[5]||(e[5]=t=>D.value=t),title:V.value?"编辑抽样方案":"新增抽样方案",onOk:se},{default:a(()=>[l(Y,{layout:"vertical",model:u},{default:a(()=>[l(m,{label:"方案代码",required:""},{default:a(()=>[l(S,{value:u.planCode,"onUpdate:value":e[1]||(e[1]=t=>u.planCode=t)},null,8,["value"])]),_:1}),l(m,{label:"方案名称",required:""},{default:a(()=>[l(S,{value:u.planName,"onUpdate:value":e[2]||(e[2]=t=>u.planName=t)},null,8,["value"])]),_:1}),l(m,{label:"抽样方法",required:""},{default:a(()=>[l(P,{value:u.samplingMethod,"onUpdate:value":e[3]||(e[3]=t=>u.samplingMethod=t)},{default:a(()=>[l(p,{value:"STANDARD_BASED"},{default:a(()=>[...e[19]||(e[19]=[i("国标/标准",-1)])]),_:1}),l(p,{value:"FIXED_QUANTITY"},{default:a(()=>[...e[20]||(e[20]=[i("固定数量",-1)])]),_:1}),l(p,{value:"PERCENTAGE"},{default:a(()=>[...e[21]||(e[21]=[i("百分比",-1)])]),_:1}),l(p,{value:"FULL_INSPECTION"},{default:a(()=>[...e[22]||(e[22]=[i("全检",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(m,{label:"描述"},{default:a(()=>[l(_e,{value:u.description,"onUpdate:value":e[4]||(e[4]=t=>u.description=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),l(K,{visible:R.value,"onUpdate:visible":e[11]||(e[11]=t=>R.value=t),title:f.value?"编辑规则":"规则详情",width:"700px",onOk:ce},{default:a(()=>[l(Y,{layout:"vertical",model:d},{default:a(()=>[l(H,{gutter:16},{default:a(()=>[l(L,{span:12},{default:a(()=>[l(m,{label:"规则代码",required:""},{default:a(()=>[l(S,{value:d.ruleCode,"onUpdate:value":e[6]||(e[6]=t=>d.ruleCode=t),disabled:!f.value},null,8,["value","disabled"])]),_:1})]),_:1}),l(L,{span:12},{default:a(()=>[l(m,{label:"规则名称",required:""},{default:a(()=>[l(S,{value:d.ruleName,"onUpdate:value":e[7]||(e[7]=t=>d.ruleName=t),disabled:!f.value},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),l(H,{gutter:16},{default:a(()=>[l(L,{span:8},{default:a(()=>[l(m,{label:"检验水平"},{default:a(()=>[l(P,{value:d.inspectionLevel,"onUpdate:value":e[8]||(e[8]=t=>d.inspectionLevel=t),disabled:!f.value},{default:a(()=>[l(p,{value:"I"},{default:a(()=>[...e[23]||(e[23]=[i("I",-1)])]),_:1}),l(p,{value:"II"},{default:a(()=>[...e[24]||(e[24]=[i("II",-1)])]),_:1}),l(p,{value:"III"},{default:a(()=>[...e[25]||(e[25]=[i("III",-1)])]),_:1}),l(p,{value:"S1"},{default:a(()=>[...e[26]||(e[26]=[i("S1",-1)])]),_:1}),l(p,{value:"S2"},{default:a(()=>[...e[27]||(e[27]=[i("S2",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),l(L,{span:8},{default:a(()=>[l(m,{label:"检验类型"},{default:a(()=>[l(P,{value:d.inspectionType,"onUpdate:value":e[9]||(e[9]=t=>d.inspectionType=t),disabled:!f.value},{default:a(()=>[l(p,{value:"NORMAL"},{default:a(()=>[...e[28]||(e[28]=[i("正常检验",-1)])]),_:1}),l(p,{value:"STRICT"},{default:a(()=>[...e[29]||(e[29]=[i("加严检验",-1)])]),_:1}),l(p,{value:"REDUCED"},{default:a(()=>[...e[30]||(e[30]=[i("放宽检验",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),l(L,{span:8},{default:a(()=>[l(m,{label:"AQL值"},{default:a(()=>[l(fe,{value:d.aqlValue,"onUpdate:value":e[10]||(e[10]=t=>d.aqlValue=t),disabled:!f.value,min:0,step:.1,style:{width:"100%"}},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),l(be,null,{default:a(()=>[...e[31]||(e[31]=[i("抽样明细",-1)])]),_:1}),l(O,{columns:Q,"data-source":d.details,pagination:!1,size:"small",bordered:""},null,8,["data-source"])]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),sl=we(ll,[["__scopeId","data-v-9bd3fcfe"]]);export{sl as default};
