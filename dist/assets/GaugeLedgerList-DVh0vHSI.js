import{d as Te,r as v,a as V,k as F,m as he,c as Q,e as c,x as a,q as t,s as d,t as M,o as b,y as x,P as J,R as Ye,S as qe,p as E,w as H,G as Oe,I as Be,h as r,f as Ge,M as W,C as R,E as y,u as $e}from"./index-C4MSyl8P.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"page-container"},ze={class:"split-layout"},je={class:"left-panel"},Ve={class:"panel-header"},Fe={class:"search-box"},Qe={class:"tree-container"},Je={class:"tree-node-content"},He={class:"node-title"},We={class:"node-actions"},Xe={class:"right-panel"},Ze={key:0,class:"empty-selection"},ea={key:1,class:"content-wrapper"},aa={class:"right-header"},ta={class:"header-info"},la={class:"category-title"},na={class:"category-meta"},sa={class:"header-actions"},ua={class:"ledger-search-box"},oa={class:"table-container"},ia=Te({__name:"GaugeLedgerList",setup(da){const ue=$e(),G=v(!1),X=v([]),$=v(""),U=v([]),K=v([]),P=v(!1),m=v([]),w=v([]),S=v(!1),z=v(!1),C=V({id:null,parentId:null,typeName:"",precision:.01,isMsaRequired:!1}),T=v("根节点"),A=v(!1),h=v(!1),s=V({id:null,gaugeNo:"",gaugeName:"",model:"",manufacturer:"",serialNo:"",measureRange:"",resolution:.01,accuracy:"",calibrationCycle:12,lastCalDate:null,nextCalDate:null,status:"IN_USE",location:"",custodian:"",certificateNo:"",purchaseDate:null,description:""}),o=V({gaugeNo:"",gaugeName:"",status:void 0,dateRange:[]}),Y=F(()=>X.value),oe=F(()=>($.value,Y.value)),N=F(()=>{if(U.value.length===0)return null;const n=(e,u)=>{for(const p of e){if(p.id===u)return p;if(p.children){const D=n(p.children,u);if(D)return D}}return null};return n(Y.value,U.value[0])}),q=()=>{G.value=!0,setTimeout(()=>{X.value=[{id:301,typeName:"数显卡尺",parentId:null,precision:.01,isMsaRequired:!0,children:[{id:3011,typeName:"数显卡尺-A品牌",parentId:301,precision:.01,isMsaRequired:!0}]},{id:302,typeName:"塞尺",parentId:null,precision:.05,isMsaRequired:!1,children:[]}],K.value=[301],G.value=!1},500)},ie=n=>{n.length>0?Z(n[0]):m.value=[]},de=()=>{z.value=!1,T.value="根类型",Object.assign(C,{id:null,parentId:null,typeName:"",precision:.01,isMsaRequired:!1}),O.value="新增根量检具类型",S.value=!0},re=n=>{z.value=!1,T.value=n.typeName,Object.assign(C,{id:null,parentId:n.id,typeName:"",precision:n.precision,isMsaRequired:n.isMsaRequired}),O.value="新增子量检具类型",S.value=!0},ce=n=>{z.value=!0,T.value=n.parentId?"上级ID:"+n.parentId:"根类型",Object.assign(C,{...n}),O.value="编辑量检具类型",S.value=!0},pe=n=>{W.confirm({title:"确认删除",content:`确定删除类型 ${n.typeName} 及其下属所有台账吗？`,okType:"danger",onOk(){R.success("类型已删除"),q(),U.value=[],m.value=[]}})},O=v(""),ve=()=>{R.success("类型保存成功"),S.value=!1,q()},fe=[{title:"量具编号",dataIndex:"gaugeNo",key:"gaugeNo",width:120},{title:"量具名称",dataIndex:"gaugeName",key:"gaugeName",width:140},{title:"规格型号",dataIndex:"model",key:"model",width:100},{title:"制造商",dataIndex:"manufacturer",key:"manufacturer",width:100},{title:"量程",dataIndex:"measureRange",key:"measureRange",width:100},{title:"状态",dataIndex:"status",key:"status",width:80},{title:"校准状态",key:"calStatus",width:90},{title:"下次校准",dataIndex:"nextCalDate",key:"nextCalDate",width:110},{title:"保管人",dataIndex:"custodian",key:"custodian",width:80},{title:"操作",key:"action",width:180}],Z=n=>{P.value=!0,setTimeout(()=>{let e=[];if((n===301||n===3011)&&(e=[{id:1001,gaugeNo:"G-001",gaugeName:"数显卡尺01",model:"M-150",manufacturer:"三丰",serialNo:"SN2023001",measureRange:"0-150mm",resolution:.01,accuracy:"±0.02mm",calibrationCycle:12,lastCalDate:"2023-06-15",nextCalDate:"2024-06-15",status:"IN_USE",location:"产线A",custodian:"张三",certificateNo:"CAL-2023-0001",description:"产线A使用"},{id:1002,gaugeNo:"G-002",gaugeName:"数显卡尺02",model:"M-150",manufacturer:"三丰",serialNo:"SN2023002",measureRange:"0-150mm",resolution:.01,accuracy:"±0.02mm",calibrationCycle:12,lastCalDate:"2023-09-01",nextCalDate:y().add(10,"day").format("YYYY-MM-DD"),status:"IN_USE",location:"产线B",custodian:"李四",certificateNo:"CAL-2023-0002",description:"即将到期校准"},{id:1003,gaugeNo:"G-003",gaugeName:"数显卡尺03",model:"M-200",manufacturer:"三丰",serialNo:"SN2022003",measureRange:"0-200mm",resolution:.01,accuracy:"±0.03mm",calibrationCycle:12,lastCalDate:"2022-12-01",nextCalDate:"2023-12-01",status:"CALIBRATING",location:"计量室",custodian:"王五",certificateNo:"",description:"送外校准中"}]),o.gaugeNo&&(e=e.filter(u=>u.gaugeNo.includes(o.gaugeNo))),o.gaugeName&&(e=e.filter(u=>u.gaugeName.includes(o.gaugeName))),o.status&&(e=e.filter(u=>u.status===o.status)),o.dateRange&&o.dateRange.length===2){const u=o.dateRange[0].format("YYYY-MM-DD"),p=o.dateRange[1].format("YYYY-MM-DD");e=e.filter(D=>D.nextCalDate>=u&&D.nextCalDate<=p)}m.value=e,P.value=!1},300)},ee=()=>{N.value&&Z(N.value.id)},ge=()=>{o.gaugeNo="",o.gaugeName="",o.status=void 0,o.dateRange=[],ee()},me=n=>{w.value=n},_e=()=>{var n;h.value=!1,Object.assign(s,{id:null,gaugeNo:"",gaugeName:((n=N.value)==null?void 0:n.typeName)||"",model:"",manufacturer:"",serialNo:"",measureRange:"",resolution:.01,accuracy:"",calibrationCycle:12,lastCalDate:null,nextCalDate:null,status:"IN_USE",location:"",custodian:"",certificateNo:"",purchaseDate:null,description:""}),A.value=!0},ye=n=>{h.value=!0;const e={...n};e.nextCalDate&&(e.nextCalDate=y(e.nextCalDate)),e.lastCalDate&&(e.lastCalDate=y(e.lastCalDate)),e.purchaseDate&&(e.purchaseDate=y(e.purchaseDate)),Object.assign(s,e),A.value=!0},Ce=n=>{W.confirm({title:"确认删除",content:`确定删除量具 ${n.gaugeNo} 吗？`,okType:"danger",onOk(){m.value=m.value.filter(e=>e.id!==n.id),R.success("删除成功")}})},Ne=()=>{W.confirm({title:"确认批量删除",content:`确定删除选中的 ${w.value.length} 条记录吗？`,okType:"danger",onOk(){m.value=m.value.filter(n=>!w.value.includes(n.id)),w.value=[],R.success("批量删除成功")}})},De=()=>{if(!s.gaugeNo||!s.gaugeName){R.warn("请填写必填项");return}const n={...s};if(n.nextCalDate&&(n.nextCalDate=y(n.nextCalDate).format("YYYY-MM-DD")),n.lastCalDate&&(n.lastCalDate=y(n.lastCalDate).format("YYYY-MM-DD")),n.purchaseDate&&(n.purchaseDate=y(n.purchaseDate).format("YYYY-MM-DD")),h.value){const e=m.value.findIndex(u=>u.id===s.id);e!==-1&&Object.assign(m.value[e],n)}else m.value.push({...n,id:Date.now()});R.success("台账保存成功"),A.value=!1},ke=()=>{R.success("导出任务已开始...")},be=n=>{ue.push(`/inspection-model/gauge-ledgers/${n.id}`)},xe=n=>{switch(n){case"IN_USE":return"green";case"CALIBRATING":return"orange";case"SEALED":return"gray";case"SCRAPPED":return"red";default:return"default"}},Re=n=>{switch(n){case"IN_USE":return"在用";case"CALIBRATING":return"校准中";case"SEALED":return"封存";case"SCRAPPED":return"报废";default:return n}},we=n=>{if(!n)return"default";const e=y(),p=y(n).diff(e,"day");return p<0?"red":p<=14?"orange":"green"},Se=n=>{if(!n)return"-";const e=y(),p=y(n).diff(e,"day");return p<0?"已过期":p<=14?"即将到期":"正常"};return he(()=>{q()}),(n,e)=>{const u=d("a-button"),p=d("a-tooltip"),D=d("a-space"),f=d("a-input"),Ie=d("a-tree"),ae=d("a-empty"),Me=d("a-spin"),B=d("a-tag"),i=d("a-form-item"),k=d("a-select-option"),te=d("a-select"),Ue=d("a-range-picker"),j=d("a-form"),Ae=d("a-table"),le=d("a-input-number"),Le=d("a-switch"),ne=d("a-modal"),g=d("a-col"),I=d("a-row"),se=d("a-date-picker"),Ee=d("a-textarea");return b(),Q("div",Pe,[c("div",ze,[c("div",je,[c("div",Ve,[e[24]||(e[24]=c("span",{class:"panel-title"},"量检具类型",-1)),a(D,null,{default:t(()=>[a(p,{title:"新增根类型"},{default:t(()=>[a(u,{type:"primary",size:"small",shape:"circle",onClick:de},{icon:t(()=>[a(x(J))]),_:1})]),_:1}),a(p,{title:"刷新"},{default:t(()=>[a(u,{size:"small",shape:"circle",onClick:q},{icon:t(()=>[a(x(Ye))]),_:1})]),_:1})]),_:1})]),c("div",Fe,[a(f,{value:$.value,"onUpdate:value":e[0]||(e[0]=l=>$.value=l),placeholder:"搜索类型","allow-clear":"",size:"small"},{prefix:t(()=>[a(x(qe))]),_:1},8,["value"])]),c("div",Qe,[a(Me,{spinning:G.value},{default:t(()=>[Y.value.length>0?(b(),E(Ie,{key:0,selectedKeys:U.value,"onUpdate:selectedKeys":e[1]||(e[1]=l=>U.value=l),expandedKeys:K.value,"onUpdate:expandedKeys":e[2]||(e[2]=l=>K.value=l),"tree-data":oe.value,"field-names":{children:"children",title:"typeName",key:"id"},"block-node":"",onSelect:ie},{title:t(({typeName:l,data:_})=>[c("div",Je,[c("span",He,M(l),1),c("div",We,[a(x(J),{class:"action-icon",title:"添加子类型",onClick:H(L=>re(_),["stop"])},null,8,["onClick"]),a(x(Oe),{class:"action-icon",title:"编辑",onClick:H(L=>ce(_),["stop"])},null,8,["onClick"]),a(x(Be),{class:"action-icon",title:"删除",onClick:H(L=>pe(_),["stop"])},null,8,["onClick"])])])]),_:1},8,["selectedKeys","expandedKeys","tree-data"])):(b(),E(ae,{key:1,description:"暂无类型数据",class:"empty-state"}))]),_:1},8,["spinning"])])]),c("div",Xe,[N.value?(b(),Q("div",ea,[c("div",aa,[c("div",ta,[c("div",la,M(N.value.typeName),1),c("div",na,[a(B,{color:"blue"},{default:t(()=>[r("精度: "+M(N.value.precision),1)]),_:1}),a(B,{color:N.value.isMsaRequired?"orange":"green"},{default:t(()=>[r(M(N.value.isMsaRequired?"需MSA":"不需MSA"),1)]),_:1},8,["color"])])]),c("div",sa,[a(u,{type:"primary",onClick:_e},{icon:t(()=>[a(x(J))]),default:t(()=>[e[25]||(e[25]=r(" 新增设备 ",-1))]),_:1}),a(u,{danger:"",disabled:w.value.length===0,onClick:Ne},{default:t(()=>[...e[26]||(e[26]=[r(" 批量删除 ",-1)])]),_:1},8,["disabled"]),a(u,{onClick:ke},{default:t(()=>[...e[27]||(e[27]=[r("导出",-1)])]),_:1})])]),c("div",ua,[a(j,{layout:"inline",model:o},{default:t(()=>[a(i,{label:"量具编号"},{default:t(()=>[a(f,{value:o.gaugeNo,"onUpdate:value":e[3]||(e[3]=l=>o.gaugeNo=l),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),a(i,{label:"量具名称"},{default:t(()=>[a(f,{value:o.gaugeName,"onUpdate:value":e[4]||(e[4]=l=>o.gaugeName=l),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),a(i,{label:"状态"},{default:t(()=>[a(te,{value:o.status,"onUpdate:value":e[5]||(e[5]=l=>o.status=l),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:t(()=>[a(k,{value:"IN_USE"},{default:t(()=>[...e[28]||(e[28]=[r("在用",-1)])]),_:1}),a(k,{value:"CALIBRATING"},{default:t(()=>[...e[29]||(e[29]=[r("校准中",-1)])]),_:1}),a(k,{value:"SEALED"},{default:t(()=>[...e[30]||(e[30]=[r("封存",-1)])]),_:1}),a(k,{value:"SCRAPPED"},{default:t(()=>[...e[31]||(e[31]=[r("报废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),a(i,{label:"校准日期"},{default:t(()=>[a(Ue,{value:o.dateRange,"onUpdate:value":e[6]||(e[6]=l=>o.dateRange=l)},null,8,["value"])]),_:1}),a(i,null,{default:t(()=>[a(u,{type:"primary",onClick:ee},{default:t(()=>[...e[32]||(e[32]=[r("查询",-1)])]),_:1}),a(u,{style:{"margin-left":"8px"},onClick:ge},{default:t(()=>[...e[33]||(e[33]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",oa,[a(Ae,{columns:fe,"data-source":m.value,loading:P.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:w.value,onChange:me},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`}},{bodyCell:t(({column:l,record:_})=>[l.key==="status"?(b(),E(B,{key:0,color:xe(_.status)},{default:t(()=>[r(M(Re(_.status)),1)]),_:2},1032,["color"])):l.key==="calStatus"?(b(),E(B,{key:1,color:we(_.nextCalDate)},{default:t(()=>[r(M(Se(_.nextCalDate)),1)]),_:2},1032,["color"])):l.key==="action"?(b(),E(D,{key:2},{default:t(()=>[a(u,{type:"link",size:"small",onClick:L=>be(_)},{default:t(()=>[...e[34]||(e[34]=[r("查看",-1)])]),_:1},8,["onClick"]),a(u,{type:"link",size:"small",onClick:L=>ye(_)},{default:t(()=>[...e[35]||(e[35]=[r("编辑",-1)])]),_:1},8,["onClick"]),a(u,{type:"link",danger:"",size:"small",onClick:L=>Ce(_)},{default:t(()=>[...e[36]||(e[36]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):Ge("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])):(b(),Q("div",Ze,[a(ae,{description:"请选择左侧类型查看台账"})]))])]),a(ne,{visible:S.value,"onUpdate:visible":e[10]||(e[10]=l=>S.value=l),title:O.value,onOk:ve},{default:t(()=>[a(j,{layout:"vertical",model:C},{default:t(()=>[a(i,{label:"父级类型"},{default:t(()=>[a(f,{value:T.value,disabled:""},null,8,["value"])]),_:1}),a(i,{label:"类型名称",required:""},{default:t(()=>[a(f,{value:C.typeName,"onUpdate:value":e[7]||(e[7]=l=>C.typeName=l)},null,8,["value"])]),_:1}),a(i,{label:"精度/分辨率",required:""},{default:t(()=>[a(le,{value:C.precision,"onUpdate:value":e[8]||(e[8]=l=>C.precision=l),style:{width:"100%"},min:0,step:.01},null,8,["value"])]),_:1}),a(i,{label:"是否需MSA"},{default:t(()=>[a(Le,{checked:C.isMsaRequired,"onUpdate:checked":e[9]||(e[9]=l=>C.isMsaRequired=l),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(ne,{visible:A.value,"onUpdate:visible":e[23]||(e[23]=l=>A.value=l),title:h.value?"编辑量检具台账":"新增量检具台账",width:"700px",onOk:De},{default:t(()=>[a(j,{layout:"vertical",model:s},{default:t(()=>[a(I,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(i,{label:"所属类型"},{default:t(()=>{var l;return[a(f,{value:(l=N.value)==null?void 0:l.typeName,disabled:""},null,8,["value"])]}),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(i,{label:"量具编号",required:""},{default:t(()=>[a(f,{value:s.gaugeNo,"onUpdate:value":e[11]||(e[11]=l=>s.gaugeNo=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(i,{label:"量具名称",required:""},{default:t(()=>[a(f,{value:s.gaugeName,"onUpdate:value":e[12]||(e[12]=l=>s.gaugeName=l)},null,8,["value"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(i,{label:"规格型号"},{default:t(()=>[a(f,{value:s.model,"onUpdate:value":e[13]||(e[13]=l=>s.model=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(i,{label:"制造商"},{default:t(()=>[a(f,{value:s.manufacturer,"onUpdate:value":e[14]||(e[14]=l=>s.manufacturer=l)},null,8,["value"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(i,{label:"量程范围"},{default:t(()=>[a(f,{value:s.measureRange,"onUpdate:value":e[15]||(e[15]=l=>s.measureRange=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(i,{label:"分辨率"},{default:t(()=>[a(le,{value:s.resolution,"onUpdate:value":e[16]||(e[16]=l=>s.resolution=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(i,{label:"保管人"},{default:t(()=>[a(f,{value:s.custodian,"onUpdate:value":e[17]||(e[17]=l=>s.custodian=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(i,{label:"存放位置"},{default:t(()=>[a(f,{value:s.location,"onUpdate:value":e[18]||(e[18]=l=>s.location=l)},null,8,["value"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(i,{label:"状态",required:""},{default:t(()=>[a(te,{value:s.status,"onUpdate:value":e[19]||(e[19]=l=>s.status=l)},{default:t(()=>[a(k,{value:"IN_USE"},{default:t(()=>[...e[37]||(e[37]=[r("在用",-1)])]),_:1}),a(k,{value:"CALIBRATING"},{default:t(()=>[...e[38]||(e[38]=[r("校准中",-1)])]),_:1}),a(k,{value:"SEALED"},{default:t(()=>[...e[39]||(e[39]=[r("封存",-1)])]),_:1}),a(k,{value:"SCRAPPED"},{default:t(()=>[...e[40]||(e[40]=[r("报废",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(I,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(i,{label:"下次校准日期"},{default:t(()=>[a(se,{value:s.nextCalDate,"onUpdate:value":e[20]||(e[20]=l=>s.nextCalDate=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(i,{label:"购置日期"},{default:t(()=>[a(se,{value:s.purchaseDate,"onUpdate:value":e[21]||(e[21]=l=>s.purchaseDate=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(i,{label:"描述"},{default:t(()=>[a(Ee,{value:s.description,"onUpdate:value":e[22]||(e[22]=l=>s.description=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),pa=Ke(ia,[["__scopeId","data-v-e6f6062b"]]);export{pa as default};
