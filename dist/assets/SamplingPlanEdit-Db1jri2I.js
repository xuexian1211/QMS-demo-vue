import{d as pe,r as I,k as L,j as me,a as V,m as ce,c as x,e as _,x as a,f,q as t,s as i,p as b,t as T,o as c,h as o,y as P,K as ve,P as _e,u as fe,C as k}from"./index-C4MSyl8P.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"page-container"},ye={class:"page-header"},ge={class:"header-left"},Ce={class:"title-section"},Ie={class:"page-title"},Te={key:0,class:"header-actions"},Se={key:0,class:"tab-toolbar"},ke={class:"detail-table-wrapper"},Ae={class:"detail-header"},Ee=pe({__name:"SamplingPlanEdit",setup(Re){const D=fe(),A=me(),w=I(),E=I(!1),z=I("rules"),m=L(()=>A.path.includes("/view/")),U=L(()=>A.path.includes("/edit/")),h=L(()=>m.value?"查看抽样方案":U.value?"编辑抽样方案":"新增抽样方案"),s=V({id:null,planCode:"",planName:"",samplingMethod:"STANDARD_BASED",standard:"",description:"",rules:[]}),j={planCode:[{required:!0,message:"请输入方案代码",trigger:"blur"}],planName:[{required:!0,message:"请输入方案名称",trigger:"blur"}],samplingMethod:[{required:!0,message:"请选择抽样方法",trigger:"change"}]},Q=n=>({STANDARD_BASED:"blue",FIXED_QUANTITY:"cyan",PERCENTAGE:"orange",FULL_INSPECTION:"green"})[n]||"default",G=n=>({STANDARD_BASED:"国标",FIXED_QUANTITY:"固定数量",PERCENTAGE:"百分比",FULL_INSPECTION:"全检"})[n]||n,F=[{title:"规则代码",dataIndex:"ruleCode",key:"ruleCode",width:150},{title:"规则名称",dataIndex:"ruleName",key:"ruleName",width:200},{title:"检验水平",key:"inspectionLevel",width:100},{title:"检验类型",key:"inspectionType",width:120},{title:"AQL值",dataIndex:"aqlValue",key:"aqlValue",width:80},{title:"操作",key:"action",width:150}],X=[{title:"批量下限",dataIndex:"batchSizeMin",key:"batchSizeMin"},{title:"批量上限",dataIndex:"batchSizeMax",key:"batchSizeMax"},{title:"样本量字码",dataIndex:"sampleSizeCode",key:"sampleSizeCode"},{title:"Ac(接收)",dataIndex:"acceptanceNumber",key:"acceptanceNumber"},{title:"Re(拒收)",dataIndex:"rejectionNumber",key:"rejectionNumber"}],Y=n=>{switch(n){case"NORMAL":return"green";case"STRICT":return"red";case"REDUCED":return"orange";default:return"default"}},K=n=>({NORMAL:"正常",STRICT:"加严",REDUCED:"放宽"})[n]||n,N=I(!1),y=I(!1),d=V({id:null,ruleCode:"",ruleName:"",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,details:[]}),$=()=>{y.value=!1,Object.assign(d,{id:null,ruleCode:"",ruleName:"",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:1,details:[]}),N.value=!0},H=n=>{y.value=!0,Object.assign(d,{...n,details:[...n.details||[]]}),N.value=!0},J=()=>{if(!d.ruleCode||!d.ruleName){k.error("请填写必填项");return}if(y.value){const n=s.rules.findIndex(e=>e.id===d.id);n!==-1&&Object.assign(s.rules[n],{...d,details:[...d.details]})}else s.rules.push({...d,id:Date.now().toString(),details:[]});N.value=!1,k.success(y.value?"规则已更新":"规则已添加")},W=n=>{s.rules.splice(n,1)},Z=()=>{D.push("/inspection-model/sampling-plans")},ee=async()=>{var n;try{E.value=!0,await((n=w.value)==null?void 0:n.validate()),k.success("保存成功"),D.push("/inspection-model/sampling-plans")}catch{k.error("请完善必填项")}finally{E.value=!1}},ae=()=>{const n=A.params.id;if(n){const v={1:{id:"1",planCode:"AQL-GB2828",planName:"GB/T 2828.1-2012",samplingMethod:"STANDARD_BASED",standard:"GB/T 2828.1",description:"基于国标的AQL抽样",rules:[{id:"101",ruleCode:"GB-L2-N-0.65",ruleName:"Level II 正常 AQL 0.65",inspectionLevel:"II",inspectionType:"NORMAL",aqlValue:.65,details:[{id:1,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1},{id:2,batchSizeMin:9,batchSizeMax:15,sampleSizeCode:"B",acceptanceNumber:0,rejectionNumber:1},{id:3,batchSizeMin:16,batchSizeMax:25,sampleSizeCode:"C",acceptanceNumber:0,rejectionNumber:1}]},{id:"102",ruleCode:"GB-L2-S-0.65",ruleName:"Level II 加严 AQL 0.65",inspectionLevel:"II",inspectionType:"STRICT",aqlValue:.65,details:[{id:4,batchSizeMin:1,batchSizeMax:8,sampleSizeCode:"A",acceptanceNumber:0,rejectionNumber:1}]}]},2:{id:"2",planCode:"FIX-QTY",planName:"固定数量抽样",samplingMethod:"FIXED_QUANTITY",standard:"内部标准",description:"不管多少只抽5个",rules:[]},3:{id:"3",planCode:"PERCENT-10",planName:"10%抽样",samplingMethod:"PERCENTAGE",standard:"内部标准",description:"按数量10%抽",rules:[]}}[n];v&&Object.assign(s,v)}};return ce(()=>{ae()}),(n,e)=>{const v=i("a-button"),R=i("a-tag"),g=i("a-input"),r=i("a-form-item"),p=i("a-col"),u=i("a-select-option"),M=i("a-select"),C=i("a-row"),te=i("a-textarea"),B=i("a-form"),O=i("a-card"),le=i("a-space"),q=i("a-table"),ne=i("a-empty"),se=i("a-tab-pane"),oe=i("a-tabs"),de=i("a-input-number"),ie=i("a-modal");return c(),x("div",Ne,[_("div",ye,[_("div",ge,[a(v,{type:"text",onClick:Z,class:"back-button"},{icon:t(()=>[a(P(ve))]),default:t(()=>[e[12]||(e[12]=o(" 返回 ",-1))]),_:1}),_("div",Ce,[_("h2",Ie,T(h.value),1),s.samplingMethod?(c(),b(R,{key:0,color:Q(s.samplingMethod)},{default:t(()=>[o(T(G(s.samplingMethod)),1)]),_:1},8,["color"])):f("",!0)])]),m.value?f("",!0):(c(),x("div",Te,[a(v,{type:"primary",onClick:ee,loading:E.value},{default:t(()=>[...e[13]||(e[13]=[o("保存",-1)])]),_:1},8,["loading"])]))]),a(O,{class:"form-card",title:"基本信息"},{default:t(()=>[a(B,{ref_key:"formRef",ref:w,model:s,rules:j,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:t(()=>[a(C,{gutter:24},{default:t(()=>[a(p,{span:8},{default:t(()=>[a(r,{label:"方案代码",name:"planCode"},{default:t(()=>[a(g,{value:s.planCode,"onUpdate:value":e[0]||(e[0]=l=>s.planCode=l),disabled:m.value||U.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(p,{span:8},{default:t(()=>[a(r,{label:"方案名称",name:"planName"},{default:t(()=>[a(g,{value:s.planName,"onUpdate:value":e[1]||(e[1]=l=>s.planName=l),disabled:m.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(p,{span:8},{default:t(()=>[a(r,{label:"抽样方法",name:"samplingMethod"},{default:t(()=>[a(M,{value:s.samplingMethod,"onUpdate:value":e[2]||(e[2]=l=>s.samplingMethod=l),disabled:m.value,placeholder:"请选择"},{default:t(()=>[a(u,{value:"STANDARD_BASED"},{default:t(()=>[...e[14]||(e[14]=[o("国标/标准",-1)])]),_:1}),a(u,{value:"FIXED_QUANTITY"},{default:t(()=>[...e[15]||(e[15]=[o("固定数量",-1)])]),_:1}),a(u,{value:"PERCENTAGE"},{default:t(()=>[...e[16]||(e[16]=[o("百分比",-1)])]),_:1}),a(u,{value:"FULL_INSPECTION"},{default:t(()=>[...e[17]||(e[17]=[o("全检",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:24},{default:t(()=>[a(p,{span:8},{default:t(()=>[a(r,{label:"适用标准",name:"standard"},{default:t(()=>[a(g,{value:s.standard,"onUpdate:value":e[3]||(e[3]=l=>s.standard=l),disabled:m.value,placeholder:"如: GB/T 2828.1"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:24},{default:t(()=>[a(p,{span:16},{default:t(()=>[a(r,{label:"描述",name:"description","label-col":{span:3},"wrapper-col":{span:20}},{default:t(()=>[a(te,{value:s.description,"onUpdate:value":e[4]||(e[4]=l=>s.description=l),disabled:m.value,rows:2,placeholder:"请输入描述"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(O,{class:"tab-card"},{default:t(()=>[a(oe,{activeKey:z.value,"onUpdate:activeKey":e[5]||(e[5]=l=>z.value=l)},{default:t(()=>[a(se,{key:"rules",tab:"抽样规则"},{default:t(()=>[m.value?f("",!0):(c(),x("div",Se,[a(v,{type:"primary",size:"small",onClick:$},{default:t(()=>[a(P(_e)),e[18]||(e[18]=o(" 添加规则 ",-1))]),_:1})])),a(q,{columns:F,"data-source":s.rules,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:l,record:S,index:ue})=>[l.key==="inspectionLevel"?(c(),b(R,{key:0,color:"blue"},{default:t(()=>[o(T(S.inspectionLevel),1)]),_:2},1024)):l.key==="inspectionType"?(c(),b(R,{key:1,color:Y(S.inspectionType)},{default:t(()=>[o(T(K(S.inspectionType)),1)]),_:2},1032,["color"])):l.key==="action"?(c(),b(le,{key:2},{default:t(()=>[a(v,{type:"link",size:"small",onClick:re=>H(S)},{default:t(()=>[...e[19]||(e[19]=[o("编辑",-1)])]),_:1},8,["onClick"]),m.value?f("",!0):(c(),b(v,{key:0,type:"link",danger:"",size:"small",onClick:re=>W(ue)},{default:t(()=>[...e[20]||(e[20]=[o("删除",-1)])]),_:1},8,["onClick"]))]),_:2},1024)):f("",!0)]),expandedRowRender:t(({record:l})=>[_("div",ke,[_("div",Ae,"抽样明细 ("+T(l.ruleCode)+")",1),a(q,{columns:X,"data-source":l.details,"row-key":"id",size:"small",pagination:!1,bordered:""},null,8,["data-source"])])]),_:1},8,["data-source"]),s.rules.length===0?(c(),b(ne,{key:1,description:"暂无抽样规则，请添加"})):f("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1}),a(ie,{visible:N.value,"onUpdate:visible":e[11]||(e[11]=l=>N.value=l),title:y.value?"编辑规则":"新增规则",width:"700px",onOk:J},{default:t(()=>[a(B,{layout:"vertical",model:d},{default:t(()=>[a(C,{gutter:16},{default:t(()=>[a(p,{span:12},{default:t(()=>[a(r,{label:"规则代码",required:""},{default:t(()=>[a(g,{value:d.ruleCode,"onUpdate:value":e[6]||(e[6]=l=>d.ruleCode=l)},null,8,["value"])]),_:1})]),_:1}),a(p,{span:12},{default:t(()=>[a(r,{label:"规则名称",required:""},{default:t(()=>[a(g,{value:d.ruleName,"onUpdate:value":e[7]||(e[7]=l=>d.ruleName=l)},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(C,{gutter:16},{default:t(()=>[a(p,{span:8},{default:t(()=>[a(r,{label:"检验水平"},{default:t(()=>[a(M,{value:d.inspectionLevel,"onUpdate:value":e[8]||(e[8]=l=>d.inspectionLevel=l)},{default:t(()=>[a(u,{value:"I"},{default:t(()=>[...e[21]||(e[21]=[o("I",-1)])]),_:1}),a(u,{value:"II"},{default:t(()=>[...e[22]||(e[22]=[o("II",-1)])]),_:1}),a(u,{value:"III"},{default:t(()=>[...e[23]||(e[23]=[o("III",-1)])]),_:1}),a(u,{value:"S1"},{default:t(()=>[...e[24]||(e[24]=[o("S1",-1)])]),_:1}),a(u,{value:"S2"},{default:t(()=>[...e[25]||(e[25]=[o("S2",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(p,{span:8},{default:t(()=>[a(r,{label:"检验类型"},{default:t(()=>[a(M,{value:d.inspectionType,"onUpdate:value":e[9]||(e[9]=l=>d.inspectionType=l)},{default:t(()=>[a(u,{value:"NORMAL"},{default:t(()=>[...e[26]||(e[26]=[o("正常检验",-1)])]),_:1}),a(u,{value:"STRICT"},{default:t(()=>[...e[27]||(e[27]=[o("加严检验",-1)])]),_:1}),a(u,{value:"REDUCED"},{default:t(()=>[...e[28]||(e[28]=[o("放宽检验",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(p,{span:8},{default:t(()=>[a(r,{label:"AQL值"},{default:t(()=>[a(de,{value:d.aqlValue,"onUpdate:value":e[10]||(e[10]=l=>d.aqlValue=l),min:0,step:.1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),xe=be(Ee,[["__scopeId","data-v-b40a46e4"]]);export{xe as default};
