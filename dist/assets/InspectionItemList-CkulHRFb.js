import{d as Ue,r as c,a as P,k as de,m as Re,c as B,e as L,x as a,q as t,s as u,o as f,h as o,y as _,P as ne,G as Le,I as ze,R as $e,g as Fe,p as v,t as I,Y as He,Z as Ae,a7 as Ge,F as Ve,z as Ke,f as D,u as Pe,C as b,M as oe}from"./index-Ozo2vowX.js";import{u as Be}from"./excel-B07CBqJs.js";import{E as We}from"./ExportOutlined-Bxr6hJMG.js";import{_ as Qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"page-container"},Je={class:"toolbar"},Ye={class:"table-container"},Ze={key:1},Xe={style:{"margin-bottom":"8px"}},et=Ue({__name:"InspectionItemList",setup(tt){const z=Pe(),ie=c("1"),$=c(!1),M=c(!1),p=c([]),y=c([]),F=c([{id:"GROUP",name:"集团",color:"gold"},{id:"1",name:"合肥工厂",color:"blue"},{id:"2",name:"芜湖工厂",color:"green"}]),se=l=>{if(l===null)return"集团";const e=F.value.find(i=>i.id===l);return e?e.name:l},ue=l=>{if(l===null)return"gold";const e=F.value.find(i=>i.id===l);return e?e.color:"default"},n=P({code:"",name:"",category:void 0,dataType:void 0,orgIds:[],status:void 0}),h=P({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),re=[{title:"项目编码",dataIndex:"code",key:"code",width:120},{title:"项目名称",dataIndex:"name",key:"name",width:150},{title:"所属组织",dataIndex:"orgId",key:"orgId",width:90},{title:"分类",dataIndex:"category",key:"category",width:80},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:90},{title:"单位",dataIndex:"uom",key:"uom",width:60},{title:"默认方法",dataIndex:"defaultMethodName",key:"defaultMethodName",width:120,ellipsis:!0},{title:"标记",key:"flags",width:100},{title:"状态",dataIndex:"status",key:"status",width:70},{title:"操作",key:"action",width:180,fixed:"right"}],W=l=>({dimension:"尺寸",appearance:"外观",physical_chemical:"理化",functional:"功能"})[l]||l,T=l=>ie.value===null?!0:l.orgId!==null,fe=de(()=>{if(y.value.length!==1)return!1;const l=p.value.find(e=>e.id===y.value[0]);return l?T(l):!1}),Q=de(()=>y.value.length===0?!1:y.value.every(l=>{const e=p.value.find(i=>i.id===l);return e?T(e):!1})),S=()=>{$.value=!0,setTimeout(()=>{let l=[{id:"1",orgId:null,code:"ITEM-G-LENGTH",name:"长度检测",category:"dimension",dataType:"quantitative",uom:"mm",defaultMethodId:"101",defaultMethodName:"卡尺测量法",isSpcDefault:!0,isLabTestDefault:!1,description:"集团标准长度检测项目",status:"enabled"},{id:"2",orgId:null,code:"ITEM-G-HARDNESS",name:"洛氏硬度",category:"physical_chemical",dataType:"quantitative",uom:"HRC",defaultMethodId:"102",defaultMethodName:"硬度计测量",isSpcDefault:!0,isLabTestDefault:!0,description:"集团标准硬度检测",status:"enabled"},{id:"3",orgId:"1",code:"ITEM-HF-SURFACE",name:"表面外观检查",category:"appearance",dataType:"qualitative",uom:"",defaultMethodId:"103",defaultMethodName:"目视检查",isSpcDefault:!1,isLabTestDefault:!1,description:"合肥工厂本地外观检查",status:"enabled"},{id:"4",orgId:"1",code:"ITEM-HF-COATING",name:"涂层厚度",category:"dimension",dataType:"quantitative",uom:"μm",defaultMethodId:"104",defaultMethodName:"涂层测厚仪",isSpcDefault:!0,isLabTestDefault:!1,description:"合肥工厂专用涂层检测",status:"enabled"},{id:"5",orgId:"1",code:"ITEM-HF-SALT",name:"盐雾测试",category:"functional",dataType:"qualitative",uom:"",defaultMethodId:"105",defaultMethodName:"盐雾试验法",isSpcDefault:!1,isLabTestDefault:!0,description:"合肥工厂特殊测试项目",status:"disabled"},{id:"6",orgId:"2",code:"ITEM-WH-TORQUE",name:"扭矩检测",category:"functional",dataType:"quantitative",uom:"N·m",defaultMethodId:"106",defaultMethodName:"扭矩扳手测量",isSpcDefault:!0,isLabTestDefault:!1,description:"芜湖工厂扭矩检测项目",status:"enabled"},{id:"7",orgId:"2",code:"ITEM-WH-WEIGHT",name:"重量检测",category:"dimension",dataType:"quantitative",uom:"g",defaultMethodId:"107",defaultMethodName:"电子秤称重",isSpcDefault:!1,isLabTestDefault:!1,description:"芜湖工厂重量检测项目",status:"enabled"}];n.code&&(l=l.filter(e=>e.code.toLowerCase().includes(n.code.toLowerCase()))),n.name&&(l=l.filter(e=>e.name.includes(n.name))),n.category&&(l=l.filter(e=>e.category===n.category)),n.dataType&&(l=l.filter(e=>e.dataType===n.dataType)),n.status&&(l=l.filter(e=>e.status===n.status)),n.orgIds&&n.orgIds.length>0&&(l=l.filter(e=>!!(n.orgIds.includes("GROUP")&&e.orgId===null||e.orgId!==null&&n.orgIds.includes(e.orgId)))),p.value=l,h.total=l.length,$.value=!1},300)},j=()=>{h.current=1,S()},ce=()=>{n.code="",n.name="",n.category=void 0,n.dataType=void 0,n.orgIds=[],n.status=void 0,j()},pe=l=>{h.current=l.current,h.pageSize=l.pageSize,S()},ve=l=>{y.value=l},H=c(!1),A=c(!1),J=c("basic"),Y=c(),r=P({id:null,code:"",name:"",category:"dimension",dataType:"quantitative",uom:"",defaultMethodId:"",defaultMethodName:"",description:""}),me={code:[{required:!0,message:"请输入项目编码",trigger:"blur"}],name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},ye=()=>{z.push("/inspection-model/inspection-items/create")},ge=l=>{z.push(`/inspection-model/inspection-items/view/${l.id}`)},Z=l=>{const e=l.id?l:p.value.find(i=>i.id===y.value[0]);if(e){if(!T(e)){b.warning("集团标准项目不可编辑");return}z.push(`/inspection-model/inspection-items/edit/${e.id}`)}},ke=l=>{if(!T(l)){b.warning("集团标准项目不可删除");return}oe.confirm({title:"确认删除",content:`确定删除检验项目 ${l.name} 吗？`,okType:"danger",onOk(){p.value=p.value.filter(e=>e.id!==l.id),b.success("删除成功")}})},be=()=>{if(!Q.value){b.warning("选中的项目中包含集团标准，不可删除");return}oe.confirm({title:"确认批量删除",content:`确定删除选中的 ${y.value.length} 条记录吗？`,okType:"danger",onOk(){p.value=p.value.filter(l=>!y.value.includes(l.id)),y.value=[],b.success("删除成功")}})},_e=()=>{Y.value.validate().then(()=>{if(A.value){const l=p.value.findIndex(e=>e.id===r.id);l>-1&&Object.assign(p.value[l],r)}else p.value.push({...r,id:Date.now().toString()});b.success("保存成功"),H.value=!1,S()})},Ie=()=>{if(p.value.length===0){b.warning("暂无数据可导出");return}const l=[{title:"项目编码",dataIndex:"code"},{title:"项目名称",dataIndex:"name"},{title:"所属组织",dataIndex:"orgId",formatter:i=>i?"本地":"集团"},{title:"分类",dataIndex:"category",formatter:W},{title:"数据类型",dataIndex:"dataType",formatter:i=>i==="quantitative"?"计量型":"计数型"},{title:"单位",dataIndex:"uom"},{title:"默认方法",dataIndex:"defaultMethodName"},{title:"描述",dataIndex:"description"}],{exportToCSV:e}=Be();e(p.value,l,"检验项目"),b.success("导出成功")};Re(()=>{S()});const C=c([]),O=c(!1),G=c(!1),E=c([]),U=c([]),we=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",dataIndex:"severity",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"}],Te=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",dataIndex:"severity",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:120}],Ce=l=>{b.info(`编辑关联: ${l.name}`)},X=l=>{switch(l){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}},xe=()=>{G.value=!0,setTimeout(()=>{E.value=[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"},{id:"103",code:"DEF-003",name:"裂纹",severity:"CR",description:"产品裂纹"},{id:"104",code:"DEF-004",name:"变形",severity:"MA",description:"产品变形"},{id:"105",code:"DEF-005",name:"色差",severity:"MI",description:"颜色不均匀"}];const l=C.value.map(e=>e.id);E.value=E.value.filter(e=>!l.includes(e.id)),U.value=[],G.value=!1},300),O.value=!0},De=l=>{U.value=l},Me=()=>{const l=E.value.filter(e=>U.value.includes(e.id));C.value.push(...l),O.value=!1,b.success(`已添加 ${l.length} 个关联缺陷`)},he=l=>{C.value=C.value.filter(e=>e.id!==l)};return(l,e)=>{const i=u("a-button"),N=u("a-space"),x=u("a-input"),m=u("a-form-item"),g=u("a-col"),k=u("a-select-option"),q=u("a-select"),R=u("a-row"),ee=u("a-form"),Se=u("a-card"),w=u("a-tag"),te=u("a-divider"),V=u("a-table"),Ee=u("a-textarea"),ae=u("a-tab-pane"),Ne=u("a-empty"),qe=u("a-tabs"),le=u("a-modal");return f(),B("div",je,[L("div",Je,[a(N,null,{default:t(()=>[a(i,{type:"primary",onClick:ye},{icon:t(()=>[a(_(ne))]),default:t(()=>[e[16]||(e[16]=o("新增 ",-1))]),_:1}),a(i,{disabled:y.value.length!==1||!fe.value,onClick:Z},{icon:t(()=>[a(_(Le))]),default:t(()=>[e[17]||(e[17]=o("编辑 ",-1))]),_:1},8,["disabled"]),a(i,{danger:"",disabled:y.value.length===0||!Q.value,onClick:be},{icon:t(()=>[a(_(ze))]),default:t(()=>[e[18]||(e[18]=o("删除 ",-1))]),_:1},8,["disabled"]),a(i,{onClick:Ie},{icon:t(()=>[a(_(We))]),default:t(()=>[e[19]||(e[19]=o("导出 ",-1))]),_:1}),a(i,{onClick:S},{icon:t(()=>[a(_($e))]),default:t(()=>[e[20]||(e[20]=o("刷新 ",-1))]),_:1})]),_:1})]),a(Se,{class:"search-card",bordered:!1},{default:t(()=>[a(ee,{model:n,"label-col":{span:24},"wrapper-col":{span:24}},{default:t(()=>[a(R,{gutter:16},{default:t(()=>[a(g,{span:6},{default:t(()=>[a(m,{label:"项目编码"},{default:t(()=>[a(x,{value:n.code,"onUpdate:value":e[0]||(e[0]=d=>n.code=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),a(g,{span:6},{default:t(()=>[a(m,{label:"项目名称"},{default:t(()=>[a(x,{value:n.name,"onUpdate:value":e[1]||(e[1]=d=>n.name=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1})]),_:1}),a(g,{span:6},{default:t(()=>[a(m,{label:"分类"},{default:t(()=>[a(q,{value:n.category,"onUpdate:value":e[2]||(e[2]=d=>n.category=d),style:{width:"100%"},"allow-clear":"",placeholder:"请选择"},{default:t(()=>[a(k,{value:"dimension"},{default:t(()=>[...e[21]||(e[21]=[o("尺寸",-1)])]),_:1}),a(k,{value:"appearance"},{default:t(()=>[...e[22]||(e[22]=[o("外观",-1)])]),_:1}),a(k,{value:"physical_chemical"},{default:t(()=>[...e[23]||(e[23]=[o("理化",-1)])]),_:1}),a(k,{value:"functional"},{default:t(()=>[...e[24]||(e[24]=[o("功能",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(g,{span:6},{default:t(()=>[a(m,{label:" ",colon:!1},{default:t(()=>[a(N,null,{default:t(()=>[a(i,{type:"primary",onClick:j},{default:t(()=>[...e[25]||(e[25]=[o("查询",-1)])]),_:1}),a(i,{onClick:ce},{default:t(()=>[...e[26]||(e[26]=[o("重置",-1)])]),_:1}),L("a",{onClick:e[3]||(e[3]=d=>M.value=!M.value),style:{"line-height":"32px"}},[o(I(M.value?"收起":"展开")+" ",1),M.value?(f(),v(_(Ae),{key:1})):(f(),v(_(He),{key:0}))])]),_:1})]),_:1})]),_:1})]),_:1}),Fe(a(R,{gutter:16},{default:t(()=>[a(g,{span:6},{default:t(()=>[a(m,{label:"数据类型"},{default:t(()=>[a(q,{value:n.dataType,"onUpdate:value":e[4]||(e[4]=d=>n.dataType=d),style:{width:"100%"},"allow-clear":"",placeholder:"请选择"},{default:t(()=>[a(k,{value:"quantitative"},{default:t(()=>[...e[27]||(e[27]=[o("计量型",-1)])]),_:1}),a(k,{value:"qualitative"},{default:t(()=>[...e[28]||(e[28]=[o("计数型",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(g,{span:6},{default:t(()=>[a(m,{label:"所属组织"},{default:t(()=>[a(q,{value:n.orgIds,"onUpdate:value":e[5]||(e[5]=d=>n.orgIds=d),style:{width:"100%"},"allow-clear":"",placeholder:"请选择",mode:"multiple","max-tag-count":2},{default:t(()=>[(f(!0),B(Ve,null,Ke(F.value,d=>(f(),v(k,{key:d.id,value:d.id},{default:t(()=>[o(I(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(g,{span:6},{default:t(()=>[a(m,{label:"状态"},{default:t(()=>[a(q,{value:n.status,"onUpdate:value":e[6]||(e[6]=d=>n.status=d),style:{width:"100%"},"allow-clear":"",placeholder:"请选择"},{default:t(()=>[a(k,{value:"enabled"},{default:t(()=>[...e[29]||(e[29]=[o("启用",-1)])]),_:1}),a(k,{value:"disabled"},{default:t(()=>[...e[30]||(e[30]=[o("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},512),[[Ge,M.value]])]),_:1},8,["model"])]),_:1}),L("div",Ye,[a(V,{columns:re,"data-source":p.value,loading:$.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:y.value,onChange:ve},pagination:h,onChange:pe},{bodyCell:t(({column:d,record:s})=>[d.key==="orgId"?(f(),v(w,{key:0,color:ue(s.orgId)},{default:t(()=>[o(I(se(s.orgId)),1)]),_:2},1032,["color"])):d.key==="category"?(f(),B("span",Ze,I(W(s.category)),1)):d.key==="dataType"?(f(),v(w,{key:2,color:s.dataType==="quantitative"?"blue":"purple"},{default:t(()=>[o(I(s.dataType==="quantitative"?"计量型":"计数型"),1)]),_:2},1032,["color"])):d.key==="flags"?(f(),v(N,{key:3},{default:t(()=>[s.isSpcDefault?(f(),v(w,{key:0,color:"green"},{default:t(()=>[...e[31]||(e[31]=[o("SPC",-1)])]),_:1})):D("",!0),s.isLabTestDefault?(f(),v(w,{key:1,color:"orange"},{default:t(()=>[...e[32]||(e[32]=[o("实验室",-1)])]),_:1})):D("",!0)]),_:2},1024)):d.key==="status"?(f(),v(w,{key:4,color:s.status==="enabled"?"success":"default"},{default:t(()=>[o(I(s.status==="enabled"?"启用":"禁用"),1)]),_:2},1032,["color"])):d.key==="action"?(f(),v(N,{key:5},{default:t(()=>[a(i,{type:"link",size:"small",onClick:K=>ge(s)},{default:t(()=>[...e[33]||(e[33]=[o("查看",-1)])]),_:1},8,["onClick"]),a(te,{type:"vertical"}),a(i,{type:"link",size:"small",onClick:K=>Z(s),disabled:!T(s)},{default:t(()=>[...e[34]||(e[34]=[o("编辑",-1)])]),_:1},8,["onClick","disabled"]),a(te,{type:"vertical"}),a(i,{type:"link",danger:"",size:"small",onClick:K=>ke(s),disabled:!T(s)},{default:t(()=>[...e[35]||(e[35]=[o("删除",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),a(le,{visible:H.value,"onUpdate:visible":e[14]||(e[14]=d=>H.value=d),title:A.value?"编辑检验项目":"新增检验项目",width:"600px",onOk:_e},{default:t(()=>[a(qe,{activeKey:J.value,"onUpdate:activeKey":e[13]||(e[13]=d=>J.value=d)},{default:t(()=>[a(ae,{key:"basic",tab:"基本信息"},{default:t(()=>[a(ee,{ref_key:"formRef",ref:Y,model:r,rules:me,layout:"vertical"},{default:t(()=>[a(R,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(m,{label:"项目编码",name:"code"},{default:t(()=>[a(x,{value:r.code,"onUpdate:value":e[7]||(e[7]=d=>r.code=d),placeholder:"请输入",disabled:A.value},null,8,["value","disabled"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(m,{label:"项目名称",name:"name"},{default:t(()=>[a(x,{value:r.name,"onUpdate:value":e[8]||(e[8]=d=>r.name=d),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(R,{gutter:16},{default:t(()=>[a(g,{span:12},{default:t(()=>[a(m,{label:"数据类型",name:"dataType"},{default:t(()=>[a(q,{value:r.dataType,"onUpdate:value":e[9]||(e[9]=d=>r.dataType=d)},{default:t(()=>[a(k,{value:"quantitative"},{default:t(()=>[...e[36]||(e[36]=[o("计量型",-1)])]),_:1}),a(k,{value:"qualitative"},{default:t(()=>[...e[37]||(e[37]=[o("计数型",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(g,{span:12},{default:t(()=>[a(m,{label:"单位",name:"uom"},{default:t(()=>[a(x,{value:r.uom,"onUpdate:value":e[10]||(e[10]=d=>r.uom=d),placeholder:"计量型必填",disabled:r.dataType==="qualitative"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(m,{label:"检验方法",name:"defaultMethodId"},{default:t(()=>[a(x,{value:r.defaultMethodName,"onUpdate:value":e[11]||(e[11]=d=>r.defaultMethodName=d),placeholder:"关联检验方法"},null,8,["value"])]),_:1}),a(m,{label:"描述",name:"description"},{default:t(()=>[a(Ee,{value:r.description,"onUpdate:value":e[12]||(e[12]=d=>r.description=d),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),a(ae,{key:"phenomenon",tab:"关联不良现象"},{default:t(()=>[L("div",Xe,[a(i,{type:"dashed",block:"",onClick:xe},{default:t(()=>[a(_(ne)),e[38]||(e[38]=o(" 添加关联不良现象 ",-1))]),_:1})]),a(V,{columns:Te,"data-source":C.value,pagination:!1,size:"small","row-key":"id"},{bodyCell:t(({column:d,record:s,index:K})=>[d.key==="severity"?(f(),v(w,{key:0,color:X(s.severity)},{default:t(()=>[o(I(s.severity),1)]),_:2},1032,["color"])):d.key==="action"?(f(),v(N,{key:1},{default:t(()=>[a(i,{type:"link",size:"small",onClick:Oe=>Ce(s)},{default:t(()=>[...e[39]||(e[39]=[o("编辑",-1)])]),_:1},8,["onClick"]),a(i,{type:"link",danger:"",size:"small",onClick:Oe=>he(s.id)},{default:t(()=>[...e[40]||(e[40]=[o("移除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source"]),C.value.length===0?(f(),v(Ne,{key:0,description:"尚未关联任何不良现象，点击上方按钮添加"})):D("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["visible","title"]),a(le,{visible:O.value,"onUpdate:visible":e[15]||(e[15]=d=>O.value=d),title:"选择不良现象",width:"600px",onOk:Me},{default:t(()=>[a(V,{columns:we,"data-source":E.value,loading:G.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:U.value,onChange:De}},{bodyCell:t(({column:d,record:s})=>[d.key==="severity"?(f(),v(w,{key:0,color:X(s.severity)},{default:t(()=>[o(I(s.severity),1)]),_:2},1032,["color"])):D("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),ot=Qe(et,[["__scopeId","data-v-0456fd5c"]]);export{ot as default};
