import{a as M,r as k,m as fe,c as D,o as _,e as S,x as e,q as t,h as p,y as $,P as F,s,p as x,f as T,t as R,F as O,z as j,E as B,C}from"./index-CAjnGs0g.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"page-container"},ye={class:"page-header"},ke={class:"search-form"},Ce={__name:"IQCChecklist",setup(be){const m=M({inspectionNo:"",supplier:"",materialCode:"",status:""}),f=k([]),w=k(!1),g=M({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条数据`}),E=[{title:"检验单号",dataIndex:"inspectionNo",key:"inspectionNo",width:140},{title:"供应商",dataIndex:"supplier",key:"supplier"},{title:"物料编码",dataIndex:"materialCode",key:"materialCode",width:120},{title:"物料名称",dataIndex:"materialName",key:"materialName"},{title:"批次号",dataIndex:"batchNo",key:"batchNo",width:100},{title:"来料数量",dataIndex:"quantity",key:"quantity",width:100},{title:"检验状态",dataIndex:"status",key:"status",width:100},{title:"检验日期",dataIndex:"inspectionDate",key:"inspectionDate",width:120},{title:"检验员",dataIndex:"inspector",key:"inspector",width:100},{title:"操作",key:"action",width:200,fixed:"right"}],y=k(!1),b=k(!1),U=k(),n=M({id:null,inspectionNo:"",supplier:"",inspectionDate:null,materialCode:"",materialName:"",batchNo:"",quantity:null,sampleQuantity:null,inspector:"",items:[],conclusion:"passed",remark:"",status:"pending"}),H=k([{id:1,name:"供应商A"},{id:2,name:"供应商B"},{id:3,name:"供应商C"}]),P={supplier:[{required:!0,message:"请选择供应商",trigger:"change"}],inspectionDate:[{required:!0,message:"请选择检验日期",trigger:"change"}],materialCode:[{required:!0,message:"请输入物料编码",trigger:"blur"}],materialName:[{required:!0,message:"请输入物料名称",trigger:"blur"}],quantity:[{required:!0,message:"请输入来料数量",trigger:"blur"}],inspector:[{required:!0,message:"请输入检验员姓名",trigger:"blur"}],conclusion:[{required:!0,message:"请选择检验结论",trigger:"change"}]},V=[{id:1,inspectionNo:"IQC20240115001",supplier:"供应商A",inspectionDate:"2024-01-15",materialCode:"MAT001",materialName:"原材料A",batchNo:"BATCH001",quantity:1e3,sampleQuantity:50,inspector:"张三",status:"passed",conclusion:"passed",remark:"检验合格"},{id:2,inspectionNo:"IQC20240116001",supplier:"供应商B",inspectionDate:"2024-01-16",materialCode:"MAT002",materialName:"零部件B",batchNo:"BATCH002",quantity:500,sampleQuantity:25,inspector:"李四",status:"failed",conclusion:"failed",remark:"尺寸超差"},{id:3,inspectionNo:"IQC20240117001",supplier:"供应商C",inspectionDate:"2024-01-17",materialCode:"MAT003",materialName:"组件C",batchNo:"BATCH003",quantity:200,sampleQuantity:20,inspector:"王五",status:"pending",conclusion:"passed",remark:""}],J=o=>({pending:"orange",inspecting:"blue",passed:"green",failed:"red"})[o]||"default",L=o=>({pending:"待检验",inspecting:"检验中",passed:"合格",failed:"不合格"})[o]||o,h=()=>{w.value=!0,setTimeout(()=>{f.value=V,g.total=V.length,w.value=!1},500)},z=()=>{g.current=1,h()},G=()=>{m.inspectionNo="",m.supplier="",m.materialCode="",m.status="",z()},K=o=>{g.current=o.current,g.pageSize=o.pageSize,h()},W=()=>{b.value=!1,y.value=!0,I()},X=o=>{b.value=!0,y.value=!0,Object.assign(n,{...o,inspectionDate:o.inspectionDate?B(o.inspectionDate):null,items:o.items||[{name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""}]})},Z=o=>{C.info("查看功能开发中...")},ee=o=>{o.status="inspecting",C.success("已开始检验")},ae=o=>{const a=f.value.findIndex(c=>c.id===o);a>-1&&(f.value.splice(a,1),g.total--,C.success("删除成功"))},te=()=>{n.items.push({name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""})},le=o=>{n.items.length>1&&n.items.splice(o,1)},ne=async()=>{try{if(await U.value.validate(),b.value){const o=f.value.findIndex(a=>a.id===n.id);o>-1&&(f.value[o]={...n,inspectionDate:n.inspectionDate?n.inspectionDate.format("YYYY-MM-DD"):null}),C.success("更新成功")}else{const o=Math.max(...f.value.map(r=>r.id))+1,a=`IQC${B().format("YYYYMMDD")}${String(o).padStart(3,"0")}`,c={...n,id:o,inspectionNo:a,inspectionDate:n.inspectionDate?n.inspectionDate.format("YYYY-MM-DD"):B().format("YYYY-MM-DD"),status:"pending"};f.value.unshift(c),g.total++,C.success("创建成功")}y.value=!1,I()}catch(o){console.error("表单验证失败:",o)}},oe=()=>{y.value=!1,I()},I=()=>{var o;Object.assign(n,{id:null,inspectionNo:"",supplier:"",inspectionDate:null,materialCode:"",materialName:"",batchNo:"",quantity:null,sampleQuantity:null,inspector:"",items:[{name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""}],conclusion:"passed",remark:"",status:"pending"}),(o=U.value)==null||o.resetFields()};return fe(()=>{h()}),(o,a)=>{const c=s("a-button"),r=s("a-input"),i=s("a-form-item"),q=s("a-select"),A=s("a-form"),se=s("a-tag"),ie=s("a-popconfirm"),ue=s("a-space"),de=s("a-table"),u=s("a-col"),re=s("a-select-option"),pe=s("a-date-picker"),N=s("a-row"),Q=s("a-input-number"),Y=s("a-radio"),me=s("a-radio-group"),ce=s("a-textarea"),ve=s("a-modal");return _(),D("div",ge,[S("div",ye,[a[17]||(a[17]=S("h1",null,"来料检验单(IQC)",-1)),e(c,{type:"primary",onClick:W},{icon:t(()=>[e($(F))]),default:t(()=>[a[16]||(a[16]=p(" 新建检验单 ",-1))]),_:1})]),S("div",ke,[e(A,{layout:"inline",model:m},{default:t(()=>[e(i,{label:"检验单号"},{default:t(()=>[e(r,{value:m.inspectionNo,"onUpdate:value":a[0]||(a[0]=l=>m.inspectionNo=l),placeholder:"请输入检验单号"},null,8,["value"])]),_:1}),e(i,{label:"供应商"},{default:t(()=>[e(r,{value:m.supplier,"onUpdate:value":a[1]||(a[1]=l=>m.supplier=l),placeholder:"请输入供应商名称"},null,8,["value"])]),_:1}),e(i,{label:"物料编码"},{default:t(()=>[e(r,{value:m.materialCode,"onUpdate:value":a[2]||(a[2]=l=>m.materialCode=l),placeholder:"请输入物料编码"},null,8,["value"])]),_:1}),e(i,{label:"检验状态"},{default:t(()=>[e(q,{value:m.status,"onUpdate:value":a[3]||(a[3]=l=>m.status=l),placeholder:"请选择检验状态",style:{width:"120px"},options:[{value:"pending",label:"待检验"},{value:"inspecting",label:"检验中"},{value:"passed",label:"合格"},{value:"failed",label:"不合格"}]},null,8,["value"])]),_:1}),e(i,null,{default:t(()=>[e(c,{type:"primary",onClick:z},{default:t(()=>[...a[18]||(a[18]=[p("查询",-1)])]),_:1}),e(c,{style:{"margin-left":"8px"},onClick:G},{default:t(()=>[...a[19]||(a[19]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(de,{columns:E,"data-source":f.value,pagination:g,loading:w.value,onChange:K,"row-key":"id"},{bodyCell:t(({column:l,record:v})=>[l.key==="status"?(_(),x(se,{key:0,color:J(v.status)},{default:t(()=>[p(R(L(v.status)),1)]),_:2},1032,["color"])):T("",!0),l.key==="action"?(_(),x(ue,{key:1},{default:t(()=>[e(c,{type:"link",size:"small",onClick:d=>X(v)},{default:t(()=>[...a[20]||(a[20]=[p("编辑",-1)])]),_:1},8,["onClick"]),e(c,{type:"link",size:"small",onClick:d=>Z(v)},{default:t(()=>[...a[21]||(a[21]=[p("查看",-1)])]),_:1},8,["onClick"]),v.status==="pending"?(_(),x(c,{key:0,type:"link",size:"small",onClick:d=>ee(v)},{default:t(()=>[...a[22]||(a[22]=[p(" 开始检验 ",-1)])]),_:1},8,["onClick"])):T("",!0),e(ie,{title:"确定要删除这个检验单吗？",onConfirm:d=>ae(v.id)},{default:t(()=>[e(c,{type:"link",size:"small",danger:""},{default:t(()=>[...a[23]||(a[23]=[p("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):T("",!0)]),_:1},8,["data-source","pagination","loading"]),e(ve,{visible:y.value,"onUpdate:visible":a[15]||(a[15]=l=>y.value=l),title:b.value?"编辑检验单":"新建检验单",width:"1000px",onOk:ne,onCancel:oe},{default:t(()=>[e(A,{ref_key:"formRef",ref:U,model:n,rules:P,layout:"vertical"},{default:t(()=>[e(N,{gutter:16},{default:t(()=>[e(u,{span:8},{default:t(()=>[e(i,{label:"检验单号",name:"inspectionNo"},{default:t(()=>[e(r,{value:n.inspectionNo,"onUpdate:value":a[4]||(a[4]=l=>n.inspectionNo=l),placeholder:"系统自动生成",disabled:""},null,8,["value"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(i,{label:"供应商",name:"supplier"},{default:t(()=>[e(q,{value:n.supplier,"onUpdate:value":a[5]||(a[5]=l=>n.supplier=l),placeholder:"请选择供应商","show-search":""},{default:t(()=>[(_(!0),D(O,null,j(H.value,l=>(_(),x(re,{key:l.id,value:l.name},{default:t(()=>[p(R(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(i,{label:"检验日期",name:"inspectionDate"},{default:t(()=>[e(pe,{value:n.inspectionDate,"onUpdate:value":a[6]||(a[6]=l=>n.inspectionDate=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(N,{gutter:16},{default:t(()=>[e(u,{span:8},{default:t(()=>[e(i,{label:"物料编码",name:"materialCode"},{default:t(()=>[e(r,{value:n.materialCode,"onUpdate:value":a[7]||(a[7]=l=>n.materialCode=l),placeholder:"请输入物料编码"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(i,{label:"物料名称",name:"materialName"},{default:t(()=>[e(r,{value:n.materialName,"onUpdate:value":a[8]||(a[8]=l=>n.materialName=l),placeholder:"请输入物料名称"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(i,{label:"批次号",name:"batchNo"},{default:t(()=>[e(r,{value:n.batchNo,"onUpdate:value":a[9]||(a[9]=l=>n.batchNo=l),placeholder:"请输入批次号"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(N,{gutter:16},{default:t(()=>[e(u,{span:8},{default:t(()=>[e(i,{label:"来料数量",name:"quantity"},{default:t(()=>[e(Q,{value:n.quantity,"onUpdate:value":a[10]||(a[10]=l=>n.quantity=l),placeholder:"请输入来料数量",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(i,{label:"抽样数量",name:"sampleQuantity"},{default:t(()=>[e(Q,{value:n.sampleQuantity,"onUpdate:value":a[11]||(a[11]=l=>n.sampleQuantity=l),placeholder:"请输入抽样数量",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(u,{span:8},{default:t(()=>[e(i,{label:"检验员",name:"inspector"},{default:t(()=>[e(r,{value:n.inspector,"onUpdate:value":a[12]||(a[12]=l=>n.inspector=l),placeholder:"请输入检验员姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(i,{label:"检验项目",name:"items"},{default:t(()=>[(_(!0),D(O,null,j(n.items,(l,v)=>(_(),D("div",{key:v,class:"inspection-item"},[e(N,{gutter:8},{default:t(()=>[e(u,{span:4},{default:t(()=>[e(r,{value:l.name,"onUpdate:value":d=>l.name=d,placeholder:"检验项目"},null,8,["value","onUpdate:value"])]),_:2},1024),e(u,{span:4},{default:t(()=>[e(r,{value:l.standard,"onUpdate:value":d=>l.standard=d,placeholder:"标准值"},null,8,["value","onUpdate:value"])]),_:2},1024),e(u,{span:3},{default:t(()=>[e(r,{value:l.unit,"onUpdate:value":d=>l.unit=d,placeholder:"单位"},null,8,["value","onUpdate:value"])]),_:2},1024),e(u,{span:3},{default:t(()=>[e(Q,{value:l.actualValue,"onUpdate:value":d=>l.actualValue=d,placeholder:"实测值",style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024),e(u,{span:3},{default:t(()=>[e(q,{value:l.result,"onUpdate:value":d=>l.result=d,placeholder:"结果",options:[{value:"pass",label:"合格"},{value:"fail",label:"不合格"}]},null,8,["value","onUpdate:value"])]),_:2},1024),e(u,{span:5},{default:t(()=>[e(r,{value:l.remark,"onUpdate:value":d=>l.remark=d,placeholder:"备注"},null,8,["value","onUpdate:value"])]),_:2},1024),e(u,{span:2},{default:t(()=>[e(c,{type:"text",danger:"",onClick:d=>le(v)},{default:t(()=>[...a[24]||(a[24]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),e(c,{type:"dashed",onClick:te,style:{width:"100%","margin-top":"8px"}},{icon:t(()=>[e($(F))]),default:t(()=>[a[25]||(a[25]=p(" 添加检验项目 ",-1))]),_:1})]),_:1}),e(i,{label:"检验结论",name:"conclusion"},{default:t(()=>[e(me,{value:n.conclusion,"onUpdate:value":a[13]||(a[13]=l=>n.conclusion=l)},{default:t(()=>[e(Y,{value:"passed"},{default:t(()=>[...a[26]||(a[26]=[p("合格",-1)])]),_:1}),e(Y,{value:"failed"},{default:t(()=>[...a[27]||(a[27]=[p("不合格",-1)])]),_:1}),e(Y,{value:"conditional"},{default:t(()=>[...a[28]||(a[28]=[p("有条件接收",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(i,{label:"备注",name:"remark"},{default:t(()=>[e(ce,{value:n.remark,"onUpdate:value":a[14]||(a[14]=l=>n.remark=l),rows:3,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}},xe=_e(Ce,[["__scopeId","data-v-f3271d4b"]]);export{xe as default};
