import{d as le,r as _,a as E,m as se,c as oe,e as L,x as t,q as a,s as i,o as g,h as l,y as v,P as ie,G as de,I as ue,R as re,p as O,f as D,t as pe,Y as me,u as fe,C as p,M as P}from"./index-BsO03Xlk.js";import{E as ve}from"./ExportOutlined-3X2_SK8n.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"page-container"},_e={class:"toolbar"},ke={class:"table-container"},Ce=le({__name:"InspTemplateList",setup(be){const w=fe(),T=_(!1),r=_([]),m=_([]),x=_(!1),V=_([]),s=E({code:"",name:"",status:void 0,version:""}),c=E({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),R=[{title:"模板编码",dataIndex:"code",key:"code",width:150},{title:"模板名称",dataIndex:"name",key:"name",width:200},{title:"版本",dataIndex:"version",key:"version",width:80},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"检验类型",dataIndex:"inspType",key:"inspType",width:100},{title:"明细数",dataIndex:"detailCount",key:"detailCount",width:80},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:160},{title:"操作",key:"action",width:200,fixed:"right"}],B=[{title:"版本",dataIndex:"version",key:"version",width:80},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"更新人",dataIndex:"updater",key:"updater",width:100},{title:"操作",key:"action",width:80}],U=n=>({Draft:"default",Pending:"processing",Approved:"success",Obsolete:"error"})[n]||"default",Q=n=>({Draft:"草稿",Pending:"审批中",Approved:"已批准",Obsolete:"作废"})[n]||n,k=()=>{T.value=!0,setTimeout(()=>{let n=[{id:"1",code:"TPL-IQC-001",name:"IQC原材料检验模板",version:"V1.0",status:"Approved",inspType:"IQC",detailCount:5,updateTime:"2026-01-10 10:00"},{id:"2",code:"TPL-IPQC-001",name:"IPQC过程检验模板",version:"V2.0",status:"Draft",inspType:"IPQC",detailCount:8,updateTime:"2026-01-12 14:30"},{id:"3",code:"TPL-FQC-001",name:"FQC成品检验模板",version:"V1.0",status:"Pending",inspType:"FQC",detailCount:10,updateTime:"2026-01-11 09:15"},{id:"4",code:"TPL-OQC-001",name:"OQC出货检验模板",version:"V1.0",status:"Obsolete",inspType:"OQC",detailCount:6,updateTime:"2025-12-20 16:00"}];s.code&&(n=n.filter(e=>e.code.includes(s.code))),s.name&&(n=n.filter(e=>e.name.includes(s.name))),s.status&&(n=n.filter(e=>e.status===s.status)),s.version&&(n=n.filter(e=>e.version.includes(s.version))),r.value=n,c.total=n.length,T.value=!1},300)},$=()=>{c.current=1,k()},N=()=>{s.code="",s.name="",s.status=void 0,s.version="",$()},F=n=>{c.current=n.current,c.pageSize=n.pageSize,k()},q=n=>{m.value=n},K=()=>{w.push("/inspection-model/insp-templates/create")},G=n=>{w.push(`/inspection-model/insp-templates/view/${n.id}`)},h=n=>{const e=n!=null&&n.id?n:r.value.find(o=>o.id===m.value[0]);if(e){if(e.status!=="Draft"){p.warning("只有草稿状态的模板可以编辑");return}w.push(`/inspection-model/insp-templates/edit/${e.id}`)}},H=()=>{const n=r.value.filter(e=>m.value.includes(e.id)&&e.status==="Draft");if(n.length===0){p.warning("只有草稿状态的模板可以删除");return}P.confirm({title:"确认删除",content:`确定删除选中的 ${n.length} 条草稿模板吗？`,okType:"danger",onOk(){r.value=r.value.filter(e=>!n.map(o=>o.id).includes(e.id)),m.value=[],p.success("删除成功")}})},J=(n,e)=>{if(e==="history"){V.value=[{id:"h1",version:"V1.0",status:"Approved",updateTime:"2025-12-01 10:00",updater:"张三"},{id:"h2",version:"V0.9",status:"Obsolete",updateTime:"2025-11-15 14:00",updater:"李四"}],x.value=!0;return}if(e==="copy"){p.success(`模板 ${n.code} 已复制`);return}if(e==="delete"){P.confirm({title:"确认删除",content:`确定删除模板 ${n.name} 吗？`,okType:"danger",onOk(){r.value=r.value.filter(o=>o.id!==n.id),p.success("删除成功")}});return}P.confirm({title:"确认操作",content:`确定将模板 ${n.name} 的状态变更为 ${Q(e)} 吗？`,onOk(){n.status=e,p.success("状态变更成功")}})},Y=n=>{p.info(`查看历史版本: ${n.version}`)},j=()=>{p.success("导出任务已开始")};return se(()=>{k()}),(n,e)=>{const o=i("a-button"),z=i("a-space"),I=i("a-input"),y=i("a-form-item"),C=i("a-select-option"),W=i("a-select"),X=i("a-form"),Z=i("a-card"),ee=i("a-tag"),S=i("a-divider"),f=i("a-menu-item"),M=i("a-menu-divider"),te=i("a-menu"),ae=i("a-dropdown"),A=i("a-table"),ne=i("a-modal");return g(),oe("div",ye,[L("div",_e,[t(z,null,{default:a(()=>[t(o,{type:"primary",onClick:K},{icon:a(()=>[t(v(ie))]),default:a(()=>[e[5]||(e[5]=l("新增 ",-1))]),_:1}),t(o,{disabled:m.value.length!==1,onClick:h},{icon:a(()=>[t(v(de))]),default:a(()=>[e[6]||(e[6]=l("编辑 ",-1))]),_:1},8,["disabled"]),t(o,{danger:"",disabled:m.value.length===0,onClick:H},{icon:a(()=>[t(v(ue))]),default:a(()=>[e[7]||(e[7]=l("删除 ",-1))]),_:1},8,["disabled"]),t(o,{onClick:j},{icon:a(()=>[t(v(ve))]),default:a(()=>[e[8]||(e[8]=l("导出 ",-1))]),_:1}),t(o,{onClick:k},{icon:a(()=>[t(v(re))]),default:a(()=>[e[9]||(e[9]=l("刷新 ",-1))]),_:1})]),_:1})]),t(Z,{class:"search-card",bordered:!1},{default:a(()=>[t(X,{layout:"inline",model:s},{default:a(()=>[t(y,{label:"模板编码"},{default:a(()=>[t(I,{value:s.code,"onUpdate:value":e[0]||(e[0]=d=>s.code=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(y,{label:"模板名称"},{default:a(()=>[t(I,{value:s.name,"onUpdate:value":e[1]||(e[1]=d=>s.name=d),placeholder:"请输入","allow-clear":""},null,8,["value"])]),_:1}),t(y,{label:"状态"},{default:a(()=>[t(W,{value:s.status,"onUpdate:value":e[2]||(e[2]=d=>s.status=d),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(C,{value:"Draft"},{default:a(()=>[...e[10]||(e[10]=[l("草稿",-1)])]),_:1}),t(C,{value:"Pending"},{default:a(()=>[...e[11]||(e[11]=[l("审批中",-1)])]),_:1}),t(C,{value:"Approved"},{default:a(()=>[...e[12]||(e[12]=[l("已批准",-1)])]),_:1}),t(C,{value:"Obsolete"},{default:a(()=>[...e[13]||(e[13]=[l("作废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(y,{label:"版本"},{default:a(()=>[t(I,{value:s.version,"onUpdate:value":e[3]||(e[3]=d=>s.version=d),placeholder:"如：V1.0","allow-clear":"",style:{width:"100px"}},null,8,["value"])]),_:1}),t(y,null,{default:a(()=>[t(o,{type:"primary",onClick:$},{default:a(()=>[...e[14]||(e[14]=[l("查询",-1)])]),_:1}),t(o,{style:{"margin-left":"8px"},onClick:N},{default:a(()=>[...e[15]||(e[15]=[l("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),L("div",ke,[t(A,{columns:R,"data-source":r.value,loading:T.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:m.value,onChange:q},pagination:c,onChange:F},{bodyCell:a(({column:d,record:u})=>[d.key==="status"?(g(),O(ee,{key:0,color:U(u.status)},{default:a(()=>[l(pe(Q(u.status)),1)]),_:2},1032,["color"])):D("",!0),d.key==="action"?(g(),O(z,{key:1},{default:a(()=>[t(o,{type:"link",size:"small",onClick:b=>G(u)},{default:a(()=>[...e[16]||(e[16]=[l("查看",-1)])]),_:1},8,["onClick"]),t(S,{type:"vertical"}),t(o,{type:"link",size:"small",onClick:b=>h(u),disabled:u.status!=="Draft"},{default:a(()=>[...e[17]||(e[17]=[l("编辑",-1)])]),_:1},8,["onClick","disabled"]),t(S,{type:"vertical"}),t(ae,null,{overlay:a(()=>[t(te,{onClick:b=>J(u,b.key)},{default:a(()=>[t(f,{key:"Pending",disabled:u.status!=="Draft"},{default:a(()=>[...e[19]||(e[19]=[l("提交审批",-1)])]),_:1},8,["disabled"]),t(f,{key:"Approved",disabled:u.status!=="Pending"},{default:a(()=>[...e[20]||(e[20]=[l("审批通过",-1)])]),_:1},8,["disabled"]),t(f,{key:"Obsolete",disabled:u.status==="Obsolete"},{default:a(()=>[...e[21]||(e[21]=[l("作废",-1)])]),_:1},8,["disabled"]),t(M),t(f,{key:"history"},{default:a(()=>[...e[22]||(e[22]=[l("查看历史版本",-1)])]),_:1}),t(f,{key:"copy"},{default:a(()=>[...e[23]||(e[23]=[l("复制模板",-1)])]),_:1}),t(M),t(f,{key:"delete",danger:"",disabled:u.status!=="Draft"},{default:a(()=>[...e[24]||(e[24]=[l("删除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onClick"])]),default:a(()=>[t(o,{type:"link",size:"small"},{default:a(()=>[e[18]||(e[18]=l(" 更多 ",-1)),t(v(me))]),_:1})]),_:2},1024)]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(ne,{visible:x.value,"onUpdate:visible":e[4]||(e[4]=d=>x.value=d),title:"历史版本",width:"700px",footer:null},{default:a(()=>[t(A,{columns:B,"data-source":V.value,pagination:!1,size:"small"},{bodyCell:a(({column:d,record:u})=>[d.key==="action"?(g(),O(o,{key:0,type:"link",size:"small",onClick:b=>Y(u)},{default:a(()=>[...e[25]||(e[25]=[l("查看",-1)])]),_:1},8,["onClick"])):D("",!0)]),_:1},8,["data-source"])]),_:1},8,["visible"])])}}}),xe=ce(Ce,[["__scopeId","data-v-40213533"]]);export{xe as default};
