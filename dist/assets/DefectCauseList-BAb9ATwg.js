import{d as ce,r,k as re,a as B,m as pe,c as me,e as o,x as a,q as t,s,t as P,o as h,y as F,R as ve,p as U,h as d,P as fe,f as _e,u as ye,M as j,C as E}from"./index-BsO03Xlk.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"page-container"},ke={class:"split-layout"},be={class:"left-panel"},he={class:"panel-header"},Me={class:"tree-container"},Ne={class:"node-title"},we={class:"right-panel"},Te={class:"right-header"},xe={class:"header-info"},Ke={class:"category-title"},Ue={class:"header-actions"},Ee={class:"search-box"},Se={class:"table-container"},De=ce({__name:"DefectCauseList",setup(Re){const M=ye(),N=r(!1),k=r([]),v=r([]),S=r([]),D=re(()=>{if(v.value.length===0)return null;const n=(e,c)=>{for(const _ of e){if(_.id===c)return _;if(_.children){const C=n(_.children,c);if(C)return C}}return null};return n(k.value,v.value[0])}),R=()=>{N.value=!0,setTimeout(()=>{k.value=[{id:"Man",name:"人 (Man)",children:[]},{id:"Machine",name:"机 (Machine)",children:[]},{id:"Material",name:"料 (Material)",children:[]},{id:"Method",name:"法 (Method)",children:[]},{id:"Environment",name:"环 (Environment)",children:[]}],N.value=!1},300)},J=n=>{y()},w=r(!1),p=r([]),f=r([]),u=B({causeCode:"",causeName:""}),Q=[{title:"原因代码",dataIndex:"causeCode",key:"causeCode",width:120},{title:"原因名称",dataIndex:"causeName",key:"causeName",width:200},{title:"原因类别",dataIndex:"causeType",key:"causeType",width:120},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:150}],y=()=>{w.value=!0,setTimeout(()=>{let n=[{id:1,causeCode:"C-MAN-001",causeName:"操作不当",causeType:"Man",description:"员工未按SOP操作"},{id:2,causeCode:"C-MAC-001",causeName:"设备故障",causeType:"Machine",description:"主轴跳动过大"},{id:3,causeCode:"C-MAT-001",causeName:"原料杂质",causeType:"Material",description:"供应商来料含杂质"}];v.value.length>0&&(n=n.filter(e=>e.causeType===v.value[0])),u.causeCode&&(n=n.filter(e=>e.causeCode.toLowerCase().includes(u.causeCode.toLowerCase()))),u.causeName&&(n=n.filter(e=>e.causeName.includes(u.causeName))),p.value=n,w.value=!1},300)},G=()=>{u.causeCode="",u.causeName="",y()},H=n=>{f.value=n},T=r(!1),$=r(!1),O=r("basic"),z=r(),i=B({id:null,causeCode:"",causeName:"",causeType:"Man",description:""}),W={causeCode:[{required:!0,message:"请输入原因代码",trigger:"blur"}],causeName:[{required:!0,message:"请输入原因名称",trigger:"blur"}],causeType:[{required:!0,message:"请选择原因类别",trigger:"change"}]},X=()=>{M.push("/inspection-model/defect-causes/create")},Y=n=>{M.push(`/inspection-model/defect-causes/view/${n.id}`)},Z=n=>{M.push(`/inspection-model/defect-causes/edit/${n.id}`)},ee=n=>{j.confirm({title:"确认删除",content:`确定删除原因 ${n.causeName} 吗？`,okType:"danger",onOk(){p.value=p.value.filter(e=>e.id!==n.id),E.success("删除成功")}})},ae=()=>{j.confirm({title:"确认删除",content:`确定删除选中的 ${f.value.length} 条记录吗？`,okType:"danger",onOk(){p.value=p.value.filter(n=>!f.value.includes(n.id)),f.value=[],E.success("删除成功")}})},te=()=>{z.value.validate().then(()=>{if($.value){const n=p.value.findIndex(e=>e.id===i.id);n>-1&&Object.assign(p.value[n],i)}else p.value.push({...i,id:Date.now()});E.success("保存成功"),T.value=!1,y()})};return pe(()=>{R(),y()}),(n,e)=>{const c=s("a-button"),_=s("a-tooltip"),C=s("a-space"),ne=s("a-tree"),A=s("a-empty"),le=s("a-spin"),b=s("a-input"),m=s("a-form-item"),I=s("a-form"),se=s("a-table"),x=s("a-col"),L=s("a-row"),g=s("a-select-option"),oe=s("a-select"),ie=s("a-textarea"),V=s("a-tab-pane"),de=s("a-tabs"),ue=s("a-modal");return h(),me("div",ge,[o("div",ke,[o("div",be,[o("div",he,[e[10]||(e[10]=o("span",{class:"panel-title"},"不良原因分类",-1)),a(C,null,{default:t(()=>[a(_,{title:"刷新"},{default:t(()=>[a(c,{size:"small",shape:"circle",onClick:R},{icon:t(()=>[a(F(ve))]),_:1})]),_:1})]),_:1})]),o("div",Me,[a(le,{spinning:N.value},{default:t(()=>[k.value.length>0?(h(),U(ne,{key:0,selectedKeys:v.value,"onUpdate:selectedKeys":e[0]||(e[0]=l=>v.value=l),expandedKeys:S.value,"onUpdate:expandedKeys":e[1]||(e[1]=l=>S.value=l),"tree-data":k.value,"field-names":{children:"children",title:"name",key:"id"},"block-node":"",onSelect:J},{title:t(({name:l})=>[o("span",Ne,P(l),1)]),_:1},8,["selectedKeys","expandedKeys","tree-data"])):(h(),U(A,{key:1,description:"暂无分类数据",class:"empty-state"}))]),_:1},8,["spinning"])])]),o("div",we,[o("div",Te,[o("div",xe,[o("div",Ke,P(D.value?D.value.name:"全部原因"),1)]),o("div",Ue,[a(c,{type:"primary",onClick:X},{icon:t(()=>[a(F(fe))]),default:t(()=>[e[11]||(e[11]=d(" 新增原因 ",-1))]),_:1}),a(c,{danger:"",disabled:f.value.length===0,onClick:ae},{default:t(()=>[...e[12]||(e[12]=[d(" 批量删除 ",-1)])]),_:1},8,["disabled"])])]),o("div",Ee,[a(I,{layout:"inline",model:u},{default:t(()=>[a(m,{label:"原因代码"},{default:t(()=>[a(b,{value:u.causeCode,"onUpdate:value":e[2]||(e[2]=l=>u.causeCode=l),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),a(m,{label:"原因名称"},{default:t(()=>[a(b,{value:u.causeName,"onUpdate:value":e[3]||(e[3]=l=>u.causeName=l),placeholder:"模糊搜索","allow-clear":""},null,8,["value"])]),_:1}),a(m,null,{default:t(()=>[a(c,{type:"primary",onClick:y},{default:t(()=>[...e[13]||(e[13]=[d("查询",-1)])]),_:1}),a(c,{style:{"margin-left":"8px"},onClick:G},{default:t(()=>[...e[14]||(e[14]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),o("div",Se,[a(se,{columns:Q,"data-source":p.value,loading:w.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:f.value,onChange:H},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`}},{bodyCell:t(({column:l,record:K})=>[l.key==="action"?(h(),U(C,{key:0},{default:t(()=>[a(c,{type:"link",size:"small",onClick:q=>Y(K)},{default:t(()=>[...e[15]||(e[15]=[d("查看",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",size:"small",onClick:q=>Z(K)},{default:t(()=>[...e[16]||(e[16]=[d("编辑",-1)])]),_:1},8,["onClick"]),a(c,{type:"link",danger:"",size:"small",onClick:q=>ee(K)},{default:t(()=>[...e[17]||(e[17]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):_e("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])]),a(ue,{visible:T.value,"onUpdate:visible":e[9]||(e[9]=l=>T.value=l),title:$.value?"编辑不良原因":"新增不良原因",width:"600px",onOk:te},{default:t(()=>[a(de,{activeKey:O.value,"onUpdate:activeKey":e[8]||(e[8]=l=>O.value=l)},{default:t(()=>[a(V,{key:"basic",tab:"基本信息"},{default:t(()=>[a(I,{ref_key:"formRef",ref:z,model:i,layout:"vertical",rules:W},{default:t(()=>[a(L,{gutter:16},{default:t(()=>[a(x,{span:12},{default:t(()=>[a(m,{label:"原因代码",name:"causeCode"},{default:t(()=>[a(b,{value:i.causeCode,"onUpdate:value":e[4]||(e[4]=l=>i.causeCode=l),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),a(x,{span:12},{default:t(()=>[a(m,{label:"原因名称",name:"causeName"},{default:t(()=>[a(b,{value:i.causeName,"onUpdate:value":e[5]||(e[5]=l=>i.causeName=l),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(L,{gutter:16},{default:t(()=>[a(x,{span:12},{default:t(()=>[a(m,{label:"原因类别",name:"causeType"},{default:t(()=>[a(oe,{value:i.causeType,"onUpdate:value":e[6]||(e[6]=l=>i.causeType=l)},{default:t(()=>[a(g,{value:"Man"},{default:t(()=>[...e[18]||(e[18]=[d("人 (Man)",-1)])]),_:1}),a(g,{value:"Machine"},{default:t(()=>[...e[19]||(e[19]=[d("机 (Machine)",-1)])]),_:1}),a(g,{value:"Material"},{default:t(()=>[...e[20]||(e[20]=[d("料 (Material)",-1)])]),_:1}),a(g,{value:"Method"},{default:t(()=>[...e[21]||(e[21]=[d("法 (Method)",-1)])]),_:1}),a(g,{value:"Environment"},{default:t(()=>[...e[22]||(e[22]=[d("环 (Environment)",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(m,{label:"描述",name:"description"},{default:t(()=>[a(ie,{value:i.description,"onUpdate:value":e[7]||(e[7]=l=>i.description=l),rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),a(V,{key:"fmea",tab:"FMEA关联"},{default:t(()=>[a(A,{description:"FMEA关联功能将在后续阶段实现"})]),_:1})]),_:1},8,["activeKey"])]),_:1},8,["visible","title"])])}}}),ze=Ce(De,[["__scopeId","data-v-6483cadb"]]);export{ze as default};
