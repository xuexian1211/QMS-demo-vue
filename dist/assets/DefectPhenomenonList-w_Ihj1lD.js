import{d as je,r as u,a as te,k as L,m as qe,c as ae,e as r,x as t,q as a,s as c,t as b,o as m,y as w,P as V,R as Fe,S as Be,p as h,w as le,G as We,I as Qe,h as i,f as j,M as oe,C}from"./index-CAjnGs0g.js";import{u as Ge}from"./excel-B07CBqJs.js";import{_ as He}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Je={class:"page-container"},Xe={class:"split-layout"},Ye={class:"left-panel"},Ze={class:"panel-header"},et={class:"search-box"},tt={class:"tree-container"},at={class:"tree-node-content"},lt={class:"node-title"},ot={class:"node-actions"},nt={class:"right-panel"},st={key:0,class:"empty-selection"},it={key:1,class:"content-wrapper"},dt={class:"right-header"},ut={class:"header-info"},rt={class:"category-title"},ct={class:"category-meta"},pt={class:"desc"},vt={class:"header-actions"},yt={class:"search-box"},mt={class:"table-container"},ft={style:{"margin-bottom":"12px"}},Ct=je({__name:"DefectPhenomenonList",setup(gt){const q=u(!1),ne=u([]),F=u(""),N=u([]),B=u([]),W=u(!1),y=u([]),T=u([]),d=te({code:"",name:"",severity:void 0,processType:""}),D=L(()=>{let l=y.value;return d.code&&(l=l.filter(e=>{var n;return(n=e.code)==null?void 0:n.toLowerCase().includes(d.code.toLowerCase())})),d.name&&(l=l.filter(e=>{var n;return(n=e.name)==null?void 0:n.toLowerCase().includes(d.name.toLowerCase())})),d.severity&&(l=l.filter(e=>e.severity===d.severity)),d.processType&&(l=l.filter(e=>{var n;return(n=e.processType)==null?void 0:n.toLowerCase().includes(d.processType.toLowerCase())})),l}),x=u(!1),Q=u(!1),g=te({id:null,parentId:null,categoryCode:"",categoryName:"",description:""}),U=u("根节点"),P=u(!1),O=u(!1),s=te({id:null,code:"",name:"",severity:"MI",processType:"",description:""}),S=L(()=>ne.value),pe=L(()=>(F.value,S.value)),I=L(()=>{if(N.value.length===0)return null;const l=(e,n)=>{for(const _ of e){if(_.id===n)return _;if(_.children){const A=l(_.children,n);if(A)return A}}return null};return l(S.value,N.value[0])}),E=()=>{q.value=!0,setTimeout(()=>{ne.value=[{id:1,categoryCode:"DCAT-APP",categoryName:"外观缺陷",parentId:null,description:"产品表面相关缺陷",children:[{id:11,categoryCode:"DCAT-APP-CAST",categoryName:"铸造外观",parentId:1,description:"铸造特有"},{id:12,categoryCode:"DCAT-APP-MACH",categoryName:"机加外观",parentId:1,description:"机加特有"}]},{id:2,categoryCode:"DCAT-DIM",categoryName:"尺寸缺陷",parentId:null,description:"尺寸公差超差",children:[]},{id:3,categoryCode:"DCAT-FUNC",categoryName:"性能缺陷",parentId:null,description:"功能测试失效",children:[]}],B.value=[1],q.value=!1},500)},ve=l=>{l.length>0?ke(l[0]):y.value=[]},ye=()=>{Q.value=!1,U.value="根分类",Object.assign(g,{id:null,parentId:null,categoryCode:"",categoryName:"",description:""}),z.value="新增缺陷分类",x.value=!0},me=l=>{Q.value=!1,U.value=l.categoryName,Object.assign(g,{id:null,parentId:l.id,categoryCode:"",categoryName:"",description:""}),z.value="新增子缺陷分类",x.value=!0},fe=l=>{Q.value=!0,U.value=l.parentId?"上级分类ID:"+l.parentId:"根分类",Object.assign(g,{...l}),z.value="编辑缺陷分类",x.value=!0},Ce=l=>{oe.confirm({title:"确认删除",content:`确定删除分类 ${l.categoryName} 及其所有子类吗？`,okType:"danger",onOk(){C.success("分类已删除"),E(),N.value=[],D.value=[]}})},z=u(""),ge=()=>{C.success("分类保存成功"),x.value=!1,E()},_e=[{title:"现象代码",dataIndex:"code",key:"code",width:120},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",dataIndex:"severity",key:"severity",width:100},{title:"适用工序",dataIndex:"processType",key:"processType",width:150},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:150}],ke=l=>{W.value=!0,setTimeout(()=>{l===1||l===11?y.value=[{id:101,code:"DEF-001",name:"表面划伤",severity:"MI",processType:"全工序",description:"可见划痕"},{id:102,code:"DEF-002",name:"气孔",severity:"MA",processType:"压铸",description:"表面密集气孔"}]:l===2?y.value=[{id:201,code:"DIM-001",name:"长度超差",severity:"MA",processType:"机加",description:""}]:y.value=[],W.value=!1},300)},he=l=>{T.value=l},we=()=>{O.value=!1,Object.assign(s,{id:null,code:"",name:"",severity:"MI",processType:"",description:""}),P.value=!0},be=l=>{O.value=!0,Object.assign(s,{...l}),P.value=!0},Te=l=>{oe.confirm({title:"确认删除",content:`确定删除不良现象 ${l.name} 吗？`,okType:"danger",onOk(){y.value=y.value.filter(e=>e.id!==l.id),C.success("删除成功")}})},xe=()=>{oe.confirm({title:"确认批量删除",content:`确定删除选中的 ${T.value.length} 条记录吗？`,okType:"danger",onOk(){y.value=y.value.filter(l=>!T.value.includes(l.id)),T.value=[],C.success("批量删除成功")}})},Ie=()=>{if(!s.code||!s.name){C.warn("请填写必填项");return}if(O.value){const l=y.value.findIndex(e=>e.id===s.id);l!==-1&&Object.assign(y.value[l],{...s})}else y.value.push({...s,id:Date.now()});C.success("保存成功"),P.value=!1},Me=()=>{var n;if(D.value.length===0){C.warning("暂无数据可导出");return}const l=[{title:"现象代码",dataIndex:"code"},{title:"现象名称",dataIndex:"name"},{title:"严重等级",dataIndex:"severity"},{title:"适用工序",dataIndex:"processType"},{title:"描述",dataIndex:"description"}],{exportToCSV:e}=Ge();e(D.value,l,`不良现象_${((n=I.value)==null?void 0:n.categoryName)||"导出"}`),C.success("导出成功")},Ne=()=>{C.success("查询完成")},Pe=()=>{d.code="",d.name="",d.severity=void 0,d.processType="",C.success("已重置查询条件")},K=u(!1),G=u(!1),se=u([]),R=u([]),H=u([]),Ae=[{title:"原因代码",dataIndex:"causeCode",key:"causeCode",width:120},{title:"原因名称",dataIndex:"causeName",key:"causeName",width:150},{title:"原因类别",key:"causeType",width:100},{title:"权重",key:"weight",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],De=[{title:"原因代码",dataIndex:"causeCode",key:"causeCode",width:100},{title:"原因名称",dataIndex:"causeName",key:"causeName",width:150},{title:"原因类别",key:"causeType",width:80},{title:"描述",dataIndex:"description",key:"description"}],ie=l=>({Man:"blue",Machine:"cyan",Material:"orange",Method:"purple",Environment:"green"})[l]||"default",de=l=>({Man:"人",Machine:"机",Material:"料",Method:"法",Environment:"环"})[l]||l,Ue=()=>{G.value=!0,setTimeout(()=>{const l=(s.relatedCauses||[]).map(e=>e.id);se.value=H.value.filter(e=>!l.includes(e.id)),R.value=[],G.value=!1},200),K.value=!0},Oe=l=>{R.value=l},Se=()=>{const l=H.value.filter(n=>R.value.includes(n.id));s.relatedCauses||(s.relatedCauses=[]);const e=l.map(n=>({...n,weight:n.weight||1}));s.relatedCauses.push(...e),s.relatedCauses.sort((n,_)=>(_.weight||1)-(n.weight||1)),K.value=!1,C.success(`已添加 ${l.length} 个不良原因`)},Ee=()=>{s.relatedCauses&&s.relatedCauses.sort((l,e)=>(e.weight||1)-(l.weight||1))},ze=l=>{s.relatedCauses&&s.relatedCauses.splice(l,1)},Ke=l=>{switch(l){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}};return qe(()=>{E(),H.value=[{id:"1",causeCode:"C-MAN-001",causeName:"操作不当",causeType:"Man",description:"员工未按SOP操作"},{id:"2",causeCode:"C-MAC-001",causeName:"设备故障",causeType:"Machine",description:"主轴跳动过大"},{id:"3",causeCode:"C-MAT-001",causeName:"原料杂质",causeType:"Material",description:"供应商来料含杂质"},{id:"4",causeCode:"C-MET-001",causeName:"工艺参数",causeType:"Method",description:"温度设置不当"},{id:"5",causeCode:"C-ENV-001",causeName:"环境温度",causeType:"Environment",description:"车间温度过高"}]}),(l,e)=>{const n=c("a-button"),_=c("a-tooltip"),A=c("a-space"),f=c("a-input"),Re=c("a-tree"),J=c("a-empty"),$e=c("a-spin"),$=c("a-tag"),p=c("a-form-item"),k=c("a-select-option"),X=c("a-select"),Y=c("a-form"),Z=c("a-table"),ue=c("a-textarea"),ee=c("a-modal"),re=c("a-tab-pane"),Le=c("a-input-number"),Ve=c("a-tabs");return m(),ae("div",Je,[r("div",Xe,[r("div",Ye,[r("div",Ze,[e[19]||(e[19]=r("span",{class:"panel-title"},"缺陷分类",-1)),t(A,null,{default:a(()=>[t(_,{title:"新增缺陷分类"},{default:a(()=>[t(n,{type:"primary",size:"small",shape:"circle",onClick:ye},{icon:a(()=>[t(w(V))]),_:1})]),_:1}),t(_,{title:"刷新"},{default:a(()=>[t(n,{size:"small",shape:"circle",onClick:E},{icon:a(()=>[t(w(Fe))]),_:1})]),_:1})]),_:1})]),r("div",et,[t(f,{value:F.value,"onUpdate:value":e[0]||(e[0]=o=>F.value=o),placeholder:"搜索缺陷分类","allow-clear":"",size:"small"},{prefix:a(()=>[t(w(Be))]),_:1},8,["value"])]),r("div",tt,[t($e,{spinning:q.value},{default:a(()=>[S.value.length>0?(m(),h(Re,{key:0,selectedKeys:N.value,"onUpdate:selectedKeys":e[1]||(e[1]=o=>N.value=o),expandedKeys:B.value,"onUpdate:expandedKeys":e[2]||(e[2]=o=>B.value=o),"tree-data":pe.value,"field-names":{children:"children",title:"categoryName",key:"id"},"block-node":"",onSelect:ve},{title:a(({categoryName:o,data:v})=>[r("div",at,[r("span",lt,b(o),1),r("div",ot,[t(w(V),{class:"action-icon",title:"添加子类",onClick:le(M=>me(v),["stop"])},null,8,["onClick"]),t(w(We),{class:"action-icon",title:"编辑",onClick:le(M=>fe(v),["stop"])},null,8,["onClick"]),t(w(Qe),{class:"action-icon",title:"删除",onClick:le(M=>Ce(v),["stop"])},null,8,["onClick"])])])]),_:1},8,["selectedKeys","expandedKeys","tree-data"])):(m(),h(J,{key:1,description:"暂无缺陷分类数据",class:"empty-state"}))]),_:1},8,["spinning"])])]),r("div",nt,[I.value?(m(),ae("div",it,[r("div",dt,[r("div",ut,[r("div",rt,b(I.value.categoryName),1),r("div",ct,[t($,{color:"blue"},{default:a(()=>[i(b(I.value.categoryCode),1)]),_:1}),r("span",pt,b(I.value.description||"暂无描述"),1)])]),r("div",vt,[t(n,{type:"primary",onClick:we},{icon:a(()=>[t(w(V))]),default:a(()=>[e[20]||(e[20]=i(" 新增现象 ",-1))]),_:1}),t(n,{danger:"",disabled:T.value.length===0,onClick:xe},{default:a(()=>[...e[21]||(e[21]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"]),t(n,{onClick:Me},{default:a(()=>[...e[22]||(e[22]=[i("导出",-1)])]),_:1})])]),r("div",yt,[t(Y,{layout:"inline",model:d},{default:a(()=>[t(p,{label:"现象代码"},{default:a(()=>[t(f,{value:d.code,"onUpdate:value":e[3]||(e[3]=o=>d.code=o),placeholder:"模糊搜索","allow-clear":"",style:{width:"150px"}},null,8,["value"])]),_:1}),t(p,{label:"现象名称"},{default:a(()=>[t(f,{value:d.name,"onUpdate:value":e[4]||(e[4]=o=>d.name=o),placeholder:"模糊搜索","allow-clear":"",style:{width:"150px"}},null,8,["value"])]),_:1}),t(p,{label:"严重等级"},{default:a(()=>[t(X,{value:d.severity,"onUpdate:value":e[5]||(e[5]=o=>d.severity=o),placeholder:"选择等级","allow-clear":"",style:{width:"120px"}},{default:a(()=>[t(k,{value:"CR"},{default:a(()=>[...e[23]||(e[23]=[i("致命 (CR)",-1)])]),_:1}),t(k,{value:"MA"},{default:a(()=>[...e[24]||(e[24]=[i("主要 (MA)",-1)])]),_:1}),t(k,{value:"MI"},{default:a(()=>[...e[25]||(e[25]=[i("次要 (MI)",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"适用工序"},{default:a(()=>[t(f,{value:d.processType,"onUpdate:value":e[6]||(e[6]=o=>d.processType=o),placeholder:"如：压铸","allow-clear":"",style:{width:"120px"}},null,8,["value"])]),_:1}),t(p,null,{default:a(()=>[t(n,{type:"primary",onClick:Ne},{default:a(()=>[...e[26]||(e[26]=[i("查询",-1)])]),_:1}),t(n,{style:{"margin-left":"8px"},onClick:Pe},{default:a(()=>[...e[27]||(e[27]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),r("div",mt,[t(Z,{columns:_e,"data-source":D.value,loading:W.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:T.value,onChange:he},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条`}},{bodyCell:a(({column:o,record:v})=>[o.key==="severity"?(m(),h($,{key:0,color:Ke(v.severity)},{default:a(()=>[i(b(v.severity),1)]),_:2},1032,["color"])):o.key==="action"?(m(),h(A,{key:1},{default:a(()=>[t(n,{type:"link",size:"small",onClick:M=>be(v)},{default:a(()=>[...e[28]||(e[28]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(n,{type:"link",danger:"",size:"small",onClick:M=>Te(v)},{default:a(()=>[...e[29]||(e[29]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)):j("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])])])):(m(),ae("div",st,[t(J,{description:"请选择左侧分类查看不良现象"})]))])]),t(ee,{visible:x.value,"onUpdate:visible":e[10]||(e[10]=o=>x.value=o),title:z.value,onOk:ge},{default:a(()=>[t(Y,{layout:"vertical",model:g},{default:a(()=>[t(p,{label:"父级分类"},{default:a(()=>[t(f,{value:U.value,disabled:""},null,8,["value"])]),_:1}),t(p,{label:"分类代码",required:""},{default:a(()=>[t(f,{value:g.categoryCode,"onUpdate:value":e[7]||(e[7]=o=>g.categoryCode=o)},null,8,["value"])]),_:1}),t(p,{label:"分类名称",required:""},{default:a(()=>[t(f,{value:g.categoryName,"onUpdate:value":e[8]||(e[8]=o=>g.categoryName=o)},null,8,["value"])]),_:1}),t(p,{label:"描述"},{default:a(()=>[t(ue,{value:g.description,"onUpdate:value":e[9]||(e[9]=o=>g.description=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),t(ee,{visible:P.value,"onUpdate:visible":e[17]||(e[17]=o=>P.value=o),title:O.value?"编辑不良现象":"新增不良现象",onOk:Ie,width:"900px"},{default:a(()=>[t(Ve,null,{default:a(()=>[t(re,{key:"basic",tab:"基本信息"},{default:a(()=>[t(Y,{layout:"vertical",model:s},{default:a(()=>[t(p,{label:"所属分类"},{default:a(()=>{var o;return[t(f,{value:(o=I.value)==null?void 0:o.categoryName,disabled:""},null,8,["value"])]}),_:1}),t(p,{label:"所属组织"},{default:a(()=>[t(X,{value:s.orgId,"onUpdate:value":e[11]||(e[11]=o=>s.orgId=o),"allow-clear":"",placeholder:"选择组织（留空表示集团级）"},{default:a(()=>[t(k,{value:void 0},{default:a(()=>[...e[30]||(e[30]=[i("集团级（全局可见）",-1)])]),_:1}),t(k,{value:1},{default:a(()=>[...e[31]||(e[31]=[i("合肥工厂",-1)])]),_:1}),t(k,{value:2},{default:a(()=>[...e[32]||(e[32]=[i("芜湖工厂",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"现象代码",required:""},{default:a(()=>[t(f,{value:s.code,"onUpdate:value":e[12]||(e[12]=o=>s.code=o)},null,8,["value"])]),_:1}),t(p,{label:"现象名称",required:""},{default:a(()=>[t(f,{value:s.name,"onUpdate:value":e[13]||(e[13]=o=>s.name=o)},null,8,["value"])]),_:1}),t(p,{label:"严重等级",required:""},{default:a(()=>[t(X,{value:s.severity,"onUpdate:value":e[14]||(e[14]=o=>s.severity=o)},{default:a(()=>[t(k,{value:"CR"},{default:a(()=>[...e[33]||(e[33]=[i("致命 (CR)",-1)])]),_:1}),t(k,{value:"MA"},{default:a(()=>[...e[34]||(e[34]=[i("主要 (MA)",-1)])]),_:1}),t(k,{value:"MI"},{default:a(()=>[...e[35]||(e[35]=[i("次要 (MI)",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(p,{label:"适用工序"},{default:a(()=>[t(f,{value:s.processType,"onUpdate:value":e[15]||(e[15]=o=>s.processType=o),placeholder:"如：压铸, 机加工"},null,8,["value"])]),_:1}),t(p,{label:"描述"},{default:a(()=>[t(ue,{value:s.description,"onUpdate:value":e[16]||(e[16]=o=>s.description=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),t(re,{key:"causes",tab:"关联原因"},{default:a(()=>[r("div",ft,[t(n,{type:"primary",size:"small",onClick:Ue},{default:a(()=>[t(w(V)),e[36]||(e[36]=i(" 添加关联原因 ",-1))]),_:1})]),t(Z,{columns:Ae,"data-source":s.relatedCauses||[],"row-key":"id",size:"small",pagination:!1},{bodyCell:a(({column:o,record:v,index:M})=>[o.key==="causeType"?(m(),h($,{key:0,color:ie(v.causeType)},{default:a(()=>[i(b(de(v.causeType)),1)]),_:2},1032,["color"])):o.key==="weight"?(m(),h(Le,{key:1,value:v.weight,"onUpdate:value":ce=>v.weight=ce,min:1,max:10,size:"small",style:{width:"80px"},onChange:Ee},null,8,["value","onUpdate:value"])):o.key==="action"?(m(),h(n,{key:2,type:"link",danger:"",size:"small",onClick:ce=>ze(M)},{default:a(()=>[...e[37]||(e[37]=[i("移除",-1)])]),_:1},8,["onClick"])):j("",!0)]),_:1},8,["data-source"]),!s.relatedCauses||s.relatedCauses.length===0?(m(),h(J,{key:0,description:"暂无关联原因"})):j("",!0)]),_:1})]),_:1})]),_:1},8,["visible","title"]),t(ee,{visible:K.value,"onUpdate:visible":e[18]||(e[18]=o=>K.value=o),title:"选择不良原因",width:"800px",onOk:Se},{default:a(()=>[t(Z,{columns:De,"data-source":se.value,loading:G.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:R.value,onChange:Oe}},{bodyCell:a(({column:o,record:v})=>[o.key==="causeType"?(m(),h($,{key:0,color:ie(v.causeType)},{default:a(()=>[i(b(de(v.causeType)),1)]),_:2},1032,["color"])):j("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),wt=He(Ct,[["__scopeId","data-v-6c3145f3"]]);export{wt as default};
