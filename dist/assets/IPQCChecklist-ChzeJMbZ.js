import{a as h,r as y,m as de,c as q,o as k,e as L,x as e,q as a,h as v,y as Q,P as R,s as u,p as Y,f as S,t as pe,F as ce,z as ve,E as P,C}from"./index-Ozo2vowX.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"page-container"},ge={class:"page-header"},_e={class:"search-form"},ke={__name:"IPQCChecklist",setup(be){const p=h({inspectionNo:"",workOrder:"",productionLine:"",status:""}),f=y([]),x=y(!1),g=h({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条数据`}),$=[{title:"检验单号",dataIndex:"inspectionNo",key:"inspectionNo",width:140},{title:"生产工单",dataIndex:"workOrder",key:"workOrder",width:120},{title:"产线",dataIndex:"productionLine",key:"productionLine",width:80},{title:"工序",dataIndex:"process",key:"process",width:100},{title:"产品编码",dataIndex:"productCode",key:"productCode",width:120},{title:"产品名称",dataIndex:"productName",key:"productName"},{title:"检验状态",dataIndex:"status",key:"status",width:100},{title:"检验日期",dataIndex:"inspectionDate",key:"inspectionDate",width:120},{title:"检验员",dataIndex:"inspector",key:"inspector",width:100},{title:"操作",key:"action",width:200,fixed:"right"}],_=y(!1),w=y(!1),N=y(),n=h({id:null,inspectionNo:"",workOrder:"",inspectionDate:null,productionLine:"",process:"",inspector:"",productCode:"",productName:"",frequency:"hourly",items:[],conclusion:"passed",remark:"",status:"pending"}),B={workOrder:[{required:!0,message:"请输入生产工单号",trigger:"blur"}],inspectionDate:[{required:!0,message:"请选择检验日期",trigger:"change"}],productionLine:[{required:!0,message:"请选择产线",trigger:"change"}],process:[{required:!0,message:"请输入工序名称",trigger:"blur"}],productCode:[{required:!0,message:"请输入产品编码",trigger:"blur"}],productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],inspector:[{required:!0,message:"请输入检验员姓名",trigger:"blur"}],frequency:[{required:!0,message:"请选择检验频率",trigger:"change"}],conclusion:[{required:!0,message:"请选择检验结论",trigger:"change"}]},M=[{id:1,inspectionNo:"IPQC20240115001",workOrder:"WO20240115001",inspectionDate:"2024-01-15",productionLine:"line1",process:"组装工序",inspector:"张三",productCode:"PROD001",productName:"产品A",frequency:"hourly",status:"passed",conclusion:"passed",remark:"检验合格"},{id:2,inspectionNo:"IPQC20240116001",workOrder:"WO20240116001",inspectionDate:"2024-01-16",productionLine:"line2",process:"焊接工序",inspector:"李四",productCode:"PROD002",productName:"产品B",frequency:"shift",status:"failed",conclusion:"failed",remark:"焊接质量不达标"},{id:3,inspectionNo:"IPQC20240117001",workOrder:"WO20240117001",inspectionDate:"2024-01-17",productionLine:"line3",process:"包装工序",inspector:"王五",productCode:"PROD003",productName:"产品C",frequency:"batch",status:"pending",conclusion:"passed",remark:""}],F=o=>({pending:"orange",inspecting:"blue",passed:"green",failed:"red"})[o]||"default",T=o=>({pending:"待检验",inspecting:"检验中",passed:"合格",failed:"不合格"})[o]||o,U=()=>{x.value=!0,setTimeout(()=>{f.value=M,g.total=M.length,x.value=!1},500)},V=()=>{g.current=1,U()},j=()=>{p.inspectionNo="",p.workOrder="",p.productionLine="",p.status="",V()},A=o=>{g.current=o.current,g.pageSize=o.pageSize,U()},E=()=>{w.value=!1,_.value=!0,O()},W=o=>{w.value=!0,_.value=!0,Object.assign(n,{...o,inspectionDate:o.inspectionDate?P(o.inspectionDate):null,items:o.items||[{name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""}]})},J=o=>{C.info("查看功能开发中...")},G=o=>{o.status="inspecting",C.success("已开始检验")},H=o=>{const t=f.value.findIndex(c=>c.id===o);t>-1&&(f.value.splice(t,1),g.total--,C.success("删除成功"))},K=()=>{n.items.push({name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""})},X=o=>{n.items.length>1&&n.items.splice(o,1)},Z=async()=>{try{if(await N.value.validate(),w.value){const o=f.value.findIndex(t=>t.id===n.id);o>-1&&(f.value[o]={...n,inspectionDate:n.inspectionDate?n.inspectionDate.format("YYYY-MM-DD"):null}),C.success("更新成功")}else{const o=Math.max(...f.value.map(d=>d.id))+1,t=`IPQC${P().format("YYYYMMDD")}${String(o).padStart(3,"0")}`,c={...n,id:o,inspectionNo:t,inspectionDate:n.inspectionDate?n.inspectionDate.format("YYYY-MM-DD"):P().format("YYYY-MM-DD"),status:"pending"};f.value.unshift(c),g.total++,C.success("创建成功")}_.value=!1,O()}catch(o){console.error("表单验证失败:",o)}},ee=()=>{_.value=!1,O()},O=()=>{var o;Object.assign(n,{id:null,inspectionNo:"",workOrder:"",inspectionDate:null,productionLine:"",process:"",inspector:"",productCode:"",productName:"",frequency:"hourly",items:[{name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""}],conclusion:"passed",remark:"",status:"pending"}),(o=N.value)==null||o.resetFields()};return de(()=>{U()}),(o,t)=>{const c=u("a-button"),d=u("a-input"),s=u("a-form-item"),b=u("a-select"),z=u("a-form"),te=u("a-tag"),ae=u("a-popconfirm"),le=u("a-space"),ne=u("a-table"),r=u("a-col"),oe=u("a-date-picker"),D=u("a-row"),se=u("a-input-number"),I=u("a-radio"),ue=u("a-radio-group"),re=u("a-textarea"),ie=u("a-modal");return k(),q("div",fe,[L("div",ge,[t[17]||(t[17]=L("h1",null,"过程检验单(IPQC)",-1)),e(c,{type:"primary",onClick:E},{icon:a(()=>[e(Q(R))]),default:a(()=>[t[16]||(t[16]=v(" 新建检验单 ",-1))]),_:1})]),L("div",_e,[e(z,{layout:"inline",model:p},{default:a(()=>[e(s,{label:"检验单号"},{default:a(()=>[e(d,{value:p.inspectionNo,"onUpdate:value":t[0]||(t[0]=l=>p.inspectionNo=l),placeholder:"请输入检验单号"},null,8,["value"])]),_:1}),e(s,{label:"生产工单"},{default:a(()=>[e(d,{value:p.workOrder,"onUpdate:value":t[1]||(t[1]=l=>p.workOrder=l),placeholder:"请输入生产工单号"},null,8,["value"])]),_:1}),e(s,{label:"产线"},{default:a(()=>[e(b,{value:p.productionLine,"onUpdate:value":t[2]||(t[2]=l=>p.productionLine=l),placeholder:"请选择产线",style:{width:"150px"},options:[{value:"line1",label:"产线A"},{value:"line2",label:"产线B"},{value:"line3",label:"产线C"}]},null,8,["value"])]),_:1}),e(s,{label:"检验状态"},{default:a(()=>[e(b,{value:p.status,"onUpdate:value":t[3]||(t[3]=l=>p.status=l),placeholder:"请选择检验状态",style:{width:"120px"},options:[{value:"pending",label:"待检验"},{value:"inspecting",label:"检验中"},{value:"passed",label:"合格"},{value:"failed",label:"不合格"}]},null,8,["value"])]),_:1}),e(s,null,{default:a(()=>[e(c,{type:"primary",onClick:V},{default:a(()=>[...t[18]||(t[18]=[v("查询",-1)])]),_:1}),e(c,{style:{"margin-left":"8px"},onClick:j},{default:a(()=>[...t[19]||(t[19]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(ne,{columns:$,"data-source":f.value,pagination:g,loading:x.value,onChange:A,"row-key":"id"},{bodyCell:a(({column:l,record:m})=>[l.key==="status"?(k(),Y(te,{key:0,color:F(m.status)},{default:a(()=>[v(pe(T(m.status)),1)]),_:2},1032,["color"])):S("",!0),l.key==="action"?(k(),Y(le,{key:1},{default:a(()=>[e(c,{type:"link",size:"small",onClick:i=>W(m)},{default:a(()=>[...t[20]||(t[20]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(c,{type:"link",size:"small",onClick:i=>J(m)},{default:a(()=>[...t[21]||(t[21]=[v("查看",-1)])]),_:1},8,["onClick"]),m.status==="pending"?(k(),Y(c,{key:0,type:"link",size:"small",onClick:i=>G(m)},{default:a(()=>[...t[22]||(t[22]=[v(" 开始检验 ",-1)])]),_:1},8,["onClick"])):S("",!0),e(ae,{title:"确定要删除这个检验单吗？",onConfirm:i=>H(m.id)},{default:a(()=>[e(c,{type:"link",size:"small",danger:""},{default:a(()=>[...t[23]||(t[23]=[v("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):S("",!0)]),_:1},8,["data-source","pagination","loading"]),e(ie,{visible:_.value,"onUpdate:visible":t[15]||(t[15]=l=>_.value=l),title:w.value?"编辑检验单":"新建检验单",width:"1000px",onOk:Z,onCancel:ee},{default:a(()=>[e(z,{ref_key:"formRef",ref:N,model:n,rules:B,layout:"vertical"},{default:a(()=>[e(D,{gutter:16},{default:a(()=>[e(r,{span:8},{default:a(()=>[e(s,{label:"检验单号",name:"inspectionNo"},{default:a(()=>[e(d,{value:n.inspectionNo,"onUpdate:value":t[4]||(t[4]=l=>n.inspectionNo=l),placeholder:"系统自动生成",disabled:""},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(s,{label:"生产工单",name:"workOrder"},{default:a(()=>[e(d,{value:n.workOrder,"onUpdate:value":t[5]||(t[5]=l=>n.workOrder=l),placeholder:"请输入生产工单号"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(s,{label:"检验日期",name:"inspectionDate"},{default:a(()=>[e(oe,{value:n.inspectionDate,"onUpdate:value":t[6]||(t[6]=l=>n.inspectionDate=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:a(()=>[e(r,{span:8},{default:a(()=>[e(s,{label:"产线",name:"productionLine"},{default:a(()=>[e(b,{value:n.productionLine,"onUpdate:value":t[7]||(t[7]=l=>n.productionLine=l),placeholder:"请选择产线",options:[{value:"line1",label:"产线A"},{value:"line2",label:"产线B"},{value:"line3",label:"产线C"}]},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(s,{label:"工序",name:"process"},{default:a(()=>[e(d,{value:n.process,"onUpdate:value":t[8]||(t[8]=l=>n.process=l),placeholder:"请输入工序名称"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(s,{label:"检验员",name:"inspector"},{default:a(()=>[e(d,{value:n.inspector,"onUpdate:value":t[9]||(t[9]=l=>n.inspector=l),placeholder:"请输入检验员姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(D,{gutter:16},{default:a(()=>[e(r,{span:8},{default:a(()=>[e(s,{label:"产品编码",name:"productCode"},{default:a(()=>[e(d,{value:n.productCode,"onUpdate:value":t[10]||(t[10]=l=>n.productCode=l),placeholder:"请输入产品编码"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(s,{label:"产品名称",name:"productName"},{default:a(()=>[e(d,{value:n.productName,"onUpdate:value":t[11]||(t[11]=l=>n.productName=l),placeholder:"请输入产品名称"},null,8,["value"])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(s,{label:"检验频率",name:"frequency"},{default:a(()=>[e(b,{value:n.frequency,"onUpdate:value":t[12]||(t[12]=l=>n.frequency=l),placeholder:"请选择检验频率",options:[{value:"hourly",label:"每小时"},{value:"shift",label:"每班次"},{value:"batch",label:"每批次"},{value:"random",label:"随机"}]},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(s,{label:"检验项目",name:"items"},{default:a(()=>[(k(!0),q(ce,null,ve(n.items,(l,m)=>(k(),q("div",{key:m,class:"inspection-item"},[e(D,{gutter:8},{default:a(()=>[e(r,{span:4},{default:a(()=>[e(d,{value:l.name,"onUpdate:value":i=>l.name=i,placeholder:"检验项目"},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{span:4},{default:a(()=>[e(d,{value:l.standard,"onUpdate:value":i=>l.standard=i,placeholder:"标准值"},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{span:3},{default:a(()=>[e(d,{value:l.unit,"onUpdate:value":i=>l.unit=i,placeholder:"单位"},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{span:3},{default:a(()=>[e(se,{value:l.actualValue,"onUpdate:value":i=>l.actualValue=i,placeholder:"实测值",style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{span:3},{default:a(()=>[e(b,{value:l.result,"onUpdate:value":i=>l.result=i,placeholder:"结果",options:[{value:"pass",label:"合格"},{value:"fail",label:"不合格"}]},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{span:5},{default:a(()=>[e(d,{value:l.remark,"onUpdate:value":i=>l.remark=i,placeholder:"备注"},null,8,["value","onUpdate:value"])]),_:2},1024),e(r,{span:2},{default:a(()=>[e(c,{type:"text",danger:"",onClick:i=>X(m)},{default:a(()=>[...t[24]||(t[24]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),e(c,{type:"dashed",onClick:K,style:{width:"100%","margin-top":"8px"}},{icon:a(()=>[e(Q(R))]),default:a(()=>[t[25]||(t[25]=v(" 添加检验项目 ",-1))]),_:1})]),_:1}),e(s,{label:"检验结论",name:"conclusion"},{default:a(()=>[e(ue,{value:n.conclusion,"onUpdate:value":t[13]||(t[13]=l=>n.conclusion=l)},{default:a(()=>[e(I,{value:"passed"},{default:a(()=>[...t[26]||(t[26]=[v("合格",-1)])]),_:1}),e(I,{value:"failed"},{default:a(()=>[...t[27]||(t[27]=[v("不合格",-1)])]),_:1}),e(I,{value:"conditional"},{default:a(()=>[...t[28]||(t[28]=[v("有条件接收",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(s,{label:"备注",name:"remark"},{default:a(()=>[e(re,{value:n.remark,"onUpdate:value":t[14]||(t[14]=l=>n.remark=l),rows:3,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}},we=me(ke,[["__scopeId","data-v-62c561b8"]]);export{we as default};
