import{d as _e,r as y,k as N,j as ke,a as he,m as ge,c as k,e as b,x as a,f as c,q as t,s as i,p as u,t as v,o as d,h as s,y as D,K as Me,P as L,F as Ce,C as w,u as be}from"./index-BsO03Xlk.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"page-container"},Ae={class:"page-header"},Fe={class:"header-left"},Pe={class:"title-section"},xe={class:"page-title"},Te={key:0,class:"header-actions"},Ie={key:0,class:"tab-toolbar"},Ne={key:0,class:"tab-toolbar"},De=_e({__name:"DefectCauseEdit",setup(Re){const E=be(),A=ke(),R=y(),F=y(!1),S=y("fmea"),p=N(()=>A.path.includes("/view/")),z=N(()=>A.path.includes("/edit/")),G=N(()=>p.value?"查看不良原因":z.value?"编辑不良原因":"新增不良原因"),l=he({id:null,causeCode:"",causeName:"",causeType:"Man",description:"",relatedFMEA:[],relatedPhenomena:[]}),H={causeCode:[{required:!0,message:"请输入原因代码",trigger:"blur"}],causeName:[{required:!0,message:"请输入原因名称",trigger:"blur"}],causeType:[{required:!0,message:"请选择原因类别",trigger:"change"}]},J=o=>({Man:"blue",Machine:"cyan",Material:"orange",Method:"purple",Environment:"green"})[o]||"default",Q=o=>({Man:"人",Machine:"机",Material:"料",Method:"法",Environment:"环"})[o]||o,W=[{title:"FMEA编号",dataIndex:"fmeaCode",key:"fmeaCode",width:120},{title:"失效模式",dataIndex:"failureMode",key:"failureMode",width:150},{title:"严重度(S)",key:"severity",width:90},{title:"发生度(O)",key:"occurrence",width:90},{title:"探测度(D)",key:"detection",width:90},{title:"RPN",key:"rpn",width:80},{title:"操作",key:"action",width:120}],X=o=>o>=8?"red":o>=5?"orange":"green",Y=o=>o>=200?"red":o>=100?"orange":"green",Z=()=>{w.info("FMEA选择器功能将在后续实现")},ee=o=>{E.push(`/tools/fmea?id=${o.id}`)},te=o=>{l.relatedFMEA.splice(o,1)},ae=[{title:"现象代码",dataIndex:"code",key:"code",width:120},{title:"现象名称",dataIndex:"name",key:"name",width:180},{title:"严重等级",key:"severity",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],O=o=>{switch(o){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}},h=y(!1),P=y(!1),V=y([]),g=y([]),x=y([]),oe=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"}],ne=()=>{P.value=!0,setTimeout(()=>{const o=l.relatedPhenomena.map(e=>e.id);V.value=x.value.filter(e=>!o.includes(e.id)),g.value=[],P.value=!1},200),h.value=!0},le=o=>{g.value=o},se=()=>{const o=x.value.filter(e=>g.value.includes(e.id));l.relatedPhenomena.push(...o),h.value=!1,w.success(`已添加 ${o.length} 个不良现象`)},ie=o=>{l.relatedPhenomena.splice(o,1)},de=()=>{E.push("/inspection-model/defect-causes")},re=async()=>{var o;try{F.value=!0,await((o=R.value)==null?void 0:o.validate()),w.success("保存成功"),E.push("/inspection-model/defect-causes")}catch{w.error("请完善必填项")}finally{F.value=!1}},ue=()=>{const o=A.params.id;if(o){const m={1:{id:"1",causeCode:"C-MAN-001",causeName:"操作不当",causeType:"Man",description:"员工未按SOP操作",relatedFMEA:[{id:"f1",fmeaCode:"FMEA-001",failureMode:"装配错误",severity:7,occurrence:4,detection:5,rpn:140}],relatedPhenomena:[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"}]},2:{id:"2",causeCode:"C-MAC-001",causeName:"设备故障",causeType:"Machine",description:"主轴跳动过大",relatedFMEA:[],relatedPhenomena:[]},3:{id:"3",causeCode:"C-MAT-001",causeName:"原料杂质",causeType:"Material",description:"供应商来料含杂质",relatedFMEA:[],relatedPhenomena:[]}}[o];m&&Object.assign(l,m)}};return ge(()=>{ue(),x.value=[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"},{id:"103",code:"DEF-003",name:"裂纹",severity:"CR",description:"产品裂纹"},{id:"104",code:"DEF-004",name:"变形",severity:"MA",description:"产品变形"},{id:"105",code:"DEF-005",name:"色差",severity:"MI",description:"颜色不均匀"},{id:"106",code:"DEF-006",name:"尺寸偏差",severity:"MA",description:"超出公差范围"}]}),(o,e)=>{const m=i("a-button"),f=i("a-tag"),K=i("a-input"),M=i("a-form-item"),C=i("a-col"),_=i("a-select-option"),ce=i("a-select"),U=i("a-row"),pe=i("a-textarea"),me=i("a-form"),B=i("a-card"),ye=i("a-space"),T=i("a-table"),$=i("a-empty"),q=i("a-tab-pane"),ve=i("a-tabs"),fe=i("a-modal");return d(),k("div",Ee,[b("div",Ae,[b("div",Fe,[a(m,{type:"text",onClick:de,class:"back-button"},{icon:t(()=>[a(D(Me))]),default:t(()=>[e[6]||(e[6]=s(" 返回 ",-1))]),_:1}),b("div",Pe,[b("h2",xe,v(G.value),1),l.causeType?(d(),u(f,{key:0,color:J(l.causeType)},{default:t(()=>[s(v(Q(l.causeType)),1)]),_:1},8,["color"])):c("",!0)])]),p.value?c("",!0):(d(),k("div",Te,[a(m,{type:"primary",onClick:re,loading:F.value},{default:t(()=>[...e[7]||(e[7]=[s("保存",-1)])]),_:1},8,["loading"])]))]),a(B,{class:"form-card",title:"基本信息"},{default:t(()=>[a(me,{ref_key:"formRef",ref:R,model:l,rules:H,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:t(()=>[a(U,{gutter:24},{default:t(()=>[a(C,{span:8},{default:t(()=>[a(M,{label:"原因代码",name:"causeCode"},{default:t(()=>[a(K,{value:l.causeCode,"onUpdate:value":e[0]||(e[0]=n=>l.causeCode=n),disabled:p.value||z.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(C,{span:8},{default:t(()=>[a(M,{label:"原因名称",name:"causeName"},{default:t(()=>[a(K,{value:l.causeName,"onUpdate:value":e[1]||(e[1]=n=>l.causeName=n),disabled:p.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(C,{span:8},{default:t(()=>[a(M,{label:"原因类别",name:"causeType"},{default:t(()=>[a(ce,{value:l.causeType,"onUpdate:value":e[2]||(e[2]=n=>l.causeType=n),disabled:p.value,placeholder:"请选择"},{default:t(()=>[a(_,{value:"Man"},{default:t(()=>[...e[8]||(e[8]=[s("人 (Man)",-1)])]),_:1}),a(_,{value:"Machine"},{default:t(()=>[...e[9]||(e[9]=[s("机 (Machine)",-1)])]),_:1}),a(_,{value:"Material"},{default:t(()=>[...e[10]||(e[10]=[s("料 (Material)",-1)])]),_:1}),a(_,{value:"Method"},{default:t(()=>[...e[11]||(e[11]=[s("法 (Method)",-1)])]),_:1}),a(_,{value:"Environment"},{default:t(()=>[...e[12]||(e[12]=[s("环 (Environment)",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(U,{gutter:24},{default:t(()=>[a(C,{span:16},{default:t(()=>[a(M,{label:"描述",name:"description","label-col":{span:3},"wrapper-col":{span:20}},{default:t(()=>[a(pe,{value:l.description,"onUpdate:value":e[3]||(e[3]=n=>l.description=n),disabled:p.value,rows:2,placeholder:"请输入描述"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(B,{class:"tab-card"},{default:t(()=>[a(ve,{activeKey:S.value,"onUpdate:activeKey":e[4]||(e[4]=n=>S.value=n)},{default:t(()=>[a(q,{key:"fmea",tab:"FMEA关联"},{default:t(()=>[p.value?c("",!0):(d(),k("div",Ie,[a(m,{type:"primary",size:"small",onClick:Z},{default:t(()=>[a(D(L)),e[13]||(e[13]=s(" 添加关联 ",-1))]),_:1})])),a(T,{columns:W,"data-source":l.relatedFMEA,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:n,record:r,index:I})=>[n.key==="severity"?(d(),u(f,{key:0,color:X(r.severity)},{default:t(()=>[s("S:"+v(r.severity),1)]),_:2},1032,["color"])):n.key==="occurrence"?(d(),u(f,{key:1,color:"blue"},{default:t(()=>[s("O:"+v(r.occurrence),1)]),_:2},1024)):n.key==="detection"?(d(),u(f,{key:2,color:"purple"},{default:t(()=>[s("D:"+v(r.detection),1)]),_:2},1024)):n.key==="rpn"?(d(),u(f,{key:3,color:Y(r.rpn)},{default:t(()=>[s(v(r.rpn),1)]),_:2},1032,["color"])):n.key==="action"?(d(),u(ye,{key:4},{default:t(()=>[a(m,{type:"link",size:"small",onClick:j=>ee(r)},{default:t(()=>[...e[14]||(e[14]=[s("查看",-1)])]),_:1},8,["onClick"]),p.value?c("",!0):(d(),u(m,{key:0,type:"link",danger:"",size:"small",onClick:j=>te(I)},{default:t(()=>[...e[15]||(e[15]=[s("移除",-1)])]),_:1},8,["onClick"]))]),_:2},1024)):c("",!0)]),_:1},8,["data-source"]),l.relatedFMEA.length===0?(d(),u($,{key:1,description:"暂无关联FMEA记录"})):c("",!0)]),_:1}),a(q,{key:"phenomena",tab:"关联不良现象"},{default:t(()=>[p.value?c("",!0):(d(),k("div",Ne,[a(m,{type:"primary",size:"small",onClick:ne},{default:t(()=>[a(D(L)),e[16]||(e[16]=s(" 添加关联 ",-1))]),_:1})])),a(T,{columns:ae,"data-source":l.relatedPhenomena,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:n,record:r,index:I})=>[n.key==="severity"?(d(),u(f,{key:0,color:O(r.severity)},{default:t(()=>[s(v(r.severity),1)]),_:2},1032,["color"])):n.key==="action"?(d(),k(Ce,{key:1},[p.value?c("",!0):(d(),u(m,{key:0,type:"link",danger:"",size:"small",onClick:j=>ie(I)},{default:t(()=>[...e[17]||(e[17]=[s("移除",-1)])]),_:1},8,["onClick"]))],64)):c("",!0)]),_:1},8,["data-source"]),l.relatedPhenomena.length===0?(d(),u($,{key:1,description:"暂无关联不良现象"})):c("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1}),a(fe,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=n=>h.value=n),title:"选择不良现象",width:"800px",onOk:se},{default:t(()=>[a(T,{columns:oe,"data-source":V.value,loading:P.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:g.value,onChange:le}},{bodyCell:t(({column:n,record:r})=>[n.key==="severity"?(d(),u(f,{key:0,color:O(r.severity)},{default:t(()=>[s(v(r.severity),1)]),_:2},1032,["color"])):c("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),Oe=we(De,[["__scopeId","data-v-1f6e6683"]]);export{Oe as default};
