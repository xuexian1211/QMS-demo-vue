import{d as he,r as b,k as F,j as Ce,a as J,m as Ie,c as r,e as M,x as a,f as v,q as t,s as d,p as m,t as y,o,h as u,y as D,K as Se,P as Q,F as _,w as Fe,z as Me,u as Pe,C as P}from"./index-BhbkSrG8.js";import{O as Re}from"./OperationInspConfigModal-DeVP1HV0.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"page-container"},Ne={class:"page-header"},qe={class:"header-left"},Te={class:"title-section"},Be={class:"page-title"},De={key:0,class:"header-actions"},Ve={key:0,class:"tab-toolbar"},ze={key:1},Oe={key:1},Ae={key:1},We={key:1},Le={key:3,style:{color:"#999"}},$e={key:1},Ee={key:0,class:"tab-toolbar"},Ke=he({__name:"ProcessRouteEdit",setup(je){const R=Pe(),U=Ce(),V=b(),x=b(!1),z=b("steps"),p=F(()=>U.path.includes("/view/")),O=F(()=>U.path.includes("/edit/")),X=F(()=>p.value?"查看工艺路线":O.value?"编辑工艺路线":"新增工艺路线"),n=J({id:null,code:"",name:"",version:"V1.0",status:"Draft",effectiveDate:void 0,description:"",steps:[],materials:[]}),Y={code:[{required:!0,message:"请输入路线编码",trigger:"blur"}],name:[{required:!0,message:"请输入路线名称",trigger:"blur"}]},Z=s=>({Active:"success",Draft:"default",Obsolete:"error"})[s]||"default",ee=s=>({Active:"生效",Draft:"草稿",Obsolete:"失效"})[s]||s,te=s=>({Raw:"blue",Semi:"orange",Finish:"green"})[s]||"default",ae=s=>({Raw:"原材料",Semi:"半成品",Finish:"成品"})[s]||s,N=b([{id:"1",code:"M001",name:"铝锭",spec:"ADC12",category:"Raw",unit:"kg",source:"Buy"},{id:"2",code:"P001",name:"发动机壳体",spec:"V1.0",category:"Semi",unit:"pcs",source:"Make"},{id:"3",code:"F001",name:"电动车电机",spec:"500W",category:"Finish",unit:"set",source:"Make"},{id:"4",code:"M002",name:"铜线",spec:"0.5mm",category:"Raw",unit:"kg",source:"Buy"},{id:"5",code:"M003",name:"硅钢片",spec:"B35A250",category:"Raw",unit:"kg",source:"Buy"}]),se=(s,e)=>{const c=N.value.find(k=>k.id===e.value);return c?c.code.toLowerCase().includes(s.toLowerCase())||c.name.toLowerCase().includes(s.toLowerCase()):!1},le=F(()=>{const s=n.materials.map(e=>e.id);return N.value.filter(e=>!s.includes(e.id))}),oe=[{title:"物料编码",dataIndex:"code",key:"code",width:120},{title:"物料名称",dataIndex:"name",key:"name",width:150},{title:"规格型号",dataIndex:"spec",key:"spec",width:120},{title:"分类",key:"category",width:100},{title:"单位",dataIndex:"unit",key:"unit",width:80},{title:"来源",key:"source",width:80},{title:"操作",key:"action",width:120}],C=b(!1),I=b([]),ne=()=>{I.value=[],C.value=!0},ie=()=>{const s=N.value.filter(e=>I.value.includes(e.id));n.materials.push(...s),C.value=!1,P.success(`已添加 ${s.length} 个物料`)},de=s=>{n.materials.splice(s,1)},ue=s=>{R.push(`/basic-data/material/view/${s.id}`)},re=[{title:"序号",key:"opSeq",width:80},{title:"工序名称",key:"opName",width:150},{title:"工作中心",key:"workCenter",width:120},{title:"标准工时(分)",key:"stdTime",width:100},{title:"检验配置",key:"inspConfig",width:220},{title:"工序描述",key:"description"},{title:"操作",key:"action",width:80}],pe=()=>{n.steps.push({id:Date.now().toString(),opSeq:(n.steps.length+1)*10,opName:"",workCenter:"",stdTime:0,description:"",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!1})},ce=s=>{n.steps.splice(s,1)},q=b(!1),A=J({id:"",opSeq:0,opName:"",routeId:""}),me=s=>{console.log("Opening insp config modal for:",s),Object.assign(A,{id:String(s.id),opSeq:s.opSeq,opName:s.opName,routeId:n.id||""}),q.value=!0},ve=s=>{console.log("Saving insp config:",s);const e=n.steps.find(c=>String(c.id)===s.operationId);e&&(e.hasFirstInsp=s.firstInspPlans.length>0,e.hasPatrolInsp=s.patrolInspPlans.length>0,e.hasFinalInsp=s.finalInspPlans.length>0),P.success("检验配置已更新")},fe=()=>{R.push("/basic-data/process-route")},ye=async()=>{var s;try{x.value=!0,await((s=V.value)==null?void 0:s.validate()),P.success("保存成功"),R.push("/basic-data/process-route")}catch{P.error("请完善必填项")}finally{x.value=!1}},ke=()=>{const s=U.params.id;if(s){const c={1:{id:"1",code:"PR-001",name:"壳体加工工艺",version:"V1.0",status:"Active",description:"压铸机加工",steps:[{id:"101",opSeq:10,opName:"熔炼",workCenter:"WC-01",stdTime:30,description:"铝液熔炼",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"102",opSeq:20,opName:"压铸",workCenter:"WC-02",stdTime:15,description:"高压压铸",hasFirstInsp:!0,hasPatrolInsp:!0,hasFinalInsp:!1},{id:"103",opSeq:30,opName:"去毛刺",workCenter:"WC-03",stdTime:10,description:"人工去毛刺",hasFirstInsp:!1,hasPatrolInsp:!1,hasFinalInsp:!0}],materials:[{id:"1",code:"M001",name:"铝锭",spec:"ADC12",category:"Raw",unit:"kg",source:"Buy"},{id:"2",code:"P001",name:"发动机壳体",spec:"V1.0",category:"Semi",unit:"pcs",source:"Make"}]},2:{id:"2",code:"PR-002",name:"电机组装工艺",version:"V1.0",status:"Draft",description:"电机装配流程",steps:[{id:"201",opSeq:10,opName:"绕线",workCenter:"WC-10",stdTime:45,description:"定子绕线",hasFirstInsp:!0,hasPatrolInsp:!1,hasFinalInsp:!1},{id:"202",opSeq:20,opName:"总装",workCenter:"WC-11",stdTime:20,description:"电机组装",hasFirstInsp:!1,hasPatrolInsp:!0,hasFinalInsp:!0}],materials:[{id:"3",code:"F001",name:"电动车电机",spec:"500W",category:"Finish",unit:"set",source:"Make"},{id:"4",code:"M002",name:"铜线",spec:"0.5mm",category:"Raw",unit:"kg",source:"Buy"},{id:"5",code:"M003",name:"硅钢片",spec:"B35A250",category:"Raw",unit:"kg",source:"Buy"}]}}[s];c&&Object.assign(n,c)}};return Ie(()=>{ke()}),(s,e)=>{const c=d("a-button"),k=d("a-tag"),w=d("a-input"),g=d("a-form-item"),h=d("a-col"),T=d("a-row"),S=d("a-select-option"),W=d("a-select"),_e=d("a-date-picker"),ge=d("a-textarea"),L=d("a-form"),$=d("a-card"),E=d("a-input-number"),K=d("a-space"),j=d("a-table"),G=d("a-empty"),H=d("a-tab-pane"),be=d("a-tabs"),we=d("a-modal");return o(),r("div",xe,[M("div",Ne,[M("div",qe,[a(c,{type:"text",onClick:fe,class:"back-button"},{icon:t(()=>[a(D(Se))]),default:t(()=>[e[10]||(e[10]=u(" 返回 ",-1))]),_:1}),M("div",Te,[M("h2",Be,y(X.value),1),n.version?(o(),m(k,{key:0,color:"blue"},{default:t(()=>[u(y(n.version),1)]),_:1})):v("",!0),a(k,{color:Z(n.status)},{default:t(()=>[u(y(ee(n.status)),1)]),_:1},8,["color"])])]),p.value?v("",!0):(o(),r("div",De,[a(c,{type:"primary",onClick:ye,loading:x.value},{default:t(()=>[...e[11]||(e[11]=[u("保存",-1)])]),_:1},8,["loading"])]))]),a($,{class:"form-card",title:"基本信息"},{default:t(()=>[a(L,{ref_key:"formRef",ref:V,model:n,rules:Y,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:t(()=>[a(T,{gutter:24},{default:t(()=>[a(h,{span:8},{default:t(()=>[a(g,{label:"路线编码",name:"code"},{default:t(()=>[a(w,{value:n.code,"onUpdate:value":e[0]||(e[0]=l=>n.code=l),disabled:p.value||O.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(h,{span:8},{default:t(()=>[a(g,{label:"路线名称",name:"name"},{default:t(()=>[a(w,{value:n.name,"onUpdate:value":e[1]||(e[1]=l=>n.name=l),disabled:p.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),a(h,{span:8},{default:t(()=>[a(g,{label:"版本",name:"version"},{default:t(()=>[a(w,{value:n.version,"onUpdate:value":e[2]||(e[2]=l=>n.version=l),disabled:p.value,placeholder:"如: V1.0"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(T,{gutter:24},{default:t(()=>[a(h,{span:8},{default:t(()=>[a(g,{label:"状态",name:"status"},{default:t(()=>[a(W,{value:n.status,"onUpdate:value":e[3]||(e[3]=l=>n.status=l),disabled:p.value,placeholder:"请选择"},{default:t(()=>[a(S,{value:"Draft"},{default:t(()=>[...e[12]||(e[12]=[u("草稿",-1)])]),_:1}),a(S,{value:"Active"},{default:t(()=>[...e[13]||(e[13]=[u("生效",-1)])]),_:1}),a(S,{value:"Obsolete"},{default:t(()=>[...e[14]||(e[14]=[u("失效",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),a(h,{span:8},{default:t(()=>[a(g,{label:"生效日期",name:"effectiveDate"},{default:t(()=>[a(_e,{value:n.effectiveDate,"onUpdate:value":e[4]||(e[4]=l=>n.effectiveDate=l),disabled:p.value,style:{width:"100%"}},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),a(T,{gutter:24},{default:t(()=>[a(h,{span:16},{default:t(()=>[a(g,{label:"备注",name:"description","label-col":{span:3},"wrapper-col":{span:20}},{default:t(()=>[a(ge,{value:n.description,"onUpdate:value":e[5]||(e[5]=l=>n.description=l),disabled:p.value,rows:2,placeholder:"请输入备注"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a($,{class:"tab-card"},{default:t(()=>[a(be,{activeKey:z.value,"onUpdate:activeKey":e[6]||(e[6]=l=>z.value=l)},{default:t(()=>[a(H,{key:"steps",tab:"工序明细"},{default:t(()=>[p.value?v("",!0):(o(),r("div",Ve,[a(c,{type:"primary",size:"small",onClick:pe},{default:t(()=>[a(D(Q)),e[15]||(e[15]=u(" 添加工序 ",-1))]),_:1})])),a(j,{columns:re,"data-source":n.steps,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:l,record:i,index:B})=>[l.key==="opSeq"?(o(),r(_,{key:0},[p.value?(o(),r("span",ze,y(i.opSeq),1)):(o(),m(E,{key:0,value:i.opSeq,"onUpdate:value":f=>i.opSeq=f,min:1,style:{width:"60px"}},null,8,["value","onUpdate:value"]))],64)):l.key==="opName"?(o(),r(_,{key:1},[p.value?(o(),r("span",Oe,y(i.opName),1)):(o(),m(w,{key:0,value:i.opName,"onUpdate:value":f=>i.opName=f,style:{width:"100%"}},null,8,["value","onUpdate:value"]))],64)):l.key==="workCenter"?(o(),r(_,{key:2},[p.value?(o(),r("span",Ae,y(i.workCenter),1)):(o(),m(w,{key:0,value:i.workCenter,"onUpdate:value":f=>i.workCenter=f,style:{width:"100%"}},null,8,["value","onUpdate:value"]))],64)):l.key==="stdTime"?(o(),r(_,{key:3},[p.value?(o(),r("span",We,y(i.stdTime),1)):(o(),m(E,{key:0,value:i.stdTime,"onUpdate:value":f=>i.stdTime=f,min:0,style:{width:"80px"}},null,8,["value","onUpdate:value"]))],64)):l.key==="inspConfig"?(o(),m(K,{key:4},{default:t(()=>[i.hasFirstInsp?(o(),m(k,{key:0,color:"blue",size:"small"},{default:t(()=>[...e[16]||(e[16]=[u("首检",-1)])]),_:1})):v("",!0),i.hasPatrolInsp?(o(),m(k,{key:1,color:"green",size:"small"},{default:t(()=>[...e[17]||(e[17]=[u("巡检",-1)])]),_:1})):v("",!0),i.hasFinalInsp?(o(),m(k,{key:2,color:"orange",size:"small"},{default:t(()=>[...e[18]||(e[18]=[u("末检",-1)])]),_:1})):v("",!0),!i.hasFirstInsp&&!i.hasPatrolInsp&&!i.hasFinalInsp?(o(),r("span",Le,"未配置")):v("",!0),a(c,{type:"link",size:"small",onClick:Fe(f=>me(i),["stop"])},{default:t(()=>[...e[19]||(e[19]=[u("配置",-1)])]),_:1},8,["onClick"])]),_:2},1024)):l.key==="description"?(o(),r(_,{key:5},[p.value?(o(),r("span",$e,y(i.description),1)):(o(),m(w,{key:0,value:i.description,"onUpdate:value":f=>i.description=f,style:{width:"100%"}},null,8,["value","onUpdate:value"]))],64)):l.key==="action"?(o(),r(_,{key:6},[p.value?v("",!0):(o(),m(c,{key:0,type:"link",danger:"",size:"small",onClick:f=>ce(B)},{default:t(()=>[...e[20]||(e[20]=[u("删除",-1)])]),_:1},8,["onClick"]))],64)):v("",!0)]),_:1},8,["data-source"]),n.steps.length===0?(o(),m(G,{key:1,description:"暂无工序，请添加"})):v("",!0)]),_:1}),a(H,{key:"materials",tab:"关联物料"},{default:t(()=>[p.value?v("",!0):(o(),r("div",Ee,[a(c,{type:"primary",size:"small",onClick:ne},{default:t(()=>[a(D(Q)),e[21]||(e[21]=u(" 添加物料 ",-1))]),_:1})])),a(j,{columns:oe,"data-source":n.materials,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:l,record:i,index:B})=>[l.key==="category"?(o(),m(k,{key:0,color:te(i.category)},{default:t(()=>[u(y(ae(i.category)),1)]),_:2},1032,["color"])):l.key==="source"?(o(),r(_,{key:1},[u(y(i.source==="Buy"?"采购":"自制"),1)],64)):l.key==="action"?(o(),m(K,{key:2},{default:t(()=>[a(c,{type:"link",size:"small",onClick:f=>ue(i)},{default:t(()=>[...e[22]||(e[22]=[u("查看",-1)])]),_:1},8,["onClick"]),p.value?v("",!0):(o(),m(c,{key:0,type:"link",danger:"",size:"small",onClick:f=>de(B)},{default:t(()=>[...e[23]||(e[23]=[u("移除",-1)])]),_:1},8,["onClick"]))]),_:2},1024)):v("",!0)]),_:1},8,["data-source"]),n.materials.length===0?(o(),m(G,{key:1,description:"暂无关联物料"})):v("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1}),a(Re,{visible:q.value,"onUpdate:visible":e[7]||(e[7]=l=>q.value=l),operationInfo:A,onSave:ve},null,8,["visible","operationInfo"]),a(we,{visible:C.value,"onUpdate:visible":e[9]||(e[9]=l=>C.value=l),title:"添加关联物料",width:"600px",onOk:ie},{default:t(()=>[a(L,{layout:"vertical"},{default:t(()=>[a(g,{label:"选择物料"},{default:t(()=>[a(W,{value:I.value,"onUpdate:value":e[8]||(e[8]=l=>I.value=l),mode:"multiple","show-search":"",placeholder:"请选择物料（支持多选）","filter-option":se,style:{width:"100%"}},{default:t(()=>[(o(!0),r(_,null,Me(le.value,l=>(o(),m(S,{key:l.id,value:l.id},{default:t(()=>[u(y(l.code)+" - "+y(l.name)+" ("+y(l.spec)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["visible"])])}}}),Qe=Ue(Ke,[["__scopeId","data-v-a793e067"]]);export{Qe as default};
