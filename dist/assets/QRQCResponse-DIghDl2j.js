import{a as I,r as Y,m as pe,c as z,o as v,e as Q,x as e,q as t,h as c,y as me,P as ce,s as d,p as k,f as y,t as M,n as ve,E as T,C as q}from"./index-BhbkSrG8.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"page-container"},be={class:"page-header"},ye={class:"search-form"},Te={__name:"QRQCResponse",setup(_e){const p=I({qrqcNo:"",problemType:"",urgencyLevel:"",status:""}),f=Y([]),L=Y(!1),_=I({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`共 ${n} 条数据`}),E=[{title:"反应单号",dataIndex:"qrqcNo",key:"qrqcNo",width:140},{title:"问题标题",dataIndex:"title",key:"title"},{title:"问题类型",dataIndex:"problemType",key:"problemType",width:100},{title:"紧急程度",dataIndex:"urgencyLevel",key:"urgencyLevel",width:100},{title:"影响程度",dataIndex:"impactLevel",key:"impactLevel",width:100},{title:"发生时间",dataIndex:"occurrenceTime",key:"occurrenceTime",width:140},{title:"报告人",dataIndex:"reporter",key:"reporter",width:100},{title:"响应时间要求",dataIndex:"responseTime",key:"responseTime",width:120},{title:"责任人",dataIndex:"responsiblePerson",key:"responsiblePerson",width:100},{title:"处理状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:280,fixed:"right"}],C=Y(!1),D=Y(!1),A=Y(),a=I({id:null,qrqcNo:"",occurrenceTime:null,reporter:"",problemType:"quality",urgencyLevel:"medium",impactLevel:"moderate",title:"",location:"",problemDescription:"",relatedProducts:"",relatedEquipment:"",temporaryMeasures:"",rootCauseAnalysis:"",correctiveActions:"",preventiveActions:"",responsiblePerson:"",deadline:null,responseTime:"2小时",verificationResult:"pending",closeTime:null,processor:"",remark:"",status:"pending"}),$={occurrenceTime:[{required:!0,message:"请选择发生时间",trigger:"change"}],reporter:[{required:!0,message:"请输入报告人姓名",trigger:"blur"}],problemType:[{required:!0,message:"请选择问题类型",trigger:"change"}],urgencyLevel:[{required:!0,message:"请选择紧急程度",trigger:"change"}],impactLevel:[{required:!0,message:"请选择影响程度",trigger:"change"}],title:[{required:!0,message:"请输入问题标题",trigger:"blur"}],problemDescription:[{required:!0,message:"请描述问题情况",trigger:"blur"}],responsiblePerson:[{required:!0,message:"请输入责任人姓名",trigger:"blur"}],deadline:[{required:!0,message:"请选择完成期限",trigger:"change"}],responseTime:[{required:!0,message:"请选择响应时间要求",trigger:"change"}]},h=[{id:1,qrqcNo:"QRQC20240115001",occurrenceTime:"2024-01-15 09:30:00",reporter:"张三",problemType:"quality",urgencyLevel:"high",impactLevel:"serious",title:"产品A尺寸超差",location:"生产线1",problemDescription:"产品A的关键尺寸超出公差范围，影响装配",relatedProducts:"产品A, 产品A-1",relatedEquipment:"设备CNC-001",temporaryMeasures:"暂停生产，隔离不合格品",rootCauseAnalysis:"设备刀具磨损导致加工精度下降",correctiveActions:"更换刀具，重新校准设备",preventiveActions:"建立刀具磨损监控机制",responsiblePerson:"李工程师",deadline:"2024-01-16",responseTime:"2小时",verificationResult:"effective",closeTime:"2024-01-15 15:30:00",processor:"李工程师",remark:"问题已彻底解决",status:"closed"},{id:2,qrqcNo:"QRQC20240116001",occurrenceTime:"2024-01-16 14:20:00",reporter:"王五",problemType:"equipment",urgencyLevel:"urgent",impactLevel:"critical",title:"生产线2停机故障",location:"生产线2",problemDescription:"生产线2主电机故障，整条生产线停机",relatedProducts:"产品B, 产品C",relatedEquipment:"主电机M-002",temporaryMeasures:"切换到备用生产线",rootCauseAnalysis:"电机轴承损坏",correctiveActions:"更换电机轴承",preventiveActions:"增加设备点检频率",responsiblePerson:"赵工程师",deadline:"2024-01-17",responseTime:"30分钟",verificationResult:"pending",closeTime:null,processor:"赵工程师",remark:"正在处理中",status:"processing"},{id:3,qrqcNo:"QRQC20240117001",occurrenceTime:"2024-01-17 11:45:00",reporter:"钱六",problemType:"material",urgencyLevel:"medium",impactLevel:"moderate",title:"原材料质量问题",location:"仓库A",problemDescription:"供应商提供的原材料存在色差问题",relatedProducts:"产品D",relatedEquipment:"",temporaryMeasures:"暂停使用该批次原材料",rootCauseAnalysis:"",correctiveActions:"",preventiveActions:"",responsiblePerson:"孙经理",deadline:"2024-01-18",responseTime:"4小时",verificationResult:"pending",closeTime:null,processor:"",remark:"等待供应商反馈",status:"pending"}],B=n=>({pending:"orange",processing:"blue",resolved:"green",closed:"gray"})[n]||"default",O=n=>({pending:"待处理",processing:"处理中",resolved:"已解决",closed:"已关闭"})[n]||n,V=n=>({quality:"red",equipment:"purple",process:"blue",material:"orange",safety:"green"})[n]||"default",j=n=>({quality:"质量问题",equipment:"设备故障",process:"工艺异常",material:"材料问题",safety:"安全问题"})[n]||n,F=n=>({low:"green",medium:"orange",high:"red",urgent:"purple"})[n]||"default",J=n=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[n]||n,G=n=>{if(n.status==="closed")return!1;const l=T(),i=T(n.occurrenceTime),r={"30分钟":30,"1小时":60,"2小时":120,"4小时":240,"8小时":480,"24小时":1440}[n.responseTime]||120;return l.diff(i,"minute")>r},U=()=>{L.value=!0,setTimeout(()=>{f.value=h,_.total=h.length,L.value=!1},500)},S=()=>{_.current=1,U()},K=()=>{p.qrqcNo="",p.problemType="",p.urgencyLevel="",p.status="",S()},W=n=>{_.current=n.current,_.pageSize=n.pageSize,U()},X=()=>{D.value=!1,C.value=!0,P()},Z=n=>{D.value=!0,C.value=!0,Object.assign(a,{...n,occurrenceTime:n.occurrenceTime?T(n.occurrenceTime):null,deadline:n.deadline?T(n.deadline):null,closeTime:n.closeTime?T(n.closeTime):null})},ee=n=>{q.info("查看功能开发中...")},le=n=>{n.status="processing",n.processor="当前用户",q.success("已开始处理")},te=n=>{n.status="resolved",q.success("问题已解决")},ae=n=>{n.status="closed",n.closeTime=T().format("YYYY-MM-DD HH:mm:ss"),q.success("反应单已关闭")},oe=n=>{const l=f.value.findIndex(i=>i.id===n);l>-1&&(f.value.splice(l,1),_.total--,q.success("删除成功"))},ne=async()=>{try{if(await A.value.validate(),D.value){const n=f.value.findIndex(l=>l.id===a.id);n>-1&&(f.value[n]={...a,occurrenceTime:a.occurrenceTime?a.occurrenceTime.format("YYYY-MM-DD HH:mm:ss"):null,deadline:a.deadline?a.deadline.format("YYYY-MM-DD"):null,closeTime:a.closeTime?a.closeTime.format("YYYY-MM-DD HH:mm:ss"):null}),q.success("更新成功")}else{const n=Math.max(...f.value.map(m=>m.id))+1,l=`QRQC${T().format("YYYYMMDD")}${String(n).padStart(3,"0")}`,i={...a,id:n,qrqcNo:l,occurrenceTime:a.occurrenceTime?a.occurrenceTime.format("YYYY-MM-DD HH:mm:ss"):T().format("YYYY-MM-DD HH:mm:ss"),deadline:a.deadline?a.deadline.format("YYYY-MM-DD"):null,closeTime:a.closeTime?a.closeTime.format("YYYY-MM-DD HH:mm:ss"):null,status:"pending"};f.value.unshift(i),_.total++,q.success("创建成功")}C.value=!1,P()}catch(n){console.error("表单验证失败:",n)}},re=()=>{C.value=!1,P()},P=()=>{var n;Object.assign(a,{id:null,qrqcNo:"",occurrenceTime:null,reporter:"",problemType:"quality",urgencyLevel:"medium",impactLevel:"moderate",title:"",location:"",problemDescription:"",relatedProducts:"",relatedEquipment:"",temporaryMeasures:"",rootCauseAnalysis:"",correctiveActions:"",preventiveActions:"",responsiblePerson:"",deadline:null,responseTime:"2小时",verificationResult:"pending",closeTime:null,processor:"",remark:"",status:"pending"}),(n=A.value)==null||n.resetFields()};return pe(()=>{U()}),(n,l)=>{const i=d("a-button"),m=d("a-input"),r=d("a-form-item"),g=d("a-select"),H=d("a-form"),R=d("a-tag"),se=d("a-popconfirm"),ue=d("a-space"),ie=d("a-table"),s=d("a-col"),N=d("a-date-picker"),b=d("a-row"),w=d("a-textarea"),de=d("a-modal");return v(),z("div",ge,[Q("div",be,[l[28]||(l[28]=Q("h1",null,"QRQC快速反应单",-1)),e(i,{type:"primary",onClick:X},{icon:t(()=>[e(me(ce))]),default:t(()=>[l[27]||(l[27]=c(" 新建反应单 ",-1))]),_:1})]),Q("div",ye,[e(H,{layout:"inline",model:p},{default:t(()=>[e(r,{label:"反应单号"},{default:t(()=>[e(m,{value:p.qrqcNo,"onUpdate:value":l[0]||(l[0]=o=>p.qrqcNo=o),placeholder:"请输入反应单号"},null,8,["value"])]),_:1}),e(r,{label:"问题类型"},{default:t(()=>[e(g,{value:p.problemType,"onUpdate:value":l[1]||(l[1]=o=>p.problemType=o),placeholder:"请选择问题类型",style:{width:"150px"},options:[{value:"quality",label:"质量问题"},{value:"equipment",label:"设备故障"},{value:"process",label:"工艺异常"},{value:"material",label:"材料问题"},{value:"safety",label:"安全问题"}]},null,8,["value"])]),_:1}),e(r,{label:"紧急程度"},{default:t(()=>[e(g,{value:p.urgencyLevel,"onUpdate:value":l[2]||(l[2]=o=>p.urgencyLevel=o),placeholder:"请选择紧急程度",style:{width:"120px"},options:[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"},{value:"urgent",label:"紧急"}]},null,8,["value"])]),_:1}),e(r,{label:"处理状态"},{default:t(()=>[e(g,{value:p.status,"onUpdate:value":l[3]||(l[3]=o=>p.status=o),placeholder:"请选择处理状态",style:{width:"120px"},options:[{value:"pending",label:"待处理"},{value:"processing",label:"处理中"},{value:"resolved",label:"已解决"},{value:"closed",label:"已关闭"}]},null,8,["value"])]),_:1}),e(r,null,{default:t(()=>[e(i,{type:"primary",onClick:S},{default:t(()=>[...l[29]||(l[29]=[c("查询",-1)])]),_:1}),e(i,{style:{"margin-left":"8px"},onClick:K},{default:t(()=>[...l[30]||(l[30]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(ie,{columns:E,"data-source":f.value,pagination:_,loading:L.value,onChange:W,"row-key":"id"},{bodyCell:t(({column:o,record:u})=>[o.key==="status"?(v(),k(R,{key:0,color:B(u.status)},{default:t(()=>[c(M(O(u.status)),1)]),_:2},1032,["color"])):y("",!0),o.key==="problemType"?(v(),k(R,{key:1,color:V(u.problemType)},{default:t(()=>[c(M(j(u.problemType)),1)]),_:2},1032,["color"])):y("",!0),o.key==="urgencyLevel"?(v(),k(R,{key:2,color:F(u.urgencyLevel)},{default:t(()=>[c(M(J(u.urgencyLevel)),1)]),_:2},1032,["color"])):y("",!0),o.key==="responseTime"?(v(),z("span",{key:3,class:ve({overdue:G(u)})},M(u.responseTime),3)):y("",!0),o.key==="action"?(v(),k(ue,{key:4},{default:t(()=>[e(i,{type:"link",size:"small",onClick:x=>Z(u)},{default:t(()=>[...l[31]||(l[31]=[c("编辑",-1)])]),_:1},8,["onClick"]),e(i,{type:"link",size:"small",onClick:x=>ee(u)},{default:t(()=>[...l[32]||(l[32]=[c("查看",-1)])]),_:1},8,["onClick"]),u.status==="pending"?(v(),k(i,{key:0,type:"link",size:"small",onClick:x=>le(u)},{default:t(()=>[...l[33]||(l[33]=[c(" 开始处理 ",-1)])]),_:1},8,["onClick"])):y("",!0),u.status==="processing"?(v(),k(i,{key:1,type:"link",size:"small",onClick:x=>te(u)},{default:t(()=>[...l[34]||(l[34]=[c(" 解决 ",-1)])]),_:1},8,["onClick"])):y("",!0),u.status==="resolved"?(v(),k(i,{key:2,type:"link",size:"small",onClick:x=>ae(u)},{default:t(()=>[...l[35]||(l[35]=[c(" 关闭 ",-1)])]),_:1},8,["onClick"])):y("",!0),e(se,{title:"确定要删除这个反应单吗？",onConfirm:x=>oe(u.id)},{default:t(()=>[e(i,{type:"link",size:"small",danger:""},{default:t(()=>[...l[36]||(l[36]=[c("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):y("",!0)]),_:1},8,["data-source","pagination","loading"]),e(de,{visible:C.value,"onUpdate:visible":l[26]||(l[26]=o=>C.value=o),title:D.value?"编辑反应单":"新建反应单",width:"1200px",onOk:ne,onCancel:re},{default:t(()=>[e(H,{ref_key:"formRef",ref:A,model:a,rules:$,layout:"vertical"},{default:t(()=>[e(b,{gutter:16},{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"反应单号",name:"qrqcNo"},{default:t(()=>[e(m,{value:a.qrqcNo,"onUpdate:value":l[4]||(l[4]=o=>a.qrqcNo=o),placeholder:"系统自动生成",disabled:""},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"发生时间",name:"occurrenceTime"},{default:t(()=>[e(N,{value:a.occurrenceTime,"onUpdate:value":l[5]||(l[5]=o=>a.occurrenceTime=o),"show-time":"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"报告人",name:"reporter"},{default:t(()=>[e(m,{value:a.reporter,"onUpdate:value":l[6]||(l[6]=o=>a.reporter=o),placeholder:"请输入报告人姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"问题类型",name:"problemType"},{default:t(()=>[e(g,{value:a.problemType,"onUpdate:value":l[7]||(l[7]=o=>a.problemType=o),placeholder:"请选择问题类型",options:[{value:"quality",label:"质量问题"},{value:"equipment",label:"设备故障"},{value:"process",label:"工艺异常"},{value:"material",label:"材料问题"},{value:"safety",label:"安全问题"}]},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"紧急程度",name:"urgencyLevel"},{default:t(()=>[e(g,{value:a.urgencyLevel,"onUpdate:value":l[8]||(l[8]=o=>a.urgencyLevel=o),placeholder:"请选择紧急程度",options:[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"},{value:"urgent",label:"紧急"}]},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"影响程度",name:"impactLevel"},{default:t(()=>[e(g,{value:a.impactLevel,"onUpdate:value":l[9]||(l[9]=o=>a.impactLevel=o),placeholder:"请选择影响程度",options:[{value:"minor",label:"轻微"},{value:"moderate",label:"一般"},{value:"serious",label:"严重"},{value:"critical",label:"关键"}]},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{label:"问题标题",name:"title"},{default:t(()=>[e(m,{value:a.title,"onUpdate:value":l[10]||(l[10]=o=>a.title=o),placeholder:"请输入问题标题"},null,8,["value"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{label:"发生地点",name:"location"},{default:t(()=>[e(m,{value:a.location,"onUpdate:value":l[11]||(l[11]=o=>a.location=o),placeholder:"请输入发生地点"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(r,{label:"问题描述",name:"problemDescription"},{default:t(()=>[e(w,{value:a.problemDescription,"onUpdate:value":l[12]||(l[12]=o=>a.problemDescription=o),rows:4,placeholder:"请详细描述问题情况"},null,8,["value"])]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{label:"相关产品",name:"relatedProducts"},{default:t(()=>[e(m,{value:a.relatedProducts,"onUpdate:value":l[13]||(l[13]=o=>a.relatedProducts=o),placeholder:"请输入相关产品信息"},null,8,["value"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{label:"相关设备",name:"relatedEquipment"},{default:t(()=>[e(m,{value:a.relatedEquipment,"onUpdate:value":l[14]||(l[14]=o=>a.relatedEquipment=o),placeholder:"请输入相关设备信息"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{label:"临时措施",name:"temporaryMeasures"},{default:t(()=>[e(w,{value:a.temporaryMeasures,"onUpdate:value":l[15]||(l[15]=o=>a.temporaryMeasures=o),rows:3,placeholder:"请描述已采取的临时措施"},null,8,["value"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{label:"根本原因分析",name:"rootCauseAnalysis"},{default:t(()=>[e(w,{value:a.rootCauseAnalysis,"onUpdate:value":l[16]||(l[16]=o=>a.rootCauseAnalysis=o),rows:3,placeholder:"请分析根本原因"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{label:"纠正措施",name:"correctiveActions"},{default:t(()=>[e(w,{value:a.correctiveActions,"onUpdate:value":l[17]||(l[17]=o=>a.correctiveActions=o),rows:3,placeholder:"请制定纠正措施"},null,8,["value"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{label:"预防措施",name:"preventiveActions"},{default:t(()=>[e(w,{value:a.preventiveActions,"onUpdate:value":l[18]||(l[18]=o=>a.preventiveActions=o),rows:3,placeholder:"请制定预防措施"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"责任人",name:"responsiblePerson"},{default:t(()=>[e(m,{value:a.responsiblePerson,"onUpdate:value":l[19]||(l[19]=o=>a.responsiblePerson=o),placeholder:"请输入责任人姓名"},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"完成期限",name:"deadline"},{default:t(()=>[e(N,{value:a.deadline,"onUpdate:value":l[20]||(l[20]=o=>a.deadline=o),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"响应时间要求",name:"responseTime"},{default:t(()=>[e(g,{value:a.responseTime,"onUpdate:value":l[21]||(l[21]=o=>a.responseTime=o),placeholder:"请选择响应时间要求",options:[{value:"30分钟",label:"30分钟"},{value:"1小时",label:"1小时"},{value:"2小时",label:"2小时"},{value:"4小时",label:"4小时"},{value:"8小时",label:"8小时"},{value:"24小时",label:"24小时"}]},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(b,{gutter:16},{default:t(()=>[e(s,{span:8},{default:t(()=>[e(r,{label:"验证结果",name:"verificationResult"},{default:t(()=>[e(g,{value:a.verificationResult,"onUpdate:value":l[22]||(l[22]=o=>a.verificationResult=o),placeholder:"请选择验证结果",options:[{value:"effective",label:"有效"},{value:"partially-effective",label:"部分有效"},{value:"ineffective",label:"无效"},{value:"pending",label:"待验证"}]},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"关闭时间",name:"closeTime"},{default:t(()=>[e(N,{value:a.closeTime,"onUpdate:value":l[23]||(l[23]=o=>a.closeTime=o),"show-time":"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(s,{span:8},{default:t(()=>[e(r,{label:"处理人",name:"processor"},{default:t(()=>[e(m,{value:a.processor,"onUpdate:value":l[24]||(l[24]=o=>a.processor=o),placeholder:"请输入处理人姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(r,{label:"备注",name:"remark"},{default:t(()=>[e(w,{value:a.remark,"onUpdate:value":l[25]||(l[25]=o=>a.remark=o),rows:2,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}},Ce=fe(Te,[["__scopeId","data-v-81c3339c"]]);export{Ce as default};
