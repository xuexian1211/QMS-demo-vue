import{d as fe,r as f,k as O,j as _e,a as be,m as Ce,c as y,e as L,x as t,f as u,q as e,s as p,p as k,t as C,o as s,h as i,y as x,K as Ne,F as R,z as ge,P,C as c,u as Ie}from"./index-BsO03Xlk.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const he={class:"page-container"},Te={class:"page-header"},xe={class:"header-left"},Re={class:"title-section"},Ae={class:"page-title"},Se={key:0,class:"header-actions"},Le={key:0,class:"tab-toolbar"},Pe={key:0,class:"tab-toolbar"},Qe={key:0,class:"tab-toolbar"},Ve={key:0,class:"tab-toolbar"},ze=fe({__name:"InspPlanEdit",setup(Ee){const M=Ie(),Q=_e(),U=f(),V=f(!1),D=f("binding"),d=O(()=>Q.path.includes("/view/")),B=O(()=>Q.path.includes("/edit/")),H=O(()=>d.value?"查看检验方案":B.value?"编辑检验方案":"新增检验方案"),J=f([{id:"1",name:"IQC原材料检验模板"},{id:"2",name:"IPQC过程检验模板"},{id:"3",name:"FQC成品检验模板"},{id:"4",name:"OQC出货检验模板"}]),o=be({id:null,planCode:"",planName:"",version:"V1.0",status:"DRAFT",inspType:void 0,templateId:void 0,remark:""}),W={planCode:[{required:!0,message:"请输入方案编码",trigger:"blur"}],planName:[{required:!0,message:"请输入方案名称",trigger:"blur"}],inspType:[{required:!0,message:"请选择检验类型",trigger:"change"}]},F=n=>({DRAFT:"default",IN_APPROVAL:"processing",APPROVED:"success",OBSOLETE:"error"})[n]||"default",$=n=>({DRAFT:"草稿",IN_APPROVAL:"审批中",APPROVED:"已批准",OBSOLETE:"已作废"})[n]||n,N=f([]),X=[{title:"业务上下文",dataIndex:"contextType",key:"contextType",width:120},{title:"物料编码",dataIndex:"materialCode",key:"materialCode",width:120},{title:"物料名称",dataIndex:"materialName",key:"materialName",width:150},{title:"供应商",dataIndex:"supplierName",key:"supplierName",width:120},{title:"工序",dataIndex:"operationName",key:"operationName",width:100},{title:"优先级",dataIndex:"priority",key:"priority",width:80},{title:"操作",key:"action",width:120}],g=f([]),Y=[{title:"检验项目",dataIndex:"itemName",key:"itemName",width:150},{title:"抽样规则",dataIndex:"samplingRuleName",key:"samplingRuleName",width:150},{title:"检验方法",dataIndex:"methodName",key:"methodName",width:120},{title:"量检具",dataIndex:"instrumentName",key:"instrumentName",width:100},{title:"实验室",key:"isLabTestRequired",width:80},{title:"SPC",key:"isSpcRequired",width:60},{title:"操作",key:"action",width:120}],I=f([]),Z=[{title:"检验项目",dataIndex:"itemName",key:"itemName",width:150},{title:"不良现象",dataIndex:"phenomenonName",key:"phenomenonName",width:200},{title:"不良分类",dataIndex:"categoryName",key:"categoryName",width:120},{title:"操作",key:"action",width:80}],w=f([]),ee=[{title:"物料编码",dataIndex:"materialCode",key:"materialCode",width:120},{title:"检验项目",dataIndex:"inspItemName",key:"inspItemName",width:120},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:100},{title:"目标值",dataIndex:"targetValue",key:"targetValue",width:80},{title:"上限",dataIndex:"upperLimit",key:"upperLimit",width:80},{title:"下限",dataIndex:"lowerLimit",key:"lowerLimit",width:80},{title:"单位",dataIndex:"uom",key:"uom",width:60},{title:"操作",key:"action",width:120}],ae=()=>{M.push("/inspection-model/insp-plans")},te=async()=>{var n;try{V.value=!0,await((n=U.value)==null?void 0:n.validate()),c.success("保存成功"),M.push("/inspection-model/insp-plans")}catch{c.error("请完善必填项")}finally{V.value=!1}},le=()=>{N.value.push({id:Date.now().toString(),contextType:"IQC",materialCode:"M001",materialName:"铝锭",supplierName:"供应商A",operationName:"",priority:10}),c.success("已添加绑定")},ne=n=>{c.info("编辑绑定: "+n.id)},ie=n=>{N.value=N.value.filter(a=>a.id!==n.id),c.success("已删除绑定")},se=()=>{g.value.push({id:Date.now().toString(),itemName:"长度",samplingRuleName:"AQL 0.65 Level II",methodName:"卡尺测量",instrumentName:"游标卡尺",isLabTestRequired:!1,isSpcRequired:!0}),c.success("已添加明细")},oe=n=>{c.info("编辑明细: "+n.id)},de=n=>{g.value=g.value.filter(a=>a.id!==n.id),c.success("已删除明细")},ue=()=>{I.value.push({id:Date.now().toString(),itemName:"长度",phenomenonName:"尺寸超差",categoryName:"尺寸类"}),c.success("已添加不良现象绑定")},re=n=>{I.value=I.value.filter(a=>a.id!==n.id),c.success("已删除不良现象绑定")},pe=()=>{w.value.push({id:Date.now().toString(),materialCode:"M001",inspItemName:"长度",dataType:"QUANTITATIVE",targetValue:100,upperLimit:101,lowerLimit:99,uom:"mm"}),c.success("已添加物料规格")},me=n=>{c.info("编辑物料规格: "+n.id)},ce=n=>{w.value=w.value.filter(a=>a.id!==n.id),c.success("已删除物料规格")};return Ce(()=>{const n=Q.params.id;n&&(Object.assign(o,{id:n,planCode:"IP-HFC-CASTING",planName:"合肥工厂-压铸件通用方案",version:"V1.0",status:"APPROVED",inspType:"IPQC",templateId:"2",remark:"用于压铸件过程检验"}),N.value=[{id:"801",contextType:"IPQC",materialCode:"M007",materialName:"压铸件壳体",supplierName:"",operationName:"压铸工序",priority:10}],g.value=[{id:"701",itemName:"壳体A面平面度",samplingRuleName:"AQL 0.65",methodName:"三坐标测量",instrumentName:"三坐标测量机",isLabTestRequired:!1,isSpcRequired:!0}],I.value=[{id:"1",itemName:"壳体A面平面度",phenomenonName:"平面度超差",categoryName:"尺寸类"}],w.value=[{id:"901",materialCode:"M007",inspItemName:"壳体A面平面度",dataType:"QUANTITATIVE",targetValue:.05,upperLimit:.08,lowerLimit:0,uom:"mm"}])}),(n,a)=>{const m=p("a-button"),h=p("a-tag"),z=p("a-input"),_=p("a-form-item"),b=p("a-col"),E=p("a-row"),T=p("a-select-option"),K=p("a-select"),ye=p("a-textarea"),ve=p("a-form"),j=p("a-card"),q=p("a-space"),A=p("a-table"),S=p("a-tab-pane"),G=p("a-switch"),ke=p("a-tabs");return s(),y("div",he,[L("div",Te,[L("div",xe,[t(m,{type:"text",onClick:ae,class:"back-button"},{icon:e(()=>[t(x(Ne))]),default:e(()=>[a[7]||(a[7]=i(" 返回 ",-1))]),_:1}),L("div",Re,[L("h2",Ae,C(H.value),1),o.version?(s(),k(h,{key:0,color:"blue"},{default:e(()=>[i(C(o.version),1)]),_:1})):u("",!0),t(h,{color:F(o.status)},{default:e(()=>[i(C($(o.status)),1)]),_:1},8,["color"])])]),d.value?u("",!0):(s(),y("div",Se,[t(m,{type:"primary",onClick:te,loading:V.value},{default:e(()=>[...a[8]||(a[8]=[i("保存",-1)])]),_:1},8,["loading"])]))]),t(j,{class:"form-card",title:"基本信息"},{default:e(()=>[t(ve,{ref_key:"formRef",ref:U,model:o,rules:W,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:e(()=>[t(E,{gutter:24},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(_,{label:"方案编码",name:"planCode"},{default:e(()=>[t(z,{value:o.planCode,"onUpdate:value":a[0]||(a[0]=l=>o.planCode=l),disabled:d.value||B.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(_,{label:"方案名称",name:"planName"},{default:e(()=>[t(z,{value:o.planName,"onUpdate:value":a[1]||(a[1]=l=>o.planName=l),disabled:d.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(_,{label:"版本",name:"version"},{default:e(()=>[t(z,{value:o.version,"onUpdate:value":a[2]||(a[2]=l=>o.version=l),disabled:d.value,placeholder:"如：V1.0"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(E,{gutter:24},{default:e(()=>[t(b,{span:8},{default:e(()=>[t(_,{label:"检验类型",name:"inspType"},{default:e(()=>[t(K,{value:o.inspType,"onUpdate:value":a[3]||(a[3]=l=>o.inspType=l),disabled:d.value,placeholder:"请选择"},{default:e(()=>[t(T,{value:"IQC"},{default:e(()=>[...a[9]||(a[9]=[i("IQC来料检验",-1)])]),_:1}),t(T,{value:"IPQC"},{default:e(()=>[...a[10]||(a[10]=[i("IPQC过程检验",-1)])]),_:1}),t(T,{value:"FQC"},{default:e(()=>[...a[11]||(a[11]=[i("FQC成品检验",-1)])]),_:1}),t(T,{value:"OQC"},{default:e(()=>[...a[12]||(a[12]=[i("OQC出货检验",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(_,{label:"关联模板",name:"templateId"},{default:e(()=>[t(K,{value:o.templateId,"onUpdate:value":a[4]||(a[4]=l=>o.templateId=l),disabled:d.value,placeholder:"请选择"},{default:e(()=>[(s(!0),y(R,null,ge(J.value,l=>(s(),k(T,{key:l.id,value:l.id},{default:e(()=>[i(C(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})]),_:1}),t(b,{span:8},{default:e(()=>[t(_,{label:"状态"},{default:e(()=>[t(h,{color:F(o.status)},{default:e(()=>[i(C($(o.status)),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),t(E,{gutter:24},{default:e(()=>[t(b,{span:16},{default:e(()=>[t(_,{label:"备注",name:"remark","label-col":{span:3},"wrapper-col":{span:20}},{default:e(()=>[t(ye,{value:o.remark,"onUpdate:value":a[5]||(a[5]=l=>o.remark=l),disabled:d.value,rows:2,placeholder:"请输入备注"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(j,{class:"tab-card"},{default:e(()=>[t(ke,{activeKey:D.value,"onUpdate:activeKey":a[6]||(a[6]=l=>D.value=l)},{default:e(()=>[t(S,{key:"binding",tab:"方案关联绑定"},{default:e(()=>[d.value?u("",!0):(s(),y("div",Le,[t(m,{type:"primary",size:"small",onClick:le},{icon:e(()=>[t(x(P))]),default:e(()=>[a[13]||(a[13]=i("新增绑定 ",-1))]),_:1})])),t(A,{columns:X,"data-source":N.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:e(({column:l,record:r})=>[l.key==="contextType"?(s(),k(h,{key:0},{default:e(()=>[i(C(r.contextType),1)]),_:2},1024)):u("",!0),l.key==="action"?(s(),y(R,{key:1},[d.value?u("",!0):(s(),k(q,{key:0},{default:e(()=>[t(m,{type:"link",size:"small",onClick:v=>ne(r)},{default:e(()=>[...a[14]||(a[14]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(m,{type:"link",danger:"",size:"small",onClick:v=>ie(r)},{default:e(()=>[...a[15]||(a[15]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024))],64)):u("",!0)]),_:1},8,["data-source"])]),_:1}),t(S,{key:"details",tab:"方案明细"},{default:e(()=>[d.value?u("",!0):(s(),y("div",Pe,[t(m,{type:"primary",size:"small",onClick:se},{icon:e(()=>[t(x(P))]),default:e(()=>[a[16]||(a[16]=i("新增明细 ",-1))]),_:1})])),t(A,{columns:Y,"data-source":g.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:e(({column:l,record:r})=>[l.key==="isLabTestRequired"?(s(),k(G,{key:0,checked:r.isLabTestRequired,"onUpdate:checked":v=>r.isLabTestRequired=v,disabled:d.value,size:"small"},null,8,["checked","onUpdate:checked","disabled"])):u("",!0),l.key==="isSpcRequired"?(s(),k(G,{key:1,checked:r.isSpcRequired,"onUpdate:checked":v=>r.isSpcRequired=v,disabled:d.value,size:"small"},null,8,["checked","onUpdate:checked","disabled"])):u("",!0),l.key==="action"?(s(),y(R,{key:2},[d.value?u("",!0):(s(),k(q,{key:0},{default:e(()=>[t(m,{type:"link",size:"small",onClick:v=>oe(r)},{default:e(()=>[...a[17]||(a[17]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(m,{type:"link",danger:"",size:"small",onClick:v=>de(r)},{default:e(()=>[...a[18]||(a[18]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024))],64)):u("",!0)]),_:1},8,["data-source"])]),_:1}),t(S,{key:"phenomenon",tab:"明细不良现象绑定"},{default:e(()=>[d.value?u("",!0):(s(),y("div",Qe,[t(m,{type:"primary",size:"small",onClick:ue},{icon:e(()=>[t(x(P))]),default:e(()=>[a[19]||(a[19]=i("新增绑定 ",-1))]),_:1})])),t(A,{columns:Z,"data-source":I.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:e(({column:l,record:r})=>[l.key==="action"?(s(),y(R,{key:0},[d.value?u("",!0):(s(),k(m,{key:0,type:"link",danger:"",size:"small",onClick:v=>re(r)},{default:e(()=>[...a[20]||(a[20]=[i("删除",-1)])]),_:1},8,["onClick"]))],64)):u("",!0)]),_:1},8,["data-source"])]),_:1}),t(S,{key:"materialSpec",tab:"物料检验规格"},{default:e(()=>[d.value?u("",!0):(s(),y("div",Ve,[t(m,{type:"primary",size:"small",onClick:pe},{icon:e(()=>[t(x(P))]),default:e(()=>[a[21]||(a[21]=i("新增规格 ",-1))]),_:1})])),t(A,{columns:ee,"data-source":w.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:e(({column:l,record:r})=>[l.key==="dataType"?(s(),k(h,{key:0,color:r.dataType==="QUANTITATIVE"?"blue":"purple"},{default:e(()=>[i(C(r.dataType==="QUANTITATIVE"?"计量型":"计数型"),1)]),_:2},1032,["color"])):u("",!0),l.key==="action"?(s(),y(R,{key:1},[d.value?u("",!0):(s(),k(q,{key:0},{default:e(()=>[t(m,{type:"link",size:"small",onClick:v=>me(r)},{default:e(()=>[...a[22]||(a[22]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(m,{type:"link",danger:"",size:"small",onClick:v=>ce(r)},{default:e(()=>[...a[23]||(a[23]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024))],64)):u("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["activeKey"])]),_:1})])}}}),Me=we(ze,[["__scopeId","data-v-f7464c4a"]]);export{Me as default};
