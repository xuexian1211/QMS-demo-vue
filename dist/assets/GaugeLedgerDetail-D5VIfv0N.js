import{d as V,r as T,E as C,l as $,p as I,q as t,s as r,o as b,x as e,h as l,k as it,t as i,c as M,z as X,F as H,a as ut,m as ct,j as dt,e as v,y as z,K as mt,n as _t,P as ft,f as q,u as pt,C as P}from"./index-C4MSyl8P.js";import{U as bt}from"./UploadOutlined-D7G5Igqs.js";import{_ as vt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const gt=V({__name:"CalibrationRecordModal",props:{visible:{type:Boolean}},emits:["update:visible","submit"],setup(D,{emit:O}){const R=D,g=O,a=T({calibrationType:"INTERNAL",calibrationDate:C(),result:"PASS",calibrationOrg:"",calibrator:"",certificateNo:"",conclusion:""});$(()=>R.visible,L=>{L&&(a.value={calibrationType:"INTERNAL",calibrationDate:C(),result:"PASS",calibrationOrg:"",calibrator:"",certificateNo:"",conclusion:""})});const k=()=>{a.value.calibrationDate&&g("submit",{...a.value})},N=()=>{g("update:visible",!1)};return(L,o)=>{const A=r("a-radio"),U=r("a-radio-group"),m=r("a-form-item"),f=r("a-col"),F=r("a-date-picker"),S=r("a-row"),x=r("a-select-option"),B=r("a-select"),w=r("a-input"),h=r("a-textarea"),E=r("a-form"),_=r("a-modal");return b(),I(_,{visible:D.visible,title:"新增校准记录",width:"600px",onOk:k,onCancel:N,"onUpdate:visible":o[7]||(o[7]=c=>g("update:visible",c))},{default:t(()=>[e(E,{layout:"vertical",model:a.value},{default:t(()=>[e(S,{gutter:16},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(m,{label:"校准类型",required:""},{default:t(()=>[e(U,{value:a.value.calibrationType,"onUpdate:value":o[0]||(o[0]=c=>a.value.calibrationType=c)},{default:t(()=>[e(A,{value:"INTERNAL"},{default:t(()=>[...o[8]||(o[8]=[l("内部校准",-1)])]),_:1}),e(A,{value:"EXTERNAL"},{default:t(()=>[...o[9]||(o[9]=[l("外部校准",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(m,{label:"校准日期",required:""},{default:t(()=>[e(F,{value:a.value.calibrationDate,"onUpdate:value":o[1]||(o[1]=c=>a.value.calibrationDate=c),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:16},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(m,{label:"校准结果",required:""},{default:t(()=>[e(B,{value:a.value.result,"onUpdate:value":o[2]||(o[2]=c=>a.value.result=c)},{default:t(()=>[e(x,{value:"PASS"},{default:t(()=>[...o[10]||(o[10]=[l("合格",-1)])]),_:1}),e(x,{value:"FAIL"},{default:t(()=>[...o[11]||(o[11]=[l("不合格",-1)])]),_:1}),e(x,{value:"CONDITIONAL"},{default:t(()=>[...o[12]||(o[12]=[l("有条件合格",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(m,{label:"校准机构"},{default:t(()=>[e(w,{value:a.value.calibrationOrg,"onUpdate:value":o[3]||(o[3]=c=>a.value.calibrationOrg=c),placeholder:"请输入校准机构"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:16},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(m,{label:"校准人员"},{default:t(()=>[e(w,{value:a.value.calibrator,"onUpdate:value":o[4]||(o[4]=c=>a.value.calibrator=c),placeholder:"请输入校准人员"},null,8,["value"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(m,{label:"证书编号"},{default:t(()=>[e(w,{value:a.value.certificateNo,"onUpdate:value":o[5]||(o[5]=c=>a.value.certificateNo=c),placeholder:"请输入证书编号"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(m,{label:"结论/备注"},{default:t(()=>[e(h,{value:a.value.conclusion,"onUpdate:value":o[6]||(o[6]=c=>a.value.conclusion=c),rows:2,placeholder:"请输入校准结论或备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),St=V({__name:"GaugeStatusChangeModal",props:{visible:{type:Boolean},currentStatus:{}},emits:["update:visible","submit"],setup(D,{emit:O}){const R=D,g=O,a=T({toStatus:"",reason:""}),k={IN_USE:["CALIBRATING","SEALED","SCRAPPED"],CALIBRATING:["IN_USE","SEALED","SCRAPPED"],SEALED:["IN_USE","SCRAPPED"],SCRAPPED:[]},N=it(()=>k[R.currentStatus]||[]);$(()=>R.visible,m=>{m&&(a.value={toStatus:N.value[0]||"",reason:""})});const L=()=>{!a.value.toStatus||!a.value.reason||g("submit",{...a.value})},o=()=>{g("update:visible",!1)},A=m=>{switch(m){case"IN_USE":return"green";case"CALIBRATING":return"orange";case"SEALED":return"gray";case"SCRAPPED":return"red";default:return"default"}},U=m=>{switch(m){case"IN_USE":return"在用";case"CALIBRATING":return"校准中";case"SEALED":return"封存";case"SCRAPPED":return"报废";default:return m}};return(m,f)=>{const F=r("a-tag"),S=r("a-form-item"),x=r("a-select-option"),B=r("a-select"),w=r("a-textarea"),h=r("a-form"),E=r("a-modal");return b(),I(E,{visible:D.visible,title:"状态变更",onOk:L,onCancel:o,"onUpdate:visible":f[2]||(f[2]=_=>g("update:visible",_))},{default:t(()=>[e(h,{layout:"vertical",model:a.value},{default:t(()=>[e(S,{label:"当前状态"},{default:t(()=>[e(F,{color:A(D.currentStatus)},{default:t(()=>[l(i(U(D.currentStatus)),1)]),_:1},8,["color"])]),_:1}),e(S,{label:"变更为",required:""},{default:t(()=>[e(B,{value:a.value.toStatus,"onUpdate:value":f[0]||(f[0]=_=>a.value.toStatus=_)},{default:t(()=>[(b(!0),M(H,null,X(N.value,_=>(b(),I(x,{key:_,value:_},{default:t(()=>[l(i(U(_)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e(S,{label:"变更原因",required:""},{default:t(()=>[e(w,{value:a.value.reason,"onUpdate:value":f[1]||(f[1]=_=>a.value.reason=_),rows:3,placeholder:"请输入状态变更原因"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),yt={class:"page-container"},Ct={class:"page-header"},Nt={class:"header-left"},At={class:"title-section"},It={class:"page-title"},Dt={class:"header-actions"},Et={class:"tab-toolbar"},Tt={class:"timeline-time"},kt={class:"timeline-change"},Lt={key:0,class:"timeline-reason"},xt={class:"tab-toolbar"},wt=V({__name:"GaugeLedgerDetail",setup(D){const O=dt(),R=pt(),g=T("calibration"),a=ut({id:"",gaugeNo:"",gaugeName:"",status:"IN_USE"}),k=T([]),N=T([]),L=T([]),o=T(!1),A=T(!1),U=[{title:"校准日期",dataIndex:"calibrationDate",key:"calibrationDate",width:110},{title:"类型",key:"calibrationType",width:80},{title:"结果",key:"result",width:100},{title:"校准机构",dataIndex:"calibrationOrg",key:"calibrationOrg",width:150},{title:"校准人员",dataIndex:"calibrator",key:"calibrator",width:100},{title:"证书编号",dataIndex:"certificateNo",key:"certificateNo",width:150},{title:"结论",dataIndex:"conclusion",key:"conclusion"}],m=[{title:"文件名",dataIndex:"fileName",key:"fileName",width:200},{title:"文件类型",dataIndex:"fileType",key:"fileType",width:100},{title:"上传时间",dataIndex:"uploadTime",key:"uploadTime",width:150},{title:"操作",key:"action",width:120}],f=()=>{R.push("/inspection-model/gauge-ledgers")},F=()=>{P.info("编辑功能待实现")},S=()=>{Object.assign(calibrationForm,{calibrationType:"INTERNAL",calibrationDate:C(),result:"PASS",calibrationOrg:"",calibrator:"",certificateNo:"",conclusion:""}),o.value=!0},x=()=>{S()},B=()=>{if(!calibrationForm.calibrationDate){P.warn("请选择校准日期");return}const n={id:Date.now().toString(),gaugeId:a.id,calibrationType:calibrationForm.calibrationType,calibrationDate:C(calibrationForm.calibrationDate).format("YYYY-MM-DD"),nextCalDate:C(calibrationForm.calibrationDate).add(a.calibrationCycle||12,"month").format("YYYY-MM-DD"),result:calibrationForm.result,calibrationOrg:calibrationForm.calibrationOrg,calibrator:calibrationForm.calibrator,certificateNo:calibrationForm.certificateNo,conclusion:calibrationForm.conclusion};k.value.unshift(n),a.lastCalDate=n.calibrationDate,a.nextCalDate=n.nextCalDate,a.certificateNo=n.certificateNo,P.success("校准记录保存成功"),o.value=!1},w=()=>{if(availableStatuses.value.length===0){P.warn("当前状态无法变更（终态）");return}statusForm.toStatus=availableStatuses.value[0],statusForm.reason="",A.value=!0},h=()=>{if(!statusForm.toStatus||!statusForm.reason){P.warn("请填写完整信息");return}const n={id:Date.now().toString(),gaugeId:a.id,fromStatus:a.status,toStatus:statusForm.toStatus,reason:statusForm.reason,operator:"当前用户",operateTime:C().format("YYYY-MM-DD HH:mm:ss")};N.value.unshift(n),a.status=statusForm.toStatus,P.success("状态变更成功"),A.value=!1},E=n=>{switch(n){case"IN_USE":return"green";case"CALIBRATING":return"orange";case"SEALED":return"gray";case"SCRAPPED":return"red";default:return"default"}},_=n=>{switch(n){case"IN_USE":return"在用";case"CALIBRATING":return"校准中";case"SEALED":return"封存";case"SCRAPPED":return"报废";default:return"-"}},c=n=>{if(!n)return"default";const s=C(),p=C(n).diff(s,"day");return p<0?"red":p<=14?"orange":"green"},J=n=>{if(!n)return"-";const s=C(),p=C(n).diff(s,"day");return p<0?"已过期":p<=14?"即将到期":"正常"},Q=n=>{const s=c(n);return{"cal-danger":s==="red","cal-warning":s==="orange","cal-normal":s==="green"}},W=n=>{switch(n){case"PASS":return"green";case"FAIL":return"red";case"CONDITIONAL":return"orange";default:return"default"}},Z=n=>{switch(n){case"PASS":return"合格";case"FAIL":return"不合格";case"CONDITIONAL":return"有条件合格";default:return n}},tt=n=>{switch(n){case"IN_USE":return"green";case"CALIBRATING":return"orange";case"SEALED":return"gray";case"SCRAPPED":return"red";default:return"blue"}};return ct(()=>{const n=O.params.id;n&&(Object.assign(a,{id:n,gaugeNo:"G-001",gaugeName:"数显卡尺01",typeId:"301",typeName:"数显卡尺",model:"M-150",manufacturer:"三丰",serialNo:"SN2023001",measureRange:"0-150mm",resolution:.01,accuracy:"±0.02mm",calibrationCycle:12,lastCalDate:"2023-06-15",nextCalDate:"2024-06-15",status:"IN_USE",location:"产线A",custodian:"张三",certificateNo:"CAL-2023-0001",purchaseDate:"2022-01-15",description:"产线A使用"}),k.value=[{id:"1",gaugeId:n,calibrationType:"EXTERNAL",calibrationDate:"2023-06-15",nextCalDate:"2024-06-15",result:"PASS",calibrationOrg:"省计量院",calibrator:"张工",certificateNo:"CAL-2023-0001",conclusion:"各项指标合格"},{id:"2",gaugeId:n,calibrationType:"EXTERNAL",calibrationDate:"2022-06-10",nextCalDate:"2023-06-10",result:"PASS",calibrationOrg:"省计量院",calibrator:"李工",certificateNo:"CAL-2022-0088",conclusion:"合格"}],N.value=[{id:"1",gaugeId:n,fromStatus:"CALIBRATING",toStatus:"IN_USE",reason:"校准完成，恢复使用",operator:"张三",operateTime:"2023-06-16 09:30:00"},{id:"2",gaugeId:n,fromStatus:"IN_USE",toStatus:"CALIBRATING",reason:"定期校准",operator:"张三",operateTime:"2023-06-10 14:00:00"}],L.value=[{id:"1",fileName:"CAL-2023-0001.pdf",fileType:"PDF",uploadTime:"2023-06-16"}])}),(n,s)=>{const y=r("a-button"),p=r("a-tag"),d=r("a-descriptions-item"),et=r("a-descriptions"),j=r("a-card"),K=r("a-table"),Y=r("a-tab-pane"),at=r("a-timeline-item"),lt=r("a-timeline"),ot=r("a-empty"),nt=r("a-upload"),st=r("a-space"),rt=r("a-tabs");return b(),M("div",yt,[v("div",Ct,[v("div",Nt,[e(y,{type:"text",onClick:f,class:"back-button"},{icon:t(()=>[e(z(mt))]),default:t(()=>[s[3]||(s[3]=l(" 返回 ",-1))]),_:1}),v("div",At,[v("h2",It,"量检具详情: "+i(a.gaugeNo),1),e(p,{color:E(a.status)},{default:t(()=>[l(i(_(a.status)),1)]),_:1},8,["color"]),e(p,{color:c(a.nextCalDate)},{default:t(()=>[l(i(J(a.nextCalDate)),1)]),_:1},8,["color"])])]),v("div",Dt,[e(y,{type:"primary",onClick:F},{default:t(()=>[...s[4]||(s[4]=[l("编辑",-1)])]),_:1}),e(y,{onClick:S},{default:t(()=>[...s[5]||(s[5]=[l("校准",-1)])]),_:1}),e(y,{onClick:w},{default:t(()=>[...s[6]||(s[6]=[l("状态变更",-1)])]),_:1})])]),e(j,{class:"form-card",title:"基本信息"},{default:t(()=>[e(et,{column:3,bordered:"",size:"small"},{default:t(()=>[e(d,{label:"量具编号"},{default:t(()=>[l(i(a.gaugeNo),1)]),_:1}),e(d,{label:"量具名称"},{default:t(()=>[l(i(a.gaugeName),1)]),_:1}),e(d,{label:"规格型号"},{default:t(()=>[l(i(a.model||"-"),1)]),_:1}),e(d,{label:"所属类型"},{default:t(()=>[l(i(a.typeName||"-"),1)]),_:1}),e(d,{label:"制造商"},{default:t(()=>[l(i(a.manufacturer||"-"),1)]),_:1}),e(d,{label:"出厂序列号"},{default:t(()=>[l(i(a.serialNo||"-"),1)]),_:1}),e(d,{label:"量程范围"},{default:t(()=>[l(i(a.measureRange||"-"),1)]),_:1}),e(d,{label:"分辨率"},{default:t(()=>[l(i(a.resolution?`${a.resolution}mm`:"-"),1)]),_:1}),e(d,{label:"精度等级"},{default:t(()=>[l(i(a.accuracy||"-"),1)]),_:1}),e(d,{label:"校准周期"},{default:t(()=>[l(i(a.calibrationCycle?`${a.calibrationCycle} 个月`:"-"),1)]),_:1}),e(d,{label:"上次校准"},{default:t(()=>[l(i(a.lastCalDate||"-"),1)]),_:1}),e(d,{label:"下次校准"},{default:t(()=>[v("span",{class:_t(Q(a.nextCalDate))},i(a.nextCalDate||"-"),3)]),_:1}),e(d,{label:"当前状态"},{default:t(()=>[e(p,{color:E(a.status)},{default:t(()=>[l(i(_(a.status)),1)]),_:1},8,["color"])]),_:1}),e(d,{label:"保管人"},{default:t(()=>[l(i(a.custodian||"-"),1)]),_:1}),e(d,{label:"存放位置"},{default:t(()=>[l(i(a.location||"-"),1)]),_:1}),e(d,{label:"购置日期"},{default:t(()=>[l(i(a.purchaseDate||"-"),1)]),_:1}),e(d,{label:"证书编号"},{default:t(()=>[l(i(a.certificateNo||"-"),1)]),_:1}),e(d,{label:"描述"},{default:t(()=>[l(i(a.description||"-"),1)]),_:1})]),_:1})]),_:1}),e(j,{class:"tab-card"},{default:t(()=>[e(rt,{activeKey:g.value,"onUpdate:activeKey":s[0]||(s[0]=u=>g.value=u)},{default:t(()=>[e(Y,{key:"calibration",tab:"校准记录"},{default:t(()=>[v("div",Et,[e(y,{type:"primary",size:"small",onClick:x},{icon:t(()=>[e(z(ft))]),default:t(()=>[s[7]||(s[7]=l(" 新增校准 ",-1))]),_:1})]),e(K,{columns:U,"data-source":k.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:u,record:G})=>[u.key==="calibrationType"?(b(),I(p,{key:0,color:G.calibrationType==="INTERNAL"?"blue":"purple"},{default:t(()=>[l(i(G.calibrationType==="INTERNAL"?"内校":"外校"),1)]),_:2},1032,["color"])):u.key==="result"?(b(),I(p,{key:1,color:W(G.result)},{default:t(()=>[l(i(Z(G.result)),1)]),_:2},1032,["color"])):q("",!0)]),_:1},8,["data-source"])]),_:1}),e(Y,{key:"statusLog",tab:"状态变更"},{default:t(()=>[N.value.length>0?(b(),I(lt,{key:0},{default:t(()=>[(b(!0),M(H,null,X(N.value,u=>(b(),I(at,{key:u.id,color:tt(u.toStatus)},{default:t(()=>[v("p",Tt,i(u.operateTime)+" - "+i(u.operator),1),v("p",kt,[e(p,{color:E(u.fromStatus),size:"small"},{default:t(()=>[l(i(_(u.fromStatus)),1)]),_:2},1032,["color"]),s[8]||(s[8]=v("span",{style:{margin:"0 8px"}},"→",-1)),e(p,{color:E(u.toStatus),size:"small"},{default:t(()=>[l(i(_(u.toStatus)),1)]),_:2},1032,["color"])]),u.reason?(b(),M("p",Lt,"原因："+i(u.reason),1)):q("",!0)]),_:2},1032,["color"]))),128))]),_:1})):(b(),I(ot,{key:1,description:"暂无状态变更记录"}))]),_:1}),e(Y,{key:"attachments",tab:"附件"},{default:t(()=>[v("div",xt,[e(nt,null,{default:t(()=>[e(y,{size:"small"},{icon:t(()=>[e(z(bt))]),default:t(()=>[s[9]||(s[9]=l(" 上传附件 ",-1))]),_:1})]),_:1})]),e(K,{columns:m,"data-source":L.value,"row-key":"id",size:"small",pagination:!1},{bodyCell:t(({column:u,record:G})=>[u.key==="action"?(b(),I(st,{key:0},{default:t(()=>[e(y,{type:"link",size:"small"},{default:t(()=>[...s[10]||(s[10]=[l("下载",-1)])]),_:1}),e(y,{type:"link",danger:"",size:"small"},{default:t(()=>[...s[11]||(s[11]=[l("删除",-1)])]),_:1})]),_:1})):q("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["activeKey"])]),_:1}),e(gt,{visible:o.value,"onUpdate:visible":s[1]||(s[1]=u=>o.value=u),onSubmit:B},null,8,["visible"]),e(St,{visible:A.value,"onUpdate:visible":s[2]||(s[2]=u=>A.value=u),"current-status":a.status,onSubmit:h},null,8,["visible","current-status"])])}}}),Ot=vt(wt,[["__scopeId","data-v-4f21ba94"]]);export{Ot as default};
