import{d as _e,r as f,k as E,j as be,a as ge,m as Ie,c as b,e as h,x as t,f as y,q as a,s as o,p as m,t as g,o as u,h as n,y as P,K as Te,F as U,z as j,P as ke,u as De,C as L}from"./index-Ozo2vowX.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"page-container"},Me={class:"page-header"},Ce={class:"header-left"},Ee={class:"title-section"},qe={class:"page-title"},Se={key:0,class:"header-actions"},Ne={key:1,class:"header-readonly-tip"},xe={key:0,class:"tab-toolbar"},Fe=_e({__name:"InspectionItemEdit",setup(Re){const A=De(),q=be(),S=f("1"),O=f(),N=f(!1),z=f("defects"),i=E(()=>q.path.includes("/view/")),w=E(()=>q.path.includes("/edit/")),r=E(()=>!w.value&&!i.value||S.value===null?!1:l.orgId===null),$=E(()=>i.value?"查看检验项目":w.value?"编辑检验项目":"新增检验项目"),l=ge({id:null,orgId:null,code:"",name:"",category:"dimension",dataType:"quantitative",uom:"",defaultMethodId:void 0,defaultMethodName:"",defaultInstTypeId:void 0,defaultInstTypeName:"",isLabTestDefault:!1,isSpcDefault:!1,description:"",status:"enabled",relatedDefects:[]}),J={code:[{required:!0,message:"请输入项目编码",trigger:"blur"}],name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],dataType:[{required:!0,message:"请选择数据类型",trigger:"change"}]},Q=f([{id:"101",name:"卡尺测量法"},{id:"102",name:"硬度计测量"},{id:"103",name:"目视检查"},{id:"104",name:"涂层测厚仪"},{id:"105",name:"盐雾试验法"},{id:"106",name:"三坐标测量"}]),W=f([{id:"201",name:"0-150mm 数显卡尺"},{id:"202",name:"洛氏硬度计"},{id:"203",name:"涂层测厚仪"},{id:"204",name:"三坐标测量机"},{id:"205",name:"表面粗糙度仪"}]),X=s=>s==="quantitative"?"blue":"purple",Y=s=>s==="quantitative"?"计量型":"计数型",Z=s=>{s==="qualitative"&&(l.uom="")},ee=[{title:"现象代码",dataIndex:"code",key:"code",width:120},{title:"现象名称",dataIndex:"name",key:"name",width:180},{title:"严重等级",key:"severity",width:100},{title:"描述",dataIndex:"description",key:"description"},{title:"操作",key:"action",width:80}],te=[{title:"现象代码",dataIndex:"code",key:"code",width:100},{title:"现象名称",dataIndex:"name",key:"name",width:150},{title:"严重等级",key:"severity",width:80},{title:"描述",dataIndex:"description",key:"description"}],H=s=>{switch(s){case"CR":return"red";case"MA":return"orange";case"MI":return"blue";default:return"default"}},M=f(!1),x=f(!1),K=f([]),C=f([]),F=f([]),ae=()=>{x.value=!0,setTimeout(()=>{const s=l.relatedDefects.map(e=>e.id);K.value=F.value.filter(e=>!s.includes(e.id)),C.value=[],x.value=!1},200),M.value=!0},le=s=>{C.value=s},de=()=>{const s=F.value.filter(e=>C.value.includes(e.id));l.relatedDefects.push(...s),M.value=!1,L.success(`已添加 ${s.length} 个不良现象`)},se=s=>{l.relatedDefects.splice(s,1)},ne=()=>{A.push("/inspection-model/inspection-items")},oe=async()=>{var s;try{N.value=!0,await((s=O.value)==null?void 0:s.validate()),w.value||(l.orgId=S.value),L.success("保存成功"),A.push("/inspection-model/inspection-items")}catch{L.error("请完善必填项")}finally{N.value=!1}},ie=()=>{F.value=[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"},{id:"103",code:"DEF-003",name:"裂纹",severity:"CR",description:"产品裂纹"},{id:"104",code:"DEF-004",name:"变形",severity:"MA",description:"产品变形"},{id:"105",code:"DEF-005",name:"色差",severity:"MI",description:"颜色不均匀"},{id:"106",code:"DEF-006",name:"尺寸超差",severity:"MA",description:"尺寸超出公差范围"},{id:"107",code:"DEF-007",name:"硬度不足",severity:"CR",description:"硬度低于标准值"}];const s=q.params.id;if(s){const _={1:{id:"1",orgId:null,code:"ITEM-G-LENGTH",name:"长度检测",category:"dimension",dataType:"quantitative",uom:"mm",defaultMethodId:"101",defaultMethodName:"卡尺测量法",defaultInstTypeId:"201",defaultInstTypeName:"0-150mm 数显卡尺",isLabTestDefault:!1,isSpcDefault:!0,description:"集团标准长度检测项目",status:"enabled",relatedDefects:[{id:"106",code:"DEF-006",name:"尺寸超差",severity:"MA",description:"尺寸超出公差范围"}]},2:{id:"2",orgId:null,code:"ITEM-G-HARDNESS",name:"洛氏硬度",category:"physical_chemical",dataType:"quantitative",uom:"HRC",defaultMethodId:"102",defaultMethodName:"硬度计测量",defaultInstTypeId:"202",defaultInstTypeName:"洛氏硬度计",isLabTestDefault:!0,isSpcDefault:!0,description:"集团标准硬度检测",status:"enabled",relatedDefects:[{id:"107",code:"DEF-007",name:"硬度不足",severity:"CR",description:"硬度低于标准值"}]},3:{id:"3",orgId:"1",code:"ITEM-HF-SURFACE",name:"表面外观检查",category:"appearance",dataType:"qualitative",uom:"",defaultMethodId:"103",defaultMethodName:"目视检查",defaultInstTypeId:void 0,defaultInstTypeName:"",isLabTestDefault:!1,isSpcDefault:!1,description:"合肥工厂本地外观检查",status:"enabled",relatedDefects:[{id:"101",code:"DEF-001",name:"表面划伤",severity:"MI",description:"可见划痕"},{id:"102",code:"DEF-002",name:"气孔",severity:"MA",description:"表面密集气孔"}]},4:{id:"4",orgId:"1",code:"ITEM-HF-COATING",name:"涂层厚度",category:"dimension",dataType:"quantitative",uom:"μm",defaultMethodId:"104",defaultMethodName:"涂层测厚仪",defaultInstTypeId:"203",defaultInstTypeName:"涂层测厚仪",isLabTestDefault:!1,isSpcDefault:!0,description:"合肥工厂专用涂层检测",status:"enabled",relatedDefects:[]},5:{id:"5",orgId:"1",code:"ITEM-HF-SALT",name:"盐雾测试",category:"functional",dataType:"qualitative",uom:"",defaultMethodId:"105",defaultMethodName:"盐雾试验法",defaultInstTypeId:void 0,defaultInstTypeName:"",isLabTestDefault:!0,isSpcDefault:!1,description:"合肥工厂特殊测试项目",status:"disabled",relatedDefects:[]}}[s];_&&Object.assign(l,_)}else l.orgId=S.value};return Ie(()=>{ie()}),(s,e)=>{const _=o("a-button"),I=o("a-tag"),ue=o("a-alert"),R=o("a-input"),c=o("a-form-item"),p=o("a-col"),v=o("a-select-option"),T=o("a-select"),k=o("a-row"),V=o("a-switch"),re=o("a-textarea"),ce=o("a-form"),B=o("a-card"),G=o("a-table"),pe=o("a-empty"),fe=o("a-tab-pane"),ve=o("a-tabs"),me=o("a-modal");return u(),b("div",we,[h("div",Me,[h("div",Ce,[t(_,{type:"text",onClick:ne,class:"back-button"},{icon:a(()=>[t(P(Te))]),default:a(()=>[e[13]||(e[13]=n(" 返回 ",-1))]),_:1}),h("div",Ee,[h("h2",qe,g($.value),1),l.orgId===null?(u(),m(I,{key:0,color:"gold"},{default:a(()=>[...e[14]||(e[14]=[n("集团标准",-1)])]),_:1})):(u(),m(I,{key:1,color:"blue"},{default:a(()=>[...e[15]||(e[15]=[n("本地标准",-1)])]),_:1})),l.dataType?(u(),m(I,{key:2,color:X(l.dataType)},{default:a(()=>[n(g(Y(l.dataType)),1)]),_:1},8,["color"])):y("",!0)])]),!i.value&&!r.value?(u(),b("div",Se,[t(_,{type:"primary",onClick:oe,loading:N.value},{default:a(()=>[...e[16]||(e[16]=[n("保存",-1)])]),_:1},8,["loading"])])):y("",!0),r.value&&!i.value?(u(),b("div",Ne,[t(ue,{message:"集团标准项目对工厂用户只读，如需修改请联系集团管理员",type:"warning","show-icon":""})])):y("",!0)]),t(B,{class:"form-card",title:"基本信息"},{default:a(()=>[t(ce,{ref_key:"formRef",ref:O,model:l,rules:J,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[t(k,{gutter:24},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(c,{label:"项目编码",name:"code"},{default:a(()=>[t(R,{value:l.code,"onUpdate:value":e[0]||(e[0]=d=>l.code=d),disabled:i.value||w.value||r.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(c,{label:"项目名称",name:"name"},{default:a(()=>[t(R,{value:l.name,"onUpdate:value":e[1]||(e[1]=d=>l.name=d),disabled:i.value||r.value,placeholder:"请输入"},null,8,["value","disabled"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(c,{label:"分类",name:"category"},{default:a(()=>[t(T,{value:l.category,"onUpdate:value":e[2]||(e[2]=d=>l.category=d),disabled:i.value||r.value,placeholder:"请选择"},{default:a(()=>[t(v,{value:"dimension"},{default:a(()=>[...e[17]||(e[17]=[n("尺寸",-1)])]),_:1}),t(v,{value:"appearance"},{default:a(()=>[...e[18]||(e[18]=[n("外观",-1)])]),_:1}),t(v,{value:"physical_chemical"},{default:a(()=>[...e[19]||(e[19]=[n("理化",-1)])]),_:1}),t(v,{value:"functional"},{default:a(()=>[...e[20]||(e[20]=[n("功能",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:24},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(c,{label:"数据类型",name:"dataType"},{default:a(()=>[t(T,{value:l.dataType,"onUpdate:value":e[3]||(e[3]=d=>l.dataType=d),disabled:i.value||r.value,placeholder:"请选择",onChange:Z},{default:a(()=>[t(v,{value:"quantitative"},{default:a(()=>[...e[21]||(e[21]=[n("计量型",-1)])]),_:1}),t(v,{value:"qualitative"},{default:a(()=>[...e[22]||(e[22]=[n("计数型",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(c,{label:"单位",name:"uom",rules:l.dataType==="quantitative"?[{required:!0,message:"计量型必填单位"}]:[]},{default:a(()=>[t(R,{value:l.uom,"onUpdate:value":e[4]||(e[4]=d=>l.uom=d),disabled:i.value||r.value||l.dataType==="qualitative",placeholder:l.dataType==="quantitative"?"必填":"计数型无需单位"},null,8,["value","disabled","placeholder"])]),_:1},8,["rules"])]),_:1}),t(p,{span:8},{default:a(()=>[t(c,{label:"状态",name:"status"},{default:a(()=>[t(T,{value:l.status,"onUpdate:value":e[5]||(e[5]=d=>l.status=d),disabled:i.value||r.value},{default:a(()=>[t(v,{value:"enabled"},{default:a(()=>[...e[23]||(e[23]=[n("启用",-1)])]),_:1}),t(v,{value:"disabled"},{default:a(()=>[...e[24]||(e[24]=[n("禁用",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:24},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(c,{label:"默认检验方法",name:"defaultMethodId"},{default:a(()=>[t(T,{value:l.defaultMethodId,"onUpdate:value":e[6]||(e[6]=d=>l.defaultMethodId=d),disabled:i.value||r.value,placeholder:"请选择","allow-clear":""},{default:a(()=>[(u(!0),b(U,null,j(Q.value,d=>(u(),m(v,{key:d.id,value:d.id},{default:a(()=>[n(g(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(c,{label:"默认量检具类型",name:"defaultInstTypeId"},{default:a(()=>[t(T,{value:l.defaultInstTypeId,"onUpdate:value":e[7]||(e[7]=d=>l.defaultInstTypeId=d),disabled:i.value||r.value,placeholder:"请选择","allow-clear":""},{default:a(()=>[(u(!0),b(U,null,j(W.value,d=>(u(),m(v,{key:d.id,value:d.id},{default:a(()=>[n(g(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:24},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(c,{label:"默认送实验室"},{default:a(()=>[t(V,{checked:l.isLabTestDefault,"onUpdate:checked":e[8]||(e[8]=d=>l.isLabTestDefault=d),disabled:i.value||r.value,"checked-children":"是","un-checked-children":"否"},null,8,["checked","disabled"])]),_:1})]),_:1}),t(p,{span:8},{default:a(()=>[t(c,{label:"默认启用SPC"},{default:a(()=>[t(V,{checked:l.isSpcDefault,"onUpdate:checked":e[9]||(e[9]=d=>l.isSpcDefault=d),disabled:i.value||r.value,"checked-children":"是","un-checked-children":"否"},null,8,["checked","disabled"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:24},{default:a(()=>[t(p,{span:16},{default:a(()=>[t(c,{label:"描述",name:"description","label-col":{span:3},"wrapper-col":{span:20}},{default:a(()=>[t(re,{value:l.description,"onUpdate:value":e[10]||(e[10]=d=>l.description=d),disabled:i.value||r.value,rows:2,placeholder:"请输入描述"},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(B,{class:"tab-card"},{default:a(()=>[t(ve,{activeKey:z.value,"onUpdate:activeKey":e[11]||(e[11]=d=>z.value=d)},{default:a(()=>[t(fe,{key:"defects",tab:"关联不良现象（默认）"},{default:a(()=>[!i.value&&!r.value?(u(),b("div",xe,[t(_,{type:"primary",size:"small",onClick:ae},{default:a(()=>[t(P(ke)),e[25]||(e[25]=n(" 添加关联 ",-1))]),_:1}),e[26]||(e[26]=h("span",{class:"tab-tip"},"提示：此处配置的默认不良现象将在添加到检验模板时自动带入",-1))])):y("",!0),t(G,{columns:ee,"data-source":l.relatedDefects,"row-key":"id",size:"small",pagination:!1},{bodyCell:a(({column:d,record:D,index:ye})=>[d.key==="severity"?(u(),m(I,{key:0,color:H(D.severity)},{default:a(()=>[n(g(D.severity),1)]),_:2},1032,["color"])):d.key==="action"?(u(),b(U,{key:1},[!i.value&&!r.value?(u(),m(_,{key:0,type:"link",danger:"",size:"small",onClick:Ue=>se(ye)},{default:a(()=>[...e[27]||(e[27]=[n("移除",-1)])]),_:1},8,["onClick"])):y("",!0)],64)):y("",!0)]),_:1},8,["data-source"]),l.relatedDefects.length===0?(u(),m(pe,{key:1,description:"暂无关联不良现象，请添加"})):y("",!0)]),_:1})]),_:1},8,["activeKey"])]),_:1}),t(me,{visible:M.value,"onUpdate:visible":e[12]||(e[12]=d=>M.value=d),title:"选择不良现象",width:"600px",onOk:de},{default:a(()=>[t(G,{columns:te,"data-source":K.value,loading:x.value,"row-key":"id",size:"small","row-selection":{selectedRowKeys:C.value,onChange:le}},{bodyCell:a(({column:d,record:D})=>[d.key==="severity"?(u(),m(I,{key:0,color:H(D.severity)},{default:a(()=>[n(g(D.severity),1)]),_:2},1032,["color"])):y("",!0)]),_:1},8,["data-source","loading","row-selection"])]),_:1},8,["visible"])])}}}),Oe=he(Fe,[["__scopeId","data-v-b6115e8c"]]);export{Oe as default};
