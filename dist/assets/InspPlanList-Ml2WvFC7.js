import{d as me,r as D,a as R,m as fe,c as j,e as L,x as t,q as a,s as r,o as O,h as s,y,P as ve,G as ce,I as ge,R as Ce,p as w,f as F,t as T,F as ye,Y as _e,a2 as Oe,u as Ie,C as v,M as S}from"./index-BhbkSrG8.js";import{E as be}from"./ExportOutlined-iuxpVXnR.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"page-container"},Re={class:"toolbar"},we={class:"table-container"},Te={class:"copy-source-label"},Pe=me({__name:"InspPlanList",setup(xe){const P=Ie(),q={ORG001:"合肥工厂",ORG002:"芜湖工厂",ORG003:"宁波工厂"},G=[{value:"GROUP",label:"集团（通用）"},{value:"ORG001",label:"合肥工厂"},{value:"ORG002",label:"芜湖工厂"},{value:"ORG003",label:"宁波工厂"}],K=G,U=l=>l===null?"集团":q[l]??l,x=D(!1),c=D([]),_=D([]),n=R({planCode:"",planName:"",version:"",status:void 0,orgIds:[]}),I=R({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),Y=[{title:"方案编码",dataIndex:"planCode",key:"planCode",width:180},{title:"方案名称",dataIndex:"planName",key:"planName",width:220},{title:"版本",dataIndex:"version",key:"version",width:80},{title:"归属",key:"orgId",width:100},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"检验类型",dataIndex:"inspType",key:"inspType",width:100},{title:"关联模板",dataIndex:"templateName",key:"templateName",width:160},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:160},{title:"操作",key:"action",width:200,fixed:"right"}],H=l=>({DRAFT:"default",IN_APPROVAL:"processing",APPROVED:"success",OBSOLETE:"error"})[l]||"default",A=l=>({DRAFT:"草稿",IN_APPROVAL:"审批中",APPROVED:"已批准",OBSOLETE:"已作废"})[l]||l,M=[{id:"601",planCode:"IP-HFC-CASTING",planName:"合肥工厂-压铸件通用方案",version:"V1.0",orgId:"ORG001",status:"APPROVED",inspType:"IPQC",templateName:"IPQC过程检验模板",updateTime:"2026-01-10 10:00"},{id:"602",planCode:"IQC-A-L1",planName:"来料抽样加严L1",version:"V1.2",orgId:null,status:"DRAFT",inspType:"IQC",templateName:"IQC原材料检验模板",updateTime:"2026-01-12 14:30"},{id:"603",planCode:"FQC-MOTOR-001",planName:"电机成品检验方案",version:"V2.0",orgId:"ORG002",status:"IN_APPROVAL",inspType:"FQC",templateName:"FQC成品检验模板",updateTime:"2026-01-11 09:15"},{id:"604",planCode:"OQC-EXPORT-001",planName:"出口产品检验方案",version:"V1.0",orgId:null,status:"OBSOLETE",inspType:"OQC",templateName:"OQC出货检验模板",updateTime:"2025-12-20 16:00"},{id:"605",planCode:"IQC-NB-COMMON",planName:"宁波工厂-来料通用方案",version:"V1.0",orgId:"ORG003",status:"APPROVED",inspType:"IQC",templateName:"IQC原材料检验模板",updateTime:"2026-01-08 09:00"}],b=()=>{x.value=!0,setTimeout(()=>{let l=[...M];n.planCode&&(l=l.filter(e=>e.planCode.includes(n.planCode))),n.planName&&(l=l.filter(e=>e.planName.includes(n.planName))),n.version&&(l=l.filter(e=>e.version.includes(n.version))),n.status&&(l=l.filter(e=>e.status===n.status)),n.orgIds.length>0&&(l=l.filter(e=>!!(n.orgIds.includes("GROUP")&&e.orgId===null||e.orgId!==null&&n.orgIds.includes(e.orgId)))),c.value=l,I.total=l.length,x.value=!1},300)},Q=()=>{I.current=1,b()},J=()=>{n.planCode="",n.planName="",n.version="",n.status=void 0,n.orgIds=[],Q()},W=l=>{I.current=l.current,I.pageSize=l.pageSize,b()},X=l=>{_.value=l},Z=()=>{P.push("/inspection-model/insp-plans/create")},ee=l=>{P.push(`/inspection-model/insp-plans/view/${l.id}`)},$=l=>{const e=l!=null&&l.id?l:c.value.find(u=>u.id===_.value[0]);if(e){if(e.status!=="DRAFT"){v.warning("只有草稿状态的方案可以编辑");return}if(e.orgId===null){v.warning("集团级方案不可直接编辑，请复制为本地方案后修改");return}P.push(`/inspection-model/insp-plans/edit/${e.id}`)}},te=()=>{const l=c.value.filter(e=>_.value.includes(e.id)&&e.status==="DRAFT"&&e.orgId!==null);if(l.length===0){v.warning("只有草稿状态的本地方案可以删除");return}S.confirm({title:"确认删除",content:`确定删除选中的 ${l.length} 条草稿方案吗？`,okType:"danger",onOk(){c.value=c.value.filter(e=>!l.map(u=>u.id).includes(e.id)),_.value=[],v.success("删除成功")}})},g=R({visible:!1,source:null}),d=R({planCode:"",planName:"",orgId:void 0,version:"V1.0"});function le(l){g.source=l,d.planCode=l.planCode+"-COPY",d.planName=l.planName+"（副本）",d.orgId=l.orgId??"ORG001",d.version="V1.0",g.visible=!0}function ae(){if(!d.planCode.trim()||!d.planName.trim()||!d.orgId){v.error("请填写完整的目标编码、名称和归属组织");return}const l={...g.source,id:`copy-${Date.now()}`,planCode:d.planCode,planName:d.planName,orgId:d.orgId==="GROUP"?null:d.orgId,version:d.version,status:"DRAFT",updateTime:new Date().toLocaleString("zh-CN",{hour12:!1}).replace(/\//g,"-").slice(0,16)};M.unshift(l),b(),g.visible=!1,v.success(`方案已复制为「${d.planName}」（草稿），可到列表中继续编辑`)}const ne=(l,e)=>{if(e==="copy"){le(l);return}if(e==="delete"){if(l.orgId===null){v.warning("集团级方案不允许删除");return}S.confirm({title:"确认删除",content:`确定删除方案 ${l.planName} 吗？`,okType:"danger",onOk(){c.value=c.value.filter(f=>f.id!==l.id),v.success("删除成功")}});return}const C={submit:"IN_APPROVAL",approve:"APPROVED",obsolete:"OBSOLETE"}[e];C&&S.confirm({title:"确认操作",content:`确定将方案 ${l.planName} 的状态变更为 ${A(C)} 吗？`,onOk(){l.status=C,v.success("状态变更成功")}})},oe=()=>{const l=["方案编码","方案名称","版本","归属","状态","检验类型","关联模板","更新时间"],e=c.value.map(i=>[i.planCode,i.planName,i.version,i.orgId===null?"集团":U(i.orgId),A(i.status),i.inspType,i.templateName,i.updateTime]),u=`<table><thead><tr>${l.map(i=>`<th>${i}</th>`).join("")}</tr></thead><tbody>${e.map(i=>`<tr>${i.map(k=>`<td>${String(k).replace(/&/g,"&amp;").replace(/</g,"&lt;")}</td>`).join("")}</tr>`).join("")}</tbody></table>`,C=new Blob(["\uFEFF"+u],{type:"application/vnd.ms-excel"}),f=URL.createObjectURL(C),m=document.createElement("a");m.href=f,m.download="检验方案.xls",m.click(),URL.revokeObjectURL(f),v.success("导出成功")};return fe(()=>{b()}),(l,e)=>{const u=r("a-button"),C=r("a-space"),f=r("a-input"),m=r("a-form-item"),i=r("a-select-option"),k=r("a-select"),B=r("a-form"),se=r("a-card"),E=r("a-tag"),h=r("a-divider"),N=r("a-menu-item"),z=r("a-menu-divider"),de=r("a-menu"),ie=r("a-dropdown"),ue=r("a-table"),pe=r("a-alert"),re=r("a-modal");return O(),j("div",Ne,[L("div",Re,[t(C,null,{default:a(()=>[t(u,{type:"primary",onClick:Z},{icon:a(()=>[t(y(ve))]),default:a(()=>[e[10]||(e[10]=s("新增 ",-1))]),_:1}),t(u,{disabled:_.value.length!==1,onClick:$},{icon:a(()=>[t(y(ce))]),default:a(()=>[e[11]||(e[11]=s("编辑 ",-1))]),_:1},8,["disabled"]),t(u,{danger:"",disabled:_.value.length===0,onClick:te},{icon:a(()=>[t(y(ge))]),default:a(()=>[e[12]||(e[12]=s("删除 ",-1))]),_:1},8,["disabled"]),t(u,{onClick:oe},{icon:a(()=>[t(y(be))]),default:a(()=>[e[13]||(e[13]=s("导出 ",-1))]),_:1}),t(u,{onClick:b},{icon:a(()=>[t(y(Ce))]),default:a(()=>[e[14]||(e[14]=s("刷新 ",-1))]),_:1})]),_:1})]),t(se,{class:"search-card",bordered:!1},{default:a(()=>[t(B,{layout:"inline",model:n},{default:a(()=>[t(m,{label:"方案编码"},{default:a(()=>[t(f,{value:n.planCode,"onUpdate:value":e[0]||(e[0]=o=>n.planCode=o),placeholder:"请输入","allow-clear":"",style:{width:"160px"}},null,8,["value"])]),_:1}),t(m,{label:"方案名称"},{default:a(()=>[t(f,{value:n.planName,"onUpdate:value":e[1]||(e[1]=o=>n.planName=o),placeholder:"请输入","allow-clear":"",style:{width:"200px"}},null,8,["value"])]),_:1}),t(m,{label:"版本"},{default:a(()=>[t(f,{value:n.version,"onUpdate:value":e[2]||(e[2]=o=>n.version=o),placeholder:"如：V1.0","allow-clear":"",style:{width:"100px"}},null,8,["value"])]),_:1}),t(m,{label:"状态"},{default:a(()=>[t(k,{value:n.status,"onUpdate:value":e[3]||(e[3]=o=>n.status=o),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(i,{value:"DRAFT"},{default:a(()=>[...e[15]||(e[15]=[s("草稿",-1)])]),_:1}),t(i,{value:"IN_APPROVAL"},{default:a(()=>[...e[16]||(e[16]=[s("审批中",-1)])]),_:1}),t(i,{value:"APPROVED"},{default:a(()=>[...e[17]||(e[17]=[s("已批准",-1)])]),_:1}),t(i,{value:"OBSOLETE"},{default:a(()=>[...e[18]||(e[18]=[s("已作废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{label:"归属组织"},{default:a(()=>[t(k,{value:n.orgIds,"onUpdate:value":e[4]||(e[4]=o=>n.orgIds=o),mode:"multiple",style:{"min-width":"200px","max-width":"300px"},"allow-clear":"",placeholder:"不限（全部）",options:G,"max-tag-count":2},null,8,["value"])]),_:1}),t(m,null,{default:a(()=>[t(u,{type:"primary",onClick:Q},{default:a(()=>[...e[19]||(e[19]=[s("查询",-1)])]),_:1}),t(u,{style:{"margin-left":"8px"},onClick:J},{default:a(()=>[...e[20]||(e[20]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),L("div",we,[t(ue,{columns:Y,"data-source":c.value,loading:x.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:_.value,onChange:X},pagination:I,onChange:W},{bodyCell:a(({column:o,record:p})=>[o.key==="status"?(O(),w(E,{key:0,color:H(p.status)},{default:a(()=>[s(T(A(p.status)),1)]),_:2},1032,["color"])):F("",!0),o.key==="orgId"?(O(),j(ye,{key:1},[p.orgId===null?(O(),w(E,{key:0,color:"gold"},{default:a(()=>[...e[21]||(e[21]=[s("集团",-1)])]),_:1})):(O(),w(E,{key:1,color:"cyan"},{default:a(()=>[s(T(U(p.orgId)),1)]),_:2},1024))],64)):F("",!0),o.key==="action"?(O(),w(C,{key:2},{default:a(()=>[t(u,{type:"link",size:"small",onClick:V=>ee(p)},{default:a(()=>[...e[22]||(e[22]=[s("查看",-1)])]),_:1},8,["onClick"]),t(h,{type:"vertical"}),t(u,{type:"link",size:"small",onClick:V=>$(p),disabled:p.status!=="DRAFT"||p.orgId===null},{default:a(()=>[...e[23]||(e[23]=[s("编辑",-1)])]),_:1},8,["onClick","disabled"]),t(h,{type:"vertical"}),t(ie,null,{overlay:a(()=>[t(de,{onClick:V=>ne(p,V.key)},{default:a(()=>[t(N,{key:"submit",disabled:p.status!=="DRAFT"},{default:a(()=>[...e[25]||(e[25]=[s("提交审批",-1)])]),_:1},8,["disabled"]),t(N,{key:"approve",disabled:p.status!=="IN_APPROVAL"},{default:a(()=>[...e[26]||(e[26]=[s("审批通过",-1)])]),_:1},8,["disabled"]),t(N,{key:"obsolete",disabled:p.status==="OBSOLETE"},{default:a(()=>[...e[27]||(e[27]=[s("作废",-1)])]),_:1},8,["disabled"]),t(z),t(N,{key:"copy"},{default:a(()=>[t(y(Oe)),e[28]||(e[28]=s(" 复制方案 ",-1))]),_:1}),t(z),t(N,{key:"delete",danger:"",disabled:p.status!=="DRAFT"||p.orgId===null},{default:a(()=>[...e[29]||(e[29]=[s("删除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onClick"])]),default:a(()=>[t(u,{type:"link",size:"small"},{default:a(()=>[e[24]||(e[24]=s(" 更多 ",-1)),t(y(_e))]),_:1})]),_:2},1024)]),_:2},1024)):F("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(re,{open:g.visible,"onUpdate:open":e[9]||(e[9]=o=>g.visible=o),title:"复制方案","ok-text":"确认复制","cancel-text":"取消",onOk:ae},{default:a(()=>[t(pe,{type:"info","show-icon":"",style:{"margin-bottom":"16px"}},{message:a(()=>[...e[30]||(e[30]=[s(" 复制将创建一个独立的草稿方案，包含原方案的所有检验项目明细，可在此基础上修改。 ",-1)])]),_:1}),t(B,{model:d,"label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[t(m,{label:"源方案"},{default:a(()=>{var o,p;return[L("span",Te,T((o=g.source)==null?void 0:o.planCode)+" - "+T((p=g.source)==null?void 0:p.planName),1)]}),_:1}),t(m,{label:"目标编码",required:""},{default:a(()=>[t(f,{value:d.planCode,"onUpdate:value":e[5]||(e[5]=o=>d.planCode=o),placeholder:"新方案编码，需唯一"},null,8,["value"])]),_:1}),t(m,{label:"目标名称",required:""},{default:a(()=>[t(f,{value:d.planName,"onUpdate:value":e[6]||(e[6]=o=>d.planName=o),placeholder:"新方案名称"},null,8,["value"])]),_:1}),t(m,{label:"归属组织",required:""},{default:a(()=>[t(k,{value:d.orgId,"onUpdate:value":e[7]||(e[7]=o=>d.orgId=o),placeholder:"选择新方案所属组织",options:y(K)},null,8,["value","options"])]),_:1}),t(m,{label:"新版本"},{default:a(()=>[t(f,{value:d.version,"onUpdate:value":e[8]||(e[8]=o=>d.version=o),placeholder:"如: V1.0"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}}),De=ke(Pe,[["__scopeId","data-v-d209eaa6"]]);export{De as default};
