import{d as W,a as U,r as L,m as X,c as $,e as x,x as s,q as t,s as p,C as u,o as d,h as o,y as z,P as Y,R as Z,S as ee,p as i,f as k,t as w,F as te,z as ae,u as se}from"./index-C4MSyl8P.js";import{g as oe,p as le,a as ne,d as re}from"./updateLog-D3R9GQcA.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"update-log-container"},ie={class:"toolbar"},pe={class:"search-form"},fe={class:"table-container"},ce=W({__name:"UpdateLog",setup(ye){const b=se(),n=U({page:1,pageSize:20,version:"",updateType:void 0,status:void 0,keyword:""}),T=L([]),h=L(!1),c=U({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条记录`}),I=[{title:"版本号",dataIndex:"version",key:"version",width:120},{title:"标题",dataIndex:"title",key:"title",ellipsis:!0},{title:"更新类型",dataIndex:"updateType",key:"updateType",width:100},{title:"影响模块",dataIndex:"affectedModules",key:"affectedModules",width:200},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"发布时间",dataIndex:"publishedAt",key:"publishedAt",width:180,customRender:({text:a})=>a?new Date(a).toLocaleString("zh-CN"):"-"},{title:"操作",key:"action",width:250,fixed:"right"}],y=async()=>{h.value=!0;try{const a={...n,page:c.current,pageSize:c.pageSize},e=await oe(a);e.success?(T.value=e.data.list,c.total=e.data.total):u.error(e.message)}catch(a){u.error("加载数据失败"),console.error(a)}finally{h.value=!1}},R=()=>{c.current=1,y()},N=()=>{n.version="",n.updateType=void 0,n.status=void 0,n.keyword="",c.current=1,y()},V=()=>{y()},B=a=>{c.current=a.current,c.pageSize=a.pageSize,y()},D=()=>{b.push("/system/update-log/create")},A=a=>{b.push(`/system/update-log/detail/${a.id}`)},F=a=>{b.push(`/system/update-log/edit/${a.id}`)},O=async a=>{try{const e=await le(a.id);e.success?(u.success("发布成功"),y()):u.error(e.message)}catch(e){u.error("发布失败"),console.error(e)}},P=async a=>{try{const e=await ne(a.id);e.success?(u.success("归档成功"),y()):u.error(e.message)}catch(e){u.error("归档失败"),console.error(e)}},E=async a=>{try{const e=await re(a.id);e.success?(u.success("删除成功"),y()):u.error(e.message)}catch(e){u.error("删除失败"),console.error(e)}},q=a=>({feature:"green",fix:"orange",optimize:"blue",breaking:"red"})[a]||"default",J=a=>({feature:"新功能",fix:"修复",optimize:"优化",breaking:"重大变更"})[a]||a,Q=a=>({draft:"default",published:"success",archived:"warning"})[a]||"default",j=a=>({draft:"草稿",published:"已发布",archived:"已归档"})[a]||a;return X(()=>{y()}),(a,e)=>{const f=p("a-button"),C=p("a-space"),M=p("a-input"),g=p("a-form-item"),m=p("a-select-option"),S=p("a-select"),G=p("a-form"),_=p("a-tag"),H=p("a-popconfirm"),K=p("a-table");return d(),$("div",ue,[x("div",ie,[s(C,null,{default:t(()=>[s(f,{type:"primary",onClick:D},{icon:t(()=>[s(z(Y))]),default:t(()=>[e[4]||(e[4]=o(" 新增更新日志 ",-1))]),_:1}),s(f,{onClick:V},{icon:t(()=>[s(z(Z))]),default:t(()=>[e[5]||(e[5]=o(" 刷新 ",-1))]),_:1})]),_:1})]),x("div",pe,[s(G,{layout:"inline",model:n},{default:t(()=>[s(g,{label:"版本号"},{default:t(()=>[s(M,{value:n.version,"onUpdate:value":e[0]||(e[0]=r=>n.version=r),placeholder:"请输入版本号",style:{width:"150px"}},null,8,["value"])]),_:1}),s(g,{label:"更新类型"},{default:t(()=>[s(S,{value:n.updateType,"onUpdate:value":e[1]||(e[1]=r=>n.updateType=r),placeholder:"请选择",style:{width:"120px"},"allow-clear":""},{default:t(()=>[s(m,{value:"feature"},{default:t(()=>[...e[6]||(e[6]=[o("新功能",-1)])]),_:1}),s(m,{value:"fix"},{default:t(()=>[...e[7]||(e[7]=[o("修复",-1)])]),_:1}),s(m,{value:"optimize"},{default:t(()=>[...e[8]||(e[8]=[o("优化",-1)])]),_:1}),s(m,{value:"breaking"},{default:t(()=>[...e[9]||(e[9]=[o("重大变更",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s(g,{label:"状态"},{default:t(()=>[s(S,{value:n.status,"onUpdate:value":e[2]||(e[2]=r=>n.status=r),placeholder:"请选择",style:{width:"120px"},"allow-clear":""},{default:t(()=>[s(m,{value:"draft"},{default:t(()=>[...e[10]||(e[10]=[o("草稿",-1)])]),_:1}),s(m,{value:"published"},{default:t(()=>[...e[11]||(e[11]=[o("已发布",-1)])]),_:1}),s(m,{value:"archived"},{default:t(()=>[...e[12]||(e[12]=[o("已归档",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s(g,{label:"关键词"},{default:t(()=>[s(M,{value:n.keyword,"onUpdate:value":e[3]||(e[3]=r=>n.keyword=r),placeholder:"标题或内容",style:{width:"200px"}},null,8,["value"])]),_:1}),s(g,null,{default:t(()=>[s(C,null,{default:t(()=>[s(f,{type:"primary",onClick:R},{icon:t(()=>[s(z(ee))]),default:t(()=>[e[13]||(e[13]=o(" 查询 ",-1))]),_:1}),s(f,{onClick:N},{default:t(()=>[...e[14]||(e[14]=[o("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),x("div",fe,[s(K,{columns:I,"data-source":T.value,loading:h.value,pagination:c,onChange:B,"row-key":"id"},{bodyCell:t(({column:r,record:l})=>[r.key==="version"?(d(),i(_,{key:0,color:"blue"},{default:t(()=>[o(w(l.version),1)]),_:2},1024)):r.key==="updateType"?(d(),i(_,{key:1,color:q(l.updateType)},{default:t(()=>[o(w(J(l.updateType)),1)]),_:2},1032,["color"])):r.key==="status"?(d(),i(_,{key:2,color:Q(l.status)},{default:t(()=>[o(w(j(l.status)),1)]),_:2},1032,["color"])):r.key==="affectedModules"?(d(),i(C,{key:3},{default:t(()=>[(d(!0),$(te,null,ae(l.affectedModules.slice(0,2),v=>(d(),i(_,{key:v},{default:t(()=>[o(w(v),1)]),_:2},1024))),128)),l.affectedModules.length>2?(d(),i(_,{key:0},{default:t(()=>[o(" +"+w(l.affectedModules.length-2),1)]),_:2},1024)):k("",!0)]),_:2},1024)):r.key==="action"?(d(),i(C,{key:4},{default:t(()=>[s(f,{type:"link",size:"small",onClick:v=>A(l)},{default:t(()=>[...e[15]||(e[15]=[o("查看",-1)])]),_:1},8,["onClick"]),l.status==="draft"?(d(),i(f,{key:0,type:"link",size:"small",onClick:v=>F(l)},{default:t(()=>[...e[16]||(e[16]=[o(" 编辑 ",-1)])]),_:1},8,["onClick"])):k("",!0),l.status==="draft"?(d(),i(f,{key:1,type:"link",size:"small",onClick:v=>O(l)},{default:t(()=>[...e[17]||(e[17]=[o(" 发布 ",-1)])]),_:1},8,["onClick"])):k("",!0),l.status==="published"?(d(),i(f,{key:2,type:"link",size:"small",onClick:v=>P(l)},{default:t(()=>[...e[18]||(e[18]=[o(" 归档 ",-1)])]),_:1},8,["onClick"])):k("",!0),l.status==="draft"?(d(),i(H,{key:3,title:"确定要删除这条更新日志吗？",onConfirm:v=>E(l)},{default:t(()=>[s(f,{type:"link",size:"small",danger:""},{default:t(()=>[...e[19]||(e[19]=[o("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])):k("",!0)]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}}),ge=de(ce,[["__scopeId","data-v-a9ebd871"]]);export{ge as default};
