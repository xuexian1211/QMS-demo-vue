import{a as I,r as y,m as pe,c as M,o as b,e as S,x as e,q as a,h as m,y as R,P as $,s as r,p as Y,f as B,t as ce,F as me,z as ve,E as q,C}from"./index-BPMZt9Bz.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"page-container"},_e={class:"page-header"},he={class:"search-form"},ye={__name:"OQCChecklist",setup(be){const p=I({inspectionNo:"",salesOrder:"",customer:"",status:""}),f=y([]),U=y(!1),g=I({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条数据`}),F=[{title:"检验单号",dataIndex:"inspectionNo",key:"inspectionNo",width:140},{title:"销售订单",dataIndex:"salesOrder",key:"salesOrder",width:120},{title:"客户名称",dataIndex:"customer",key:"customer"},{title:"产品编码",dataIndex:"productCode",key:"productCode",width:120},{title:"产品名称",dataIndex:"productName",key:"productName"},{title:"出货数量",dataIndex:"shipmentQuantity",key:"shipmentQuantity",width:100},{title:"检验状态",dataIndex:"status",key:"status",width:100},{title:"检验日期",dataIndex:"inspectionDate",key:"inspectionDate",width:120},{title:"检验员",dataIndex:"inspector",key:"inspector",width:100},{title:"操作",key:"action",width:200,fixed:"right"}],_=y(!1),D=y(!1),O=y(),n=I({id:null,inspectionNo:"",salesOrder:"",inspectionDate:null,customer:"",productCode:"",productName:"",shipmentQuantity:null,sampleQuantity:null,inspector:"",shipmentBatch:"",shippingMethod:"",destination:"",items:[],conclusion:"passed",shipmentDecision:"approved",remark:"",status:"pending"}),T=y([{id:1,name:"客户A"},{id:2,name:"客户B"},{id:3,name:"客户C"}]),j={salesOrder:[{required:!0,message:"请输入销售订单号",trigger:"blur"}],inspectionDate:[{required:!0,message:"请选择检验日期",trigger:"change"}],customer:[{required:!0,message:"请选择客户",trigger:"change"}],productCode:[{required:!0,message:"请输入产品编码",trigger:"blur"}],productName:[{required:!0,message:"请输入产品名称",trigger:"blur"}],shipmentQuantity:[{required:!0,message:"请输入出货数量",trigger:"blur"}],sampleQuantity:[{required:!0,message:"请输入抽样数量",trigger:"blur"}],inspector:[{required:!0,message:"请输入检验员姓名",trigger:"blur"}],shippingMethod:[{required:!0,message:"请选择运输方式",trigger:"change"}],conclusion:[{required:!0,message:"请选择检验结论",trigger:"change"}],shipmentDecision:[{required:!0,message:"请选择出货决定",trigger:"change"}]},V=[{id:1,inspectionNo:"OQC20240115001",salesOrder:"SO20240115001",inspectionDate:"2024-01-15",customer:"客户A",productCode:"PROD001",productName:"产品A",shipmentQuantity:500,sampleQuantity:50,inspector:"张三",shipmentBatch:"SHIP001",shippingMethod:"land",destination:"北京",status:"passed",conclusion:"passed",shipmentDecision:"approved",remark:"检验合格，准予出货"},{id:2,inspectionNo:"OQC20240116001",salesOrder:"SO20240116001",inspectionDate:"2024-01-16",customer:"客户B",productCode:"PROD002",productName:"产品B",shipmentQuantity:300,sampleQuantity:30,inspector:"李四",shipmentBatch:"SHIP002",shippingMethod:"air",destination:"上海",status:"failed",conclusion:"failed",shipmentDecision:"rework",remark:"包装不符合要求，需要重新包装"},{id:3,inspectionNo:"OQC20240117001",salesOrder:"SO20240117001",inspectionDate:"2024-01-17",customer:"客户C",productCode:"PROD003",productName:"产品C",shipmentQuantity:200,sampleQuantity:20,inspector:"王五",shipmentBatch:"SHIP003",shippingMethod:"sea",destination:"广州",status:"pending",conclusion:"passed",shipmentDecision:"approved",remark:""}],A=s=>({pending:"orange",inspecting:"blue",passed:"green",failed:"red"})[s]||"default",E=s=>({pending:"待检验",inspecting:"检验中",passed:"合格",failed:"不合格"})[s]||s,w=()=>{U.value=!0,setTimeout(()=>{f.value=V,g.total=V.length,U.value=!1},500)},z=()=>{g.current=1,w()},H=()=>{p.inspectionNo="",p.salesOrder="",p.customer="",p.status="",z()},J=s=>{g.current=s.current,g.pageSize=s.pageSize,w()},L=()=>{D.value=!1,_.value=!0,x()},G=s=>{D.value=!0,_.value=!0,Object.assign(n,{...s,inspectionDate:s.inspectionDate?q(s.inspectionDate):null,items:s.items||[{category:"",name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""}]})},K=s=>{C.info("查看功能开发中...")},W=s=>{s.status="inspecting",C.success("已开始检验")},X=s=>{const t=f.value.findIndex(c=>c.id===s);t>-1&&(f.value.splice(t,1),g.total--,C.success("删除成功"))},Z=()=>{n.items.push({category:"",name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""})},ee=s=>{n.items.length>1&&n.items.splice(s,1)},te=async()=>{try{if(await O.value.validate(),D.value){const s=f.value.findIndex(t=>t.id===n.id);s>-1&&(f.value[s]={...n,inspectionDate:n.inspectionDate?n.inspectionDate.format("YYYY-MM-DD"):null}),C.success("更新成功")}else{const s=Math.max(...f.value.map(d=>d.id))+1,t=`OQC${q().format("YYYYMMDD")}${String(s).padStart(3,"0")}`,c={...n,id:s,inspectionNo:t,inspectionDate:n.inspectionDate?n.inspectionDate.format("YYYY-MM-DD"):q().format("YYYY-MM-DD"),status:"pending"};f.value.unshift(c),g.total++,C.success("创建成功")}_.value=!1,x()}catch(s){console.error("表单验证失败:",s)}},ae=()=>{_.value=!1,x()},x=()=>{var s;Object.assign(n,{id:null,inspectionNo:"",salesOrder:"",inspectionDate:null,customer:"",productCode:"",productName:"",shipmentQuantity:null,sampleQuantity:null,inspector:"",shipmentBatch:"",shippingMethod:"",destination:"",items:[{category:"",name:"",standard:"",unit:"",actualValue:null,result:"pass",remark:""}],conclusion:"passed",shipmentDecision:"approved",remark:"",status:"pending"}),(s=O.value)==null||s.resetFields()};return pe(()=>{w()}),(s,t)=>{const c=r("a-button"),d=r("a-input"),u=r("a-form-item"),k=r("a-select"),P=r("a-form"),le=r("a-tag"),ne=r("a-popconfirm"),se=r("a-space"),oe=r("a-table"),o=r("a-col"),ue=r("a-date-picker"),h=r("a-row"),N=r("a-input-number"),Q=r("a-radio"),ie=r("a-radio-group"),de=r("a-textarea"),re=r("a-modal");return b(),M("div",ge,[S("div",_e,[t[21]||(t[21]=S("h1",null,"出货检验单(OQC)",-1)),e(c,{type:"primary",onClick:L},{icon:a(()=>[e(R($))]),default:a(()=>[t[20]||(t[20]=m(" 新建检验单 ",-1))]),_:1})]),S("div",he,[e(P,{layout:"inline",model:p},{default:a(()=>[e(u,{label:"检验单号"},{default:a(()=>[e(d,{value:p.inspectionNo,"onUpdate:value":t[0]||(t[0]=l=>p.inspectionNo=l),placeholder:"请输入检验单号"},null,8,["value"])]),_:1}),e(u,{label:"销售订单"},{default:a(()=>[e(d,{value:p.salesOrder,"onUpdate:value":t[1]||(t[1]=l=>p.salesOrder=l),placeholder:"请输入销售订单号"},null,8,["value"])]),_:1}),e(u,{label:"客户名称"},{default:a(()=>[e(d,{value:p.customer,"onUpdate:value":t[2]||(t[2]=l=>p.customer=l),placeholder:"请输入客户名称"},null,8,["value"])]),_:1}),e(u,{label:"检验状态"},{default:a(()=>[e(k,{value:p.status,"onUpdate:value":t[3]||(t[3]=l=>p.status=l),placeholder:"请选择检验状态",style:{width:"120px"},options:[{value:"pending",label:"待检验"},{value:"inspecting",label:"检验中"},{value:"passed",label:"合格"},{value:"failed",label:"不合格"}]},null,8,["value"])]),_:1}),e(u,null,{default:a(()=>[e(c,{type:"primary",onClick:z},{default:a(()=>[...t[22]||(t[22]=[m("查询",-1)])]),_:1}),e(c,{style:{"margin-left":"8px"},onClick:H},{default:a(()=>[...t[23]||(t[23]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(oe,{columns:F,"data-source":f.value,pagination:g,loading:U.value,onChange:J,"row-key":"id"},{bodyCell:a(({column:l,record:v})=>[l.key==="status"?(b(),Y(le,{key:0,color:A(v.status)},{default:a(()=>[m(ce(E(v.status)),1)]),_:2},1032,["color"])):B("",!0),l.key==="action"?(b(),Y(se,{key:1},{default:a(()=>[e(c,{type:"link",size:"small",onClick:i=>G(v)},{default:a(()=>[...t[24]||(t[24]=[m("编辑",-1)])]),_:1},8,["onClick"]),e(c,{type:"link",size:"small",onClick:i=>K(v)},{default:a(()=>[...t[25]||(t[25]=[m("查看",-1)])]),_:1},8,["onClick"]),v.status==="pending"?(b(),Y(c,{key:0,type:"link",size:"small",onClick:i=>W(v)},{default:a(()=>[...t[26]||(t[26]=[m(" 开始检验 ",-1)])]),_:1},8,["onClick"])):B("",!0),e(ne,{title:"确定要删除这个检验单吗？",onConfirm:i=>X(v.id)},{default:a(()=>[e(c,{type:"link",size:"small",danger:""},{default:a(()=>[...t[27]||(t[27]=[m("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):B("",!0)]),_:1},8,["data-source","pagination","loading"]),e(re,{visible:_.value,"onUpdate:visible":t[19]||(t[19]=l=>_.value=l),title:D.value?"编辑检验单":"新建检验单",width:"1100px",onOk:te,onCancel:ae},{default:a(()=>[e(P,{ref_key:"formRef",ref:O,model:n,rules:j,layout:"vertical"},{default:a(()=>[e(h,{gutter:16},{default:a(()=>[e(o,{span:8},{default:a(()=>[e(u,{label:"检验单号",name:"inspectionNo"},{default:a(()=>[e(d,{value:n.inspectionNo,"onUpdate:value":t[4]||(t[4]=l=>n.inspectionNo=l),placeholder:"系统自动生成",disabled:""},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"销售订单",name:"salesOrder"},{default:a(()=>[e(d,{value:n.salesOrder,"onUpdate:value":t[5]||(t[5]=l=>n.salesOrder=l),placeholder:"请输入销售订单号"},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"检验日期",name:"inspectionDate"},{default:a(()=>[e(ue,{value:n.inspectionDate,"onUpdate:value":t[6]||(t[6]=l=>n.inspectionDate=l),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(h,{gutter:16},{default:a(()=>[e(o,{span:8},{default:a(()=>[e(u,{label:"客户名称",name:"customer"},{default:a(()=>[e(k,{value:n.customer,"onUpdate:value":t[7]||(t[7]=l=>n.customer=l),placeholder:"请选择客户","show-search":"",options:T.value.map(l=>({value:l.name,label:l.name}))},null,8,["value","options"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"产品编码",name:"productCode"},{default:a(()=>[e(d,{value:n.productCode,"onUpdate:value":t[8]||(t[8]=l=>n.productCode=l),placeholder:"请输入产品编码"},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"产品名称",name:"productName"},{default:a(()=>[e(d,{value:n.productName,"onUpdate:value":t[9]||(t[9]=l=>n.productName=l),placeholder:"请输入产品名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(h,{gutter:16},{default:a(()=>[e(o,{span:8},{default:a(()=>[e(u,{label:"出货数量",name:"shipmentQuantity"},{default:a(()=>[e(N,{value:n.shipmentQuantity,"onUpdate:value":t[10]||(t[10]=l=>n.shipmentQuantity=l),placeholder:"请输入出货数量",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"抽样数量",name:"sampleQuantity"},{default:a(()=>[e(N,{value:n.sampleQuantity,"onUpdate:value":t[11]||(t[11]=l=>n.sampleQuantity=l),placeholder:"请输入抽样数量",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"检验员",name:"inspector"},{default:a(()=>[e(d,{value:n.inspector,"onUpdate:value":t[12]||(t[12]=l=>n.inspector=l),placeholder:"请输入检验员姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(h,{gutter:16},{default:a(()=>[e(o,{span:8},{default:a(()=>[e(u,{label:"出货批次",name:"shipmentBatch"},{default:a(()=>[e(d,{value:n.shipmentBatch,"onUpdate:value":t[13]||(t[13]=l=>n.shipmentBatch=l),placeholder:"请输入出货批次号"},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"运输方式",name:"shippingMethod"},{default:a(()=>[e(k,{value:n.shippingMethod,"onUpdate:value":t[14]||(t[14]=l=>n.shippingMethod=l),placeholder:"请选择运输方式",options:[{value:"land",label:"陆运"},{value:"sea",label:"海运"},{value:"air",label:"空运"},{value:"express",label:"快递"}]},null,8,["value"])]),_:1})]),_:1}),e(o,{span:8},{default:a(()=>[e(u,{label:"目的地",name:"destination"},{default:a(()=>[e(d,{value:n.destination,"onUpdate:value":t[15]||(t[15]=l=>n.destination=l),placeholder:"请输入目的地"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(u,{label:"检验项目",name:"items"},{default:a(()=>[(b(!0),M(me,null,ve(n.items,(l,v)=>(b(),M("div",{key:v,class:"inspection-item"},[e(h,{gutter:8},{default:a(()=>[e(o,{span:3},{default:a(()=>[e(d,{value:l.category,"onUpdate:value":i=>l.category=i,placeholder:"类别"},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:4},{default:a(()=>[e(d,{value:l.name,"onUpdate:value":i=>l.name=i,placeholder:"检验项目"},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:3},{default:a(()=>[e(d,{value:l.standard,"onUpdate:value":i=>l.standard=i,placeholder:"标准值"},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:2},{default:a(()=>[e(d,{value:l.unit,"onUpdate:value":i=>l.unit=i,placeholder:"单位"},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:2},{default:a(()=>[e(N,{value:l.actualValue,"onUpdate:value":i=>l.actualValue=i,placeholder:"实测值",style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:2},{default:a(()=>[e(k,{value:l.result,"onUpdate:value":i=>l.result=i,placeholder:"结果",options:[{value:"pass",label:"合格"},{value:"fail",label:"不合格"}]},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:4},{default:a(()=>[e(d,{value:l.remark,"onUpdate:value":i=>l.remark=i,placeholder:"备注"},null,8,["value","onUpdate:value"])]),_:2},1024),e(o,{span:2},{default:a(()=>[e(c,{type:"text",danger:"",onClick:i=>ee(v)},{default:a(()=>[...t[28]||(t[28]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),e(c,{type:"dashed",onClick:Z,style:{width:"100%","margin-top":"8px"}},{icon:a(()=>[e(R($))]),default:a(()=>[t[29]||(t[29]=m(" 添加检验项目 ",-1))]),_:1})]),_:1}),e(h,{gutter:16},{default:a(()=>[e(o,{span:12},{default:a(()=>[e(u,{label:"检验结论",name:"conclusion"},{default:a(()=>[e(ie,{value:n.conclusion,"onUpdate:value":t[16]||(t[16]=l=>n.conclusion=l)},{default:a(()=>[e(Q,{value:"passed"},{default:a(()=>[...t[30]||(t[30]=[m("合格",-1)])]),_:1}),e(Q,{value:"failed"},{default:a(()=>[...t[31]||(t[31]=[m("不合格",-1)])]),_:1}),e(Q,{value:"conditional"},{default:a(()=>[...t[32]||(t[32]=[m("有条件接收",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(o,{span:12},{default:a(()=>[e(u,{label:"出货决定",name:"shipmentDecision"},{default:a(()=>[e(k,{value:n.shipmentDecision,"onUpdate:value":t[17]||(t[17]=l=>n.shipmentDecision=l),placeholder:"请选择出货决定",options:[{value:"approved",label:"准予出货"},{value:"conditional",label:"有条件出货"},{value:"rejected",label:"拒绝出货"},{value:"rework",label:"返工后出货"}]},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(u,{label:"备注",name:"remark"},{default:a(()=>[e(de,{value:n.remark,"onUpdate:value":t[18]||(t[18]=l=>n.remark=l),rows:3,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}},De=fe(ye,[["__scopeId","data-v-d822b69f"]]);export{De as default};
