import{d as fe,r as C,a as q,m as ve,c as K,e as r,x as t,q as a,s as i,o as T,h as n,y as O,P as ye,G as _e,I as ge,R as Ce,p as R,f as D,t as f,Y as Te,F as Oe,z as ce,u as ke,C as v,M as E}from"./index-BPMZt9Bz.js";import{E as Ie}from"./ExportOutlined-D_JI9KKd.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"page-container"},be={class:"toolbar"},Re={class:"table-container"},Ee={class:"history-version-dot"},Ve=fe({__name:"InspTemplateList",setup(Ae){const I=ke(),V=C(!1),m=C([]),y=C([]),P=C(!1),S=C([]),w=C(null),s=q({orgId:void 0,inspType:void 0,code:"",name:"",status:void 0,version:""}),c=q({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0}),J=[{title:"所属组织",dataIndex:"orgName",key:"orgName",width:100},{title:"模板编码",dataIndex:"code",key:"code",width:140},{title:"模板名称",dataIndex:"name",key:"name",width:180},{title:"检验类型",dataIndex:"inspType",key:"inspType",width:90},{title:"版本",dataIndex:"version",key:"version",width:70},{title:"状态",dataIndex:"status",key:"status",width:90},{title:"明细数",dataIndex:"detailCount",key:"detailCount",width:80},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:150},{title:"操作",key:"action",width:200,fixed:"right"}],N=l=>({DRAFT:"default",IN_APPROVAL:"processing",APPROVED:"success",OBSOLETE:"error"})[l]||"default",A=l=>({DRAFT:"草稿",IN_APPROVAL:"审批中",APPROVED:"已批准",OBSOLETE:"已作废"})[l]||l,b=()=>{V.value=!0,setTimeout(()=>{let l=[{id:"1",orgId:"ORG001",orgName:"集团",code:"TPL-IQC-001",name:"IQC原材料检验模板",version:"V1.0",status:"APPROVED",inspType:"IQC",detailCount:5,updateTime:"2026-01-10 10:00"},{id:"2",orgId:"ORG002",orgName:"芜湖工厂",code:"TPL-IPQC-001",name:"IPQC过程检验模板",version:"V2.0",status:"DRAFT",inspType:"IPQC",detailCount:8,updateTime:"2026-01-12 14:30"},{id:"3",orgId:"ORG003",orgName:"合肥工厂",code:"TPL-FQC-001",name:"FQC成品检验模板",version:"V1.0",status:"IN_APPROVAL",inspType:"FQC",detailCount:10,updateTime:"2026-01-11 09:15"},{id:"4",orgId:"ORG002",orgName:"芜湖工厂",code:"TPL-OQC-001",name:"OQC出货检验模板",version:"V1.0",status:"OBSOLETE",inspType:"OQC",detailCount:6,updateTime:"2025-12-20 16:00"},{id:"5",orgId:"ORG001",orgName:"集团",code:"TPL-IQC-002",name:"IQC电子元器件检验模板",version:"V1.0",status:"APPROVED",inspType:"IQC",detailCount:12,updateTime:"2026-01-15 08:00"},{id:"6",orgId:"ORG003",orgName:"合肥工厂",code:"TPL-IPQC-002",name:"IPQC焊接工序检验模板",version:"V1.0",status:"APPROVED",inspType:"IPQC",detailCount:6,updateTime:"2026-01-08 11:00"}];s.orgId&&(l=l.filter(e=>e.orgId===s.orgId)),s.inspType&&(l=l.filter(e=>e.inspType===s.inspType)),s.code&&(l=l.filter(e=>e.code.includes(s.code))),s.name&&(l=l.filter(e=>e.name.includes(s.name))),s.status&&(l=l.filter(e=>e.status===s.status)),s.version&&(l=l.filter(e=>e.version.includes(s.version))),m.value=l,c.total=l.length,V.value=!1},300)},F=()=>{c.current=1,b()},Y=()=>{s.orgId=void 0,s.inspType=void 0,s.code="",s.name="",s.status=void 0,s.version="",F()},j=l=>{c.current=l.current,c.pageSize=l.pageSize,b()},W=l=>{y.value=l},X=()=>{I.push("/inspection-model/insp-templates/create")},Z=l=>{I.push(`/inspection-model/insp-templates/view/${l.id}`)},B=l=>{const e=l!=null&&l.id?l:m.value.find(d=>d.id===y.value[0]);if(e){if(e.status!=="Draft"){v.warning("只有草稿状态的模板可以编辑");return}I.push(`/inspection-model/insp-templates/edit/${e.id}`)}},h=()=>{const l=m.value.filter(e=>y.value.includes(e.id)&&e.status==="Draft");if(l.length===0){v.warning("只有草稿状态的模板可以删除");return}E.confirm({title:"确认删除",content:`确定删除选中的 ${l.length} 条草稿模板吗？`,okType:"danger",onOk(){m.value=m.value.filter(e=>!l.map(d=>d.id).includes(e.id)),y.value=[],v.success("删除成功")}})},ee=(l,e)=>{if(e==="history"){w.value=l,S.value=[{id:"h1",version:"V2.0",status:"APPROVED",updateTime:"2026-01-10 10:00",updater:"张三",changeSummary:"增加硬度检验项目"},{id:"h2",version:"V1.1",status:"OBSOLETE",updateTime:"2025-12-15 14:00",updater:"李四",changeSummary:"调整抽样规则为 AQL 0.65"},{id:"h3",version:"V1.0",status:"OBSOLETE",updateTime:"2025-11-01 09:00",updater:"王五",changeSummary:"初始版本创建"}],P.value=!0;return}if(e==="copy"){v.success(`模板 ${l.code} 已复制`);return}if(e==="delete"){E.confirm({title:"确认删除",content:`确定删除模板 ${l.name} 吗？`,okType:"danger",onOk(){m.value=m.value.filter(d=>d.id!==l.id),v.success("删除成功")}});return}E.confirm({title:"确认操作",content:`确定将模板 ${l.name} 的状态变更为 ${A(e)} 吗？`,onOk(){l.status=e,v.success("状态变更成功")}})},te=l=>({DRAFT:"gray",IN_APPROVAL:"blue",APPROVED:"green",OBSOLETE:"red"})[l]||"gray",ae=l=>{var e;I.push(`/inspection-model/insp-templates/view/${(e=w.value)==null?void 0:e.id}?version=${l.version}`)},le=l=>{E.confirm({title:"恢复版本",content:`确定基于 ${l.version} 创建新版本吗？这将创建一个草稿状态的新版本。`,onOk(){v.success(`已基于 ${l.version} 创建新版本草稿`),P.value=!1}})},ne=()=>{v.success("导出任务已开始")};return ve(()=>{b()}),(l,e)=>{const d=i("a-button"),$=i("a-space"),p=i("a-select-option"),x=i("a-select"),_=i("a-form-item"),Q=i("a-input"),se=i("a-form"),z=i("a-card"),G=i("a-tag"),M=i("a-divider"),g=i("a-menu-item"),U=i("a-menu-divider"),oe=i("a-menu"),ie=i("a-dropdown"),de=i("a-table"),ue=i("a-alert"),k=i("a-col"),H=i("a-row"),re=i("a-timeline-item"),pe=i("a-timeline"),me=i("a-modal");return T(),K("div",we,[r("div",be,[t($,null,{default:a(()=>[t(d,{type:"primary",onClick:X},{icon:a(()=>[t(O(ye))]),default:a(()=>[e[7]||(e[7]=n("新增 ",-1))]),_:1}),t(d,{disabled:y.value.length!==1,onClick:B},{icon:a(()=>[t(O(_e))]),default:a(()=>[e[8]||(e[8]=n("编辑 ",-1))]),_:1},8,["disabled"]),t(d,{danger:"",disabled:y.value.length===0,onClick:h},{icon:a(()=>[t(O(ge))]),default:a(()=>[e[9]||(e[9]=n("删除 ",-1))]),_:1},8,["disabled"]),t(d,{onClick:ne},{icon:a(()=>[t(O(Ie))]),default:a(()=>[e[10]||(e[10]=n("导出 ",-1))]),_:1}),t(d,{onClick:b},{icon:a(()=>[t(O(Ce))]),default:a(()=>[e[11]||(e[11]=n("刷新 ",-1))]),_:1})]),_:1})]),t(z,{class:"search-card",bordered:!1},{default:a(()=>[t(se,{layout:"inline",model:s},{default:a(()=>[t(_,{label:"所属组织"},{default:a(()=>[t(x,{value:s.orgId,"onUpdate:value":e[0]||(e[0]=o=>s.orgId=o),style:{width:"150px"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(p,{value:"ORG001"},{default:a(()=>[...e[12]||(e[12]=[n("集团",-1)])]),_:1}),t(p,{value:"ORG002"},{default:a(()=>[...e[13]||(e[13]=[n("芜湖工厂",-1)])]),_:1}),t(p,{value:"ORG003"},{default:a(()=>[...e[14]||(e[14]=[n("合肥工厂",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(_,{label:"检验类型"},{default:a(()=>[t(x,{value:s.inspType,"onUpdate:value":e[1]||(e[1]=o=>s.inspType=o),style:{width:"120px"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(p,{value:"IQC"},{default:a(()=>[...e[15]||(e[15]=[n("IQC来料",-1)])]),_:1}),t(p,{value:"IPQC"},{default:a(()=>[...e[16]||(e[16]=[n("IPQC过程",-1)])]),_:1}),t(p,{value:"FQC"},{default:a(()=>[...e[17]||(e[17]=[n("FQC成品",-1)])]),_:1}),t(p,{value:"OQC"},{default:a(()=>[...e[18]||(e[18]=[n("OQC出货",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(_,{label:"模板编码"},{default:a(()=>[t(Q,{value:s.code,"onUpdate:value":e[2]||(e[2]=o=>s.code=o),placeholder:"请输入","allow-clear":"",style:{width:"120px"}},null,8,["value"])]),_:1}),t(_,{label:"模板名称"},{default:a(()=>[t(Q,{value:s.name,"onUpdate:value":e[3]||(e[3]=o=>s.name=o),placeholder:"请输入","allow-clear":"",style:{width:"150px"}},null,8,["value"])]),_:1}),t(_,{label:"状态"},{default:a(()=>[t(x,{value:s.status,"onUpdate:value":e[4]||(e[4]=o=>s.status=o),style:{width:"100px"},"allow-clear":"",placeholder:"请选择"},{default:a(()=>[t(p,{value:"DRAFT"},{default:a(()=>[...e[19]||(e[19]=[n("草稿",-1)])]),_:1}),t(p,{value:"IN_APPROVAL"},{default:a(()=>[...e[20]||(e[20]=[n("审批中",-1)])]),_:1}),t(p,{value:"APPROVED"},{default:a(()=>[...e[21]||(e[21]=[n("已批准",-1)])]),_:1}),t(p,{value:"OBSOLETE"},{default:a(()=>[...e[22]||(e[22]=[n("已作废",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(_,{label:"版本"},{default:a(()=>[t(Q,{value:s.version,"onUpdate:value":e[5]||(e[5]=o=>s.version=o),placeholder:"如：V1.0","allow-clear":"",style:{width:"80px"}},null,8,["value"])]),_:1}),t(_,null,{default:a(()=>[t(d,{type:"primary",onClick:F},{default:a(()=>[...e[23]||(e[23]=[n("查询",-1)])]),_:1}),t(d,{style:{"margin-left":"8px"},onClick:Y},{default:a(()=>[...e[24]||(e[24]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),r("div",Re,[t(de,{columns:J,"data-source":m.value,loading:V.value,"row-key":"id",size:"middle","row-selection":{selectedRowKeys:y.value,onChange:W},pagination:c,onChange:j},{bodyCell:a(({column:o,record:u})=>[o.key==="status"?(T(),R(G,{key:0,color:N(u.status)},{default:a(()=>[n(f(A(u.status)),1)]),_:2},1032,["color"])):D("",!0),o.key==="action"?(T(),R($,{key:1},{default:a(()=>[t(d,{type:"link",size:"small",onClick:L=>Z(u)},{default:a(()=>[...e[25]||(e[25]=[n("查看",-1)])]),_:1},8,["onClick"]),t(M,{type:"vertical"}),t(d,{type:"link",size:"small",onClick:L=>B(u),disabled:u.status!=="DRAFT"},{default:a(()=>[...e[26]||(e[26]=[n("编辑",-1)])]),_:1},8,["onClick","disabled"]),t(M,{type:"vertical"}),t(ie,null,{overlay:a(()=>[t(oe,{onClick:L=>ee(u,L.key)},{default:a(()=>[t(g,{key:"IN_APPROVAL",disabled:u.status!=="DRAFT"},{default:a(()=>[...e[28]||(e[28]=[n("提交审批",-1)])]),_:1},8,["disabled"]),t(g,{key:"APPROVED",disabled:u.status!=="IN_APPROVAL"},{default:a(()=>[...e[29]||(e[29]=[n("审批通过",-1)])]),_:1},8,["disabled"]),t(g,{key:"OBSOLETE",disabled:u.status==="OBSOLETE"},{default:a(()=>[...e[30]||(e[30]=[n("作废",-1)])]),_:1},8,["disabled"]),t(U),t(g,{key:"history"},{default:a(()=>[...e[31]||(e[31]=[n("查看历史版本",-1)])]),_:1}),t(g,{key:"copy"},{default:a(()=>[...e[32]||(e[32]=[n("复制模板",-1)])]),_:1}),t(U),t(g,{key:"delete",danger:"",disabled:u.status!=="DRAFT"},{default:a(()=>[...e[33]||(e[33]=[n("删除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onClick"])]),default:a(()=>[t(d,{type:"link",size:"small"},{default:a(()=>[e[27]||(e[27]=n(" 更多 ",-1)),t(O(Te))]),_:1})]),_:2},1024)]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading","row-selection","pagination"])]),t(me,{visible:P.value,"onUpdate:visible":e[6]||(e[6]=o=>P.value=o),title:"历史版本",width:"850px",footer:null},{default:a(()=>[t(ue,{type:"info","show-icon":"",style:{"margin-bottom":"16px"}},{message:a(()=>{var o,u;return[e[34]||(e[34]=n(" 模板编码：",-1)),r("strong",null,f((o=w.value)==null?void 0:o.code),1),e[35]||(e[35]=n("  |  名称：",-1)),r("strong",null,f((u=w.value)==null?void 0:u.name),1)]}),_:1}),t(pe,{mode:"left"},{default:a(()=>[(T(!0),K(Oe,null,ce(S.value,o=>(T(),R(re,{key:o.id,color:te(o.status)},{dot:a(()=>[r("div",Ee,f(o.version),1)]),default:a(()=>[t(z,{size:"small",bordered:!1,class:"history-card"},{default:a(()=>[t(H,{gutter:16},{default:a(()=>[t(k,{span:6},{default:a(()=>[e[36]||(e[36]=r("span",{class:"history-label"},"状态",-1)),t(G,{color:N(o.status)},{default:a(()=>[n(f(A(o.status)),1)]),_:2},1032,["color"])]),_:2},1024),t(k,{span:6},{default:a(()=>[e[37]||(e[37]=r("span",{class:"history-label"},"更新时间",-1)),r("span",null,f(o.updateTime),1)]),_:2},1024),t(k,{span:4},{default:a(()=>[e[38]||(e[38]=r("span",{class:"history-label"},"操作人",-1)),r("span",null,f(o.updater),1)]),_:2},1024),t(k,{span:8},{default:a(()=>[e[39]||(e[39]=r("span",{class:"history-label"},"变更摘要",-1)),r("span",null,f(o.changeSummary||"-"),1)]),_:2},1024)]),_:2},1024),t(H,{style:{"margin-top":"8px"}},{default:a(()=>[t(k,{span:24,style:{"text-align":"right"}},{default:a(()=>[t(d,{type:"link",size:"small",onClick:u=>ae(o)},{default:a(()=>[...e[40]||(e[40]=[n("查看详情",-1)])]),_:1},8,["onClick"]),o.status==="OBSOLETE"?(T(),R(d,{key:0,type:"link",size:"small",onClick:u=>le(o)},{default:a(()=>[...e[41]||(e[41]=[n("恢复此版本",-1)])]),_:1},8,["onClick"])):D("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["color"]))),128))]),_:1})]),_:1},8,["visible"])])}}}),De=Pe(Ve,[["__scopeId","data-v-731f4cc0"]]);export{De as default};
