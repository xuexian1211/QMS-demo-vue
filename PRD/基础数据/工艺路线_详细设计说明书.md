# 工艺路线管理 (Process Route) - 详细设计文档

## 1. 模块概述
**模块名称**：工艺路线与工序检验挂载管理
**所属子系统**：基础数据 / IPQC模块 (过程检验)
**目标**：统筹定义某一款产品对应的完整生产流转工艺过程。它是车间 IPQC (过程检验)、首检、末检的锚点基座。通过该模型可以在特定的工序卡点强行织入检验逻辑。

## 2. 界面布局与交互设计
### 2.1 主子表联动网格 (Master-Detail Grid)
- **主表视图**：提供工艺路线的基础清单（包括编码、路线名称、挂接物料编号及目前管控状态）。
- **嵌套行展开视图 (`expandedRowRender`)**：利用 Vue 的 Table Slot 机制，实现点击主表某路线的”+”展开后，无需跳转即可全景预览属于该关联项的所有**工序明细表 (Steps)**。

### 2.2 复杂页签式表单 (Tabbed Modal Forms)
新增与编辑器抛弃了堆叠平铺，改用 `a-tabs` 结构：
- **Tab 1: 基本信息**：填写路线的纲领信息与多版本（`Version`）号控制字段。同时可在这里挂接需要此条工艺的对应物料产品。
- **Tab 2: 工序明细**：
  - 属于动态行联动的内嵌编辑表格。
  - 支持随时通过 `handleAddStep` 插入新工序。
  - 内嵌输入框管理其：序号 (opSeq)、工序工步名称 (opName) 及对应的 工作段 (workCenter)。

### 2.3 高阶路由重定向编辑
- 除了 Modal 快捷编辑，还设计了跨路由挂载项（在操作列加入了专用的编辑、查看超链接，触发 `vue-router` 跳转到高等级的全屏级详情页面`/basic-data/process-route/edit/:id` 进行重量级排布修改）。

## 3. 核心功能设计
### 3.1 工序的检验组装插拔 (Inspection Configuration)
在 Tab 2 工序明细维护中，核心杀手锏功能：
- 单层工序列具有“检验配置”能力。
- 前端显性放置 `FirstInsp` (首件校验)、`PatrolInsp` (巡检校验)、`FinalInsp` (末件校验) 的彩色能力标识微标签 (Tags)。
- 提供【配置】按钮，它触发引荐组件 `<OperationInspConfigModal>`，实现在特定的一条工艺序位内注入不同维度的抽样或必检计划模板联动。

### 3.2 灵活的路线与物料结合
- **下拉模糊过滤物料**：`a-select` 中启用 `show-search` 并且实现了自定义了 `filter-option` 回调逻辑，支撑跨数层级的下拉联想补全。
- 一条工艺路线可以服务于某些特性类同的多个SKU或独立使用。支持强大的版本管控（如新路线验证期设为 Draft 草稿，确认量产设为 Active 生效）。

## 4. 数据模型 (Data Model)
核心属于典型的【主从表设计】(1对多)：

**主实体 `Route Master`**:
- `id`: 表记录主键
- `code`: 工艺唯一编码
- `name`: 工艺名称
- `materialId`: 默认适配挂载的产品外键
- `version`: 生效版本号控制 (如 V1.0、V2.0)
- `description`: 技术备忘信息
- `status`: 生命周期（`Draft` / `Active` / `Obsolete`）

**子实体 `Route Steps` (工序)**:
- `id`: 工步内码
- `opSeq`: 技术加工执行流水序号 (10, 20, 30 ...用以留空插位)
- `opName`: 工艺名 (如：压铸、熔炼、组装)
- `workCenter`: 要求生产落地的实际车间/机器设备组识别号
- `hasFirstInsp` / `hasPatrolInsp` / `hasFinalInsp`: 是否挂载三检配置规则的布尔标记位 (Boolean)

## 5. 约束与规则
- **序列排序约束**：进入的生产操作时序(`opSeq`)应该符合自增要求（非必须连续，但业务上需要）。
- **生效态数据拦截**：如果一条路线的 `status` 为已生效运行 (`Active`) ，修改其底下的抽检首检校验计划必须伴有高等级放行或直接拦截提示建议升级 `version` 版本以作变动追溯。
