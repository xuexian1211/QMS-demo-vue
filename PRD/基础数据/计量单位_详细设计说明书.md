# 计量单位管理 (Unit Management) - 详细设计文档

## 1. 模块概述
**模块名称**：计量单位管理
**所属子系统**：基础数据管理模块
**目标**：统一定义和管理系统中使用的所有商品、物料及包装的计量单位，支持国际标准的单位类型分类（重量、长度、体积、面积等），并支持设定基准单位及复杂的换算比率，为库存换算、BOM计算及采购入库提供底层支撑。

## 2. 界面布局与交互设计
### 2.1 整体布局
页面采用了标准化的“表单查询 + 工具栏 + 数据表格”三段式卡片布局。

### 2.2 搜索区设计
- **单位编码**：文本检索。
- **单位名称**：文本检索。
- **单位类型**：下拉选择（重量、长度、体积、数量、面积、时间）。
- **状态**：启用/禁用筛选。

### 2.3 数据表格展示
- 关键展示字段包括单位的编码、名称以及分类的单位类型。
- **视觉优化**：利用 `a-tag` 将不同单位类型渲染为不同颜色（例如：重量显示为紫色，长度蓝色，数量绿色等）。
- 增加了“换算基准单位”与“换算系数”两列，以及是否为“首选/基准单位”的标签。

## 3. 核心功能设计
### 3.1 换算基准体系
- **是否基准单位 (`isBaseUnit`)**：表单中可单选，用于定义某一类量的绝对基准（如重量基准为“KG”）。
- **换算基准单位 (`baseUnitId`)**：针对非基准单位，要求必须选择同类型的基准单位进行挂靠关联。
- **换算系数 (`conversionFactor`)**：提供极高精度的数字输入组件，定义1个当前单位等于多少个基准单位（例如，“吨”挂靠“千克”，系数设为 1000）。

### 3.2 CRUD 与批量操作
- **新增/编辑**：由对话框 (Modal) 承接，支持基准单位联动的规则校验。
- **状态管理**：支持单选或批量勾选执行“启用/禁用”操作。
- **导出 (Export)**：工具栏内置导出 CSV 表格能力，方便主数据报表拉取。

## 4. 数据模型 (Data Model)
核心实体 `Unit` 属性定义：
- `id`: 唯一标识符
- `unitCode`: 单位编码（验证规则：大写字母加下划线，如 `KG`, `PCS`）
- `unitName`: 描述名称（如：千克，个）
- `unitType`: 单位类型 (`weight`, `length`, `volume`, `count`, `area`, `time`)
- `baseUnitId`: 换算基准单位 ID（自身外键）
- `conversionFactor`: 换算乘数系数（精确至6位小数）
- `isBaseUnit`: 标识本单位是否作为类型的基准点 (1/0)
- `sortOrder`: 下拉排列顺序
- `description`: 描述说明
- `status`: 生命周期状态

## 5. 约束与规则
- **防呆控制**：同一 `unitType` 分类下，原则上只能有一个启用的基准单位（逻辑实现落地后端时拦截）。
- **递归防范**：在选择 `baseUnitId` 时，可选池需要过滤掉自身，且强制展示 `isBaseUnit=1` 的单位列表，防止出现循环换算定义。
