# 客户档案 (Customer Archive) - 详细设计文档

## 1. 模块概述
**模块名称**：客户档案管理
**所属子系统**：基础数据管理模块
**目标**：维护企业所有客户的主数据信息，支持多组织数据隔离、资质附件管理与批量数据导入，为销售、发货及客诉等后续业务提供基础数据支撑。

## 2. 界面布局与交互设计
### 2.1 整体布局
页面采用标准的“上中下”上下分层布局：
- **顶部查询区 (Search Card)**：提供多种组合查询条件。
- **中部操作栏 (Toolbar)**：提供全局业务操作按钮。
- **下部数据区 (Table Container)**：以分页表格形式展示客户台账列表。

### 2.2 搜索区设计
包含以下检索条件：
- **所属组织**：多选下拉框 (选项：集团、合肥工厂、芜湖工厂)，用于按组织域过滤客户。
- **客户编码**：文本精确/模糊检索。
- **客户名称**：文本精确/模糊检索。
- **客户等级**：下拉选择 (A级、B级、C级)。
- **客户类型**：下拉选择 (国内、海外、内部交易)。
- **状态**：下拉选择 (启用、禁用)。

### 2.3 操作栏设计
- **新增**：打开新增客户的抽屉或弹窗。
- **编辑**：选中单条记录后激活，打开编辑表单。
- **删除**：批量删除选定的记录。
- **状态操作**：下拉菜单支持“批量启用”和“批量禁用”。
- **导入**：下拉菜单包含“下载导入模板”和“上传Excel文件”。
- **导出**：将目前查询结果导出为 Excel。
- **刷新**：重新加载当前表格数据。

## 3. 核心功能设计
### 3.1 多组织支持 (Multi-Organization)
- 在数据模型中增加 `orgId` 字段。
- 列表页展示“所属组织”列，通过 `Tag` 标签使用不同颜色做视觉区分（集团为紫色，合肥工厂为蓝色，芜湖工厂为青色）。
- 搜索表单支持按组织维度圈定数据可见范围。
- 新增/编辑表单中，必须指定该客户档案归属的组织。

### 3.2 资质附件管理
- 在新增及编辑表单中，添加了独立的“资质附件管理”区块。
- 使用 `a-upload` 组件实现多文件上传及列表展示管理。
- 保存时附件记录序列化并随主对象保存。

### 3.3 导入与导出
- **导入**：利用不可见的 `<input type="file">` 实现文件选择，拦截系统默认行为，使用前端 FileReader 解析或上传给后端接口。
- **导出**：封装通用工具方法，将当前在前端的展示数据转换为 CSV 或 Excel 格式供用户下载保存。

## 4. 数据模型 (Data Model)
核心实体 `Customer` 属性定义：
- `id`: 唯一主键
- `orgId`: 所属组织标识 (Group / 1 / 2)
- `customerCode`: 客户编码
- `customerName`: 客户名称
- `customerLevel`: 客户等级
- `customerType`: 客户类型
- `creditLevel`: 信用等级
- `contactPerson`: 联系人
- `phone`: 联系电话
- `address`: 联系地址
- `remark`: 备注
- `status`: 状态 (0: 禁用, 1: 启用)
- `attachments`: 资质附件列表 (Array)

## 5. 约束与规则
- **唯一性约束**：同一组织下的客户编码必须唯一。
- **必填项验证**：所属组织、客户编码、客户名称、联系人等为必填字段。
- **权限控制**：编辑和删除操作需具备对应的数据权限，只能看到分配的组织的数据。
