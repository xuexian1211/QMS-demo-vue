# 量检具台账与类型管理 (Gauge Ledger) - 详细设计文档

## 1. 模块概述
**模块名称**：量检具管理台账与层级树
**所属子系统**：质量主数据模块 (Quality Master Data) / 检验支持模块
**目标**：构建全厂测量系统资产（卡尺、硬度仪、三坐标等设备）的全生命周期管理跟踪卡。支持设备的层级分类、高精度测量属性配置并核心支撑MSA（测量系统分析）的依赖前提和定期设备送校提醒。

## 2. 界面布局与交互设计
### 2.1 “左树右表” 复杂布局 (Split Layout)
页面布局采用了高频的高级左树右表结构：
- **左侧容器 (Left Panel - Tree)**：使用 `a-tree` 组建渲染量检具分类树。
  - 支持节点过滤搜索（如输入“卡尺”过滤树状节点）。
  - 在每个节点上支持悬浮动作组（新增子类、编辑本类、删除大类）。
- **右侧工作台 (Right Panel - Ledger List)**：设备明细列表。
  - 只有在选中左侧设备类目后，右侧才会呈现挂属于此品类或此族系下的设备实体。
  - 带有醒目的表头展示目前选中的大类其精度或“是否需MSA”。

### 2.2 视觉驱动的阈值警告
在量检具中，“校准到期监控”是最为关键的质量管理动作。
- 在表格和详情中渲染 `nextCalDate` 时加入强校验逻辑：
  - 如果日期已逾期 ( `<0 days` )：使用红色警报 `red`
  - 如果在即将逾期范围内 ( `<14 days` )：使用警戒色 `orange`
  - 正常在案：绿色 `green`

## 3. 核心功能设计
### 3.1 量检具类型属性定义 (Gauge Type Tree)
类型不仅仅是个文本标签，他附带两大质量属性：
- `precision` (分辨率/精度)：如0.01mm，这个精度将直接预设到新建的具体卡尺上。
- `isMsaRequired` (是否需要MSA校验)：布尔值控制，如果是，未来在进行 GR&R 试验分析时，该类的设备才会被强制要求挑选出做验证。

### 3.2 周期性校验 (Calibration Cycle)
这部分由核心的生命周期字段控制：
- `status`: 在用、校准中、封存、报废。
- 如果设备状态被标记为`CALIBRATING`(校准中)或`SCRAPPED`(报废)，在检验员准备做 IPQC/OQC 选择所用设备输入时，下拉框会对其进行自动防呆拦截，不可选用。

## 4. 数据模型 (Data Model)
**类型节点实体 (`GaugeType`)**:
- `id`, `parentId`, `typeName`: 维护无限极树的基础。
- `precision`: 缺省精度
- `isMsaRequired`: 强制MSA分析标记

**量检具台账明细 (`GaugeLedger`)**:
- `gaugeNo`: 设备唯一资产编号
- `gaugeName`, `model`, `manufacturer`: 基本名牌参数
- `accuracy`, `resolution`, `measureRange`: 测定边界能力
- `calibrationCycle`: 周期(比如 12个月)
- `lastCalDate`: 上次强检时间
- `nextCalDate`: 证书失效/下次强检时间(触发报警核心字段)
- `status`: 生命周期（`IN_USE`, `CALIBRATING`, `SEALED`, `SCRAPPED`）
- `custodian`, `location`: 物理存放与保管责任追踪。

## 5. 约束与规则
- **强校准阻断**：当 `nextCalDate` 已过期，其对应的台账状态建议必须进入锁定态，不得在生产检验流程的下拉列表中再被选中作为“测定依据”，否则极易导致产品错漏判的质量事故。
- **关联删除限制**：如果要删除左侧树节点类型时，系统必须防呆确保其下面未挂靠任何存量（哪怕是报废的）台账。
