# 质量检验计划与方案方案 (Inspection Plan & Scheme) - 详细设计文档

## 1. 模块概述
**模块名称**：质量检验计划管理 (Inspection Plan/Scheme)
**所属子系统**：质量主数据模块 (Quality Master Data)
**目标**：统筹 IQC、IPQC、FQC 与 OQC 等全工艺制程检验的纲领性顶层设计。它是最重要的高维聚合主数据。它将之前单独定义的【检验项目】、【检验方法】和【AQL 抽样规则】按照某种逻辑组合并打包为一个供一线使用的一体化检验套件。

## 2. 界面布局与交互设计
### 2.1 高级查询与状态总览
使用了完整的查询面版：
- **方案状态过滤**：草稿(Draft), 审批中(In Approval), 已批准(Approved), 已作废(Obsolete)。
- **多组织归属过滤 (`orgIds`)**：支持使用 Multi-select 联合查询多个归属地（集团、合肥工厂等）下的质量预案。

### 2.2 独创的副本复制向导 (Clone/Copy Modal)
由于检验预案往往极其繁复庞大（包含成百上千条特征规格校验），在 UI 交互中设计了专属的【复制方案】组件功能：
- 提供源名称提示。
- 提供输入新的 `目标编码` 和 `目标名称` 的表单卡，并**可以变更归属组织域**（即集团标准的方案允许被轻松复制为特定地方工厂的执行标准草稿）。

## 3. 核心功能设计
### 3.1 工作流级生命周期管理
该页面抛弃了简单的“启用/禁用”，通过引入标准的文件受控审批概念：
1. **DRAFT (草稿)**：系统独家用此状态，保证只有该状态的计划方案可以被“编辑”。
2. **IN_APPROVAL (审批中)**：方案经编撰人员提交后的状态锁定。
3. **APPROVED (执行态/已批准)**：允许被应用到各类产线出货端。一旦进入此状态，本页面内的任何编辑动作都会被直接拉黑防呆，防止执行期篡改标准。
4. **OBSOLETE (作废)**。

### 3.2 集团与工厂层级的重用继承保护（Group vs Factory）
- **隔离规则**：对属于集团级定义 (`orgId === null`) 的原版检验方案，所有厂级质量人员可以在列表中查看，但绝对**不允许直接编辑和删除**（即使用户尝试点击或破解触发编辑API，也会被代码 `canEdit` 或表单级的守卫给拦截）。
- **破局方式**：工厂用户可通过上文提到的**『一键复制』**将高级别通用标准拷贝，衍生出本厂特有的 DRAFT 版再进行改写与使用。

### 3.3 检验明细的模板挂载与深度定制
- **模板引用与快速加载**：在新增或编辑检验方案时，支持在基础信息区域直接关联已配置好的【检验模板 (`templateId`)】。关联后，系统可将该检验模板下挂载的海量“标准检验项明细”一键快速加载、引入到当前检验方案中。
- **自定义后续编辑**：被加载进方案的检验明细，实质上脱离了原模板的强绑定束缚，变为了当前方案的实例级数据。质量主观或测试配置工程师随后可在**方案编辑详情**的“明细列表”页签下，针对这些衍生引入的项目，任意进行继续编辑调整（如设定是否强制实验室测试、单独剥离或增加部分特征），使得计划具备极其灵活的微调能力，兼顾了规范性和灵活性。

## 4. 数据模型 (Data Model)
此页为高维路由枢纽，核心实体 `InspectionPlan` 表字段概念包括：
- `id`: 表主键
- `orgId`: 数据控制域隔离字段
- `planCode`: 检验大纲号
- `planName`: 方案中文全称
- `version`: 技术版本号(管控追溯)
- `inspType`: 检验过程类型（`IQC/IPQC/FQC/OQC`）
- `templateName`: 引用的底层检测表原始模板外键名称
- `status`: 生命周期。

> **关联特性**：在这个抽象记录的下方（通过进入编辑/查看的方案详细页面），将挂接着多对多形态的 `检验特征列表`、对应的 `AQL 放行细则` 以及 `特定料号库` 匹配规则。

## 5. 约束与规则
- **变更追溯**：正在使用的 `APPROVED` 状态绝不允许覆盖修改。任何技术调整必须通过修改原本生成 `OBSOLETE` 或重新生成递进高版本号的副本。
- **引用防呆**：如果某个物料主数据的免检配置或检验绑定已指配到了该方案，则此方案必须处于 `APPROVED` 安全状态。
