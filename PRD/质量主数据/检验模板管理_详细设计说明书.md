# 检验模板管理 (Inspection Template) - 详细设计文档

## 1. 模块概述
**模块名称**：质量检验模板管理 (Inspection Template)
**所属子系统**：质量主数据模块 (Quality Master Data)
**目标**：统一定义各工序、各类型检验（IQC/IPQC/FQC/OQC）在执行检验动作时的具体“表单外观”及验证特征清单。它是连接底层的“检验项目(Inspection Item)”和高层的“检验方案(Inspection Plan)”的中间载体，决定了一线质检员会看到怎样的检测记录页面结构。

## 2. 界面布局与交互设计
### 2.1 高级查询面板
页面顶部区域内置了多维检索栏目，满足快速筛查的需求：
- **组织过滤**：可按照归属地（例如：集团、芜湖工厂、合肥工厂）筛选。
- **阶段过滤**：按照特定的检验阶段 (`IQC来料`, `IPQC过程`, `FQC成品`, `OQC出货`) 进行目标靶向过滤查询。
- **基础状态查询**：内置了类似于生命周期的状态（草稿、审批中、已批准、已作废）筛选器。
 
### 2.2 表格与操作设计
- **丰富的数据列表**：一目了然地展示模板的编码、名称、版本、关联细项数量(`detailCount`)及最新同步状态。
- **受控的操作机制**：操作列遵循了严格的文件受控策略，使用了下拉菜单 (`更多`) 来折叠低频的审批和流转动作操作（“提交审批”、“审批通过”、“历史版本管理”等）。

## 3. 核心功能设计
### 3.1 严格的版本历程追溯台账 (History Version Tracking)
此功能是本页面最大的亮点，引入了深度贴合军工及汽车制造行业要求的 **版本追踪树** 弹窗：
- 用户点击 “查看历史版本”，将弹出带左侧对齐锚点的 `a-timeline` 时间轴。
- 直观渲染该模板的升版历程。包括某版本于何时被谁（Updater）以何种摘要（changeSummary，如：“调整了某项外观不良校验逻辑”）生成。
- **版本快速回滚**：针对作废的历史快照（`OBSOLETE`），提供【恢复此版本】这一快捷路径按钮。此操作并不会去篡改现有生效版本，而是将其底层数据镜像一份，克隆生成最新编号的新一轮 `DRAFT` (草稿)版本，极大地减少了工程师重建模板工作量。

### 3.2 组织下沉体系
- 检验模板同样融入了集团 (`Group`，数据结构里一般表现为 `orgId: 'ORG001'`等类似顶层标识）和工厂 (`Factory`) 两套体系。下级工厂通常不允许直接篡改乃至删除带有上级标识的标准模板定义，仅能将其**复制 (Copy)** 下来做自我工厂级属性扩展。

## 4. 数据模型 (Data Model)
核心实体 `InspectionTemplate` 定义：
- `id`: 表主记录标识
- `orgId`: 指向数据所有的权限组或厂区域内码。
- `code`: 系统内校验或导入时认定的逻辑编码
- `name`: 模板可视化命名（如：IQC电子元器件检验单模板）
- `inspType`: 检验大类域字典标识（`IQC`, `IPQC`, `FQC`, `OQC`）
- `status`: 生命周期（`DRAFT`, `IN_APPROVAL`, `APPROVED`, `OBSOLETE`）
- `version`: 当前生效管控的字面字符串（如：`V1.0`, `V2.1`）
- `detailCount`: 下级装配检测项的数据规模反馈量。

**历史节点模型 (History Node)**:
- `version`: 关联子版本
- `updateTime`, `updater`: 操作归属人日志
- `changeSummary`: 用于技术变更(ECO)关联说明的简讯。

## 5. 约束与规则
- **生命周期锁定 (Status Guard)**：数据在 `DRAFT` (草稿阶段) 才可以做核心编辑 (`handleEdit`) 和清理废除 (`handleDelete`) 的动作。一旦状态机跃迁到其它任何形态，界面即进入强制只读与拦截态。
- **关联锁定限制**：任何处在 `APPROVED` 已发布状态被 `InspPlan` (方案主数据表) 关联依赖的特征模板，必须通过版本升级 (New Version) 的方式处理维护。不允许直接撤下或破坏其内部已装嵌的校验项目，保证历史质检订单打开时的追溯呈现完备性。
