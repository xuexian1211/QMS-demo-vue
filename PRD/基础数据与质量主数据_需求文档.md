# 基础数据与质量主数据模块 - 需求说明书(PRD)

## 1. 概述
本文档基于现已完成的“基础数据”与“质量主数据”系统代码与模块进行梳理生成，旨在固化已有研发成果。同时，结合《舜富QMS系统完整解决方案》的宏观设计，给出当前实现与理想方案之间的差距分析，为下一阶段迭代提供参考。

---

## 2. 差距分析 (Gap Analysis)

对比《解决方案》中涉及主数据相关章节（如分册7、分册8），目前已实现的模块能够支撑核心的前期检验和基础生产管理需求，满足了最核心的质量标准配置，但在更深入的防错预防、智能化方面存在部分缺失需求：

1. **抽样标准的动态检验规则缺失（涉及第17章）**
   - **已实现**：静态的抽样参数配置（支持正常/加严/放宽，支持AQL值及Ac/Re判断）。
   - **缺失点**：缺乏“放宽/加严/正常/免检”之间自动转换的**业务规则引擎与计数器配置**（如：连续10批合格转放宽、连续5批下2批不合格转加严等自动化转移逻辑配置）。
2. **MSA与SPC的深度主数据配置缺失（涉及第16章）**
   - **已实现**：计量器具台账列表（实现基础设备追踪）。
   - **缺失点**：缺乏量具“校准计划模板”与量具“Gage R&R研究”（重复性、再现性分析）的参数化模板配置；缺失SPC相关的控制图类型、控制界限(UCL/LCL)的定义与异常判定规则配置。
3. **QRQC、CAPA配套的基础知识与工作流主数据未完全建立（涉及第9、11、18章）**
   - **说明**：当前已完成基础的缺陷分类（现象与原因），但针对CAPA根因分析（如5Why模板、鱼骨图模板）和QRQC报警级别与多部门团队的基础架构等依赖数据未做体系化的配置页。

3. **基础数据层面的多组织架构支撑缺失 (Multi-Organization)**
   - **已实现**：当前的客户、供应商、物料、工序等基础数据属于扁平化的全局数据，未区分组织维度。
   - **缺失点**：作为集团型制造业，基础数据（特别是物料、BOM、工序）通常存在“集团级主数据”与“工厂级/组织级业务数据”的区别。目前系统缺少了字段级的`orgId`归属隔离机制，以及“分配/下发”至特定厂区的业务逻辑。
4. **进阶业务功能与体验的缺失 (UI及易用性)**
   - **数据导入能力**：当前缺少Excel批量导入功能，导致基础数据初始化工作量大。
   - **分类层级展示**：目前物料分类、缺陷原因分类采用下拉或列表展示，当层级过深时，缺乏高级的“左树右表”布局结构支持。
   - **文件控制流**：客户档案材料（如营业执照）、供应商资质证明（SQE准入证明）目前缺少文件对象存储与附件管理机制集成。

> **结论**：如上所述，在支持基本检验的“人、机、料、法”等静态基础数据上基本满足核心流转需求；但在高阶的动态规则、数据隔离（多组织）以及部分用户体验（如左树右表、附件管理、批量导入）上存在改进空间。

---

## 3. 已实现业务需求列表 (需求清单)

### 3.1 基础数据模块 (Basic Data)

基础数据主要用于规范系统运行所需的静态业务对象，确保后续检验、客诉、供应商分析的一致性。

#### 3.1.1 客户与供应商管理
* **客户档案管理 (CustomerArchive)**：维护企业客户的基本信息和合作状态，支撑OQC阶段及客诉模块的关联。
* **供应商档案管理 (SupplierArchive)**：维护供应商的基本资质、联络人等信息，为IQC来料检验提供货源关联支持。
* **客供关系映射 (CustomerSupplier)**：针对包含特殊供应链关系的企业，维护两者联动的映射结构。

#### 3.1.2 物料与工艺结构
* **物料分类管理 (MaterialCategory)**：支持对物料建立多层级的树状分类体系（如原材料、半成品、成品等）。
* **物料/产品主数据 (MaterialProduct)**：对具体的铝合金、锌合金、外协件及产成品进行编码和业务属性定义。
* **工艺路线管理 (ProcessRoute)**：建立标准工序的先后执行顺序，为IPQC（首件、巡检、末件）提供基于工序的质量控制节点。

#### 3.1.3 生产辅助基础
* **生产班组信息 (ProductionTeam)**：维护各生产车间的班组构成，用于检验任务和生产任务的责任人定界。
* **库位划分 (StorageLocation)**：维护物料的存放区域与货位体系。
* **单位体系 (UnitManagement)**：定义系统的度量衡主数据（如PC、KG、M 等），确保库存、抽样与检验单位的统一。

---

### 3.2 质量主数据模块 (Quality Master Data)

质量主数据聚焦于检验管控所必需的准则和特征，是驱动IQC~OQC四级检验运作的核心引擎。

#### 3.2.1 缺陷定义及管理
* **缺陷现象库 (DefectPhenomenon)**：对可能发生的不良表现（如表面划伤、尺寸超差、压铸气孔等）进行标准化定义，支持多维度查询。
* **缺陷原因库 (DefectCause)**：对触发缺陷的结构性原因建立知识树，便于后续不合格品分析和CAPA追溯。

#### 3.2.2 检验特征基础数据
* **检验项目管理 (InspectionItem)**：定义独立的检验要素（如：外径长度、硬度值、外观颜色），支持集团/多工厂级别的组织隔离。
* **检验方法管理 (InspectionMethod)**：定义对应的测试和测量手段（如三坐标测量、光谱分析、目视检验等）。

#### 3.2.3 抽样体系及判定标准
* **抽样方案配置 (SamplingPlan)**：
  * 支持多维度的抽样模式：基于国标（GB/T 2828.1等）根据批量与AQL自动推导样本量和Ac/Re、固定数量抽样、百分比抽样、全检。
  * 根据检验水平（I、II、III、S1-S4等）和检验类型（正常、加严、放宽）进行全方位判定支持。

#### 3.2.4 检验方案及模板引擎集
* **检验模板设计 (InspTemplate)**：抽象出一套通用的检验标准集合模板，可复用于具备相似特性的产品/物料。
* **检验方案设计 (InspScheme)**：定义了高度灵活的验证逻辑单元，将检验项目、检验方法、相关缺陷代码与抽样方案打包整合。
* **检验计划模型 (InspPlan)**：在检验方案之上绑定触发条件（如特定供应商、特定物料组、具体产线工序等），在执行层指导任务的自动生成逻辑。

#### 3.2.5 器具及仪器设备
* **计量器具台账 (GaugeLedger)**：管理质量检测所涉及的各类量具的状态、检定周期、精度等级及保管员，为后续MSA铺平基础。

---

## 4. 后续演进计划 (Roadmap)

根据GAP分析结果，针对基础数据与质量主数据的演进路线图建议如下：

### 阶段一：动态规则完善 (近期)
* **动态抽样规则引擎**：增加检验批次计数器与转移规则配置模块（支持在正常、加严、放宽、免检间自动转换）。
* **自动化触发集成**：将检验计划与动态抽样规则引擎结合，在生成检验任务时自动推导当前的抽样严格度。

### 阶段二：配置化MSA与SPC (中期)
* **测量系统分析中心**：在现有的计量器具台账基础上，增加Gage R&R研究配置模板与数据采集模型，形成MSA基础配置数据。
* **统计过程控制主数据**：建立SPC控制图类型、判定规则（判异规则）等基础配置，为未来的SPC过程监控做好支撑准备。
* **多组织与权限隔离改造**：在所有基础数据（物料、客户、供应商）中增加 `org_id` 租户级或工厂级隔离，支持按组织查看不同工厂下的物料。

### 阶段三：CAPA及QRQC数据基础建设与UI重构 (远期)
* **高级UI重构与树状结构**：针对含有层级结构的基础数据（如物料分类、缺陷原因等），优化为“左树右表”的左右分栏交互。增加各基础数据的Excel模板下载与批量导入能力。
* **根因分析模型配置**：搭建5Why模板、鱼骨图分类等分析模型基础数据源。
* **高阶报警与工作流策略**：搭建QRQC缺陷分级策略配置，为后续触发不同部门快速响应的报警级别及升级规则打通数据关联。
* **资质附件管理体系**：打通文件服务系统，在供应商、客户档案中集成资质证书附件的上传与有效期预警。
